"use strict";var p=(t,e)=>()=>(e||t((e={exports:{}}).exports,e),e.exports);var te=p((R7,mg)=>{"use strict";var Do=require("path");function _P(t){return t=String(t).toLowerCase(),t==="true"||t==="1"}function bP(t){return t=String(t).toLowerCase(),t==="false"||t==="0"}function yP(t){return!!(t instanceof Error||t&&t.message&&t.stack)}function vP(t,e){let r=0,s=0,n=0,i=0;for(;r<t.length||s<e.length;){if(r<t.length){let o=t[r];switch(o){default:if(s<e.length&&e[s]===o){r++,s++;continue}break;case"?":if(s<e.length){r++,s++;continue}break;case"*":n=r,i=s+1,r++;continue}}if(i>0&&i<=e.length){r=n,s=i;continue}return!1}return!0}function SP(t){let e=t.split(Do.sep),r=e.lastIndexOf("packages");return e.slice(0,r).join(Do.sep)+Do.sep}mg.exports={isTrue:_P,isFalse:bP,isError:yP,globMatch:vP,calculateDDBasePath:SP}});var bg=p((C7,_g)=>{"use strict";var Mo=class{active(){return null}activate(e,r){return typeof r!="function"?r:r()}bind(e,r){return e}};_g.exports=Mo});var Xt=p((O7,yg)=>{"use strict";yg.exports={USER_REJECT:-1,AUTO_REJECT:0,AUTO_KEEP:1,USER_KEEP:2}});var Qt=p((P7,vg)=>{"use strict";var{AUTO_KEEP:qP}=Xt(),Lo=class{constructor(e){e=e||{},this._traceId=e.traceId,this._spanId=e.spanId,this._parentId=e.parentId||null,this._name=e.name,this._isFinished=e.isFinished||!1,this._tags=e.tags||{},this._sampling=Object.assign({},e.sampling),this._baggageItems=e.baggageItems||{},this._traceparent=e.traceparent,this._tracestate=e.tracestate,this._noop=e.noop||null,this._trace=e.trace||{started:[],finished:[],tags:{}}}toTraceId(){return this._traceId.toString(10)}toSpanId(){return this._spanId.toString(10)}toTraceparent(){let e=this._sampling.priority>=qP?"01":"00",r=this._traceId.toBuffer().length<=8&&this._trace.tags["_dd.p.tid"]?this._trace.tags["_dd.p.tid"]+this._traceId.toString(16).padStart(16,"0"):this._traceId.toString(16).padStart(32,"0"),s=this._spanId.toString(16).padStart(16,"0");return`${this._traceparent&&this._traceparent.version||"00"}-${r}-${s}-${e}`}};vg.exports=Lo});var qg=p((N7,Sg)=>{"use strict";var EP=Qt(),TP=Xt(),wP=TP.USER_REJECT,jo=class extends EP{constructor(e){super(e),this._sampling.priority=wP}};Sg.exports=jo});var de=p((D7,wg)=>{"use strict";var{randomFillSync:xP}=require("crypto"),un=4294967296,je=new Uint8Array(8*8192),IP=new Uint8Array(8),AP=Array.prototype.map,kP=t=>`${t<16?"0":""}${t.toString(16)}`,cn=0,Uo=class{constructor(e,r=16){this._isUint64BE=!0,this._buffer=r===16?RP(e):CP(e,r)}toString(e=16){return e===16?PP(this._buffer):OP(this._buffer,e)}toBuffer(){return this._buffer}toArray(){return this._buffer.length===8?this._buffer:this._buffer.slice(-8)}toJSON(){return this.toString()}};function RP(t){if(t==="0")return IP;if(!t)return NP();let e=Math.ceil(t.length/16)*16,r=e/2,s=new Array(r);t=t.padStart(e,"0");for(let n=0;n<r;n++)s[n]=parseInt(t.substring(n*2,n*2+2),16);return s}function CP(t,e){let r=new Array(8),s=t.length,n=0,i=0,o=0;t[0]==="-"&&n++;let a=n;for(;n<s;){let c=parseInt(t[n++],e);if(!(c>=0))break;o=o*e+c,i=i*e+Math.floor(o/un),o%=un}return a&&(i=~i,o?o=un-o:i++),Tg(r,i,0),Tg(r,o,4),r}function OP(t,e){let r=Eg(t,t.length-8),s=Eg(t,t.length-4),n="";for(e=e||10;;){let i=r%e*un+s;if(r=Math.floor(r/e),s=Math.floor(i/e),n=(i%e).toString(e)+n,!r&&!s)break}return n}function PP(t){return AP.call(t,kP).join("")}function NP(){cn===0&&xP(je),cn=(cn+1)%8192;let t=cn*8;return[je[t]&127,je[t+1],je[t+2],je[t+3],je[t+4],je[t+5],je[t+6],je[t+7]]}function Eg(t,e){return t[e+0]*16777216+(t[e+1]<<16)+(t[e+2]<<8)+t[e+3]}function Tg(t,e,r){t[3+r]=e&255,e=e>>8,t[2+r]=e&255,e=e>>8,t[1+r]=e&255,e=e>>8,t[0+r]=e&255}wg.exports=(t,e)=>new Uo(t,e)});var Rg=p((M7,kg)=>{"use strict";var{Channel:DP,channel:Ig}=require("diagnostics_channel"),[MP,LP]=process.versions.node.split("."),xg=new WeakSet,Ag={channel:Ig};MP==="19"&&LP==="9"&&(Ag.channel=function(){let t=Ig.apply(this,arguments);if(!xg.has(t)){let e=t.subscribe,r=t.unsubscribe;t.subscribe=function(){delete t.subscribe,delete t.unsubscribe;let s=e.apply(this,arguments);return this.subscribe(()=>{}),s},t.unsubscribe===DP.prototype.unsubscribe&&(t.unsubscribe=function(){return delete t.subscribe,delete t.unsubscribe,this.subscribe(()=>{}),r.apply(this,arguments)}),xg.add(t)}return t});kg.exports=Ag});var H=p((L7,Cg)=>{"use strict";Cg.exports=Rg()});var Bo=p((j7,Dg)=>{"use strict";var{createHook:jP,executionAsyncResource:UP}=require("async_hooks"),{channel:Pg}=H(),HP=Pg("dd-trace:storage:before"),BP=Pg("dd-trace:storage:after"),Ng=Symbol;function Og(){Ng=new Function("name","return %CreatePrivateSymbol(name)")}try{Og()}catch{try{let e=require("v8");e.setFlagsFromString("--allow-natives-syntax"),Og(),e.setFlagsFromString("--no-allow-natives-syntax")}catch{}}var Ho=class{constructor(){this._ddResourceStore=Ng("ddResourceStore"),this._enabled=!1,this._hook=jP(this._createHook())}disable(){this._enabled&&(this._hook.disable(),this._enabled=!1)}getStore(){return this._enabled?this._executionAsyncResource()[this._ddResourceStore]:void 0}enterWith(e){this._enable();let r=this._executionAsyncResource();r[this._ddResourceStore]=e}run(e,r,...s){this._enable();let n=this._executionAsyncResource(),i=n[this._ddResourceStore];n[this._ddResourceStore]=e;try{return r(...s)}finally{n[this._ddResourceStore]=i}}_createHook(){return{init:this._init.bind(this),before(){HP.publish()},after(){BP.publish()}}}_enable(){this._enabled||(this._enabled=!0,this._hook.enable())}_init(e,r,s,n){let i=this._executionAsyncResource();Object.prototype.hasOwnProperty.call(i,this._ddResourceStore)&&(n[this._ddResourceStore]=i[this._ddResourceStore])}_executionAsyncResource(){return UP()||{}}};Dg.exports=Ho});var Lg=p((U7,Mg)=>{"use strict";var{executionAsyncId:$P}=require("async_hooks"),GP=Bo(),$o=class extends GP{constructor(){super(),this._resources=new Map}disable(){super.disable(),this._resources.clear()}_createHook(){return{...super._createHook(),destroy:this._destroy.bind(this)}}_init(e,r,s,n){super._init.apply(this,arguments),this._resources.set(e,n)}_destroy(e){this._resources.delete(e)}_executionAsyncResource(){let e=$P(),r=this._resources.get(e);return r||this._resources.set(e,r={}),r}};Mg.exports=$o});var jg=p((H7,Go)=>{"use strict";var FP=require("semver"),zP=FP.satisfies(process.versions.node,">=14.5");zP?Go.exports=Bo():Go.exports=Lg()});var I=p((B7,Ug)=>{"use strict";var WP=jg(),VP=new WP;Ug.exports={storage:VP}});var $g=p(($7,Bg)=>{"use strict";var Hg=qg(),KP=de(),{storage:YP}=I(),Fo=class{constructor(e,r){this._store=YP.getStore(),this._noopTracer=e,this._noopContext=this._createContext(r)}context(){return this._noopContext}tracer(){return this._noopTracer}setOperationName(e){return this}setBaggageItem(e,r){return this}getBaggageItem(e){}setTag(e,r){return this}addTags(e){return this}log(){return this}logEvent(){}finish(e){}_createContext(e){let r=KP();return e?new Hg({noop:this,traceId:e._traceId,spanId:r,parentId:e._spanId,baggageItems:Object.assign({},e._baggageItems)}):new Hg({noop:this,traceId:r,spanId:r})}};Bg.exports=Fo});var Fg=p((G7,Gg)=>{"use strict";var JP=bg(),XP=$g(),zo=class{constructor(e){this._scope=new JP,this._span=new XP(this)}trace(e,r,s){return s(this._span,()=>{})}wrap(e,r,s){return s}scope(){return this._scope}getRumData(){return""}setUrl(){}startSpan(e,r){return this._span}inject(e,r,s){}extract(e,r){return this._span.context()}setUser(){return this}};Gg.exports=zo});var Wg=p((F7,zg)=>{"use strict";var Wo=class{trackUserLoginSuccessEvent(){}trackUserLoginFailureEvent(){}trackCustomEvent(){}isUserBlocked(){}blockRequest(){}setUser(){}};zg.exports=Wo});var Ko=p((z7,Vg)=>{"use strict";var QP=Fg(),ZP=Wg(),eN=new QP,tN=new ZP,Vo=class{constructor(){this._tracer=eN,this.appsec=tN}init(){return this}use(){return this}trace(e,r,s){if(s||(s=r,r={}),typeof s=="function")return r=r||{},this._tracer.trace(e,r,s)}wrap(e,r,s){return s||(s=r,r={}),typeof s!="function"?s:(r=r||{},this._tracer.wrap(e,r,s))}setUrl(){return this._tracer.setUrl.apply(this._tracer,arguments),this}startSpan(){return this._tracer.startSpan.apply(this._tracer,arguments)}inject(){return this._tracer.inject.apply(this._tracer,arguments)}extract(){return this._tracer.extract.apply(this._tracer,arguments)}scope(){return this._tracer.scope.apply(this._tracer,arguments)}getRumData(){return this._tracer.getRumData.apply(this._tracer,arguments)}setUser(e){return this.appsec.setUser(e),this}};Vg.exports=Vo});var Yo=p((W7,Yg)=>{"use strict";var{channel:rN}=H(),W={Debug:"debug",Info:"info",Warn:"warn",Error:"error"},Kg=W.Debug,wt={[W.Debug]:pn(W.Debug,20),[W.Info]:pn(W.Info,30),[W.Warn]:pn(W.Warn,40),[W.Error]:pn(W.Error,50)};function pn(t,e){let r=rN(`datadog:log:${t}`);return r.logLevel=e,r}function sN(t){let e;return t&&typeof t=="string"?e=wt[t.toLowerCase().trim()]||wt[Kg]:e=wt[Kg],e.logLevel}Yg.exports={Level:W,getChannelLogLevel:sN,debugChannel:wt[W.Debug],infoChannel:wt[W.Info],warnChannel:wt[W.Warn],errorChannel:wt[W.Error]}});var Qo=p((V7,im)=>{"use strict";var{storage:Jo}=I(),{getChannelLogLevel:Xo,debugChannel:ln,infoChannel:dn,warnChannel:hn,errorChannel:fn}=Yo(),Jg={debug:t=>console.debug(t),info:t=>console.info(t),warn:t=>console.warn(t),error:t=>console.error(t)},xt=!1,st=Jg,Zt=Xo();function gn(t){let e=Jo.getStore();Jo.enterWith({noop:!0}),t(),Jo.enterWith(e)}function nN(){ln.hasSubscribers&&ln.unsubscribe(tm),dn.hasSubscribers&&dn.unsubscribe(em),hn.hasSubscribers&&hn.unsubscribe(Zg),fn.hasSubscribers&&fn.unsubscribe(Qg)}function Xg(t){nN(),t&&(ln.logLevel>=Zt&&ln.subscribe(tm),dn.logLevel>=Zt&&dn.subscribe(em),hn.logLevel>=Zt&&hn.subscribe(Zg),fn.logLevel>=Zt&&fn.subscribe(Qg))}function iN(t,e){e!==void 0&&(Zt=Xo(e)),xt=t,Xg(xt)}function oN(t){t&&t.debug instanceof Function&&t.error instanceof Function&&(st=t)}function aN(){st=Jg,xt=!1,Zt=Xo(),Xg(!1)}function Qg(t){xt&&rm(t)}function Zg(t){xt&&sm(t)}function em(t){xt&&nm(t)}function tm(t){xt&&mn(t)}function rm(t){typeof t!="object"||!t?t=String(t):t.stack||(t=String(t.message||t)),typeof t=="string"&&(t=new Error(t)),gn(()=>st.error(t))}function sm(t){if(!st.warn)return mn(t);gn(()=>st.warn(t))}function nm(t){if(!st.info)return mn(t);gn(()=>st.info(t))}function mn(t){gn(()=>st.debug(t))}im.exports={use:oN,toggle:iN,reset:aN,error:rm,warn:sm,info:nm,debug:mn}});var E=p((K7,pm)=>{"use strict";var{debugChannel:om,infoChannel:am,warnChannel:cm,errorChannel:Zo}=Yo(),ea=Qo(),cN=t=>{let e={};return function(s){return e[s]||(e[s]=t.apply(this,arguments)),e[s]}};function _n(t){return typeof t=="function"?t():t}var um={use(t){return ea.use(t),this},toggle(t,e){return ea.toggle(t,e),this},reset(){return ea.reset(),this._deprecate=cN((t,e)=>(Zo.publish(e),!0)),this},debug(t){return om.hasSubscribers&&om.publish(_n(t)),this},info(t){return am.hasSubscribers&&am.publish(_n(t)),this},warn(t){return cm.hasSubscribers&&cm.publish(_n(t)),this},error(t){return Zo.hasSubscribers&&Zo.publish(_n(t)),this},deprecate(t,e){return this._deprecate(t,e)}};um.reset();pm.exports=um});var ta=p((Y7,dm)=>{"use strict";var uN=E();function lm(t,e){if(!(!t||!e)){if(Array.isArray(e))return e.forEach(r=>lm(t,r));try{if(typeof e=="string"){let r=e.split(",");for(let s of r){let n=s.indexOf(":");if(n===-1)continue;let i=s.slice(0,n),o=s.slice(n+1);t[i.trim()]=o.trim()}}else Object.assign(t,e)}catch(r){uN.error(r)}}}dm.exports={add:lm}});var ra=p((J7,hm)=>{"use strict";var pN=require("fs"),lN="[0-9a-f]{8}[-_][0-9a-f]{4}[-_][0-9a-f]{4}[-_][0-9a-f]{4}[-_][0-9a-f]{12}|[0-9a-f]{8}(?:-[0-9a-f]{4}){4}$",dN="[0-9a-f]{64}",hN="[0-9a-f]{32}-\\d+",fN=new RegExp(`.*(${lN}|${dN}|${hN})(?:\\.scope)?$`,"m"),gN=mN();function mN(){return((_N()||"").trim().match(fN)||[])[1]}function _N(){try{return pN.readFileSync("/proc/self/cgroup").toString()}catch{}}hm.exports={id(){return gN}}});var mm=p((X7,gm)=>{"use strict";var bN=require("http"),yN=require("https"),{storage:vN}=I(),SN=!0,qN=1;function fm(t){class e extends t{constructor(){super({keepAlive:SN,maxSockets:qN})}createConnection(...s){return this._noop(()=>super.createConnection(...s))}keepSocketAlive(...s){return this._noop(()=>super.keepSocketAlive(...s))}reuseSocket(...s){return this._noop(()=>super.reuseSocket(...s))}_noop(s){return vN.run({noop:!0},s)}}return e}var EN=fm(bN.Agent),TN=fm(yN.Agent);gm.exports={httpAgent:new EN,HttpsAgent:new TN}});var X=p((Q7,ym)=>{"use strict";var{Readable:wN}=require("stream"),na=require("http"),xN=require("https"),{parse:IN}=require("url"),AN=ra(),{httpAgent:kN,httpsAgent:RN}=mm(),{storage:sa}=I(),CN=E(),ON=8,_m=AN.id(),bn=0;function bm(t){let e=t.agent||na.globalAgent,r={protocol:t.protocol||e.protocol,hostname:typeof t.hostname=="string"&&t.hostname.startsWith("[")?t.hostname.slice(1,-1):t.hostname||t.host||"localhost",hash:t.hash,search:t.search,pathname:t.pathname,path:`${t.pathname||""}${t.search||""}`,href:t.href};return t.port!==""&&(r.port=Number(t.port)),(t.username||t.password)&&(r.auth=`${t.username}:${t.password}`),r}function PN(t){return typeof urlToHttpOptions=="function"?bm(new URL(t)):IN(t)}function ia(t,e,r){if(e.headers||(e.headers={}),e.url){let l=typeof e.url=="object"?bm(e.url):PN(e.url);l.protocol==="unix:"?e.socketPath=l.pathname:(e.path||(e.path=l.path),e.protocol=l.protocol,e.hostname=l.hostname,e.port=l.port)}let s=t instanceof wN,n=e.timeout||2e3,i=e.protocol==="https:",o=i?xN:na,a=[].concat(t);s||(e.headers["Content-Length"]=NN(a)),_m&&(e.headers["Datadog-Container-ID"]=_m),e.agent=i?RN:kN;let c=l=>{let d="";l.setTimeout(n),l.on("data",h=>{d+=h}),l.on("end",()=>{if(bn--,l.statusCode>=200&&l.statusCode<=299)r(null,d,l.statusCode);else{let h="";try{h=`Error from ${new URL(e.path,e.url||e.hostname||`http://localhost:${e.port}`).href}: ${l.statusCode} ${na.STATUS_CODES[l.statusCode]}.`}catch{}d&&(h+=` Response from the endpoint: "${d}"`);let f=new Error(h);f.status=l.statusCode,r(f,null,l.statusCode)}})},u=l=>{if(!ia.writable)return CN.debug("Maximum number of active requests reached: payload is discarded."),r(null);bn++;let d=sa.getStore();sa.enterWith({noop:!0});let h=o.request(e,c);h.once("error",f=>{bn--,l(f)}),h.setTimeout(n,h.abort),s?t.pipe(h):(a.forEach(f=>h.write(f)),h.end()),sa.enterWith(d)};u(()=>setTimeout(()=>u(r)))}function NN(t){return t.length>0?t.reduce((e,r)=>e+r.length,0):0}Object.defineProperty(ia,"writable",{get(){return bn<ON}});ym.exports=ia});var Sm=p((Z7,vm)=>{"use strict";var DN=require("dns").lookup,MN=X(),LN=require("dgram"),jN=require("net").isIP,oa=E(),UN=1024,aa=class{constructor(e){e=e||{},e.metricsProxyUrl&&(this._httpOptions={url:e.metricsProxyUrl.toString(),path:"/dogstatsd/v2/proxy"}),this._host=e.host||"localhost",this._family=jN(this._host),this._port=e.port||8125,this._prefix=e.prefix||"",this._tags=e.tags||[],this._queue=[],this._buffer="",this._offset=0,this._udp4=this._socket("udp4"),this._udp6=this._socket("udp6")}gauge(e,r,s){this._add(e,r,"g",s)}increment(e,r,s){this._add(e,r,"c",s)}flush(){let e=this._enqueue();this._queue.length!==0&&(this._queue=[],this._httpOptions?this._sendHttp(e):this._sendUdp(e))}_sendHttp(e){let r=Buffer.concat(e);MN(r,this._httpOptions,s=>{s&&(oa.error("HTTP error from agent: "+s.stack),s.status&&(s.status===404&&(this._httpOptions=null),this._sendUdp(e)))})}_sendUdp(e){this._family!==0?this._sendUdpFromQueue(e,this._host,this._family):DN(this._host,(r,s,n)=>{if(r)return oa.error(r);this._sendUdpFromQueue(e,s,n)})}_sendUdpFromQueue(e,r,s){let n=s===6?this._udp6:this._udp4;e.forEach(i=>{oa.debug(`Sending to DogStatsD: ${i}`),n.send(i,0,i.length,this._port,r)})}_add(e,r,s,n){let i=`${this._prefix+e}:${r}|${s}`;n=n?this._tags.concat(n):this._tags,n.length>0?this._write(`${i}|#${n.join(",")}
`):this._write(`${i}
`)}_write(e){let r=Buffer.byteLength(e);this._offset+r>UN&&this._enqueue(),this._offset+=r,this._buffer+=e}_enqueue(){return this._offset>0&&(this._queue.push(Buffer.from(this._buffer)),this._buffer="",this._offset=0),this._queue}_socket(e){let r=LN.createSocket(e);return r.on("error",()=>{}),r.unref(),r}};vm.exports=aa});var Em=p((eQ,qm)=>{"use strict";var{DDSketch:HN}=require("@datadog/sketches-js"),ca=class{constructor(){this.reset()}get min(){return this._min}get max(){return this._max}get avg(){return this._count===0?0:this._sum/this._count}get sum(){return this._sum}get count(){return this._count}get median(){return this.percentile(50)}get p95(){return this.percentile(95)}percentile(e){return this._histogram.getValueAtQuantile(e/100)||0}record(e){this._count===0?this._min=this._max=e:(this._min=Math.min(this._min,e),this._max=Math.max(this._max,e)),this._count++,this._sum+=e,this._histogram.accept(e)}reset(){this._min=0,this._max=0,this._sum=0,this._count=0,this._histogram=new HN}};qm.exports=ca});var Gr=p((tQ,km)=>{"use strict";var{URL:BN,format:$N}=require("url"),pa=require("v8"),Tm=require("os"),GN=Sm(),FN=E(),zN=Em(),{performance:wm}=require("perf_hooks"),xm=10*1e3,he=null,Br,w,er,vn,It,$r,nt,ua;Am();km.exports={start(t){let e=[];Object.keys(t.tags).filter(s=>typeof t.tags[s]=="string").filter(s=>s!=="runtime-id"?!0:t.experimental&&t.experimental.runtimeId).forEach(s=>{let n=t.tags[s].replace(/[^a-z0-9_:./-]/ig,"_");e.push(`${s}:${n}`)});try{he=require("@datadog/native-metrics"),he.start()}catch(s){FN.error(s),he=null}let r={host:t.dogstatsd.hostname,port:t.dogstatsd.port,tags:e};t.url?r.metricsProxyUrl=t.url:t.port&&(r.metricsProxyUrl=new BN($N({protocol:"http:",hostname:t.hostname||"localhost",port:t.port}))),w=new GN(r),er=process.hrtime(),he?Br=setInterval(()=>{Im(),tD(),w.flush()},xm):(vn=process.cpuUsage(),Br=setInterval(()=>{Im(),WN(),JN(),w.flush()},xm)),Br.unref()},stop(){he&&he.stop(),clearInterval(Br),Am()},track(t){if(he){let e=he.track(t);return{finish:()=>he.finish(e)}}return{finish:()=>{}}},boolean(t,e,r){this.gauge(t,e?1:0,r)},histogram(t,e,r){w&&(nt[t]=nt[t]||new Map,nt[t].has(r)||nt[t].set(r,new zN),nt[t].get(r).record(e))},count(t,e,r,s=!1){if(!w)return;typeof r=="boolean"&&(s=r,r=void 0);let n=s?$r:It;n[t]=n[t]||new Map;let i=n[t].get(r)||0;n[t].set(r,i+e)},gauge(t,e,r){w&&(It[t]=It[t]||new Map,It[t].set(r,e))},increment(t,e,r){this.count(t,1,e,r)},decrement(t,e){this.count(t,-1,e)}};function Am(){Br=null,w=null,er=null,vn=null,It={},$r={},nt={},he=null}function WN(){if(!process.cpuUsage)return;let t=process.hrtime(er),e=process.cpuUsage(vn);er=process.hrtime(),vn=process.cpuUsage();let r=t[0]*1e3+t[1]/1e6,s=100*e.user/1e3/r,n=100*e.system/1e3/r,i=s+n;w.gauge("runtime.node.cpu.system",n.toFixed(2)),w.gauge("runtime.node.cpu.user",s.toFixed(2)),w.gauge("runtime.node.cpu.total",i.toFixed(2))}function VN(){let t=process.memoryUsage();w.gauge("runtime.node.mem.heap_total",t.heapTotal),w.gauge("runtime.node.mem.heap_used",t.heapUsed),w.gauge("runtime.node.mem.rss",t.rss),w.gauge("runtime.node.mem.total",Tm.totalmem()),w.gauge("runtime.node.mem.free",Tm.freemem()),t.external&&w.gauge("runtime.node.mem.external",t.external)}function KN(){w.gauge("runtime.node.process.uptime",Math.round(process.uptime()))}function YN(){let t=pa.getHeapStatistics();w.gauge("runtime.node.heap.total_heap_size",t.total_heap_size),w.gauge("runtime.node.heap.total_heap_size_executable",t.total_heap_size_executable),w.gauge("runtime.node.heap.total_physical_size",t.total_physical_size),w.gauge("runtime.node.heap.total_available_size",t.total_available_size),w.gauge("runtime.node.heap.heap_size_limit",t.heap_size_limit),t.malloced_memory&&w.gauge("runtime.node.heap.malloced_memory",t.malloced_memory),t.peak_malloced_memory&&w.gauge("runtime.node.heap.peak_malloced_memory",t.peak_malloced_memory)}function JN(){if(!pa.getHeapSpaceStatistics)return;let t=pa.getHeapSpaceStatistics();for(let e=0,r=t.length;e<r;e++){let s=[`space:${t[e].space_name}`];w.gauge("runtime.node.heap.size.by.space",t[e].space_size,s),w.gauge("runtime.node.heap.used_size.by.space",t[e].space_used_size,s),w.gauge("runtime.node.heap.available_size.by.space",t[e].space_available_size,s),w.gauge("runtime.node.heap.physical_size.by.space",t[e].physical_space_size,s)}}function XN(){Object.keys(It).forEach(t=>{It[t].forEach((e,r)=>{w.gauge(t,e,r&&[r])})})}function QN(){Object.keys($r).forEach(t=>{$r[t].forEach((e,r)=>{w.increment(t,e,r&&[r])})}),$r={}}function ZN(){Object.keys(nt).forEach(t=>{nt[t].forEach((e,r)=>{yn(t,e,r&&[r]),e.reset()})})}var eD="eventLoopUtilization"in wm?()=>{ua=wm.eventLoopUtilization(ua),w.gauge("runtime.node.event_loop.utilization",ua.utilization)}:()=>{};function Im(){VN(),KN(),YN(),XN(),QN(),ZN(),eD()}function tD(){let t=he.stats(),e=t.heap.spaces,r=process.hrtime(er);er=process.hrtime();let s=r[0]*1e6+r[1]/1e3,n=100*t.cpu.user/s,i=100*t.cpu.system/s,o=n+i;w.gauge("runtime.node.cpu.system",i.toFixed(2)),w.gauge("runtime.node.cpu.user",n.toFixed(2)),w.gauge("runtime.node.cpu.total",o.toFixed(2)),yn("runtime.node.event_loop.delay",t.eventLoop),Object.keys(t.gc).forEach(a=>{a==="all"?yn("runtime.node.gc.pause",t.gc[a]):yn("runtime.node.gc.pause.by.type",t.gc[a],[`gc_type:${a}`])});for(let a=0,c=e.length;a<c;a++){let u=[`heap_space:${e[a].space_name}`];w.gauge("runtime.node.heap.size.by.space",e[a].space_size,u),w.gauge("runtime.node.heap.used_size.by.space",e[a].space_used_size,u),w.gauge("runtime.node.heap.available_size.by.space",e[a].space_available_size,u),w.gauge("runtime.node.heap.physical_size.by.space",e[a].physical_space_size,u)}}function yn(t,e,r){r=[].concat(r),w.gauge(`${t}.min`,e.min,r),w.gauge(`${t}.max`,e.max,r),w.increment(`${t}.sum`,e.sum,r),w.increment(`${t}.total`,e.sum,r),w.gauge(`${t}.avg`,e.avg,r),w.increment(`${t}.count`,e.count,r),w.gauge(`${t}.median`,e.median,r),w.gauge(`${t}.95percentile`,e.p95,r)}});var Um=p((rQ,jm)=>{"use strict";var{performance:Rm}=require("perf_hooks"),Cm=Rm.now.bind(Rm),Om=Date.now,rD=require("semver"),Pm=Qt(),Nm=de(),sD=ta(),re=Gr(),nD=E(),{storage:iD}=I(),{DD_TRACE_EXPERIMENTAL_STATE_TRACKING:oD,DD_TRACE_EXPERIMENTAL_SPAN_COUNTS:Dm}=process.env,Mm=Lm("unfinished"),la=Lm("finished"),da=class{constructor(e,r,s,n,i){let o=n.operationName,a=n.parent||null,c=Object.assign({},n.tags),u=n.hostname;this._parentTracer=e,this._debug=i,this._processor=r,this._prioritySampler=s,this._store=iD.getStore(),this._duration=void 0,this._name=o,this._spanContext=this._createContext(a,n),this._spanContext._name=o,this._spanContext._tags=c,this._spanContext._hostname=u,this._startTime=n.startTime||this._getTime(),Dm&&la&&(re.increment("runtime.node.spans.unfinished"),re.increment("runtime.node.spans.unfinished.by.name",`span_name:${o}`),re.increment("runtime.node.spans.open"),re.increment("runtime.node.spans.open.by.name",`span_name:${o}`),Mm.register(this,o,this))}toString(){let e=this.context(),r=e._tags["resource.name"],s=r.length>100?`${r.substring(0,97)}...`:r;return`Span${JSON.stringify({traceId:e._traceId,spanId:e._spanId,parentId:e._parentId,service:e._tags["service.name"],name:e._name,resource:s})}`}context(){return this._spanContext}tracer(){return this._parentTracer}setOperationName(e){return this._spanContext._name=e,this}setBaggageItem(e,r){return this._spanContext._baggageItems[e]=r,this}getBaggageItem(e){return this._spanContext._baggageItems[e]}setTag(e,r){return this._addTags({[e]:r}),this}addTags(e){return this._addTags(e),this}log(){return this}logEvent(){}finish(e){this._duration===void 0&&(oD==="true"&&(this._spanContext._tags["service.name"]||nD.error(`Finishing invalid span: ${this}`)),Dm&&la&&(re.decrement("runtime.node.spans.unfinished"),re.decrement("runtime.node.spans.unfinished.by.name",`span_name:${this._name}`),re.increment("runtime.node.spans.finished"),re.increment("runtime.node.spans.finished.by.name",`span_name:${this._name}`),re.decrement("runtime.node.spans.open"),re.decrement("runtime.node.spans.open.by.name",`span_name:${this._name}`),Mm.unregister(this),la.register(this,this._name)),e=parseFloat(e)||this._getTime(),this._duration=e-this._startTime,this._spanContext._trace.finished.push(this),this._spanContext._isFinished=!0,this._processor.process(this))}_createContext(e,r){let s;if(e)s=new Pm({traceId:e._traceId,spanId:Nm(),parentId:e._spanId,sampling:e._sampling,baggageItems:Object.assign({},e._baggageItems),trace:e._trace,tracestate:e._tracestate}),s._trace.startTime||(s._trace.startTime=Om());else{let n=Nm(),i=Om();s=new Pm({traceId:n,spanId:n}),s._trace.startTime=i,r.traceId128BitGenerationEnabled&&(s._trace.tags["_dd.p.tid"]=Math.floor(i/1e3).toString(16).padStart(8,"0").padEnd(16,"0"))}return s._trace.started.push(this),s._trace.ticks=s._trace.ticks||Cm(),s}_getTime(){let{startTime:e,ticks:r}=this._spanContext._trace;return e+Cm()-r}_addTags(e){sD.add(this._spanContext._tags,e),this._prioritySampler.sample(this,!1)}};function Lm(t){if(rD.satisfies(process.version,">=14.6"))return new global.FinalizationRegistry(e=>{re.decrement(`runtime.node.spans.${t}`),re.decrement(`runtime.node.spans.${t}.by.name`,[`span_name:${e}`])})}jm.exports=da});var A=p((sQ,Hm)=>{"use strict";Hm.exports={SAMPLING_PRIORITY_KEY:"_sampling_priority_v1",ANALYTICS_KEY:"_dd1.sr.eausr",ORIGIN_KEY:"_dd.origin",HOSTNAME_KEY:"_dd.hostname",TOP_LEVEL_KEY:"_dd.top_level",SAMPLING_RULE_DECISION:"_dd.rule_psr",SAMPLING_LIMIT_DECISION:"_dd.limit_psr",SAMPLING_AGENT_DECISION:"_dd.agent_psr",SAMPLING_MECHANISM_DEFAULT:0,SAMPLING_MECHANISM_AGENT:1,SAMPLING_MECHANISM_RULE:3,SAMPLING_MECHANISM_MANUAL:4,SAMPLING_MECHANISM_APPSEC:5,SAMPLING_MECHANISM_SPAN:8,SPAN_SAMPLING_MECHANISM:"_dd.span_sampling.mechanism",SPAN_SAMPLING_RULE_RATE:"_dd.span_sampling.rule_rate",SPAN_SAMPLING_MAX_PER_SECOND:"_dd.span_sampling.max_per_second",DATADOG_LAMBDA_EXTENSION_PATH:"/opt/extensions/datadog-agent",DECISION_MAKER_KEY:"_dd.p.dm",PROCESS_ID:"process_id",ERROR_TYPE:"error.type",ERROR_MESSAGE:"error.message",ERROR_STACK:"error.stack",COMPONENT:"component",CLIENT_PORT_KEY:"network.destination.port"}});var B=p((nQ,Bm)=>{"use strict";var ha={SERVICE_NAME:"service.name",RESOURCE_NAME:"resource.name",SPAN_TYPE:"span.type",SPAN_KIND:"span.kind",SAMPLING_PRIORITY:"sampling.priority",ANALYTICS:"_dd1.sr.eausr",ERROR:"error",MANUAL_KEEP:"manual.keep",MANUAL_DROP:"manual.drop",MEASURED:"_dd.measured",HTTP_URL:"http.url",HTTP_METHOD:"http.method",HTTP_STATUS_CODE:"http.status_code",HTTP_ROUTE:"http.route",HTTP_REQUEST_HEADERS:"http.request.headers",HTTP_RESPONSE_HEADERS:"http.response.headers",HTTP_USERAGENT:"http.useragent",HTTP_CLIENT_IP:"http.client_ip"};ha.ANALYTICS_SAMPLE_RATE=ha.ANALYTICS;Bm.exports=ha});var Xm=p((iQ,Jm)=>{"use strict";var $=A(),aD=B(),cD=de(),{isError:uD}=te(),pD=$.SAMPLING_PRIORITY_KEY,$m=$.SAMPLING_RULE_DECISION,Gm=$.SAMPLING_LIMIT_DECISION,Fm=$.SAMPLING_AGENT_DECISION,lD=$.SPAN_SAMPLING_MECHANISM,dD=$.SPAN_SAMPLING_RULE_RATE,hD=$.SPAN_SAMPLING_MAX_PER_SECOND,fD=$.SAMPLING_MECHANISM_SPAN,zm=aD.MEASURED,gD=$.ORIGIN_KEY,Wm=$.HOSTNAME_KEY,mD=$.TOP_LEVEL_KEY,_D=$.PROCESS_ID,Vm=$.ERROR_MESSAGE,Km=$.ERROR_STACK,Ym=$.ERROR_TYPE,bD={"service.name":"service","span.type":"type","resource.name":"resource"};function yD(t){let e=vD(t);return ED(e,t),TD(e,t),qD(e,t),e}function vD(t){let e=t.context();return{trace_id:e._traceId,span_id:e._spanId,parent_id:e._parentId||cD("0"),name:String(e._name),resource:String(e._name),error:0,meta:{},metrics:{},start:Math.round(t._startTime*1e6),duration:Math.round(t._duration*1e6)}}function SD(t,e){e&&(C({},t.metrics,lD,fD),C({},t.metrics,dD,e.sampleRate),C({},t.metrics,hD,e.maxPerSecond))}function qD(t,e){let r=e.context(),s=r._trace.origin,n=r._tags,i=r._hostname,o=r._sampling.priority;n["span.kind"]&&n["span.kind"]!=="internal"&&C({},t.metrics,zm,1);for(let a in n)switch(a){case"service.name":case"span.type":case"resource.name":C(t,{},bD[a],n[a]);break;case"http.status_code":C(t.meta,{},a,n[a]&&String(n[a]));break;case Wm:case zm:C({},t.metrics,a,n[a]===void 0||n[a]?1:0);break;case"error":r._name!=="fs.operation"&&wD(t,n[a]);break;case Ym:case Vm:case Km:if(r._name!=="fs.operation")t.error=1;else break;default:C(t.meta,t.metrics,a,n[a])}SD(t,r._sampling.spanSampling),C(t.meta,t.metrics,"language","javascript"),C(t.meta,t.metrics,_D,process.pid),C(t.meta,t.metrics,pD,o),C(t.meta,t.metrics,gD,s),C(t.meta,t.metrics,Wm,i)}function ED(t,e){let r=e.context(),s=e===r._trace.started[0],n=r._parentId;!s||n&&n.toString(10)!=="0"||(C({},t.metrics,$m,r._trace[$m]),C({},t.metrics,Gm,r._trace[Gm]),C({},t.metrics,Fm,r._trace[Fm]),C({},t.metrics,mD,1))}function TD(t,e){let r=e.context();if(e===r._trace.started[0])for(let n in r._trace.tags)C(t.meta,t.metrics,n,r._trace.tags[n])}function wD(t,e){e&&(t.error=1,uD(e)&&(C(t.meta,t.metrics,Vm,e.message||e.code),C(t.meta,t.metrics,Ym,e.name),C(t.meta,t.metrics,Km,e.stack)))}function C(t,e,r,s,n){switch(typeof s){case"string":if(!s)break;t[r]=s;break;case"number":if(isNaN(s))break;e[r]=s;break;case"boolean":e[r]=s?1:0;break;case"undefined":break;case"object":if(s===null)break;if(ID(s)||AD(s))e[r]=s.toString();else if(!Array.isArray(s)&&!n)for(let i in s)xD(s,i)&&C(t,e,`${r}.${i}`,s[i],!0);break}}function xD(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function ID(t){return t.constructor&&t.constructor.name==="Buffer"&&typeof t.readInt8=="function"&&typeof t.toString=="function"}function AD(t){return t.constructor&&t.constructor.name==="URL"&&typeof t.href=="string"&&typeof t.toString=="function"}Jm.exports=yD});var fe=p((oQ,Qm)=>{"use strict";Qm.exports={TEXT_MAP:"text_map",HTTP_HEADERS:"http_headers",BINARY:"binary",LOG:"log"}});var Sn=p((aQ,Zm)=>{"use strict";Zm.exports={SERVER:"server",CLIENT:"client",PRODUCER:"producer",CONSUMER:"consumer"}});var fa=p((cQ,e_)=>{"use strict";e_.exports={HTTP:"http",WEB:"web"}});var ga=p((uQ,t_)=>{"use strict";t_.exports={LOG:"log",AGENT:"agent",DATADOG:"datadog",AGENT_PROXY:"agent_proxy",JEST_WORKER:"jest_worker"}});var ma=p((pQ,r_)=>{"use strict";var kD=fe(),RD=Sn(),CD=Xt(),OD=B(),PD=fa(),ND=ga();r_.exports={formats:kD,kinds:RD,priority:CD,tags:OD,types:PD,exporters:ND}});var qn=p((lQ,s_)=>{"use strict";var DD=require("limiter"),_a=class{constructor(e){this._rateLimit=parseInt(e),this._limiter=new DD.RateLimiter(this._rateLimit,"second"),this._tokensRequested=0,this._prevIntervalTokens=0,this._prevTokensRequested=0}isAllowed(){let e=this._limiter.curIntervalStart,r=this._limiter.tokensThisInterval,s=this._isAllowed();return e!==this._limiter.curIntervalStart?(this._prevIntervalTokens=r,this._prevTokensRequested=this._tokensRequested,this._tokensRequested=1):this._tokensRequested++,s}effectiveRate(){if(this._rateLimit<0)return 1;if(this._rateLimit===0)return 0;if(this._tokensRequested===0)return 1;let e=this._prevIntervalTokens+this._limiter.tokensThisInterval,r=this._prevTokensRequested+this._tokensRequested;return e/r}_isAllowed(){return this._rateLimit<0?!0:this._rateLimit===0?!1:this._limiter.tryRemoveTokens(1)}_currentWindowRate(){return this._rateLimit<0?1:this._rateLimit===0?0:this._tokensRequested===0?1:this._limiter.tokensThisInterval/this._tokensRequested}};s_.exports=_a});var ya=p((dQ,n_)=>{"use strict";var ba=class{constructor(e){this._rate=e}rate(){return this._rate}isSampled(){return this._rate===1||Math.random()<this._rate}};n_.exports=ba});var a_=p((hQ,o_)=>{"use strict";var{globMatch:i_}=te(),{USER_KEEP:MD,AUTO_KEEP:LD}=ma().priority,jD=qn(),UD=ya(),Fr=class{constructor({service:e,name:r,sampleRate:s=1,maxPerSecond:n}={}){this.service=e,this.name=r,this._sampler=new UD(s),this._limiter=void 0,Number.isFinite(n)&&(this._limiter=new jD(n))}get sampleRate(){return this._sampler.rate()}get maxPerSecond(){return this._limiter&&this._limiter._rateLimit}static from(e){return new Fr(e)}match(e,r){return!(this.service&&!i_(this.service,e)||this.name&&!i_(this.name,r))}sample(){return this._sampler.isSampled()?this._limiter?this._limiter.isAllowed():!0:!1}},va=class{constructor({spanSamplingRules:e=[]}={}){this._rules=e.map(Fr.from)}findRule(e,r){for(let s of this._rules)if(s.match(e,r))return s}sample(e){let r=e._sampling.priority;if(r===MD||r===LD)return;let{started:s}=e._trace;for(let n of s){let i=n.context(),o=i._tags||{},a=i._name,c=o.service||o["service.name"]||n.tracer()._service,u=this.findRule(c,a);u&&u.sample()&&(n.context()._sampling.spanSampling={sampleRate:u.sampleRate,maxPerSecond:u.maxPerSecond})}}};o_.exports=va});var Sa=p((fQ,l_)=>{"use strict";var c_=require("fs"),zr=require("path");function u_(){return require.main&&require.main.filename?zr.dirname(require.main.filename):process.cwd()}function HD(){let t=u_(),e=zr.resolve(t),r=zr.parse(e);if(!r)return{};let{root:s}=r,n=p_("package.json",s,e);try{return JSON.parse(c_.readFileSync(n,"utf8"))}catch{return{}}}function p_(t,e,r){for(;;){let s=zr.resolve(r,t);if(c_.existsSync(s))return s;if(r===e)return;r=zr.dirname(r)}}l_.exports=Object.assign(HD(),{findRoot:u_,findUp:p_})});var Ie=p((gQ,BD)=>{BD.exports={name:"dd-trace",version:"4.0.0-pre",description:"Datadog APM tracing client for JavaScript",main:"index.js",typings:"index.d.ts",scripts:{preinstall:"node scripts/preinstall.js",bundle:"node scripts/bundle",bench:"node benchmark","bench:profiler":"node benchmark/profiler","bench:e2e":"SERVICES=mongo yarn services && cd benchmark/e2e && node benchmark-run.js --duration=30","bench:e2e:ci-visibility":"node benchmark/e2e-ci/benchmark-run.js","type:doc":"cd docs && yarn && yarn build","type:test":"cd docs && yarn && yarn test",lint:"node scripts/check_licenses.js && eslint . && yarn audit --groups dependencies",services:"node ./scripts/install_plugin_modules && node packages/dd-trace/test/setup/services",test:"SERVICES=* yarn services && mocha --colors --exit --expose-gc 'packages/dd-trace/test/setup/node.js' 'packages/*/test/**/*.spec.js'","test:appsec":'mocha --colors --exit -r "packages/dd-trace/test/setup/mocha.js" --exclude "packages/dd-trace/test/appsec/iast/**/*.plugin.spec.js" "packages/dd-trace/test/appsec/**/*.spec.js"',"test:appsec:ci":'nyc --no-clean --include "packages/dd-trace/src/appsec/**/*.js" --exclude "packages/dd-trace/test/appsec/iast/**/*.plugin.spec.js" -- npm run test:appsec',"test:appsec:plugins":'mocha --colors --exit -r "packages/dd-trace/test/setup/mocha.js" "packages/dd-trace/test/appsec/iast/**/*.@($(echo $PLUGINS)).plugin.spec.js"',"test:appsec:plugins:ci":'yarn services && nyc --no-clean --include "packages/dd-trace/test/appsec/iast/**/*.@($(echo $PLUGINS)).plugin.spec.js" -- npm run test:appsec:plugins',"test:trace:core":'tap packages/dd-trace/test/*.spec.js "packages/dd-trace/test/{ci-visibility,encode,exporters,opentracing,plugins,telemetry}/**/*.spec.js"',"test:trace:core:ci":'npm run test:trace:core -- --coverage --nyc-arg=--include="packages/dd-trace/src/**/*.js"',"test:instrumentations":"mocha --colors -r 'packages/dd-trace/test/setup/mocha.js' 'packages/datadog-instrumentations/test/**/*.spec.js'","test:instrumentations:ci":"nyc --no-clean --include 'packages/datadog-instrumentations/src/**/*.js' -- npm run test:instrumentations","test:core":'tap "packages/datadog-core/test/**/*.spec.js"',"test:core:ci":'npm run test:core -- --coverage --nyc-arg=--include="packages/datadog-core/src/**/*.js"',"test:lambda":'mocha --colors --exit -r "packages/dd-trace/test/setup/mocha.js" "packages/dd-trace/test/lambda/**/*.spec.js"',"test:lambda:ci":'nyc --no-clean --include "packages/dd-trace/src/lambda/**/*.js" -- npm run test:lambda',"test:plugins":'mocha --colors --exit -r "packages/dd-trace/test/setup/mocha.js" "packages/datadog-instrumentations/test/@($(echo $PLUGINS)).spec.js" "packages/datadog-plugin-@($(echo $PLUGINS))/test/**/*.spec.js"',"test:plugins:ci":'yarn services && nyc --no-clean --include "packages/datadog-instrumentations/src/@($(echo $PLUGINS)).js" --include "packages/datadog-instrumentations/src/@($(echo $PLUGINS))/**/*.js" --include "packages/datadog-plugin-@($(echo $PLUGINS))/src/**/*.js" -- npm run test:plugins',"test:plugins:upstream":"node ./packages/dd-trace/test/plugins/suite.js","test:profiler":'tap "packages/dd-trace/test/profiling/**/*.spec.js"',"test:profiler:ci":'npm run test:profiler -- --coverage --nyc-arg=--include="packages/dd-trace/src/profiling/**/*.js"',"test:integration":'mocha --colors --timeout 30000 "integration-tests/*.spec.js"',"test:integration:cucumber":'mocha --colors --timeout 30000 "integration-tests/cucumber/*.spec.js"',"test:integration:cypress":'mocha --colors --timeout 30000 "integration-tests/cypress/*.spec.js"',"test:integration:playwright":'mocha --colors --timeout 30000 "integration-tests/playwright/*.spec.js"',"test:shimmer":"mocha --colors 'packages/datadog-shimmer/test/**/*.spec.js'","test:shimmer:ci":"nyc --no-clean --include 'packages/datadog-shimmer/src/**/*.js' -- npm run test:shimmer","leak:core":"node ./scripts/install_plugin_modules && (cd packages/memwatch && yarn) && NODE_PATH=./packages/memwatch/node_modules node --no-warnings ./node_modules/.bin/tape 'packages/dd-trace/test/leak/**/*.js'","leak:plugins":'yarn services && (cd packages/memwatch && yarn) && NODE_PATH=./packages/memwatch/node_modules node --no-warnings ./node_modules/.bin/tape "packages/datadog-plugin-@($(echo $PLUGINS))/test/leak.js"'},repository:{type:"git",url:"git+https://github.com/DataDog/dd-trace-js.git"},keywords:["datadog","trace","tracing","profile","profiler","profiling","opentracing","apm"],author:"Datadog Inc. <info@datadoghq.com>",license:"BSD-3-Clause",bugs:{url:"https://github.com/DataDog/dd-trace-js/issues"},homepage:"https://github.com/DataDog/dd-trace-js#readme",engines:{node:">=14"},dependencies:{"@datadog/native-appsec":"2.0.0","@datadog/native-iast-rewriter":"2.0.1","@datadog/native-iast-taint-tracking":"^1.4.0","@datadog/native-metrics":"^1.6.0","@datadog/pprof":"^2.2.0","@datadog/sketches-js":"^2.1.0","crypto-randomuuid":"^1.0.0",diagnostics_channel:"^1.1.0",ignore:"^5.2.0","import-in-the-middle":"^1.3.5","ipaddr.js":"^2.0.1","istanbul-lib-coverage":"3.2.0",koalas:"^1.0.2",limiter:"^1.1.4","lodash.kebabcase":"^4.1.1","lodash.pick":"^4.4.0","lodash.sortby":"^4.7.0","lodash.uniq":"^4.5.0","lru-cache":"^7.14.0",methods:"^1.1.2","module-details-from-path":"^1.0.3","node-abort-controller":"^3.0.1",opentracing:">=0.12.1","path-to-regexp":"^0.1.2",protobufjs:"^7.1.2",retry:"^0.10.1",semver:"^7.3.8"},devDependencies:{"@types/node":">=14",autocannon:"^4.5.2",axios:"^0.21.2",benchmark:"^2.1.4","body-parser":"^1.18.2",chai:"^4.2.0",chalk:"^3.0.0",checksum:"^0.1.1","cli-table3":"^0.5.1",dotenv:"8.2.0",esbuild:"^0.17.18","esbuild-node-externals":"^1.7.0",eslint:"^8.23.0","eslint-config-standard":"^11.0.0-beta.0","eslint-plugin-import":"^2.8.0","eslint-plugin-mocha":"^10.1.0","eslint-plugin-n":"^15.7.0","eslint-plugin-node":"^5.2.1","eslint-plugin-promise":"^3.6.0","eslint-plugin-standard":"^3.0.1",express:"^4.16.2","get-port":"^3.2.0",glob:"^7.1.6",graphql:"0.13.2","int64-buffer":"^0.1.9",jszip:"^3.5.0",mkdirp:"^0.5.1",mocha:"8","msgpack-lite":"^0.1.26",multer:"^1.4.5-lts.1",nock:"^11.3.3",nyc:"^15.1.0","pprof-format":"^2.0.7",proxyquire:"^1.8.0",rimraf:"^3.0.0",sinon:"^11.1.2","sinon-chai":"^3.7.0",tap:"^16.3.4",tape:"^4.9.1"}}});var tr=p((mQ,f_)=>{var d_="unnamed_operation",h_="unnamed-service";function $D(t,e=!0){e&&t.resource&&t.resource.length>5e3&&(t.resource=`${t.resource.slice(0,5e3)}...`);for(let r in t.meta){let s=t.meta[r];r.length>200&&(delete t.meta[r],r=`${r.slice(0,200)}...`,t.metrics[r]=s),s&&s.length>25e3&&(t.meta[r]=`${s.slice(0,25e3)}...`)}for(let r in t.metrics){let s=t.metrics[r];r.length>200&&(delete t.metrics[r],r=`${r.slice(0,200)}...`,t.metrics[r]=s)}return t}function GD(t){return t.service=t.service||h_,t.service.length>100&&(t.service=t.service.slice(0,100)),t.name=t.name||d_,t.name.length>100&&(t.name=t.name.slice(0,100)),t.resource||(t.resource=t.name),t.type&&t.type.length>100&&(t.type=t.type.slice(0,100)),t}f_.exports={truncateSpan:$D,normalizeSpan:GD,MAX_META_KEY_LENGTH:200,MAX_META_VALUE_LENGTH:25e3,MAX_METRIC_KEY_LENGTH:200,MAX_NAME_LENGTH:100,MAX_SERVICE_LENGTH:100,MAX_TYPE_LENGTH:100,MAX_RESOURCE_NAME_LENGTH:5e3,DEFAULT_SPAN_NAME:d_,DEFAULT_SERVICE_NAME:h_}});var Ea=p((_Q,g_)=>{"use strict";var qa=class{constructor(e=2097152){this.buffer=Buffer.allocUnsafe(e),this.length=0,this._minSize=e}write(e){let r=Buffer.byteLength(e),s=this.length;return r<32?(this.reserve(r+1),this.length+=1,this.buffer[s]=r|160):r<4294967296&&(this.reserve(r+5),this.length+=5,this.buffer[s]=219,this.buffer[s+1]=r>>24,this.buffer[s+2]=r>>16,this.buffer[s+3]=r>>8,this.buffer[s+4]=r),this.length+=this.buffer.utf8Write(e,this.length,r),this.length-s}copy(e,r,s){e.set(new Uint8Array(this.buffer.buffer,r,s-r))}set(e){this.reserve(e.length),this.buffer.set(e,this.length),this.length+=e.length}reserve(e){this.length+e>this.buffer.length&&this._resize(this._minSize*Math.ceil((this.length+e)/this._minSize))}_resize(e){let r=this.buffer;this.buffer=Buffer.allocUnsafe(e),r.copy(this.buffer,0,0,this.length)}};g_.exports=qa});var rr=p((bQ,b_)=>{"use strict";var{truncateSpan:FD,normalizeSpan:zD}=tr(),m_=Ea(),__=E(),{isTrue:WD}=te(),VD=require("koalas"),KD=8*1024*1024,xa=new Float64Array(1),Ta=new Uint8Array(xa.buffer);xa[0]=-1;var YD=Ta[7]===0;function JD(t){return zD(FD(t,!1))}var wa=class{constructor(e,r=KD){this._limit=r,this._traceBytes=new m_,this._stringBytes=new m_,this._writer=e,this._reset(),this._debugEncoding=WD(VD(process.env.DD_TRACE_ENCODING_DEBUG,!1))}count(){return this._traceCount}encode(e){let r=this._traceBytes,s=r.length;this._traceCount++,this._encode(r,e);let n=r.length;this._debugEncoding&&__.debug(()=>`Adding encoded trace to buffer: ${r.buffer.subarray(s,n).toString("hex").match(/../g).join(" ")}`),(this._traceBytes.length>this._limit||this._stringBytes.length>this._limit)&&(__.debug("Buffer went over soft limit, flushing"),this._writer.flush())}makePayload(){let e=this._traceBytes.length+5,r=Buffer.allocUnsafe(e);return this._writeTraces(r),this._reset(),r}reset(){this._reset()}_encode(e,r){this._encodeArrayPrefix(e,r);for(let s of r)s=JD(s),e.reserve(1),s.type?(e.buffer[e.length++]=140,this._encodeString(e,"type"),this._encodeString(e,s.type)):e.buffer[e.length++]=139,this._encodeString(e,"trace_id"),this._encodeId(e,s.trace_id),this._encodeString(e,"span_id"),this._encodeId(e,s.span_id),this._encodeString(e,"parent_id"),this._encodeId(e,s.parent_id),this._encodeString(e,"name"),this._encodeString(e,s.name),this._encodeString(e,"resource"),this._encodeString(e,s.resource),this._encodeString(e,"service"),this._encodeString(e,s.service),this._encodeString(e,"error"),this._encodeInteger(e,s.error),this._encodeString(e,"start"),this._encodeLong(e,s.start),this._encodeString(e,"duration"),this._encodeLong(e,s.duration),this._encodeString(e,"meta"),this._encodeMap(e,s.meta),this._encodeString(e,"metrics"),this._encodeMap(e,s.metrics)}_reset(){this._traceCount=0,this._traceBytes.length=0,this._stringCount=0,this._stringBytes.length=0,this._stringMap={},this._cacheString("")}_encodeArrayPrefix(e,r){let s=r.length,n=e.length;e.reserve(5),e.length+=5,e.buffer[n]=221,e.buffer[n+1]=s>>24,e.buffer[n+2]=s>>16,e.buffer[n+3]=s>>8,e.buffer[n+4]=s}_encodeMapPrefix(e,r){let s=e.length;e.reserve(5),e.length+=5,e.buffer[s]=223,e.buffer[s+1]=r>>24,e.buffer[s+2]=r>>16,e.buffer[s+3]=r>>8,e.buffer[s+4]=r}_encodeByte(e,r){e.reserve(1),e.buffer[e.length++]=r}_encodeId(e,r){let s=e.length;e.reserve(9),e.length+=9,r=r.toArray(),e.buffer[s]=207,e.buffer[s+1]=r[0],e.buffer[s+2]=r[1],e.buffer[s+3]=r[2],e.buffer[s+4]=r[3],e.buffer[s+5]=r[4],e.buffer[s+6]=r[5],e.buffer[s+7]=r[6],e.buffer[s+8]=r[7]}_encodeInteger(e,r){let s=e.length;e.reserve(5),e.length+=5,e.buffer[s]=206,e.buffer[s+1]=r>>24,e.buffer[s+2]=r>>16,e.buffer[s+3]=r>>8,e.buffer[s+4]=r}_encodeLong(e,r){let s=e.length,n=r/Math.pow(2,32)>>0,i=r>>>0;e.reserve(9),e.length+=9,e.buffer[s]=207,e.buffer[s+1]=n>>24,e.buffer[s+2]=n>>16,e.buffer[s+3]=n>>8,e.buffer[s+4]=n,e.buffer[s+5]=i>>24,e.buffer[s+6]=i>>16,e.buffer[s+7]=i>>8,e.buffer[s+8]=i}_encodeMap(e,r){let n=Object.keys(r).filter(i=>typeof r[i]=="string"||typeof r[i]=="number");this._encodeMapPrefix(e,n.length);for(let i of n)this._encodeString(e,i),this._encodeValue(e,r[i])}_encodeValue(e,r){switch(typeof r){case"string":this._encodeString(e,r);break;case"number":this._encodeFloat(e,r);break;default:}}_encodeString(e,r=""){this._cacheString(r);let{start:s,end:n}=this._stringMap[r];this._stringBytes.copy(e,s,n)}_encodeFloat(e,r){xa[0]=r;let s=e.length;if(e.reserve(9),e.length+=9,e.buffer[s]=203,YD)for(let n=0;n<=7;n++)e.buffer[s+n+1]=Ta[n];else for(let n=7;n>=0;n--)e.buffer[e.length-n-1]=Ta[n]}_cacheString(e){e in this._stringMap||(this._stringCount++,this._stringMap[e]={start:this._stringBytes.length,end:this._stringBytes.length+this._stringBytes.write(e)})}_writeArrayPrefix(e,r,s){return e[r++]=221,e.writeUInt32BE(s,r),r+4}_writeTraces(e,r=0){return r=this._writeArrayPrefix(e,r,this._traceCount),r+=this._traceBytes.buffer.copy(e,r,0,this._traceBytes.length),r}};b_.exports={AgentEncoder:wa}});var v_=p((yQ,y_)=>{"use strict";var{AgentEncoder:XD}=rr(),{MAX_NAME_LENGTH:QD,MAX_SERVICE_LENGTH:ZD,MAX_RESOURCE_NAME_LENGTH:eM,MAX_TYPE_LENGTH:tM,DEFAULT_SPAN_NAME:rM,DEFAULT_SERVICE_NAME:sM}=tr();function En(t,e,r=""){return t&&(t.length>e?`${t.slice(0,e)}${r}`:t)}var Ia=class extends XD{_encodeBool(e,r){this._encodeByte(e,r?195:194)}makePayload(){let e=this._traceBytes.length,r=Buffer.allocUnsafe(e);return this._traceBytes.copy(r,0,e),this._reset(),r}_encodeMapPrefix(e,r){let s=e.length;e.reserve(1),e.length+=1,e.buffer[s]=128+r}_encodeBuffer(e,r){let s=r.length,n=e.length;e.reserve(5),e.length+=5,e.buffer[n]=198,e.buffer[n+1]=s>>24,e.buffer[n+2]=s>>16,e.buffer[n+3]=s>>8,e.buffer[n+4]=s,r.copy(e.buffer,n+5),e.length+=s}_encodeStat(e,r){this._encodeMapPrefix(e,12),this._encodeString(e,"Service");let s=r.Service||sM;this._encodeString(e,En(s,ZD)),this._encodeString(e,"Name");let n=r.Name||rM;this._encodeString(e,En(n,QD)),this._encodeString(e,"Resource"),this._encodeString(e,En(r.Resource,eM,"...")),this._encodeString(e,"HTTPStatusCode"),this._encodeInteger(e,r.HTTPStatusCode),this._encodeString(e,"Type"),this._encodeString(e,En(r.Type,tM)),this._encodeString(e,"Hits"),this._encodeLong(e,r.Hits),this._encodeString(e,"Errors"),this._encodeLong(e,r.Errors),this._encodeString(e,"Duration"),this._encodeLong(e,r.Duration),this._encodeString(e,"OkSummary"),this._encodeBuffer(e,r.OkSummary),this._encodeString(e,"ErrorSummary"),this._encodeBuffer(e,r.ErrorSummary),this._encodeString(e,"Synthetics"),this._encodeBool(e,r.Synthetics),this._encodeString(e,"TopLevelHits"),this._encodeLong(e,r.TopLevelHits)}_encodeBucket(e,r){this._encodeMapPrefix(e,3),this._encodeString(e,"Start"),this._encodeLong(e,r.Start),this._encodeString(e,"Duration"),this._encodeLong(e,r.Duration),this._encodeString(e,"Stats"),this._encodeArrayPrefix(e,r.Stats);for(let s of r.Stats)this._encodeStat(e,s)}_encode(e,r){this._encodeMapPrefix(e,8),this._encodeString(e,"Hostname"),this._encodeString(e,r.Hostname),this._encodeString(e,"Env"),this._encodeString(e,r.Env),this._encodeString(e,"Version"),this._encodeString(e,r.Version),this._encodeString(e,"Stats"),this._encodeArrayPrefix(e,r.Stats);for(let s of r.Stats)this._encodeBucket(e,s);this._encodeString(e,"Lang"),this._encodeString(e,r.Lang),this._encodeString(e,"TracerVersion"),this._encodeString(e,r.TracerVersion),this._encodeString(e,"RuntimeID"),this._encodeString(e,r.RuntimeID),this._encodeString(e,"Sequence"),this._encodeLong(e,r.Sequence)}};y_.exports={SpanStatsEncoder:Ia}});var Wr=p((vQ,E_)=>{"use strict";var S_=X(),q_=E(),Aa=class{constructor({url:e}){this._url=e}flush(e=()=>{}){let r=this._encoder.count();if(!S_.writable)this._encoder.reset(),e();else if(r>0){let s=this._encoder.makePayload();this._sendPayload(s,r,e)}else e()}append(e){if(!S_.writable){q_.debug(()=>`Maximum number of active requests reached. Payload discarded: ${JSON.stringify(e)}`);return}q_.debug(()=>`Encoding payload: ${JSON.stringify(e)}`),this._encode(e)}_encode(e){this._encoder.encode(e)}setUrl(e){this._url=e}};E_.exports=Aa});var w_=p((SQ,T_)=>{var{SpanStatsEncoder:nM}=v_(),iM=Ie(),oM=Wr(),aM=X(),ka=E(),Ra=class extends oM{constructor({url:e}){super(...arguments),this._url=e,this._encoder=new nM(this)}_sendPayload(e,r,s){cM(e,this._url,(n,i)=>{if(n){ka.error(n),s();return}ka.debug(`Response from the intake: ${i}`),s()})}};function cM(t,e,r){let s={path:"/v0.6/stats",method:"PUT",headers:{"Datadog-Meta-Lang":"javascript","Datadog-Meta-Tracer-Version":iM.version,"Content-Type":"application/msgpack"}};s.protocol=e.protocol,s.hostname=e.hostname,s.port=e.port,ka.debug(()=>`Request to the intake: ${JSON.stringify(s)}`),aM(t,s,(n,i)=>{r(n,i)})}T_.exports={Writer:Ra}});var I_=p((qQ,x_)=>{var{URL:uM,format:pM}=require("url"),{Writer:lM}=w_(),Ca=class{constructor(e){let{hostname:r="127.0.0.1",port:s=8126,tags:n,url:i}=e;this._url=i||new uM(pM({protocol:"http:",hostname:r||"localhost",port:s})),this._writer=new lM({url:this._url,tags:n})}export(e){this._writer.append(e),this._writer.flush()}};x_.exports={SpanStatsExporter:Ca}});var C_=p((EQ,R_)=>{var dM=require("os"),{version:hM}=Sa(),fM=Ie(),{LogCollapsingLowestDenseDDSketch:A_}=require("@datadog/sketches-js"),{ORIGIN_KEY:gM,TOP_LEVEL_KEY:k_}=A(),{MEASURED:mM,HTTP_STATUS_CODE:_M}=B(),{SpanStatsExporter:bM}=I_(),{DEFAULT_SPAN_NAME:yM,DEFAULT_SERVICE_NAME:vM}=tr(),Tn=class{constructor(e){this.aggKey=e,this.hits=0,this.topLevelHits=0,this.errors=0,this.duration=0,this.okDistribution=new A_(.00775),this.errorDistribution=new A_(.00775)}record(e){let r=e.duration;this.hits++,this.duration+=r,e.metrics[k_]&&this.topLevelHits++,e.error?(this.errors++,this.errorDistribution.accept(r)):this.okDistribution.accept(r)}toJSON(){let{name:e,service:r,resource:s,type:n,statusCode:i,synthetics:o}=this.aggKey;return{Name:e,Service:r,Resource:s,Type:n,HTTPStatusCode:i,Synthetics:o,Hits:this.hits,TopLevelHits:this.topLevelHits,Errors:this.errors,Duration:this.duration,OkSummary:this.okDistribution.toProto(),ErrorSummary:this.errorDistribution.toProto()}}},wn=class{constructor(e){this.name=e.name||yM,this.service=e.service||vM,this.resource=e.resource||"",this.type=e.type||"",this.statusCode=e.meta[_M]||0,this.synthetics=e.meta[gM]==="synthetics"}toString(){return[this.name,this.service,this.resource,this.type,this.statusCode,this.synthetics].join(",")}},xn=class extends Map{forSpan(e){let r=new wn(e),s=r.toString();return this.has(s)||this.set(s,new Tn(r)),this.get(s)}},In=class extends Map{forTime(e){return this.has(e)||this.set(e,new xn),this.get(e)}},Oa=class{constructor({stats:{enabled:e=!1,interval:r=10},hostname:s,port:n,url:i,env:o,tags:a}={}){this.exporter=new bM({hostname:s,port:n,tags:a,url:i}),this.interval=r,this.bucketSizeNs=r*1e9,this.buckets=new In,this.hostname=dM.hostname(),this.enabled=e,this.env=o,this.tags=a||{},this.sequence=0,e&&(this.timer=setInterval(this.onInterval.bind(this),r*1e3),this.timer.unref())}onInterval(){let e=this._serializeBuckets();e&&this.exporter.export({Hostname:this.hostname,Env:this.env,Version:hM,Stats:e,Lang:"javascript",TracerVersion:fM.version,RuntimeID:this.tags["runtime-id"],Sequence:++this.sequence})}onSpanFinished(e){if(!this.enabled||!e.metrics[k_]&&!e.metrics[mM])return;let r=e.startTime+e.duration,s=r-r%this.bucketSizeNs;this.buckets.forTime(s).forSpan(e).record(e)}_serializeBuckets(){let{bucketSizeNs:e}=this,r=[];for(let[s,n]of this.buckets.entries()){let i=[];for(let o of n.values())i.push(o.toJSON());r.push({Start:s,Duration:e,Stats:i})}return this.buckets.clear(),r}};R_.exports={SpanAggStats:Tn,SpanAggKey:wn,SpanBuckets:xn,TimeBuckets:In,SpanStatsProcessor:Oa}});var D_=p((TQ,N_)=>{"use strict";var Ae=E(),SM=Xm(),qM=a_(),{SpanStatsProcessor:EM}=C_(),O_=new WeakSet,P_=new WeakSet,Pa=class{constructor(e,r,s){this._exporter=e,this._prioritySampler=r,this._config=s,this._killAll=!1,this._stats=new EM(s),this._spanSampler=new qM(s.sampler)}process(e){let r=e.context(),s=[],n=[],i=r._trace,{flushMinSpans:o}=this._config,{started:a,finished:c}=i;if(i.record!==!1){if(a.length===c.length||c.length>=o){this._prioritySampler.sample(r),this._spanSampler.sample(r);for(let u of a)if(u._duration!==void 0){let l=SM(u);this._stats.onSpanFinished(l),n.push(l)}else s.push(u);n.length!==0&&i.isRecording!==!1&&this._exporter.export(n),this._erase(i,s)}this._killAll&&a.map(u=>{u._finished||u.finish()})}}killAll(){this._killAll=!0}_erase(e,r){if(process.env.DD_TRACE_EXPERIMENTAL_STATE_TRACKING==="true"){let s=new Set,n=new Set,i=new Set,o=new Set;for(let a of e.finished){let c=a.context(),u=c.toSpanId();i.has(a)?Ae.error(`Span was already finished in the same trace: ${a}`):(i.add(a),o.has(u)?Ae.error(`Another span with the same ID was already finished in the same trace: ${a}`):o.add(u),c._trace!==e&&Ae.error(`A span was finished in the wrong trace: ${a}.`),P_.has(a)?Ae.error(`Span was already finished in a different trace: ${a}`):P_.add(a))}for(let a of e.started){let c=a.context(),u=c.toSpanId();s.has(a)?Ae.error(`Span was already started in the same trace: ${a}`):(s.add(a),n.has(u)?Ae.error(`Another span with the same ID was already started in the same trace: ${a}`):n.add(u),c._trace!==e&&Ae.error(`A span was started in the wrong trace: ${a}.`),O_.has(a)?Ae.error(`Span was already started in a different trace: ${a}`):O_.add(a)),i.has(a)||Ae.error(`Span started in one trace but was finished in another trace: ${a}`)}for(let a of e.finished)s.has(a)||Ae.error(`Span finished in one trace but was started in another trace: ${a}`)}for(let s of e.finished)s.context()._tags={};e.started=r,e.finished=[]}};N_.exports=Pa});var Vr=p((wQ,L_)=>{"use strict";var{info:TM,warn:wM}=Qo(),Na=require("os"),{inspect:xM}=require("util"),IM=Ie().version,P,An,Da=[],M_=!1;function AM(){let t=new Set,e={};for(let r in An._pluginsByName)t.add(r);return e.integrations_loaded=Array.from(t),e}function kM({agentError:t}={}){if(!P||!An||M_||(M_=!0,!P.startupLogs))return;let e=P.url||`http://${P.hostname||"localhost"}:${P.port}`,r={[xM.custom](){return String(this)},toString(){return JSON.stringify(this)}};r.date=new Date().toISOString(),r.os_name=Na.type(),r.os_version=Na.release(),r.architecture=Na.arch(),r.version=IM,r.lang="nodejs",r.lang_version=process.versions.node,r.env=P.env,r.enabled=P.enabled,r.service=P.service,r.agent_url=e,t&&(r.agent_error=t.message),r.debug=!!P.debug,r.sample_rate=P.sampleRate,r.sampling_rules=Da,r.tags=P.tags,P.tags&&P.tags.version&&(r.dd_version=P.tags.version),r.log_injection_enabled=!!P.logInjection,r.runtime_metrics_enabled=!!P.runtimeMetrics,r.profiling_enabled=!!(P.profiling||{}).enabled,Object.assign(r,AM()),r.appsec_enabled=!!P.appsec.enabled,TM("DATADOG TRACER CONFIGURATION - "+r),t&&wM("DATADOG TRACER DIAGNOSTIC - Agent Error: "+t.message),P=void 0,An=void 0,Da=void 0}function RM(t){P=t}function CM(t){An=t}function OM(t){Da=t}L_.exports={startupLog:kM,setStartupLogConfig:RM,setStartupLogPluginManager:CM,setSamplingRules:OM}});var F_=p((xQ,G_)=>{"use strict";var PM=qn(),ja=ya(),it=ma(),{setSamplingRules:NM}=Vr(),{SAMPLING_MECHANISM_DEFAULT:DM,SAMPLING_MECHANISM_AGENT:MM,SAMPLING_MECHANISM_RULE:LM,SAMPLING_MECHANISM_MANUAL:jM,SAMPLING_RULE_DECISION:UM,SAMPLING_LIMIT_DECISION:HM,SAMPLING_AGENT_DECISION:BM,DECISION_MAKER_KEY:Ma}=A(),$M=it.tags.SERVICE_NAME,GM=it.tags.SAMPLING_PRIORITY,j_=it.tags.MANUAL_KEEP,U_=it.tags.MANUAL_DROP,kn=it.priority.USER_REJECT,H_=it.priority.AUTO_REJECT,Yr=it.priority.AUTO_KEEP,Kr=it.priority.USER_KEEP,La="service:,env:",B_=new ja(Yr),Ua=class{constructor(e,{sampleRate:r,rateLimit:s=100,rules:n=[]}={}){this._env=e,this._rules=this._normalizeRules(n,r),this._limiter=new PM(s),NM(this._rules),this.update({})}isSampled(e){let r=this._getPriorityFromAuto(e);return r===Kr||r===Yr}sample(e,r=!0){if(!e)return;let s=this._getContext(e),n=s._trace.started[0];if(s._sampling.priority!==void 0||!n)return;let i=this._getPriorityFromTags(s._tags);if(this.validate(i))s._sampling.priority=i,s._sampling.mechanism=jM;else if(r)s._sampling.priority=this._getPriorityFromAuto(n);else return;this._addDecisionMaker(n)}update(e){let r={};for(let s in e){let n=e[s],i=new ja(n);r[s]=i}r[La]=r[La]||B_,this._samplers=r}validate(e){switch(e){case kn:case Kr:case H_:case Yr:return!0;default:return!1}}_getContext(e){return typeof e.context=="function"?e.context():e}_getPriorityFromAuto(e){let r=this._getContext(e),s=this._findRule(r);return s?this._getPriorityByRule(r,s):this._getPriorityByAgent(r)}_getPriorityFromTags(e){if($_(e,j_)&&e[j_]!==!1)return Kr;if($_(e,U_)&&e[U_]!==!1)return kn;{let r=parseInt(e[GM],10);if(r===1||r===2)return Kr;if(r===0||r===-1)return kn}}_getPriorityByRule(e,r){return e._trace[UM]=r.sampleRate,e._sampling.mechanism=LM,r.sampler.isSampled(e)&&this._isSampledByRateLimit(e)?Kr:kn}_isSampledByRateLimit(e){let r=this._limiter.isAllowed();return e._trace[HM]=this._limiter.effectiveRate(),r}_getPriorityByAgent(e){let r=`service:${e._tags[$M]},env:${this._env}`,s=this._samplers[r]||this._samplers[La];return e._trace[BM]=s.rate(),s===B_?e._sampling.mechanism=DM:e._sampling.mechanism=MM,s.isSampled(e)?Yr:H_}_addDecisionMaker(e){let r=e.context(),s=r._trace,n=r._sampling.priority,i=r._sampling.mechanism;n>=Yr?s.tags[Ma]||(s.tags[Ma]=`-${i}`):delete s.tags[Ma]}_normalizeRules(e,r){return e=[].concat(e||[]),e.concat({sampleRate:r}).map(s=>({...s,sampleRate:parseFloat(s.sampleRate)})).filter(s=>!isNaN(s.sampleRate)).map(s=>({...s,sampler:new ja(s.sampleRate)}))}_findRule(e){for(let r=0,s=this._rules.length;r<s;r++)if(this._matchRule(e,this._rules[r]))return this._rules[r]}_matchRule(e,r){let s=e._name,n=e._tags["service.name"];return!(r.name instanceof RegExp&&!r.name.test(s)||typeof r.name=="string"&&r.name!==s||r.service instanceof RegExp&&!r.service.test(n)||typeof r.service=="string"&&r.service!==n)}};function $_(t,e){return Object.prototype.hasOwnProperty.call(t,e)}G_.exports=Ua});var K_=p((IQ,V_)=>{"use strict";var FM=/[ \t]*([^=]+)=([ \t]*[^, \t]+)[ \t]*(,|$)/gim,zM=/([^:]+):([^;]+)(;|$)/gim;function z_(t,e,r){if(typeof r!="string"||!r.length)return new t;let s=[];for(let n of r.matchAll(e))s.unshift(n.slice(1,3));return new t(s)}function W_(t,e,r){return Array.from(t.entries()).reverse().map(s=>s.join(e)).join(r)}var Jr=class extends Map{constructor(...e){super(...e),this.changed=!1}set(...e){if(!(this.has(e[0])&&this.get(e[0])===e[1]))return this.changed=!0,super.set(...e)}delete(...e){return this.changed=!0,super.delete(...e)}clear(...e){return this.changed=!0,super.clear(...e)}static fromString(e){return z_(Jr,zM,e)}toString(){return W_(this,":",";")}},Xr=class extends Map{set(e,r){return this.has(e)&&this.delete(e),super.set(e,r)}forVendor(e,r){let s=super.get(e),n=Jr.fromString(s),i=r(n);return n.changed&&(n.toString()?this.set(e,n.toString()):this.delete(e)),i}static fromString(e){return z_(Xr,FM,e)}toString(){return W_(this,"=",",")}};V_.exports=Xr});var Wa=p((AQ,tb)=>{"use strict";var Y_=require("lodash.pick"),Qr=de(),Ha=Qt(),ot=E(),J_=K_(),{AUTO_KEEP:Rn,AUTO_REJECT:WM,USER_KEEP:VM}=Xt(),$a="x-datadog-trace-id",Ga="x-datadog-parent-id",On="x-datadog-origin",Fa="x-datadog-sampling-priority",Cn="x-datadog-tags",Z_="ot-baggage-",at="x-b3-traceid",KM=/^([0-9a-f]{16}){1,2}$/i,At="x-b3-spanid",YM=/^[0-9a-f]{16}$/i,eb="x-b3-parentspanid",Ue="x-b3-sampled",ct="x-b3-flags",Zr="b3",JM="x-aws-sqsd-attr-_datadog",XM=/^(([0-9a-f]{16}){1,2}-[0-9a-f]{16}(-[01d](-[0-9a-f]{16})?)?|[01d])$/i,QM=new RegExp(`^${Z_}(.+)$`),ZM=/^_dd\.p\.[\x21-\x2b\x2d-\x7e]+$/,e1=/^[\x20-\x2b\x2d-\x7e]*$/,t1=[$a,Ga,Fa,On],r1=[at,At,eb,Ue,ct,Zr],X_=t1.concat(r1),s1=/^([a-f0-9]{2})-([a-f0-9]{32})-([a-f0-9]{16})-([a-f0-9]{2})(-.*)?$/i,Q_="traceparent",n1=/[^\x20-\x2b\x2d-\x3a\x3c-\x7d]/g,i1=/[^\x21-\x2b\x2d-\x3c\x3e-\x7e]/g,o1=/[^\x20-\x2b\x2d-\x3a\x3c-\x7d]/g,Ba=/^0+$/,za=class{constructor(e){this._config=e}inject(e,r){this._injectBaggageItems(e,r),this._injectDatadog(e,r),this._injectB3MultipleHeaders(e,r),this._injectB3SingleHeader(e,r),this._injectTraceparent(e,r),ot.debug(()=>`Inject into carrier: ${JSON.stringify(Y_(r,X_))}.`)}extract(e){let r=this._extractSpanContext(e);return r&&(ot.debug(()=>`Extract from carrier: ${JSON.stringify(Y_(e,X_))}.`),r)}_injectDatadog(e,r){this._hasPropagationStyle("inject","datadog")&&(r[$a]=e.toTraceId(),r[Ga]=e.toSpanId(),this._injectOrigin(e,r),this._injectSamplingPriority(e,r),this._injectTags(e,r))}_injectOrigin(e,r){let s=e._trace.origin;s&&(r[On]=s)}_injectSamplingPriority(e,r){let s=e._sampling.priority;Number.isInteger(s)&&(r[Fa]=s.toString())}_injectBaggageItems(e,r){e._baggageItems&&Object.keys(e._baggageItems).forEach(s=>{r[Z_+s]=String(e._baggageItems[s])})}_injectTags(e,r){let s=e._trace;if(this._config.tagsHeaderMaxLength===0){ot.debug("Trace tag propagation is disabled, skipping injection.");return}let n=[];for(let o in s.tags)if(!(!s.tags[o]||!o.startsWith("_dd.p."))){if(!this._validateTagKey(o)||!this._validateTagValue(s.tags[o])){ot.error("Trace tags from span are invalid, skipping injection.");return}n.push(`${o}=${s.tags[o]}`)}let i=n.join(",");i.length>this._config.tagsHeaderMaxLength?ot.error("Trace tags from span are too large, skipping injection."):i&&(r[Cn]=i)}_injectB3MultipleHeaders(e,r){let s=this._hasPropagationStyle("inject","b3"),n=this._hasPropagationStyle("inject","b3multi");(s||n)&&(r[at]=this._getB3TraceId(e),r[At]=e._spanId.toString(16),r[Ue]=e._sampling.priority>=Rn?"1":"0",e._sampling.priority>Rn&&(r[ct]="1"),e._parentId&&(r[eb]=e._parentId.toString(16)))}_injectB3SingleHeader(e,r){if(!this._hasPropagationStyle("inject","b3 single header"))return null;let n=this._getB3TraceId(e),i=e._spanId.toString(16),o=e._sampling.priority>=Rn?"1":"0";r[Zr]=`${n}-${i}-${o}`,e._parentId&&(r[Zr]+="-"+e._parentId.toString(16))}_injectTraceparent(e,r){if(!this._hasPropagationStyle("inject","tracecontext"))return;let{_sampling:{priority:s,mechanism:n},_tracestate:i=new J_,_trace:{origin:o,tags:a}}=e;r[Q_]=e.toTraceparent(),i.forVendor("dd",c=>{if(c.set("s",s),n&&c.set("t.dm",n),typeof o=="string"){let u=o.replace(n1,"_").replace(/[\x3d]/g,"~");c.set("o",u)}for(let u in a){if(!a[u]||!u.startsWith("_dd.p."))continue;let l="t."+u.slice(6).replace(i1,"_"),d=a[u].toString().replace(o1,"_").replace(/[\x3d]/g,"~");c.set(l,d)}}),r.tracestate=i.toString()}_hasPropagationStyle(e,r){return this._config.tracePropagationStyle[e].includes(r)}_extractSpanContext(e){for(let r of this._config.tracePropagationStyle.extract){let s=null;switch(r){case"datadog":s=this._extractDatadogContext(e);break;case"tracecontext":s=this._extractTraceparentContext(e);break;case"b3":case"b3multi":s=this._extractB3MultiContext(e);break;case"b3 single header":s=this._extractB3SingleContext(e);break}if(s!==null)return s}return this._extractSqsdContext(e)}_extractDatadogContext(e){let r=this._extractGenericContext(e,$a,Ga,10);return r&&(this._extractOrigin(e,r),this._extractBaggageItems(e,r),this._extractSamplingPriority(e,r),this._extractTags(e,r)),r}_extractB3MultiContext(e){let r=this._extractB3MultipleHeaders(e);return r?this._extractB3Context(r):null}_extractB3SingleContext(e){if(!XM.test(e[Zr]))return null;let r=this._extractB3SingleHeader(e);return r?this._extractB3Context(r):null}_extractB3Context(e){let r=e[ct]==="1",s=this._getPriority(e[Ue],r),n=this._extractGenericContext(e,at,At,16);if(s!==void 0){if(!n)return new Ha({traceId:Qr(),spanId:null,sampling:{priority:s}});n._sampling.priority=s}return this._extract128BitTraceId(e[at],n),n}_extractSqsdContext(e){let r=e[JM];if(!r)return null;let s;try{s=JSON.parse(r)}catch{return null}return this._extractDatadogContext(s)}_extractTraceparentContext(e){let r=e[Q_];if(!r)return null;let s=r.trim().match(s1);if(s.length){let[n,i,o,a,c]=s.slice(1),u={version:n},l=J_.fromString(e.tracestate);if(Ba.test(i)||Ba.test(o)||n==="ff"||c&&n==="00")return null;let d=new Ha({traceId:Qr(i,16),spanId:Qr(o,16),sampling:{priority:parseInt(a,10)&1?1:0},traceparent:u,tracestate:l});return this._extract128BitTraceId(i,d),l.forVendor("dd",h=>{for(let[f,g]of h.entries())switch(f){case"s":{let v=parseInt(g,10);if(!Number.isInteger(v))continue;(d._sampling.priority===1&&v>0||d._sampling.priority===0&&v<0)&&(d._sampling.priority=v);break}case"o":d._trace.origin=g;break;case"t.dm":{let v=-Math.abs(parseInt(g,10));Number.isInteger(v)&&(d._sampling.mechanism=v,d._trace.tags["_dd.p.dm"]=String(v));break}default:if(!f.startsWith("t."))continue;d._trace.tags[`_dd.p.${f.slice(2)}`]=g.replace(/[\x7e]/gm,"=")}}),this._extractBaggageItems(e,d),d}return null}_extractGenericContext(e,r,s,n){return e[r]&&e[s]?Ba.test(e[r])?null:new Ha({traceId:Qr(e[r],n),spanId:Qr(e[s],n)}):null}_extractB3MultipleHeaders(e){let r=!0,s={};return KM.test(e[at])&&YM.test(e[At])&&(s[at]=e[at],s[At]=e[At],r=!1),e[Ue]&&(s[Ue]=e[Ue],r=!1),e[ct]&&(s[ct]=e[ct],r=!1),r?null:s}_extractB3SingleHeader(e){let r=e[Zr];if(!r)return null;let s=r.split("-");if(s[0]==="d")return{[Ue]:"1",[ct]:"1"};if(s.length===1)return{[Ue]:s[0]};{let n={[at]:s[0],[At]:s[1]};return s[2]&&(n[Ue]=s[2]!=="0"?"1":"0",s[2]==="d"&&(n[ct]="1")),n}}_extractOrigin(e,r){let s=e[On];typeof e[On]=="string"&&(r._trace.origin=s)}_extractBaggageItems(e,r){Object.keys(e).forEach(s=>{let n=s.match(QM);n&&(r._baggageItems[n[1]]=e[s])})}_extractSamplingPriority(e,r){let s=parseInt(e[Fa],10);Number.isInteger(s)&&(r._sampling.priority=s)}_extractTags(e,r){if(!e[Cn])return;let s=r._trace;if(this._config.tagsHeaderMaxLength===0)ot.debug("Trace tag propagation is disabled, skipping extraction.");else if(e[Cn].length>this._config.tagsHeaderMaxLength)ot.error("Trace tags from carrier are too large, skipping extraction.");else{let n=e[Cn].split(","),i={};for(let o of n){let[a,...c]=o.split("="),u=c.join("=");if(!this._validateTagKey(a)||!this._validateTagValue(u)){ot.error("Trace tags from carrier are invalid, skipping extraction.");return}i[a]=u}Object.assign(s.tags,i)}}_extract128BitTraceId(e,r){if(!r||r._traceId.toBuffer().length!==16)return;let n=e.substring(0,16);n!=="0000000000000000"&&(r._trace.tags["_dd.p.tid"]=n)}_validateTagKey(e){return ZM.test(e)}_validateTagValue(e){return e1.test(e)}_getPriority(e,r){if(r)return VM;if(e==="1")return Rn;if(e==="0")return WM}_getB3TraceId(e){return e._traceId.toBuffer().length<=8&&e._trace.tags["_dd.p.tid"]?e._trace.tags["_dd.p.tid"]+e._traceId.toString(16):e._traceId.toString(16)}};tb.exports=za});var sb=p((kQ,rb)=>{"use strict";var a1=Wa(),Va=class extends a1{};rb.exports=Va});var ib=p((RQ,nb)=>{"use strict";var Ka=class{inject(e,r){}extract(e){return null}};nb.exports=Ka});var cb=p((CQ,ab)=>{"use strict";var Pn=de(),ob=Qt(),Ya=class{constructor(e){this._config=e}inject(e,r){r&&(r.dd={},e&&(this._config.traceId128BitLoggingEnabled&&e._trace.tags["_dd.p.tid"]?r.dd.trace_id=e._trace.tags["_dd.p.tid"]+e._traceId.toString(16):r.dd.trace_id=e.toTraceId(),r.dd.span_id=e.toSpanId()),this._config.service&&(r.dd.service=this._config.service),this._config.version&&(r.dd.version=this._config.version),this._config.env&&(r.dd.env=this._config.env))}extract(e){if(!e||!e.dd||!e.dd.trace_id||!e.dd.span_id)return null;if(e.dd.trace_id.length===32){let r=e.dd.trace_id.substring(0,16),s=e.dd.trace_id.substring(16,32),n=new ob({traceId:Pn(s,16),spanId:Pn(e.dd.span_id,10)});return n._trace.tags["_dd.p.tid"]=r,n}else return new ob({traceId:Pn(e.dd.trace_id,10),spanId:Pn(e.dd.span_id,10)})}};ab.exports=Ya});var Qa=p((OQ,hb)=>{"use strict";var ub=E(),lb='{"traces":[[',db=`]]}
`,Ja=lb.length+db.length,pb=64*1024,Xa=class{export(e){ub.debug(()=>`Adding trace to queue: ${JSON.stringify(e)}`);let r=Ja,s=[];for(let n of e){let i=JSON.stringify(n);if(i.length+Ja>pb){ub.debug("Span too large to send to logs, dropping");continue}i.length+r>pb&&(this._printSpans(s),s=[],r=Ja),r+=i.length+1,s.push(i)}s.length>0&&this._printSpans(s)}_printSpans(e){let r=lb,s=!0;for(let n of e)s?(s=!1,r+=n):r+=","+n;r+=db,process.stdout.write(r)}};hb.exports=Xa});var gb=p((PQ,fb)=>{"use strict";var{truncateSpan:c1,normalizeSpan:u1}=tr(),{AgentEncoder:p1}=rr(),l1=146,d1=156;function h1(t){return u1(c1(t,!1))}var Za=class extends p1{makePayload(){let r=this._stringBytes.length+5,s=this._traceBytes.length+5,n=Buffer.allocUnsafe(1+r+s),i=0;return n[i++]=l1,i=this._writeStrings(n,i),i=this._writeTraces(n,i),this._reset(),n}_encode(e,r){this._encodeArrayPrefix(e,r);for(let s of r)s=h1(s),this._encodeByte(e,d1),this._encodeString(e,s.service),this._encodeString(e,s.name),this._encodeString(e,s.resource),this._encodeId(e,s.trace_id),this._encodeId(e,s.span_id),this._encodeId(e,s.parent_id),this._encodeLong(e,s.start||0),this._encodeLong(e,s.duration||0),this._encodeInteger(e,s.error),this._encodeMap(e,s.meta||{}),this._encodeMap(e,s.metrics||{}),this._encodeString(e,s.type)}_encodeString(e,r=""){this._cacheString(r),this._encodeInteger(e,this._stringMap[r])}_cacheString(e){e in this._stringMap||(this._stringMap[e]=this._stringCount++,this._stringBytes.write(e))}_writeStrings(e,r){return r=this._writeArrayPrefix(e,r,this._stringCount),r+=this._stringBytes.buffer.copy(e,r,0,this._stringBytes.length),r}};fb.exports={AgentEncoder:Za}});var rc=p((NQ,_b)=>{"use strict";var f1=X(),{startupLog:mb}=Vr(),ut=Gr(),Nn=E(),g1=Ie().version,m1=Wr(),pt="datadog.tracer.node.exporter.agent",tc=class extends m1{constructor({prioritySampler:e,lookup:r,protocolVersion:s,headers:n}){super(...arguments);let i=_1(s);this._prioritySampler=e,this._lookup=r,this._protocolVersion=s,this._encoder=new i(this),this._headers=n}_sendPayload(e,r,s){ut.increment(`${pt}.requests`,!0);let{_headers:n,_lookup:i,_protocolVersion:o,_url:a}=this;b1(o,e,r,a,n,i,!0,(c,u,l)=>{if(l?(ut.increment(`${pt}.responses`,!0),ut.increment(`${pt}.responses.by.status`,`status:${l}`,!0)):c&&(ut.increment(`${pt}.errors`,!0),ut.increment(`${pt}.errors.by.name`,`name:${c.name}`,!0),c.code&&ut.increment(`${pt}.errors.by.code`,`code:${c.code}`,!0)),mb({agentError:c}),c){Nn.error(c),s();return}Nn.debug(`Response from the agent: ${u}`);try{this._prioritySampler.update(JSON.parse(u).rate_by_service)}catch(d){Nn.error(d),ut.increment(`${pt}.errors`,!0),ut.increment(`${pt}.errors.by.name`,`name:${d.name}`,!0)}s()})}};function ec(t,e,r){r&&(t[e]=r)}function _1(t){return t==="0.5"?gb().AgentEncoder:rr().AgentEncoder}function b1(t,e,r,s,n,i,o,a){let c={path:`/v${t}/traces`,method:"PUT",headers:{...n,"Content-Type":"application/msgpack","Datadog-Meta-Tracer-Version":g1,"X-Datadog-Trace-Count":String(r)},lookup:i,url:s};ec(c.headers,"Datadog-Meta-Lang","nodejs"),ec(c.headers,"Datadog-Meta-Lang-Version",process.version),ec(c.headers,"Datadog-Meta-Lang-Interpreter",process.jsEngine||"v8"),Nn.debug(()=>`Request to the agent: ${JSON.stringify(c)}`),f1(e,c,(u,l,d)=>{o&&mb({agentError:d!==404&&d!==200?u:void 0}),a(u,l,d)})}_b.exports=tc});var nc=p((DQ,yb)=>{"use strict";var{URL:bb,format:y1}=require("url"),v1=E(),S1=rc(),sc=class{constructor(e,r){this._config=e;let{url:s,hostname:n,port:i,lookup:o,protocolVersion:a,stats:c={}}=e;this._url=s||new bb(y1({protocol:"http:",hostname:n||"localhost",port:i}));let u={};c.enabled&&(u["Datadog-Client-Computed-Stats"]="yes"),this._writer=new S1({url:this._url,prioritySampler:r,lookup:o,protocolVersion:a,headers:u}),this._timer=void 0,process.once("beforeExit",()=>this._writer.flush())}setUrl(e){try{e=new bb(e),this._url=e,this._writer.setUrl(e)}catch(r){v1.warn(r.stack)}}export(e){this._writer.append(e);let{flushInterval:r}=this._config;r===0?this._writer.flush():r>0&&!this._timer&&(this._timer=setTimeout(()=>{this._writer.flush(),this._timer=clearTimeout(this._timer)},r).unref())}flush(e=()=>{}){this._writer.flush(e)}};yb.exports=sc});var qb=p((MQ,Sb)=>{"use strict";var{truncateSpan:q1,normalizeSpan:E1}=tr(),{AgentEncoder:T1}=rr(),{version:w1}=Ie(),ic=de(),vb=1,x1=["test_session_end","test_module_end","test_suite_end","test"],I1=12,A1=11,k1=10,R1=2*1024*1024;function C1(t){let e=vb;return t.type==="test"&&t.meta&&t.meta.test_session_id&&(e=2),{type:x1.includes(t.type)?t.type:"span",version:e,content:E1(q1(t))}}var oc=class extends T1{constructor(e,{runtimeId:r,service:s,env:n}){super(e,R1),this.runtimeId=r,this.service=s,this.env=n,this._eventCount=0,this.reset()}_encodeTestSuite(e,r){this._encodeMapPrefix(e,I1),this._encodeString(e,"type"),this._encodeString(e,r.type),this._encodeString(e,"test_session_id"),this._encodeId(e,r.trace_id),this._encodeString(e,"test_module_id"),this._encodeId(e,r.parent_id),this._encodeString(e,"test_suite_id"),this._encodeId(e,r.span_id),this._encodeString(e,"error"),this._encodeNumber(e,r.error),this._encodeString(e,"name"),this._encodeString(e,r.name),this._encodeString(e,"service"),this._encodeString(e,r.service),this._encodeString(e,"resource"),this._encodeString(e,r.resource),this._encodeString(e,"start"),this._encodeNumber(e,r.start),this._encodeString(e,"duration"),this._encodeNumber(e,r.duration),this._encodeString(e,"meta"),this._encodeMap(e,r.meta),this._encodeString(e,"metrics"),this._encodeMap(e,r.metrics)}_encodeTestModule(e,r){this._encodeMapPrefix(e,A1),this._encodeString(e,"type"),this._encodeString(e,r.type),this._encodeString(e,"test_session_id"),this._encodeId(e,r.trace_id),this._encodeString(e,"test_module_id"),this._encodeId(e,r.span_id),this._encodeString(e,"error"),this._encodeNumber(e,r.error),this._encodeString(e,"name"),this._encodeString(e,r.name),this._encodeString(e,"service"),this._encodeString(e,r.service),this._encodeString(e,"resource"),this._encodeString(e,r.resource),this._encodeString(e,"start"),this._encodeNumber(e,r.start),this._encodeString(e,"duration"),this._encodeNumber(e,r.duration),this._encodeString(e,"meta"),this._encodeMap(e,r.meta),this._encodeString(e,"metrics"),this._encodeMap(e,r.metrics)}_encodeTestSession(e,r){this._encodeMapPrefix(e,k1),this._encodeString(e,"type"),this._encodeString(e,r.type),this._encodeString(e,"test_session_id"),this._encodeId(e,r.trace_id),this._encodeString(e,"error"),this._encodeNumber(e,r.error),this._encodeString(e,"name"),this._encodeString(e,r.name),this._encodeString(e,"service"),this._encodeString(e,r.service),this._encodeString(e,"resource"),this._encodeString(e,r.resource),this._encodeString(e,"start"),this._encodeNumber(e,r.start),this._encodeString(e,"duration"),this._encodeNumber(e,r.duration),this._encodeString(e,"meta"),this._encodeMap(e,r.meta),this._encodeString(e,"metrics"),this._encodeMap(e,r.metrics)}_encodeEventContent(e,r){let s=Object.keys(r).length;r.meta.test_session_id?this._encodeMapPrefix(e,s+3):this._encodeMapPrefix(e,s),r.type&&(this._encodeString(e,"type"),this._encodeString(e,r.type)),this._encodeString(e,"trace_id"),this._encodeId(e,r.trace_id),this._encodeString(e,"span_id"),this._encodeId(e,r.span_id),this._encodeString(e,"parent_id"),this._encodeId(e,r.parent_id),this._encodeString(e,"name"),this._encodeString(e,r.name),this._encodeString(e,"resource"),this._encodeString(e,r.resource),this._encodeString(e,"service"),this._encodeString(e,r.service),this._encodeString(e,"error"),this._encodeNumber(e,r.error),this._encodeString(e,"start"),this._encodeNumber(e,r.start),this._encodeString(e,"duration"),this._encodeNumber(e,r.duration),r.meta.test_session_id&&(this._encodeString(e,"test_session_id"),this._encodeId(e,ic(r.meta.test_session_id,10)),delete r.meta.test_session_id,this._encodeString(e,"test_module_id"),this._encodeId(e,ic(r.meta.test_module_id,10)),delete r.meta.test_module_id,this._encodeString(e,"test_suite_id"),this._encodeId(e,ic(r.meta.test_suite_id,10)),delete r.meta.test_suite_id),this._encodeString(e,"meta"),this._encodeMap(e,r.meta),this._encodeString(e,"metrics"),this._encodeMap(e,r.metrics)}_encodeEvent(e,r){this._encodeMapPrefix(e,Object.keys(r).length),this._encodeString(e,"type"),this._encodeString(e,r.type),this._encodeString(e,"version"),this._encodeNumber(e,r.version),this._encodeString(e,"content"),r.type==="span"||r.type==="test"?this._encodeEventContent(e,r.content):r.type==="test_suite_end"?this._encodeTestSuite(e,r.content):r.type==="test_module_end"?this._encodeTestModule(e,r.content):r.type==="test_session_end"&&this._encodeTestSession(e,r.content)}_encodeNumber(e,r){return Math.floor(r)!==r?this._encodeFloat(e,r):this._encodeLong(e,r)}_encodeLong(e,r){let s=r>=0,n=s?r/Math.pow(2,32)>>0:Math.floor(r/Math.pow(2,32)),i=r>>>0,o=s?207:211,a=e.length;e.reserve(9),e.length+=9,e.buffer[a]=o,e.buffer[a+1]=n>>24,e.buffer[a+2]=n>>16,e.buffer[a+3]=n>>8,e.buffer[a+4]=n,e.buffer[a+5]=i>>24,e.buffer[a+6]=i>>16,e.buffer[a+7]=i>>8,e.buffer[a+8]=i}_encode(e,r){let s=r.map(C1),n=s.filter(a=>a.type==="test_session_end"||a.type==="test_suite_end"||a.type==="test_module_end"),o=!!n.length?n:s;this._eventCount+=o.length;for(let a of o)this._encodeEvent(e,a)}makePayload(){let e=this._traceBytes,r=this._eventsOffset,s=this._eventCount;e.buffer[r]=221,e.buffer[r+1]=s>>24,e.buffer[r+2]=s>>16,e.buffer[r+3]=s>>8,e.buffer[r+4]=s;let n=e.length,i=Buffer.allocUnsafe(n);return e.buffer.copy(i,0,0,n),this.reset(),i}_encodePayloadStart(e){let r={version:vb,metadata:{"*":{language:"javascript",library_version:w1}},events:[]};this.env&&(r.metadata["*"].env=this.env),this.runtimeId&&(r.metadata["*"]["runtime-id"]=this.runtimeId),this._encodeMapPrefix(e,Object.keys(r).length),this._encodeString(e,"version"),this._encodeNumber(e,r.version),this._encodeString(e,"metadata"),this._encodeMapPrefix(e,Object.keys(r.metadata).length),this._encodeString(e,"*"),this._encodeMap(e,r.metadata["*"]),this._encodeString(e,"events"),this._eventsOffset=e.length,e.reserve(5),e.length+=5}reset(){this._reset(),this._eventCount=0,this._encodePayloadStart(this._traceBytes)}};Sb.exports={AgentlessCiVisibilityEncoder:oc}});var uc=p((LQ,Eb)=>{"use strict";var O1=X(),ac=E(),{AgentlessCiVisibilityEncoder:P1}=qb(),N1=Wr();function D1(t){return JSON.stringify(t,(e,r)=>e!=="dd-api-key"?r:void 0)}var cc=class extends N1{constructor({url:e,tags:r,evpProxyPrefix:s=""}){super(...arguments);let{"runtime-id":n,env:i,service:o}=r;this._url=e,this._encoder=new P1(this,{runtimeId:n,env:i,service:o}),this._evpProxyPrefix=s}_sendPayload(e,r,s){let n={path:"/api/v2/citestcycle",method:"POST",headers:{"dd-api-key":process.env.DATADOG_API_KEY||process.env.DD_API_KEY,"Content-Type":"application/msgpack"},timeout:15e3,url:this._url};this._evpProxyPrefix&&(n.path=`${this._evpProxyPrefix}/api/v2/citestcycle`,delete n.headers["dd-api-key"],n.headers["X-Datadog-EVP-Subdomain"]="citestcycle-intake"),ac.debug(()=>`Request to the intake: ${D1(n)}`),O1(e,n,(i,o)=>{if(i){ac.error(i),s();return}ac.debug(`Response from the intake: ${o}`),s()})}};Eb.exports=cc});var Dn=p((jQ,Tb)=>{"use strict";var{Readable:M1}=require("stream"),L1=de(),pc=class extends M1{constructor(){super(),this._boundary=L1().toString(),this._data=[]}append(e,r,s={}){this._appendBoundary(),s.filename?this._appendFile(e,r,s):this._appendMetadata(e,r,s)}getHeaders(){return{"Content-Type":"multipart/form-data; boundary="+this._boundary}}_appendBoundary(){this._data.push(`--${this._boundary}\r
`)}_appendMetadata(e,r){this._data.push(`Content-Disposition: form-data; name="${e}"\r
\r
${r}\r
`)}_appendFile(e,r,{filename:s,contentType:n="application/octet-stream"}){this._data.push(`Content-Disposition: form-data; name="${e}"; filename="${s}"\r
`),this._data.push(`Content-Type: ${n}\r
\r
`),this._data.push(r),this._data.push(`\r
`)}_read(){this.push(this._data.shift()),this._data.length===0&&(this.push(`--${this._boundary}--\r
`),this.push(null))}};Tb.exports=pc});var Ib=p((UQ,xb)=>{"use strict";var{AgentEncoder:j1}=rr(),U1=Ea(),wb=Dn(),H1=2,B1=2,lc=class extends j1{constructor(){super(...arguments),this._coverageBytes=new U1,this.form=new wb,this._coveragesCount=0,this.reset()}count(){return this._coveragesCount}encode(e){this._coveragesCount++,this.encodeCodeCoverage(this._coverageBytes,e)}encodeCodeCoverage(e,r){this._encodeMapPrefix(e,3),this._encodeString(e,"test_session_id"),this._encodeId(e,r.traceId),this._encodeString(e,"test_suite_id"),this._encodeId(e,r.spanId),this._encodeString(e,"files"),this._encodeArrayPrefix(e,r.files);for(let s of r.files)this._encodeMapPrefix(e,1),this._encodeString(e,"filename"),this._encodeString(e,s)}reset(){this._reset(),this._coverageBytes&&(this._coverageBytes.length=0),this._coveragesCount=0,this._encodePayloadStart(this._coverageBytes)}_encodePayloadStart(e){let r={version:H1,coverages:[]};this._encodeMapPrefix(e,B1),this._encodeString(e,"version"),this._encodeInteger(e,r.version),this._encodeString(e,"coverages"),this._coveragesOffset=e.length,e.reserve(5),e.length+=5}makePayload(){let e=this._coverageBytes,r=this._coveragesOffset,s=this._coveragesCount;e.buffer[r]=221,e.buffer[r+1]=s>>24,e.buffer[r+2]=s>>16,e.buffer[r+3]=s>>8,e.buffer[r+4]=s;let n=e.length,i=Buffer.allocUnsafe(n);e.buffer.copy(i,0,0,e.length),this.form.append("coverage1",i,{filename:"coverage1.msgpack",contentType:"application/msgpack"}),this.form.append("event",JSON.stringify({dummy:!0}),{filename:"event.json",contentType:"application/json"});let o=this.form;return this.form=new wb,this.reset(),o}};xb.exports={CoverageCIVisibilityEncoder:lc}});var fc=p((HQ,Ab)=>{"use strict";var $1=X(),dc=E(),{CoverageCIVisibilityEncoder:G1}=Ib(),F1=Wr();function z1(t){return JSON.stringify(t,(e,r)=>e!=="dd-api-key"?r:void 0)}var hc=class extends F1{constructor({url:e,evpProxyPrefix:r=""}){super(...arguments),this._url=e,this._encoder=new G1(this),this._evpProxyPrefix=r}_sendPayload(e,r,s){let n={path:"/api/v2/citestcov",method:"POST",headers:{"dd-api-key":process.env.DATADOG_API_KEY||process.env.DD_API_KEY,...e.getHeaders()},timeout:15e3,url:this._url};this._evpProxyPrefix&&(n.path=`${this._evpProxyPrefix}/api/v2/citestcov`,delete n.headers["dd-api-key"],n.headers["X-Datadog-EVP-Subdomain"]="event-platform-intake"),dc.debug(()=>`Request to the intake: ${z1(n)}`),$1(e,n,(i,o)=>{if(i){dc.error(i),s();return}dc.debug(`Response from the intake: ${o}`),s()})}};Ab.exports=hc});var Rb=p((BQ,kb)=>{var W1=require("child_process"),V1=(t,e={})=>{try{return W1.execSync(t,e).toString().replace(/(\r\n|\n|\r)/gm,"")}catch{return""}};kb.exports={sanitizedExec:V1}});var es=p(($Q,Cb)=>{var K1="git.commit.sha",Y1="git.branch",J1="git.repository_url",X1="git.tag",Q1="git.commit.message",Z1="git.commit.committer.date",eL="git.commit.committer.email",tL="git.commit.committer.name",rL="git.commit.author.date",sL="git.commit.author.email",nL="git.commit.author.name",iL="ci.pipeline.id",oL="ci.pipeline.name",aL="ci.pipeline.number",cL="ci.pipeline.url",uL="ci.provider.name",pL="ci.workspace_path",lL="ci.job.url",dL="ci.job.name",hL="ci.stage.name",fL="_dd.ci.env_vars";Cb.exports={GIT_COMMIT_SHA:K1,GIT_BRANCH:Y1,GIT_REPOSITORY_URL:J1,GIT_TAG:X1,GIT_COMMIT_MESSAGE:Q1,GIT_COMMIT_COMMITTER_DATE:Z1,GIT_COMMIT_COMMITTER_EMAIL:eL,GIT_COMMIT_COMMITTER_NAME:tL,GIT_COMMIT_AUTHOR_DATE:rL,GIT_COMMIT_AUTHOR_EMAIL:sL,GIT_COMMIT_AUTHOR_NAME:nL,CI_PIPELINE_ID:iL,CI_PIPELINE_NAME:oL,CI_PIPELINE_NUMBER:aL,CI_PIPELINE_URL:cL,CI_PROVIDER_NAME:uL,CI_WORKSPACE_PATH:pL,CI_JOB_URL:lL,CI_JOB_NAME:dL,CI_STAGE_NAME:hL,CI_ENV_VARS:fL}});var gc=p((GQ,Nb)=>{var{execSync:ts}=require("child_process"),gL=require("os"),Ob=require("path"),rs=E(),{sanitizedExec:lt}=Rb(),{GIT_COMMIT_SHA:mL,GIT_BRANCH:_L,GIT_REPOSITORY_URL:bL,GIT_TAG:yL,GIT_COMMIT_MESSAGE:vL,GIT_COMMIT_COMMITTER_DATE:SL,GIT_COMMIT_COMMITTER_EMAIL:qL,GIT_COMMIT_COMMITTER_NAME:EL,GIT_COMMIT_AUTHOR_DATE:TL,GIT_COMMIT_AUTHOR_EMAIL:wL,GIT_COMMIT_AUTHOR_NAME:xL,CI_WORKSPACE_PATH:IL}=es(),Pb=8*1024*1024;function AL(){return lt("git rev-parse --is-shallow-repository",{stdio:"pipe"})==="true"}function kL(){try{ts('git config remote.origin.partialclonefilter "blob:none"',{stdio:"pipe"}),ts('git fetch --shallow-since="1 month ago" --update-shallow --refetch',{stdio:"pipe"})}catch(t){rs.error(t)}}function RL(){return lt("git config --get remote.origin.url",{stdio:"pipe"})}function CL(){try{return ts('git log --format=%H -n 1000 --since="1 month ago"',{stdio:"pipe"}).toString().split(`
`).filter(t=>t)}catch(t){return rs.error(t),[]}}function OL(t){let e='git rev-list --objects --no-object-names --filter=blob:none --since="1 month ago" HEAD';t.forEach(r=>{e=`${e} ^${r}`});try{return ts(e,{stdio:"pipe",maxBuffer:Pb}).toString().split(`
`).filter(r=>r)}catch(r){return rs.error(r),[]}}function PL(t){let e=gL.tmpdir(),r=String(Math.floor(Math.random()*1e4)),s=Ob.join(e,r),n=Ob.join(process.cwd(),r);function i(o){return ts(`git pack-objects --compression=9 --max-pack-size=3m ${o}`,{input:t.join(`
`)}).toString().split(`
`).filter(a=>a).map(a=>`${o}-${a}.pack`)}try{return i(s,t)}catch(o){rs.error(o);try{return i(n,t)}catch(a){rs.error(a)}return[]}}function NL(t){let{commitSHA:e,branch:r,repositoryUrl:s,tag:n,commitMessage:i,authorName:o,authorEmail:a,ciWorkspacePath:c}=t,[u,l,d,h,f,g]=lt("git show -s --format=%an,%ae,%aI,%cn,%ce,%cI",{stdio:"pipe"}).split(",");return{[bL]:s||lt("git ls-remote --get-url",{stdio:"pipe"}),[vL]:i||lt("git show -s --format=%s",{stdio:"pipe"}),[TL]:d,[xL]:o||u,[wL]:a||l,[SL]:g,[EL]:h,[qL]:f,[_L]:r||lt("git rev-parse --abbrev-ref HEAD",{stdio:"pipe"}),[mL]:e||lt("git rev-parse HEAD",{stdio:"pipe"}),[yL]:n,[IL]:c||lt("git rev-parse --show-toplevel",{stdio:"pipe"})}}Nb.exports={getGitMetadata:NL,getLatestCommits:CL,getRepositoryUrl:RL,generatePackFilesForCommits:PL,getCommitsToUpload:OL,GIT_REV_LIST_MAX_BUFFER:Pb,isShallowRepository:AL,unshallowRepository:kL}});var Ub=p((FQ,jb)=>{var DL=require("fs"),ML=require("path"),LL=Dn(),Mb=X(),jL=E(),{getLatestCommits:UL,getRepositoryUrl:HL,generatePackFilesForCommits:BL,getCommitsToUpload:$L,isShallowRepository:GL,unshallowRepository:FL}=gc(),zL=t=>/^[0-9a-f]{40}$/.test(t),WL=t=>/^[0-9a-f]{64}$/.test(t);function VL(t){return t.map(({id:e,type:r})=>{if(r!=="commit")throw new Error("Invalid commit type response");if(zL(e)||WL(e))return e.replace(/[^0-9a-f]+/g,"");throw new Error("Invalid commit format")})}function Lb(t){return{method:"POST",headers:{"dd-api-key":process.env.DATADOG_API_KEY||process.env.DD_API_KEY},timeout:15e3,url:t}}function KL({url:t,isEvpProxy:e,repositoryUrl:r},s){let n=UL(),[i]=n,o=Lb(t),a={...o,headers:{...o.headers,"Content-Type":"application/json"},path:"/api/v2/git/repository/search_commits"};e&&(a.path="/evp_proxy/v2/api/v2/git/repository/search_commits",a.headers["X-Datadog-EVP-Subdomain"]="api",delete a.headers["dd-api-key"]);let c=JSON.stringify({meta:{repository_url:r},data:n.map(u=>({id:u,type:"commit"}))});Mb(c,a,(u,l)=>{if(u){let h=new Error(`Error fetching commits to exclude: ${u.message}`);return s(h)}let d;try{d=VL(JSON.parse(l).data)}catch(h){return s(new Error(`Can't parse commits to exclude response: ${h.message}`))}s(null,d,i)})}function Db({url:t,isEvpProxy:e,packFileToUpload:r,repositoryUrl:s,headCommit:n},i){let o=new LL,a=JSON.stringify({data:{id:n,type:"commit"},meta:{repository_url:s}});o.append("pushedSha",a,{contentType:"application/json"});try{let l=DL.readFileSync(r),[,d]=ML.basename(r).split("-");o.append("packfile",l,{filename:d,contentType:"application/octet-stream"})}catch{i(new Error(`Could not read "${r}"`));return}let c=Lb(t),u={...c,path:"/api/v2/git/repository/packfile",headers:{...c.headers,...o.getHeaders()}};e&&(u.path="/evp_proxy/v2/api/v2/git/repository/packfile",u.headers["X-Datadog-EVP-Subdomain"]="api",delete u.headers["dd-api-key"]),Mb(o,u,(l,d,h)=>{if(l){let f=new Error(`Could not upload packfiles: status code ${h}: ${l.message}`);return i(f)}i(null)})}function YL(t,e,r){let s=HL();if(!s)return r(new Error("Repository URL is empty"));GL()&&FL(),KL({url:t,repositoryUrl:s,isEvpProxy:e},(n,i,o)=>{if(n)return r(n);let a=$L(i);if(!a.length)return jL.debug("No commits to upload"),r(null);let c=BL(a);if(!c.length)return r(new Error("Failed to generate packfiles"));let u=0,l=d=>d||u===c.length?r(d):Db({packFileToUpload:c[u++],url:t,isEvpProxy:e,repositoryUrl:s,headCommit:o},l);Db({packFileToUpload:c[u++],url:t,isEvpProxy:e,repositoryUrl:s,headCommit:o},l)})}jb.exports={sendGitMetadata:YL}});var Bb=p((zQ,Hb)=>{var JL=X(),XL=de();function QL({url:t,isEvpProxy:e,env:r,service:s,repositoryUrl:n,sha:i,osVersion:o,osPlatform:a,osArchitecture:c,runtimeName:u,runtimeVersion:l,branch:d,custom:h},f){let g={path:"/api/v2/libraries/tests/services/setting",method:"POST",headers:{"Content-Type":"application/json"},url:t};if(e)g.path="/evp_proxy/v2/api/v2/libraries/tests/services/setting",g.headers["X-Datadog-EVP-Subdomain"]="api",g.headers["X-Datadog-NeedsAppKey"]="true";else{let q=process.env.DATADOG_API_KEY||process.env.DD_API_KEY,_=process.env.DATADOG_APP_KEY||process.env.DD_APP_KEY||process.env.DATADOG_APPLICATION_KEY||process.env.DD_APPLICATION_KEY,S="Request to settings endpoint was not done because Datadog";if(!_)return f(new Error(`${S} application key is not defined.`));if(!q)return f(new Error(`${S} API key is not defined.`));g.headers["dd-api-key"]=q,g.headers["dd-application-key"]=_}let v=JSON.stringify({data:{id:XL().toString(10),type:"ci_app_test_service_libraries_settings",attributes:{test_level:"suite",configurations:{"os.platform":a,"os.version":o,"os.architecture":c,"runtime.name":u,"runtime.version":l,custom:h},service:s,env:r,repository_url:n,sha:i,branch:d}}});JL(v,g,(q,_)=>{if(q)f(q);else try{let{data:{attributes:{code_coverage:S,tests_skipping:T}}}=JSON.parse(_);f(null,{isCodeCoverageEnabled:S,isSuitesSkippingEnabled:T})}catch(S){f(S)}})}Hb.exports={getItrConfiguration:QL}});var Gb=p((WQ,$b)=>{var ZL=X();function ej({url:t,isEvpProxy:e,env:r,service:s,repositoryUrl:n,sha:i,osVersion:o,osPlatform:a,osArchitecture:c,runtimeName:u,runtimeVersion:l,custom:d},h){let f={path:"/api/v2/ci/tests/skippable",method:"POST",headers:{"Content-Type":"application/json"},timeout:2e4,url:t};if(e)f.path="/evp_proxy/v2/api/v2/ci/tests/skippable",f.headers["X-Datadog-EVP-Subdomain"]="api",f.headers["X-Datadog-NeedsAppKey"]="true";else{let v=process.env.DATADOG_API_KEY||process.env.DD_API_KEY,q=process.env.DATADOG_APP_KEY||process.env.DD_APP_KEY||process.env.DATADOG_APPLICATION_KEY||process.env.DD_APPLICATION_KEY,_="Skippable suites were not fetched because Datadog";if(!q)return h(new Error(`${_} application key is not defined.`));if(!v)return h(new Error(`${_} API key is not defined.`));f.headers["dd-api-key"]=v,f.headers["dd-application-key"]=q}let g=JSON.stringify({data:{type:"test_params",attributes:{test_level:"suite",configurations:{"os.platform":a,"os.version":o,"os.architecture":c,"runtime.name":u,"runtime.version":l,custom:d},service:s,env:r,repository_url:n,sha:i}}});ZL(g,f,(v,q)=>{if(v)h(v);else{let _=[];try{_=JSON.parse(q).data.filter(({type:S})=>S==="suite").map(({attributes:{suite:S}})=>S),h(null,_)}catch(S){h(S)}}})}$b.exports={getSkippableSuites:ej}});var zb=p((VQ,Fb)=>{var{URL:tj,format:rj}=require("url"),sj=X();function nj(t,e){sj("",{path:"/info",url:t},(r,s)=>{if(r)return e(r);try{let n=JSON.parse(s);return e(null,n)}catch(n){return e(n)}})}var mc=class{constructor(e){this._config=e;let{url:r,hostname:s,port:n}=this._config;this._url=r||new tj(rj({protocol:"http:",hostname:s||"localhost",port:n})),this._traceBuffer=[],this._isInitialized=!1}getAgentInfo(e){nj(this._url,e)}export(e){if(!this._isInitialized){this._traceBuffer.push(e);return}this._export(e)}_export(e,r=this._writer,s="_timer"){r.append(e);let{flushInterval:n}=this._config;n===0?r.flush():n>0&&!this[s]&&(this[s]=setTimeout(()=>{r.flush(),this[s]=clearTimeout(this[s])},n).unref())}getUncodedTraces(){return this._traceBuffer}exportUncodedTraces(){this.getUncodedTraces().forEach(e=>{this.export(e)}),this.resetUncodedTraces()}resetUncodedTraces(){this._traceBuffer=[]}};Fb.exports=mc});var yc=p((KQ,Yb)=>{"use strict";var Wb=require("url").URL,{sendGitMetadata:ij}=Ub(),{getItrConfiguration:oj}=Bb(),{getSkippableSuites:aj}=Gb(),_c=E(),cj=zb();function Vb(t){return t?Object.keys(t).reduce((e,r)=>{if(r.startsWith("test.configuration.")){let[,s]=r.split("test.configuration.");e[s]=t[r]}return e},{}):{}}function uj(t){return t.some(e=>e.type==="test_session_end"||e.type==="test_suite_end"||e.type==="test_module_end")}var Kb=6e4,pj=Kb,bc=class extends cj{constructor(e){super(e),this._timer=void 0,this._coverageTimer=void 0,this._coverageBuffer=[],this._canUseCiVisProtocol=!1;let r=setTimeout(()=>{this._resolveGit(new Error("Timeout while uploading git metadata"))},Kb).unref(),s=setTimeout(()=>{this._resolveCanUseCiVisProtocol(!1)},pj).unref();this._gitUploadPromise=new Promise(n=>{this._resolveGit=i=>{clearTimeout(r),n(i)}}),this._canUseCiVisProtocolPromise=new Promise(n=>{this._resolveCanUseCiVisProtocol=i=>{clearTimeout(s),this._canUseCiVisProtocol=i,n(i)}}),process.once("beforeExit",()=>{this._writer&&this._writer.flush(),this._coverageWriter&&this._coverageWriter.flush()})}shouldRequestSkippableSuites(){return!!(this._config.isIntelligentTestRunnerEnabled&&this._canUseCiVisProtocol&&this._itrConfig&&this._itrConfig.isSuitesSkippingEnabled)}shouldRequestItrConfiguration(){return this._config.isIntelligentTestRunnerEnabled}canReportSessionTraces(){return this._canUseCiVisProtocol}canReportCodeCoverage(){return this._canUseCiVisProtocol}getSkippableSuites(e,r){if(!this.shouldRequestSkippableSuites())return r(null,[]);this._gitUploadPromise.then(s=>{if(s)return r(s,[]);let n={url:this._getApiUrl(),site:this._config.site,env:this._config.env,service:this._config.service,isEvpProxy:!!this._isUsingEvpProxy,custom:Vb(this._config.tags),...e};aj(n,r)})}getItrConfiguration(e,r){if(this.sendGitMetadata(),!this.shouldRequestItrConfiguration())return r(null,{});this._canUseCiVisProtocolPromise.then(s=>{if(!s)return r(null,{});let n={url:this._getApiUrl(),env:this._config.env,service:this._config.service,isEvpProxy:!!this._isUsingEvpProxy,custom:Vb(this._config.tags),...e};oj(n,(i,o)=>{this._itrConfig=o,r(i,o)})})}sendGitMetadata(){this._config.isGitUploadEnabled&&this._canUseCiVisProtocolPromise.then(e=>{e&&ij(this._getApiUrl(),!!this._isUsingEvpProxy,r=>{r?_c.error(`Error uploading git metadata: ${r.message}`):_c.debug("Successfully uploaded git metadata"),this._resolveGit(r)})})}export(e){if(!this._isInitialized){this._traceBuffer.push(e);return}!this.canReportSessionTraces()&&uj(e)||this._export(e)}exportCoverage(e){if(!this._isInitialized){this._coverageBuffer.push(e);return}this.canReportCodeCoverage()&&this._export(e,this._coverageWriter,"_coverageTimer")}flush(e=()=>{}){if(!this._isInitialized)return e();this._writer.flush(()=>{this._coverageWriter?this._coverageWriter.flush(e):e()})}exportUncodedCoverages(){this._coverageBuffer.forEach(e=>{this.exportCoverage(e)}),this._coverageBuffer=[]}_setUrl(e,r=e){try{e=new Wb(e),r=new Wb(r),this._url=e,this._coverageUrl=r,this._writer.setUrl(e),this._coverageWriter.setUrl(r)}catch(s){_c.error(s)}}_getApiUrl(){return this._url}};Yb.exports=bc});var Xb=p((YQ,Jb)=>{"use strict";var Mn=require("url").URL,lj=uc(),dj=fc(),hj=yc(),fj=E(),vc=class extends hj{constructor(e){super(e);let{tags:r,site:s,url:n}=e;this._isInitialized=!0,this._resolveCanUseCiVisProtocol(!0),this._url=n||new Mn(`https://citestcycle-intake.${s}`),this._writer=new lj({url:this._url,tags:r}),this._coverageUrl=n||new Mn(`https://event-platform-intake.${s}`),this._coverageWriter=new dj({url:this._coverageUrl}),this._apiUrl=n||new Mn(`https://api.${s}`)}setUrl(e,r=e,s=e){this._setUrl(e,r);try{s=new Mn(s),this._apiUrl=s}catch(n){fj.error(n)}}_getApiUrl(){return this._apiUrl}};Jb.exports=vc});var Zb=p((JQ,Qb)=>{"use strict";var gj=rc(),mj=uc(),_j=fc(),bj=yc(),Sc="/evp_proxy/v2";function yj(t,e){return!t&&e.endpoints.some(r=>r.includes(Sc))}var qc=class extends bj{constructor(e){super(e);let{tags:r,prioritySampler:s,lookup:n,protocolVersion:i,headers:o}=e;this.getAgentInfo((a,c)=>{this._isInitialized=!0;let u=yj(a,c);u?(this._isUsingEvpProxy=!0,this._writer=new mj({url:this._url,tags:r,evpProxyPrefix:Sc}),this._coverageWriter=new _j({url:this._url,evpProxyPrefix:Sc})):(this._writer=new gj({url:this._url,prioritySampler:s,lookup:n,protocolVersion:i,headers:o}),this._coverageBuffer=[]),this._resolveCanUseCiVisProtocol(u),this.exportUncodedTraces(),this.exportUncodedCoverages()})}setUrl(e,r){this._setUrl(e,r)}};Qb.exports=qc});var ty=p((XQ,ey)=>{"use strict";var Ec=class{constructor(){this.payloads=[]}encode(e){this.payloads.push(e)}count(){return this.payloads.length}reset(){this.payloads=[]}makePayload(){let e=JSON.stringify(this.payloads);return this.reset(),e}};ey.exports={JSONEncoder:Ec}});var sy=p((QQ,ry)=>{"use strict";var{JSONEncoder:vj}=ty(),Tc=class{constructor(e){this._encoder=new vj,this._interprocessCode=e}flush(){if(this._encoder.count()>0){let r=this._encoder.makePayload();this._sendPayload(r)}}append(e){this._encoder.encode(e)}_sendPayload(e){process.send&&process.send([this._interprocessCode,e])}};ry.exports=Tc});var wc=p((ZQ,iy)=>{var Sj=require("url").URL,{GIT_BRANCH:se,GIT_COMMIT_SHA:ge,GIT_TAG:ne,GIT_COMMIT_AUTHOR_EMAIL:Ln,GIT_COMMIT_AUTHOR_NAME:jn,GIT_COMMIT_MESSAGE:kt,GIT_COMMIT_AUTHOR_DATE:qj,GIT_REPOSITORY_URL:ie,CI_PIPELINE_ID:me,CI_PIPELINE_NAME:_e,CI_PIPELINE_NUMBER:ke,CI_PIPELINE_URL:be,CI_PROVIDER_NAME:oe,CI_WORKSPACE_PATH:ye,CI_JOB_URL:He,CI_JOB_NAME:ss,CI_STAGE_NAME:ny,CI_ENV_VARS:Rt,GIT_COMMIT_COMMITTER_NAME:Ej,GIT_COMMIT_COMMITTER_EMAIL:Tj}=es();function wj(t){if(!t)return{name:"",email:""};let e="",r="",s=t.match(/(?:"?([^"]*)"?\s)?(?:<?(.+@[^>]+)>?)/);return s&&(e=s[1],r=s[2]),{name:e,email:r}}function xj(t){return Object.keys(t).reduce((e,r)=>t[r]?{...e,[r]:t[r]}:e,{})}function Un(t,e,r){t[e]&&(t[e]=r(t[e]))}function Hn(t){return t&&t.replace(/origin\/|refs\/heads\/|tags\//gm,"")}function Ij(t){if(t.startsWith("git@"))return t;try{let{protocol:e,hostname:r,pathname:s}=new Sj(t);return`${e}//${r}${s}`}catch{return t}}function Aj(t){return!t||typeof t!="string"?"":t[0]==="~"&&(t[1]==="/"||t.length===1)?t.replace("~",process.env.HOME):t}iy.exports={normalizeRef:Hn,getCIMetadata(){let{env:t}=process,e={};if(t.JENKINS_URL){let{WORKSPACE:r,BUILD_TAG:s,JOB_NAME:n,BUILD_NUMBER:i,BUILD_URL:o,GIT_BRANCH:a,GIT_COMMIT:c,GIT_URL:u,GIT_URL_1:l,DD_CUSTOM_TRACE_ID:d}=t;e={[me]:s,[ke]:i,[be]:o,[oe]:"jenkins",[ge]:c,[ie]:u||l,[ye]:r,[Rt]:JSON.stringify({DD_CUSTOM_TRACE_ID:d})};let f=a&&a.includes("tags/")?ne:se,g=Hn(a);e[f]=g;let v="";if(n){let q=n.split("/");q.length>1&&q[1].includes("=")?v=q[0]:v=n.replace(`/${g}`,""),e[_e]=v}}if(t.GITLAB_CI){let{CI_PIPELINE_ID:r,CI_PROJECT_PATH:s,CI_PIPELINE_IID:n,CI_PIPELINE_URL:i,CI_PROJECT_DIR:o,CI_COMMIT_REF_NAME:a,CI_COMMIT_TAG:c,CI_COMMIT_SHA:u,CI_REPOSITORY_URL:l,CI_JOB_URL:d,CI_JOB_STAGE:h,CI_JOB_NAME:f,CI_COMMIT_MESSAGE:g,CI_COMMIT_TIMESTAMP:v,CI_COMMIT_AUTHOR:q,CI_PROJECT_URL:_,CI_JOB_ID:S}=t,{name:T,email:x}=wj(q);e={[me]:r,[_e]:s,[ke]:n,[oe]:"gitlab",[ge]:u,[ie]:l,[He]:d,[ne]:c,[se]:a,[ye]:o,[be]:i&&i.replace("/-/pipelines/","/pipelines/"),[ny]:h,[ss]:f,[kt]:g,[jn]:T,[Ln]:x,[qj]:v,[Rt]:JSON.stringify({CI_PROJECT_URL:_,CI_PIPELINE_ID:r,CI_JOB_ID:S})}}if(t.CIRCLECI){let{CIRCLE_WORKFLOW_ID:r,CIRCLE_PROJECT_REPONAME:s,CIRCLE_BUILD_URL:n,CIRCLE_WORKING_DIRECTORY:i,CIRCLE_BRANCH:o,CIRCLE_TAG:a,CIRCLE_SHA1:c,CIRCLE_REPOSITORY_URL:u,CIRCLE_JOB:l,CIRCLE_BUILD_NUM:d}=t,h=`https://app.circleci.com/pipelines/workflows/${r}`;e={[me]:r,[_e]:s,[be]:h,[ss]:l,[oe]:"circleci",[ge]:c,[ie]:u,[He]:n,[ye]:i,[ne]:a,[se]:o,[Rt]:JSON.stringify({CIRCLE_WORKFLOW_ID:r,CIRCLE_BUILD_NUM:d})}}if(t.GITHUB_ACTIONS||t.GITHUB_ACTION){let{GITHUB_RUN_ID:r,GITHUB_WORKFLOW:s,GITHUB_RUN_NUMBER:n,GITHUB_WORKSPACE:i,GITHUB_HEAD_REF:o,GITHUB_REF:a,GITHUB_SHA:c,GITHUB_REPOSITORY:u,GITHUB_SERVER_URL:l,GITHUB_RUN_ATTEMPT:d,GITHUB_JOB:h}=t,f=`${l}/${u}.git`,g=`${l}/${u}/actions/runs/${r}`;d&&(g=`${g}/attempts/${d}`);let v=`${l}/${u}/commit/${c}/checks`,q=o||a||"",_=q.includes("tags/")?ne:se;e={[me]:r,[_e]:s,[ke]:n,[be]:g,[oe]:"github",[ge]:c,[ie]:f,[He]:v,[ss]:h,[ye]:i,[_]:q,[Rt]:JSON.stringify({GITHUB_SERVER_URL:l,GITHUB_REPOSITORY:u,GITHUB_RUN_ID:r,GITHUB_RUN_ATTEMPT:d})}}if(t.APPVEYOR){let{APPVEYOR_REPO_NAME:r,APPVEYOR_REPO_PROVIDER:s,APPVEYOR_BUILD_FOLDER:n,APPVEYOR_BUILD_ID:i,APPVEYOR_BUILD_NUMBER:o,APPVEYOR_REPO_COMMIT:a,APPVEYOR_PULL_REQUEST_HEAD_REPO_BRANCH:c,APPVEYOR_REPO_BRANCH:u,APPVEYOR_REPO_TAG_NAME:l,APPVEYOR_REPO_COMMIT_AUTHOR:d,APPVEYOR_REPO_COMMIT_AUTHOR_EMAIL:h,APPVEYOR_REPO_COMMIT_MESSAGE:f,APPVEYOR_REPO_COMMIT_MESSAGE_EXTENDED:g}=t,v=`https://ci.appveyor.com/project/${r}/builds/${i}`;e={[oe]:"appveyor",[be]:v,[me]:i,[_e]:r,[ke]:o,[He]:v,[ye]:n,[jn]:d,[Ln]:h,[kt]:f+`
`+g},s==="github"&&(e={...e,[ie]:`https://github.com/${r}.git`,[ge]:a,[ne]:l,[se]:c||u})}if(t.TF_BUILD){let{BUILD_SOURCESDIRECTORY:r,BUILD_BUILDID:s,BUILD_DEFINITIONNAME:n,SYSTEM_TEAMFOUNDATIONSERVERURI:i,SYSTEM_TEAMPROJECTID:o,SYSTEM_JOBID:a,SYSTEM_TASKINSTANCEID:c,SYSTEM_PULLREQUEST_SOURCEBRANCH:u,BUILD_SOURCEBRANCH:l,BUILD_SOURCEBRANCHNAME:d,SYSTEM_PULLREQUEST_SOURCECOMMITID:h,SYSTEM_PULLREQUEST_SOURCEREPOSITORYURI:f,BUILD_REPOSITORY_URI:g,BUILD_SOURCEVERSION:v,BUILD_REQUESTEDFORID:q,BUILD_REQUESTEDFOREMAIL:_,BUILD_SOURCEVERSIONMESSAGE:S,SYSTEM_STAGEDISPLAYNAME:T,SYSTEM_JOBDISPLAYNAME:x}=t,R=u||l||d,ue=(R||"").includes("tags/")?ne:se;if(e={[oe]:"azurepipelines",[me]:s,[_e]:n,[ke]:s,[ge]:h||v,[ye]:r,[ie]:f||g,[ue]:R,[jn]:q,[Ln]:_,[kt]:S,[ny]:T,[ss]:x,[Rt]:JSON.stringify({SYSTEM_TEAMPROJECTID:o,BUILD_BUILDID:s,SYSTEM_JOBID:a})},i&&o&&s){let z=`${i}${o}/_build/results?buildId=${s}`,Me=z,Le=`${z}&view=logs&j=${a}&t=${c}`;e={...e,[be]:Me,[He]:Le}}}if(t.BITBUCKET_COMMIT){let{BITBUCKET_REPO_FULL_NAME:r,BITBUCKET_BUILD_NUMBER:s,BITBUCKET_BRANCH:n,BITBUCKET_COMMIT:i,BITBUCKET_GIT_SSH_ORIGIN:o,BITBUCKET_TAG:a,BITBUCKET_PIPELINE_UUID:c,BITBUCKET_CLONE_DIR:u}=t,l=`https://bitbucket.org/${r}/addon/pipelines/home#!/results/${s}`;e={[oe]:"bitbucket",[ge]:i,[ke]:s,[_e]:r,[He]:l,[be]:l,[se]:n,[ne]:a,[ie]:o,[ye]:u,[me]:c&&c.replace(/{|}/gm,"")}}if(t.BITRISE_BUILD_SLUG){let{BITRISE_GIT_COMMIT:r,GIT_CLONE_COMMIT_HASH:s,BITRISEIO_GIT_BRANCH_DEST:n,BITRISE_GIT_BRANCH:i,BITRISE_BUILD_SLUG:o,BITRISE_TRIGGERED_WORKFLOW_ID:a,BITRISE_BUILD_NUMBER:c,BITRISE_BUILD_URL:u,BITRISE_SOURCE_DIR:l,GIT_REPOSITORY_URL:d,BITRISE_GIT_TAG:h,BITRISE_GIT_MESSAGE:f}=t;e={[oe]:"bitrise",[me]:o,[_e]:a,[ke]:c,[be]:u,[ge]:r||s,[ie]:d,[ye]:l,[ne]:h,[se]:n||i,[kt]:f}}if(t.BUILDKITE){let{BUILDKITE_BRANCH:r,BUILDKITE_COMMIT:s,BUILDKITE_REPO:n,BUILDKITE_TAG:i,BUILDKITE_BUILD_ID:o,BUILDKITE_PIPELINE_SLUG:a,BUILDKITE_BUILD_NUMBER:c,BUILDKITE_BUILD_URL:u,BUILDKITE_JOB_ID:l,BUILDKITE_BUILD_CHECKOUT_PATH:d,BUILDKITE_BUILD_AUTHOR:h,BUILDKITE_BUILD_AUTHOR_EMAIL:f,BUILDKITE_MESSAGE:g}=t;e={[oe]:"buildkite",[me]:o,[_e]:a,[ke]:c,[be]:u,[He]:`${u}#${l}`,[ge]:s,[ye]:d,[ie]:n,[ne]:i,[se]:r,[jn]:h,[Ln]:f,[kt]:g,[Rt]:JSON.stringify({BUILDKITE_BUILD_ID:o,BUILDKITE_JOB_ID:l})}}if(t.TRAVIS){let{TRAVIS_PULL_REQUEST_BRANCH:r,TRAVIS_BRANCH:s,TRAVIS_COMMIT:n,TRAVIS_REPO_SLUG:i,TRAVIS_TAG:o,TRAVIS_JOB_WEB_URL:a,TRAVIS_BUILD_ID:c,TRAVIS_BUILD_NUMBER:u,TRAVIS_BUILD_WEB_URL:l,TRAVIS_BUILD_DIR:d,TRAVIS_COMMIT_MESSAGE:h}=t;e={[oe]:"travisci",[He]:a,[me]:c,[_e]:i,[ke]:u,[be]:l,[ge]:n,[ie]:`https://github.com/${i}.git`,[ye]:d,[ne]:o,[se]:r||s,[kt]:h}}if(t.BUDDY){let{BUDDY_EXECUTION_BRANCH:r,BUDDY_EXECUTION_ID:s,BUDDY_EXECUTION_REVISION:n,BUDDY_EXECUTION_REVISION_COMMITTER_EMAIL:i,BUDDY_EXECUTION_REVISION_COMMITTER_NAME:o,BUDDY_EXECUTION_REVISION_MESSAGE:a,BUDDY_EXECUTION_TAG:c,BUDDY_EXECUTION_URL:u,BUDDY_PIPELINE_ID:l,BUDDY_PIPELINE_NAME:d,BUDDY_SCM_URL:h}=t;e={[oe]:"buddy",[me]:`${l}/${s}`,[_e]:d,[ke]:s,[be]:u,[ge]:n,[ie]:h,[se]:r,[ne]:c,[kt]:a,[Ej]:o,[Tj]:i}}if(t.TEAMCITY_VERSION){let{BUILD_URL:r,TEAMCITY_BUILDCONF_NAME:s,DATADOG_BUILD_ID:n}=t;e={[oe]:"teamcity",[He]:r,[ss]:s,[Rt]:JSON.stringify({DATADOG_BUILD_ID:n})}}return Un(e,ye,Aj),Un(e,ie,Ij),Un(e,se,Hn),Un(e,ne,Hn),xj(e)}}});var ay=p((eZ,oy)=>{var{GIT_COMMIT_SHA:kj,GIT_BRANCH:Rj,GIT_REPOSITORY_URL:Cj,GIT_TAG:Oj,GIT_COMMIT_MESSAGE:Pj,GIT_COMMIT_COMMITTER_DATE:Nj,GIT_COMMIT_COMMITTER_EMAIL:Dj,GIT_COMMIT_COMMITTER_NAME:Mj,GIT_COMMIT_AUTHOR_DATE:Lj,GIT_COMMIT_AUTHOR_EMAIL:jj,GIT_COMMIT_AUTHOR_NAME:Uj}=es(),{normalizeRef:xc}=wc();function Hj(t){return Object.keys(t).reduce((e,r)=>t[r]?{...e,[r]:t[r]}:e,{})}function Bj(t){try{if(t.startsWith("git@"))return t;let{protocol:e,hostname:r,pathname:s}=new URL(t);return`${e}//${r}${s}`}catch{return t}}function $j(){let{DD_GIT_COMMIT_SHA:t,DD_GIT_BRANCH:e,DD_GIT_REPOSITORY_URL:r,DD_GIT_TAG:s,DD_GIT_COMMIT_MESSAGE:n,DD_GIT_COMMIT_COMMITTER_NAME:i,DD_GIT_COMMIT_COMMITTER_EMAIL:o,DD_GIT_COMMIT_COMMITTER_DATE:a,DD_GIT_COMMIT_AUTHOR_NAME:c,DD_GIT_COMMIT_AUTHOR_EMAIL:u,DD_GIT_COMMIT_AUTHOR_DATE:l}=process.env,d=xc(e),h=xc(s);return((e||"").includes("origin/tags")||(e||"").includes("refs/heads/tags"))&&(h=xc(e)),Hj({[kj]:t,[Rj]:d,[Cj]:Bj(r),[Oj]:h,[Pj]:n,[Mj]:i,[Nj]:a,[Dj]:o,[Uj]:c,[jj]:u,[Lj]:l})}oy.exports={getUserProviderGitMetadata:$j}});var fy=p((tZ,hy)=>{var Gj=require("os"),cy="os.platform",uy="os.version",py="os.architecture",ly="runtime.name",dy="runtime.version";function Fj(){return{[dy]:process.version,[py]:process.arch,[cy]:process.platform,[ly]:"node",[uy]:Gj.release()}}hy.exports={getRuntimeAndOSMetadata:Fj,OS_PLATFORM:cy,OS_VERSION:uy,OS_ARCHITECTURE:py,RUNTIME_NAME:ly,RUNTIME_VERSION:dy}});var ve=p((rZ,xy)=>{var gy=require("path"),zj=require("fs"),Bn=require("istanbul-lib-coverage"),Wj=require("ignore"),{getGitMetadata:Vj}=gc(),{getUserProviderGitMetadata:Kj}=ay(),{getCIMetadata:Yj}=wc(),{getRuntimeAndOSMetadata:Jj}=fy(),{GIT_BRANCH:Xj,GIT_COMMIT_SHA:Qj,GIT_REPOSITORY_URL:Zj,GIT_TAG:e2,GIT_COMMIT_AUTHOR_EMAIL:t2,GIT_COMMIT_AUTHOR_NAME:r2,GIT_COMMIT_MESSAGE:s2,CI_WORKSPACE_PATH:n2}=es(),i2=de(),{SPAN_TYPE:$n,RESOURCE_NAME:Gn,SAMPLING_PRIORITY:o2}=B(),{SAMPLING_RULE_DECISION:a2}=A(),{AUTO_KEEP:c2}=Xt(),{version:my}=Ie(),_y="test.framework",kc="test.framework_version",Rc="test.type",by="test.name",Cc="test.suite",u2="test.status",p2="test.parameters",l2="test.skip_reason",d2="test.is_rum_active",h2="test.codeowners",yy="test.source.file",f2="test.source.start",Oc="library_version",vy="test.command",Fn="test.module",g2="test_session_id",m2="test_module_id",_2="test_suite_id",Sy="test.toolchain",b2="ciapp-test",y2="test.jest.test_runner",Ic="_dd.ci.itr.tests_skipped",qy="test_session.itr.tests_skipping.enabled",Ey="test_session.code_coverage.enabled",Ty="test_module.itr.tests_skipping.enabled",wy="test_module.code_coverage.enabled",Ac="test.codecov_lines_total",v2=60,S2=61;xy.exports={TEST_CODE_OWNERS:h2,TEST_FRAMEWORK:_y,TEST_FRAMEWORK_VERSION:kc,JEST_TEST_RUNNER:y2,TEST_TYPE:Rc,TEST_NAME:by,TEST_SUITE:Cc,TEST_STATUS:u2,TEST_PARAMETERS:p2,TEST_SKIP_REASON:l2,TEST_IS_RUM_ACTIVE:d2,TEST_SOURCE_FILE:yy,CI_APP_ORIGIN:b2,LIBRARY_VERSION:Oc,JEST_WORKER_TRACE_PAYLOAD_CODE:v2,JEST_WORKER_COVERAGE_PAYLOAD_CODE:S2,TEST_SOURCE_START:f2,getTestEnvironmentMetadata:E2,getTestParametersString:T2,finishAllTraceSpans:w2,getTestParentSpan:x2,getTestSuitePath:A2,getCodeOwnersFileEntries:R2,getCodeOwnersForFilename:C2,getTestCommonTags:I2,getTestSessionCommonTags:O2,getTestModuleCommonTags:P2,getTestSuiteCommonTags:N2,TEST_COMMAND:vy,TEST_TOOLCHAIN:Sy,TEST_SESSION_ID:g2,TEST_MODULE_ID:m2,TEST_SUITE_ID:_2,TEST_ITR_TESTS_SKIPPED:Ic,TEST_MODULE:Fn,TEST_SESSION_ITR_SKIPPING_ENABLED:qy,TEST_SESSION_CODE_COVERAGE_ENABLED:Ey,TEST_MODULE_ITR_SKIPPING_ENABLED:Ty,TEST_MODULE_CODE_COVERAGE_ENABLED:wy,TEST_CODE_COVERAGE_LINES_TOTAL:Ac,addIntelligentTestRunnerSpanTags:D2,getCoveredFilenamesFromCoverage:M2,resetCoverage:L2,mergeCoverage:j2,fromCoverageMapToCoverage:U2,getTestLineStart:H2};function q2(){try{return process.env.npm_config_user_agent.split(" ")[0].replace("/","-")}catch{return""}}function E2(t,e){let r=Yj(),{[Qj]:s,[Xj]:n,[Zj]:i,[e2]:o,[r2]:a,[t2]:c,[s2]:u,[n2]:l}=r,d=Vj({commitSHA:s,branch:n,repositoryUrl:i,tag:o,authorName:a,authorEmail:c,commitMessage:u,ciWorkspacePath:l}),h=Kj(),f=Jj(),g={[_y]:t,...d,...r,...h,...f};return e&&e.service&&(g["service.name"]=e.service),g}function T2(t,e){if(!t[e])return"";try{let r=t[e].shift();return JSON.stringify({arguments:r,metadata:{}})}catch{return""}}function w2(t){t.context()._trace.started.forEach(e=>{e!==t&&e.finish()})}function x2(t){return t.extract("text_map",{"x-datadog-trace-id":i2().toString(10),"x-datadog-parent-id":"0000000000000000"})}function I2(t,e,r){return{[$n]:"test",[Rc]:"test",[a2]:1,[o2]:c2,[by]:t,[Cc]:e,[yy]:e,[Gn]:`${e}.${t}`,[kc]:r,[Oc]:my}}function A2(t,e){return t?(t===e?t:gy.relative(e,t)).replace(gy.sep,"/"):e}var k2=["CODEOWNERS",".github/CODEOWNERS","docs/CODEOWNERS",".gitlab/CODEOWNERS"];function R2(t=process.cwd()){let e;if(k2.forEach(n=>{try{e=zj.readFileSync(`${t}/${n}`).toString()}catch{}}),!e)return null;let r=[],s=e.split(`
`);for(let n of s){let[i]=n.split("#"),o=i.trim();if(o==="")continue;let[a,...c]=o.split(/\s+/);r.push({pattern:a,owners:c})}return r.reverse()}function C2(t,e){if(!e)return null;for(let r of e)try{if(Wj().add(r.pattern).ignores(t))return JSON.stringify(r.owners)}catch{return null}return null}function Pc(t,e){return{[kc]:e,[Oc]:my,[vy]:t,[Rc]:"test"}}function O2(t,e,r){return{[$n]:"test_session_end",[Gn]:`test_session.${t}`,[Fn]:r,[Sy]:q2(),...Pc(t,e)}}function P2(t,e,r){return{[$n]:"test_module_end",[Gn]:`test_module.${t}`,[Fn]:r,...Pc(t,e)}}function N2(t,e,r,s){return{[$n]:"test_suite_end",[Gn]:`test_suite.${r}`,[Fn]:s,[Cc]:r,...Pc(t,e)}}function D2(t,e,{isSuitesSkipped:r,isSuitesSkippingEnabled:s,isCodeCoverageEnabled:n,testCodeCoverageLinesTotal:i}){t.setTag(Ic,r?"true":"false"),t.setTag(qy,s?"true":"false"),t.setTag(Ey,n?"true":"false"),e.setTag(Ic,r?"true":"false"),e.setTag(Ty,s?"true":"false"),e.setTag(wy,n?"true":"false"),i!==void 0&&!r&&(t.setTag(Ac,i),e.setTag(Ac,i))}function M2(t){let e=Bn.createCoverageMap(t);return e.files().filter(r=>{let n=e.fileCoverageFor(r).getLineCoverage();return Object.entries(n).some(([,o])=>!!o)})}function L2(t){let e=Bn.createCoverageMap(t);return e.files().forEach(r=>{e.fileCoverageFor(r).resetHits()})}function j2(t,e){let r=Bn.createCoverageMap(t);return r.files().forEach(s=>{let n=r.fileCoverageFor(s);e.data[s]||e.addFileCoverage(Bn.createFileCoverage(s)),e.addFileCoverage(n);let i=e.fileCoverageFor(s);Object.entries(i.data.b).forEach(([o,a])=>{i.data.b[o]=[...a]})})}function U2(t){return Object.entries(t.data).reduce((e,[r,s])=>(e[r]=s.data,e),{})}function H2(t,e){if(!t.stack)return null;let r=t.stack.split(`
`).find(s=>s.includes(e));try{let s=r.match(/at (?:(.+?)\s+\()?(?:(.+?):(\d+)(?::(\d+))?|([^)]+))\)?/);return parseInt(s[3],10)||null}catch{return null}}});var ky=p((sZ,Ay)=>{"use strict";var Iy=sy(),{JEST_WORKER_COVERAGE_PAYLOAD_CODE:B2,JEST_WORKER_TRACE_PAYLOAD_CODE:$2}=ve(),Nc=class{constructor(){this._writer=new Iy($2),this._coverageWriter=new Iy(B2)}export(e){this._writer.append(e)}exportCoverage(e){this._coverageWriter.append(e)}flush(){this._writer.flush(),this._coverageWriter.flush()}};Ay.exports=Nc});var Cy=p((nZ,Ry)=>{"use strict";var ns=ga(),G2=require("fs"),F2=A();Ry.exports=t=>{let e=process.env.AWS_LAMBDA_FUNCTION_NAME!==void 0,r=e&&G2.existsSync(F2.DATADOG_LAMBDA_EXTENSION_PATH);switch(t){case ns.LOG:return Qa();case ns.AGENT:return nc();case ns.DATADOG:return Xb();case ns.AGENT_PROXY:return Zb();case ns.JEST_WORKER:return ky();default:return e&&!r?Qa():nc()}}});var Dy=p((iZ,Ny)=>{"use strict";var z2=require("os"),Dc=Um(),W2=D_(),V2=F_(),K2=Wa(),Y2=sb(),J2=ib(),X2=cb(),zn=fe(),Oy=E(),Py=Gr(),Q2=Cy(),Z2=Qt(),eU="child_of",tU="follows_from",Mc=class{constructor(e){let r=Q2(e.experimental.exporter);this._service=e.service,this._version=e.version,this._env=e.env,this._tags=e.tags,this._logInjection=e.logInjection,this._debug=e.debug,this._prioritySampler=new V2(e.env,e.sampler),this._exporter=new r(e,this._prioritySampler),this._processor=new W2(this._exporter,this._prioritySampler,e),this._url=this._exporter._url,this._enableGetRumData=e.experimental.enableGetRumData,this._traceId128BitGenerationEnabled=e.traceId128BitGenerationEnabled,this._propagators={[zn.TEXT_MAP]:new K2(e),[zn.HTTP_HEADERS]:new Y2(e),[zn.BINARY]:new J2(e),[zn.LOG]:new X2(e)},e.reportHostname&&(this._hostname=z2.hostname())}startSpan(e,r={}){let s=r.childOf?rU(r.childOf):sU(r.references),n={"service.name":this._service},i=new Dc(this,this._processor,this._prioritySampler,{operationName:r.operationName||e,parent:s,tags:n,startTime:r.startTime,hostname:this._hostname,traceId128BitGenerationEnabled:this._traceId128BitGenerationEnabled},this._debug);return i.addTags(this._tags),i.addTags(r.tags),i}inject(e,r,s){e instanceof Dc&&(e=e.context());try{this._prioritySampler.sample(e),this._propagators[r].inject(e,s)}catch(n){Oy.error(n),Py.increment("datadog.tracer.node.inject.errors",!0)}}extract(e,r){try{return this._propagators[e].extract(r)}catch(s){return Oy.error(s),Py.increment("datadog.tracer.node.extract.errors",!0),null}}};function rU(t){return t instanceof Dc&&(t=t.context()),t instanceof Z2||(t=null),t}function sU(t=[]){let e=null;for(let r=0;r<t.length;r++){let s=t[r],n=s.type();if(n===eU){e=s.referencedContext();break}else n===tU&&(e||(e=s.referencedContext()))}return e}Ny.exports=Mc});var Ly=p((oZ,My)=>{"use strict";var{storage:Wn}=I(),nU=new WeakMap,Lc=class{active(){let e=Wn.getStore();return e&&e.span||null}activate(e,r){if(typeof r!="function")return r;let s=Wn.getStore(),n=e?e._store:s;Wn.enterWith({...n,span:e});try{return r()}catch(i){throw e&&typeof e.setTag=="function"&&e.setTag("error",i),i}finally{Wn.enterWith(s)}}bind(e,r){if(typeof e!="function")return e;let s=this,n=this._spanOrActive(r),i=function(){return s.activate(n,()=>e.apply(this,arguments))};return nU.set(i,e),i}_spanOrActive(e){return e!==void 0?e:this.active()}_isPromise(e){return e&&typeof e.then=="function"}};My.exports=Lc});var Uy=p((aZ,jy)=>{"use strict";var iU=Dy(),Vn=B(),oU=Ly(),{storage:aU}=I(),{isError:cU}=te(),{setStartupLogConfig:uU}=Vr(),{ERROR_MESSAGE:pU,ERROR_TYPE:lU,ERROR_STACK:dU}=A(),hU=Vn.SPAN_TYPE,fU=Vn.RESOURCE_NAME,gU=Vn.SERVICE_NAME,mU=Vn.MEASURED,Uc=class extends iU{constructor(e){super(e),this._scope=new oU,uU(e)}trace(e,r,s){if(r=Object.assign({childOf:this.scope().active()},r),!r.childOf&&r.orphanable===!1)return s(null,()=>{});let n=this.startSpan(e,r);_U(n,r);try{if(s.length>1)return this.scope().activate(n,()=>s(n,o=>{jc(n,o),n.finish()}));let i=this.scope().activate(n,()=>s(n));return i&&typeof i.then=="function"?i.then(o=>(n.finish(),o),o=>{throw jc(n,o),n.finish(),o}):(n.finish(),i)}catch(i){throw jc(n,i),n.finish(),i}}wrap(e,r,s){let n=this;return function(){let i=aU.getStore();if(i&&i.noop)return s.apply(this,arguments);let o=r;if(typeof o=="function"&&typeof s=="function"&&(o=o.apply(this,arguments)),o&&o.orphanable===!1&&!n.scope().active())return s.apply(this,arguments);let a=arguments.length-1,c=arguments[a];if(typeof c=="function"){let u=n.scope().bind(c);return n.trace(e,o,(l,d)=>(arguments[a]=function(h){return d(h),u.apply(this,arguments)},s.apply(this,arguments)))}else return n.trace(e,o,()=>s.apply(this,arguments))}}setUrl(e){this._exporter.setUrl(e)}scope(){return this._scope}getRumData(){if(!this._enableGetRumData)return"";let r=this.scope().active().context().toTraceId(),s=Date.now();return`<meta name="dd-trace-id" content="${r}" /><meta name="dd-trace-time" content="${s}" />`}};function jc(t,e){cU(e)&&t.addTags({[lU]:e.name,[pU]:e.message,[dU]:e.stack})}function _U(t,e){let r={};e.type&&(r[hU]=e.type),e.service&&(r[gU]=e.service),e.resource&&(r[fU]=e.resource),r[mU]=e.measured,t.addTags(r)}jy.exports=Uc});var Hy=p((cZ,bU)=>{bU.exports={version:"2.2",metadata:{rules_version:"1.6.0"},rules:[{id:"blk-001-001",name:"Block IP Addresses",tags:{type:"block_ip",category:"security_response"},conditions:[{parameters:{inputs:[{address:"http.client_ip"}],data:"blocked_ips"},operator:"ip_match"}],transformers:[],on_match:["block"]},{id:"blk-001-002",name:"Block User Addresses",tags:{type:"block_user",category:"security_response"},conditions:[{parameters:{inputs:[{address:"usr.id"}],data:"blocked_users"},operator:"exact_match"}],transformers:[],on_match:["block"]},{id:"crs-913-110",name:"Acunetix",tags:{type:"security_scanner",crs_id:"913110",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies"}],list:["acunetix-product","(acunetix web vulnerability scanner","acunetix-scanning-agreement","acunetix-user-agreement","md5(acunetix_wvs_security_test)"]},operator:"phrase_match"}],transformers:["lowercase"]},{id:"crs-913-120",name:"Known security scanner filename/argument",tags:{type:"security_scanner",crs_id:"913120",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"}],list:["/.adsensepostnottherenonobook","/<invalid>hello.html","/actsensepostnottherenonotive","/acunetix-wvs-test-for-some-inexistent-file","/antidisestablishmentarianism","/appscan_fingerprint/mac_address","/arachni-","/cybercop","/nessus_is_probing_you_","/nessustest","/netsparker-","/rfiinc.txt","/thereisnowaythat-you-canbethere","/w3af/remotefileinclude.html","appscan_fingerprint","w00tw00t.at.isc.sans.dfind","w00tw00t.at.blackhats.romanian.anti-sec"]},operator:"phrase_match"}],transformers:["lowercase"]},{id:"crs-920-260",name:"Unicode Full/Half Width Abuse Attack Attempt",tags:{type:"http_protocol_violation",crs_id:"920260",category:"attack_attempt",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"\\%u[fF]{2}[0-9a-fA-F]{2}",options:{case_sensitive:!0,min_length:6}},operator:"match_regex"}],transformers:[]},{id:"crs-921-110",name:"HTTP Request Smuggling Attack",tags:{type:"http_protocol_violation",crs_id:"921110",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"}],regex:"(?:get|post|head|options|connect|put|delete|trace|track|patch|propfind|propatch|mkcol|copy|move|lock|unlock)\\s+[^\\s]+\\s+http/\\d",options:{case_sensitive:!0,min_length:12}},operator:"match_regex"}],transformers:["lowercase"]},{id:"crs-921-160",name:"HTTP Header Injection Attack via payload (CR/LF and header-name detected)",tags:{type:"http_protocol_violation",crs_id:"921160",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.path_params"}],regex:"[\\n\\r]+(?:refresh|(?:set-)?cookie|(?:x-)?(?:forwarded-(?:for|host|server)|via|remote-ip|remote-addr|originating-IP))\\s*:",options:{case_sensitive:!0,min_length:3}},operator:"match_regex"}],transformers:["lowercase"]},{id:"crs-930-100",name:"Obfuscated Path Traversal Attack (/../)",tags:{type:"lfi",crs_id:"930100",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.uri.raw"},{address:"server.request.headers.no_cookies"}],regex:"(?:%(?:c(?:0%(?:[2aq]f|5c|9v)|1%(?:[19p]c|8s|af))|2(?:5(?:c(?:0%25af|1%259c)|2f|5c)|%46|f)|(?:(?:f(?:8%8)?0%8|e)0%80%a|bg%q)f|%3(?:2(?:%(?:%6|4)6|F)|5%%63)|u(?:221[56]|002f|EFC8|F025)|1u|5c)|0x(?:2f|5c)|\\/|\\x5c)(?:%(?:(?:f(?:(?:c%80|8)%8)?0%8|e)0%80%ae|2(?:(?:5(?:c0%25a|2))?e|%45)|u(?:(?:002|ff0)e|2024)|%32(?:%(?:%6|4)5|E)|c0(?:%[256aef]e|\\.))|\\.(?:%0[01])?|0x2e){2,3}(?:%(?:c(?:0%(?:[2aq]f|5c|9v)|1%(?:[19p]c|8s|af))|2(?:5(?:c(?:0%25af|1%259c)|2f|5c)|%46|f)|(?:(?:f(?:8%8)?0%8|e)0%80%a|bg%q)f|%3(?:2(?:%(?:%6|4)6|F)|5%%63)|u(?:221[56]|002f|EFC8|F025)|1u|5c)|0x(?:2f|5c)|\\/|\\x5c)",options:{min_length:4}},operator:"match_regex"}],transformers:["normalizePath"]},{id:"crs-930-110",name:"Simple Path Traversal Attack (/../)",tags:{type:"lfi",crs_id:"930110",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.uri.raw"},{address:"server.request.headers.no_cookies"}],regex:"(?:(?:^|[\\x5c/])\\.{2,3}[\\x5c/]|[\\x5c/]\\.{2,3}(?:[\\x5c/]|$))",options:{case_sensitive:!0,min_length:3}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-930-120",name:"OS File Access Attempt",tags:{type:"lfi",crs_id:"930120",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],list:["/.htaccess","/.htdigest","/.htpasswd","/.addressbook","/.aptitude/config",".aws/config",".aws/credentials","/.bash_config","/.bash_history","/.bash_logout","/.bash_profile","/.bashrc",".cache/notify-osd.log",".config/odesk/odesk team.conf","/.cshrc","/.dockerignore",".drush/","/.eslintignore","/.fbcindex","/.forward","/.git",".git/","/.gitattributes","/.gitconfig",".gnupg/",".hplip/hplip.conf","/.ksh_history","/.lesshst",".lftp/","/.lhistory","/.lldb-history",".local/share/mc/","/.lynx_cookies","/.my.cnf","/.mysql_history","/.nano_history","/.node_repl_history","/.pearrc","/.pgpass","/.php_history","/.pinerc",".pki/","/.proclog","/.procmailrc","/.psql_history","/.python_history","/.rediscli_history","/.rhistory","/.rhosts","/.sh_history","/.sqlite_history",".ssh/authorized_keys",".ssh/config",".ssh/id_dsa",".ssh/id_dsa.pub",".ssh/id_rsa",".ssh/id_rsa.pub",".ssh/identity",".ssh/identity.pub",".ssh/id_ecdsa",".ssh/id_ecdsa.pub",".ssh/known_hosts",".subversion/auth",".subversion/config",".subversion/servers",".tconn/tconn.conf","/.tcshrc",".vidalia/vidalia.conf","/.viminfo","/.vimrc","/.www_acl","/.wwwacl","/.xauthority","/.zhistory","/.zshrc","/.zsh_history","/.nsconfig","data/elasticsearch","data/kafka","etc/ansible","etc/bind","etc/centos-release","etc/centos-release-upstream","etc/clam.d","etc/elasticsearch","etc/freshclam.conf","etc/gshadow","etc/gshadow-","etc/httpd","etc/kafka","etc/kibana","etc/logstash","etc/lvm","etc/mongod.conf","etc/my.cnf","etc/nuxeo.conf","etc/pki","etc/postfix","etc/scw-release","etc/subgid","etc/subgid-","etc/sudoers.d","etc/sysconfig","etc/system-release-cpe","opt/nuxeo","opt/tomcat","tmp/kafka-logs","usr/lib/rpm/rpm.log","var/data/elasticsearch","var/lib/elasticsearch","etc/.java","etc/acpi","etc/alsa","etc/alternatives","etc/apache2","etc/apm","etc/apparmor","etc/apparmor.d","etc/apport","etc/apt","etc/asciidoc","etc/avahi","etc/bash_completion.d","etc/binfmt.d","etc/bluetooth","etc/bonobo-activation","etc/brltty","etc/ca-certificates","etc/calendar","etc/chatscripts","etc/chromium-browser","etc/clamav","etc/cni","etc/console-setup","etc/coraza-waf","etc/cracklib","etc/cron.d","etc/cron.daily","etc/cron.hourly","etc/cron.monthly","etc/cron.weekly","etc/cups","etc/cups.save","etc/cupshelpers","etc/dbus-1","etc/dconf","etc/default","etc/depmod.d","etc/dhcp","etc/dictionaries-common","etc/dkms","etc/dnsmasq.d","etc/dockeretc/dpkg","etc/emacs","etc/environment.d","etc/fail2ban","etc/firebird","etc/firefox","etc/fonts","etc/fwupd","etc/gconf","etc/gdb","etc/gdm3","etc/geoclue","etc/ghostscript","etc/gimp","etc/glvnd","etc/gnome","etc/gnome-vfs-2.0","etc/gnucash","etc/gnustep","etc/groff","etc/grub.d","etc/gss","etc/gtk-2.0","etc/gtk-3.0","etc/hp","etc/ifplugd","etc/imagemagick-6","etc/init","etc/init.d","etc/initramfs-tools","etc/insserv.conf.d","etc/iproute2","etc/iptables","etc/java","etc/java-11-openjdk","etc/java-17-oracle","etc/java-8-openjdk","etc/kernel","etc/ld.so.conf.d","etc/ldap","etc/libblockdev","etc/libibverbs.d","etc/libnl-3","etc/libpaper.d","etc/libreoffice","etc/lighttpd","etc/logcheck","etc/logrotate.d","etc/lynx","etc/mail","etc/mc","etc/menu","etc/menu-methods","etc/modprobe.d","etc/modsecurity","etc/modules-load.d","etc/monit","etc/mono","etc/mplayer","etc/mpv","etc/muttrc.d","etc/mysql","etc/netplan","etc/network","etc/networkd-dispatcher","etc/networkmanager","etc/newt","etc/nghttpx","etc/nikto","etc/odbcdatasources","etc/openal","etc/openmpi","etc/opt","etc/osync","etc/packagekit","etc/pam.d","etc/pcmcia","etc/perl","etc/php","etc/pki","etc/pm","etc/polkit-1","etc/postfix","etc/ppp","etc/profile.d","etc/proftpd","etc/pulse","etc/python","etc/rc0.d","etc/rc1.d","etc/rc2.d","etc/rc3.d","etc/rc4.d","etc/rc5.d","etc/rc6.d","etc/rcs.d","etc/resolvconf","etc/rsyslog.d","etc/samba","etc/sane.d","etc/security","etc/selinux","etc/sensors.d","etc/sgml","etc/signon-ui","etc/skel","etc/snmp","etc/sound","etc/spamassassin","etc/speech-dispatcher","etc/ssh","etc/ssl","etc/sudoers.d","etc/sysctl.d","etc/sysstat","etc/systemd","etc/terminfo","etc/texmf","etc/thermald","etc/thnuclnt","etc/thunderbird","etc/timidity","etc/tmpfiles.d","etc/ubuntu-advantage","etc/udev","etc/udisks2","etc/ufw","etc/update-manager","etc/update-motd.d","etc/update-notifier","etc/upower","etc/urlview","etc/usb_modeswitch.d","etc/vim","etc/vmware","etc/vmware-installer","etc/vmware-vix","etc/vulkan","etc/w3m","etc/wireshark","etc/wpa_supplicant","etc/x11","etc/xdg","etc/xml","etc/redis.conf","etc/redis-sentinel.conf","etc/php.ini","bin/php.ini","etc/httpd/php.ini","usr/lib/php.ini","usr/lib/php/php.ini","usr/local/etc/php.ini","usr/local/lib/php.ini","usr/local/php/lib/php.ini","usr/local/php4/lib/php.ini","usr/local/php5/lib/php.ini","usr/local/apache/conf/php.ini","etc/php4.4/fcgi/php.ini","etc/php4/apache/php.ini","etc/php4/apache2/php.ini","etc/php5/apache/php.ini","etc/php5/apache2/php.ini","etc/php/php.ini","etc/php/php4/php.ini","etc/php/apache/php.ini","etc/php/apache2/php.ini","web/conf/php.ini","usr/local/zend/etc/php.ini","opt/xampp/etc/php.ini","var/local/www/conf/php.ini","etc/php/cgi/php.ini","etc/php4/cgi/php.ini","etc/php5/cgi/php.ini","home2/bin/stable/apache/php.ini","home/bin/stable/apache/php.ini","etc/httpd/conf.d/php.conf","php5/php.ini","php4/php.ini","php/php.ini","windows/php.ini","winnt/php.ini","apache/php/php.ini","xampp/apache/bin/php.ini","netserver/bin/stable/apache/php.ini","volumes/macintosh_hd1/usr/local/php/lib/php.ini","etc/mono/1.0/machine.config","etc/mono/2.0/machine.config","etc/mono/2.0/web.config","etc/mono/config","usr/local/cpanel/logs/stats_log","usr/local/cpanel/logs/access_log","usr/local/cpanel/logs/error_log","usr/local/cpanel/logs/license_log","usr/local/cpanel/logs/login_log","var/cpanel/cpanel.config","usr/local/psa/admin/logs/httpsd_access_log","usr/local/psa/admin/logs/panel.log","usr/local/psa/admin/conf/php.ini","etc/sw-cp-server/applications.d/plesk.conf","usr/local/psa/admin/conf/site_isolation_settings.ini","usr/local/sb/config","etc/sw-cp-server/applications.d/00-sso-cpserver.conf","etc/sso/sso_config.ini","etc/mysql/conf.d/old_passwords.cnf","var/mysql.log","var/mysql-bin.index","var/data/mysql-bin.index","program files/mysql/mysql server 5.0/data/{host}.err","program files/mysql/mysql server 5.0/data/mysql.log","program files/mysql/mysql server 5.0/data/mysql.err","program files/mysql/mysql server 5.0/data/mysql-bin.log","program files/mysql/mysql server 5.0/data/mysql-bin.index","program files/mysql/data/{host}.err","program files/mysql/data/mysql.log","program files/mysql/data/mysql.err","program files/mysql/data/mysql-bin.log","program files/mysql/data/mysql-bin.index","mysql/data/{host}.err","mysql/data/mysql.log","mysql/data/mysql.err","mysql/data/mysql-bin.log","mysql/data/mysql-bin.index","usr/local/mysql/data/mysql.log","usr/local/mysql/data/mysql.err","usr/local/mysql/data/mysql-bin.log","usr/local/mysql/data/mysql-slow.log","usr/local/mysql/data/mysqlderror.log","usr/local/mysql/data/{host}.err","usr/local/mysql/data/mysql-bin.index","var/lib/mysql/my.cnf","etc/mysql/my.cnf","etc/my.cnf","program files/mysql/mysql server 5.0/my.ini","program files/mysql/mysql server 5.0/my.cnf","program files/mysql/my.ini","program files/mysql/my.cnf","mysql/my.ini","mysql/my.cnf","mysql/bin/my.ini","var/postgresql/log/postgresql.log","usr/internet/pgsql/data/postmaster.log","usr/local/pgsql/data/postgresql.log","usr/local/pgsql/data/pg_log","postgresql/log/pgadmin.log","var/lib/pgsql/data/postgresql.conf","var/postgresql/db/postgresql.conf","var/nm2/postgresql.conf","usr/local/pgsql/data/postgresql.conf","usr/local/pgsql/data/pg_hba.conf","usr/internet/pgsql/data/pg_hba.conf","usr/local/pgsql/data/passwd","usr/local/pgsql/bin/pg_passwd","etc/postgresql/postgresql.conf","etc/postgresql/pg_hba.conf","home/postgres/data/postgresql.conf","home/postgres/data/pg_version","home/postgres/data/pg_ident.conf","home/postgres/data/pg_hba.conf","program files/postgresql/8.3/data/pg_hba.conf","program files/postgresql/8.3/data/pg_ident.conf","program files/postgresql/8.3/data/postgresql.conf","program files/postgresql/8.4/data/pg_hba.conf","program files/postgresql/8.4/data/pg_ident.conf","program files/postgresql/8.4/data/postgresql.conf","program files/postgresql/9.0/data/pg_hba.conf","program files/postgresql/9.0/data/pg_ident.conf","program files/postgresql/9.0/data/postgresql.conf","program files/postgresql/9.1/data/pg_hba.conf","program files/postgresql/9.1/data/pg_ident.conf","program files/postgresql/9.1/data/postgresql.conf","wamp/logs/access.log","wamp/logs/apache_error.log","wamp/logs/genquery.log","wamp/logs/mysql.log","wamp/logs/slowquery.log","wamp/bin/apache/apache2.2.22/logs/access.log","wamp/bin/apache/apache2.2.22/logs/error.log","wamp/bin/apache/apache2.2.21/logs/access.log","wamp/bin/apache/apache2.2.21/logs/error.log","wamp/bin/mysql/mysql5.5.24/data/mysql-bin.index","wamp/bin/mysql/mysql5.5.16/data/mysql-bin.index","wamp/bin/apache/apache2.2.21/conf/httpd.conf","wamp/bin/apache/apache2.2.22/conf/httpd.conf","wamp/bin/apache/apache2.2.21/wampserver.conf","wamp/bin/apache/apache2.2.22/wampserver.conf","wamp/bin/apache/apache2.2.22/conf/wampserver.conf","wamp/bin/mysql/mysql5.5.24/my.ini","wamp/bin/mysql/mysql5.5.24/wampserver.conf","wamp/bin/mysql/mysql5.5.16/my.ini","wamp/bin/mysql/mysql5.5.16/wampserver.conf","wamp/bin/php/php5.3.8/php.ini","wamp/bin/php/php5.4.3/php.ini","xampp/apache/logs/access.log","xampp/apache/logs/error.log","xampp/mysql/data/mysql-bin.index","xampp/mysql/data/mysql.err","xampp/mysql/data/{host}.err","xampp/sendmail/sendmail.log","xampp/apache/conf/httpd.conf","xampp/filezillaftp/filezilla server.xml","xampp/mercurymail/mercury.ini","xampp/php/php.ini","xampp/phpmyadmin/config.inc.php","xampp/sendmail/sendmail.ini","xampp/webalizer/webalizer.conf","opt/lampp/etc/httpd.conf","xampp/htdocs/aca.txt","xampp/htdocs/admin.php","xampp/htdocs/leer.txt","usr/local/apache/logs/audit_log","usr/local/apache2/logs/audit_log","logs/security_debug_log","logs/security_log","usr/local/apache/conf/modsec.conf","usr/local/apache2/conf/modsec.conf","winnt/system32/logfiles/msftpsvc","winnt/system32/logfiles/msftpsvc1","winnt/system32/logfiles/msftpsvc2","windows/system32/logfiles/msftpsvc","windows/system32/logfiles/msftpsvc1","windows/system32/logfiles/msftpsvc2","etc/logrotate.d/proftpd","www/logs/proftpd.system.log","etc/pam.d/proftpd","etc/proftp.conf","etc/protpd/proftpd.conf","etc/vhcs2/proftpd/proftpd.conf","etc/proftpd/modules.conf","etc/vsftpd.chroot_list","etc/logrotate.d/vsftpd.log","etc/vsftpd/vsftpd.conf","etc/vsftpd.conf","etc/chrootusers","var/adm/log/xferlog","etc/wu-ftpd/ftpaccess","etc/wu-ftpd/ftphosts","etc/wu-ftpd/ftpusers","logs/pure-ftpd.log","usr/sbin/pure-config.pl","usr/etc/pure-ftpd.conf","etc/pure-ftpd/pure-ftpd.conf","usr/local/etc/pure-ftpd.conf","usr/local/etc/pureftpd.pdb","usr/local/pureftpd/etc/pureftpd.pdb","usr/local/pureftpd/sbin/pure-config.pl","usr/local/pureftpd/etc/pure-ftpd.conf","etc/pure-ftpd.conf","etc/pure-ftpd/pure-ftpd.pdb","etc/pureftpd.pdb","etc/pureftpd.passwd","etc/pure-ftpd/pureftpd.pdb","usr/ports/ftp/pure-ftpd/pure-ftpd.conf","usr/ports/ftp/pure-ftpd/pureftpd.pdb","usr/ports/ftp/pure-ftpd/pureftpd.passwd","usr/ports/net/pure-ftpd/pure-ftpd.conf","usr/ports/net/pure-ftpd/pureftpd.pdb","usr/ports/net/pure-ftpd/pureftpd.passwd","usr/pkgsrc/net/pureftpd/pure-ftpd.conf","usr/pkgsrc/net/pureftpd/pureftpd.pdb","usr/pkgsrc/net/pureftpd/pureftpd.passwd","usr/ports/contrib/pure-ftpd/pure-ftpd.conf","usr/ports/contrib/pure-ftpd/pureftpd.pdb","usr/ports/contrib/pure-ftpd/pureftpd.passwd","usr/sbin/mudlogd","etc/muddleftpd/mudlog","etc/muddleftpd.com","etc/muddleftpd/mudlogd.conf","etc/muddleftpd/muddleftpd.conf","usr/sbin/mudpasswd","etc/muddleftpd/muddleftpd.passwd","etc/muddleftpd/passwd","etc/logrotate.d/ftp","etc/ftpchroot","etc/ftphosts","etc/ftpusers","winnt/system32/logfiles/smtpsvc","winnt/system32/logfiles/smtpsvc1","winnt/system32/logfiles/smtpsvc2","winnt/system32/logfiles/smtpsvc3","winnt/system32/logfiles/smtpsvc4","winnt/system32/logfiles/smtpsvc5","windows/system32/logfiles/smtpsvc","windows/system32/logfiles/smtpsvc1","windows/system32/logfiles/smtpsvc2","windows/system32/logfiles/smtpsvc3","windows/system32/logfiles/smtpsvc4","windows/system32/logfiles/smtpsvc5","etc/osxhttpd/osxhttpd.conf","system/library/webobjects/adaptors/apache2.2/apache.conf","etc/apache2/sites-available/default","etc/apache2/sites-available/default-ssl","etc/apache2/sites-enabled/000-default","etc/apache2/sites-enabled/default","etc/apache2/apache2.conf","etc/apache2/ports.conf","usr/local/etc/apache/httpd.conf","usr/pkg/etc/httpd/httpd.conf","usr/pkg/etc/httpd/httpd-default.conf","usr/pkg/etc/httpd/httpd-vhosts.conf","etc/httpd/mod_php.conf","etc/httpd/extra/httpd-ssl.conf","etc/rc.d/rc.httpd","usr/local/apache/conf/httpd.conf.default","usr/local/apache/conf/access.conf","usr/local/apache22/conf/httpd.conf","usr/local/apache22/httpd.conf","usr/local/etc/apache22/conf/httpd.conf","usr/local/apps/apache22/conf/httpd.conf","etc/apache22/conf/httpd.conf","etc/apache22/httpd.conf","opt/apache22/conf/httpd.conf","usr/local/etc/apache2/vhosts.conf","usr/local/apache/conf/vhosts.conf","usr/local/apache2/conf/vhosts.conf","usr/local/apache/conf/vhosts-custom.conf","usr/local/apache2/conf/vhosts-custom.conf","etc/apache/default-server.conf","etc/apache2/default-server.conf","usr/local/apache2/conf/extra/httpd-ssl.conf","usr/local/apache2/conf/ssl.conf","etc/httpd/conf.d","usr/local/etc/apache22/httpd.conf","usr/local/etc/apache2/httpd.conf","etc/apache2/httpd2.conf","etc/apache2/ssl-global.conf","etc/apache2/vhosts.d/00_default_vhost.conf","apache/conf/httpd.conf","etc/apache/httpd.conf","etc/httpd/conf","http/httpd.conf","usr/local/apache1.3/conf/httpd.conf","usr/local/etc/httpd/conf","var/apache/conf/httpd.conf","var/www/conf","www/apache/conf/httpd.conf","www/conf/httpd.conf","etc/init.d","etc/apache/access.conf","etc/rc.conf","www/logs/freebsddiary-error.log","www/logs/freebsddiary-access_log","library/webserver/documents/index.html","library/webserver/documents/index.htm","library/webserver/documents/default.html","library/webserver/documents/default.htm","library/webserver/documents/index.php","library/webserver/documents/default.php","usr/local/etc/webmin/miniserv.conf","etc/webmin/miniserv.conf","usr/local/etc/webmin/miniserv.users","etc/webmin/miniserv.users","winnt/system32/logfiles/w3svc/inetsvn1.log","winnt/system32/logfiles/w3svc1/inetsvn1.log","winnt/system32/logfiles/w3svc2/inetsvn1.log","winnt/system32/logfiles/w3svc3/inetsvn1.log","windows/system32/logfiles/w3svc/inetsvn1.log","windows/system32/logfiles/w3svc1/inetsvn1.log","windows/system32/logfiles/w3svc2/inetsvn1.log","windows/system32/logfiles/w3svc3/inetsvn1.log","apache/logs/error.log","apache/logs/access.log","apache2/logs/error.log","apache2/logs/access.log","logs/error.log","logs/access.log","etc/httpd/logs/access_log","etc/httpd/logs/access.log","etc/httpd/logs/error_log","etc/httpd/logs/error.log","usr/local/apache/logs/access_log","usr/local/apache/logs/access.log","usr/local/apache/logs/error_log","usr/local/apache/logs/error.log","usr/local/apache2/logs/access_log","usr/local/apache2/logs/access.log","usr/local/apache2/logs/error_log","usr/local/apache2/logs/error.log","var/www/logs/access_log","var/www/logs/access.log","var/www/logs/error_log","var/www/logs/error.log","opt/lampp/logs/access_log","opt/lampp/logs/error_log","opt/xampp/logs/access_log","opt/xampp/logs/error_log","opt/lampp/logs/access.log","opt/lampp/logs/error.log","opt/xampp/logs/access.log","opt/xampp/logs/error.log","program files/apache group/apache/logs/access.log","program files/apache group/apache/logs/error.log","program files/apache software foundation/apache2.2/logs/error.log","program files/apache software foundation/apache2.2/logs/access.log","opt/apache/apache.conf","opt/apache/conf/apache.conf","opt/apache2/apache.conf","opt/apache2/conf/apache.conf","opt/httpd/apache.conf","opt/httpd/conf/apache.conf","etc/httpd/apache.conf","etc/apache2/apache.conf","etc/httpd/conf/apache.conf","usr/local/apache/apache.conf","usr/local/apache/conf/apache.conf","usr/local/apache2/apache.conf","usr/local/apache2/conf/apache.conf","usr/local/php/apache.conf.php","usr/local/php4/apache.conf.php","usr/local/php5/apache.conf.php","usr/local/php/apache.conf","usr/local/php4/apache.conf","usr/local/php5/apache.conf","private/etc/httpd/apache.conf","opt/apache/apache2.conf","opt/apache/conf/apache2.conf","opt/apache2/apache2.conf","opt/apache2/conf/apache2.conf","opt/httpd/apache2.conf","opt/httpd/conf/apache2.conf","etc/httpd/apache2.conf","etc/httpd/conf/apache2.conf","usr/local/apache/apache2.conf","usr/local/apache/conf/apache2.conf","usr/local/apache2/apache2.conf","usr/local/apache2/conf/apache2.conf","usr/local/php/apache2.conf.php","usr/local/php4/apache2.conf.php","usr/local/php5/apache2.conf.php","usr/local/php/apache2.conf","usr/local/php4/apache2.conf","usr/local/php5/apache2.conf","private/etc/httpd/apache2.conf","usr/local/apache/conf/httpd.conf","usr/local/apache2/conf/httpd.conf","etc/httpd/conf/httpd.conf","etc/apache/apache.conf","etc/apache/conf/httpd.conf","etc/apache2/httpd.conf","usr/apache2/conf/httpd.conf","usr/apache/conf/httpd.conf","usr/local/etc/apache/conf/httpd.conf","usr/local/apache/httpd.conf","usr/local/apache2/httpd.conf","usr/local/httpd/conf/httpd.conf","usr/local/etc/apache2/conf/httpd.conf","usr/local/etc/httpd/conf/httpd.conf","usr/local/apps/apache2/conf/httpd.conf","usr/local/apps/apache/conf/httpd.conf","usr/local/php/httpd.conf.php","usr/local/php4/httpd.conf.php","usr/local/php5/httpd.conf.php","usr/local/php/httpd.conf","usr/local/php4/httpd.conf","usr/local/php5/httpd.conf","etc/apache2/conf/httpd.conf","etc/http/conf/httpd.conf","etc/httpd/httpd.conf","etc/http/httpd.conf","etc/httpd.conf","opt/apache/conf/httpd.conf","opt/apache2/conf/httpd.conf","var/www/conf/httpd.conf","private/etc/httpd/httpd.conf","private/etc/httpd/httpd.conf.default","etc/apache2/vhosts.d/default_vhost.include","etc/apache2/conf.d/charset","etc/apache2/conf.d/security","etc/apache2/envvars","etc/apache2/mods-available/autoindex.conf","etc/apache2/mods-available/deflate.conf","etc/apache2/mods-available/dir.conf","etc/apache2/mods-available/mem_cache.conf","etc/apache2/mods-available/mime.conf","etc/apache2/mods-available/proxy.conf","etc/apache2/mods-available/setenvif.conf","etc/apache2/mods-available/ssl.conf","etc/apache2/mods-enabled/alias.conf","etc/apache2/mods-enabled/deflate.conf","etc/apache2/mods-enabled/dir.conf","etc/apache2/mods-enabled/mime.conf","etc/apache2/mods-enabled/negotiation.conf","etc/apache2/mods-enabled/php5.conf","etc/apache2/mods-enabled/status.conf","program files/apache group/apache/conf/httpd.conf","program files/apache group/apache2/conf/httpd.conf","program files/xampp/apache/conf/apache.conf","program files/xampp/apache/conf/apache2.conf","program files/xampp/apache/conf/httpd.conf","program files/apache group/apache/apache.conf","program files/apache group/apache/conf/apache.conf","program files/apache group/apache2/conf/apache.conf","program files/apache group/apache/apache2.conf","program files/apache group/apache/conf/apache2.conf","program files/apache group/apache2/conf/apache2.conf","program files/apache software foundation/apache2.2/conf/httpd.conf","volumes/macintosh_hd1/opt/httpd/conf/httpd.conf","volumes/macintosh_hd1/opt/apache/conf/httpd.conf","volumes/macintosh_hd1/opt/apache2/conf/httpd.conf","volumes/macintosh_hd1/usr/local/php/httpd.conf.php","volumes/macintosh_hd1/usr/local/php4/httpd.conf.php","volumes/macintosh_hd1/usr/local/php5/httpd.conf.php","volumes/webbackup/opt/apache2/conf/httpd.conf","volumes/webbackup/private/etc/httpd/httpd.conf","volumes/webbackup/private/etc/httpd/httpd.conf.default","usr/local/etc/apache/vhosts.conf","usr/local/jakarta/tomcat/conf/jakarta.conf","usr/local/jakarta/tomcat/conf/server.xml","usr/local/jakarta/tomcat/conf/context.xml","usr/local/jakarta/tomcat/conf/workers.properties","usr/local/jakarta/tomcat/conf/logging.properties","usr/local/jakarta/dist/tomcat/conf/jakarta.conf","usr/local/jakarta/dist/tomcat/conf/server.xml","usr/local/jakarta/dist/tomcat/conf/context.xml","usr/local/jakarta/dist/tomcat/conf/workers.properties","usr/local/jakarta/dist/tomcat/conf/logging.properties","usr/share/tomcat6/conf/server.xml","usr/share/tomcat6/conf/context.xml","usr/share/tomcat6/conf/workers.properties","usr/share/tomcat6/conf/logging.properties","var/cpanel/tomcat.options","usr/local/jakarta/tomcat/logs/catalina.out","usr/local/jakarta/tomcat/logs/catalina.err","opt/tomcat/logs/catalina.out","opt/tomcat/logs/catalina.err","usr/share/logs/catalina.out","usr/share/logs/catalina.err","usr/share/tomcat/logs/catalina.out","usr/share/tomcat/logs/catalina.err","usr/share/tomcat6/logs/catalina.out","usr/share/tomcat6/logs/catalina.err","usr/local/apache/logs/mod_jk.log","usr/local/jakarta/tomcat/logs/mod_jk.log","usr/local/jakarta/dist/tomcat/logs/mod_jk.log","opt/[jboss]/server/default/conf/jboss-minimal.xml","opt/[jboss]/server/default/conf/jboss-service.xml","opt/[jboss]/server/default/conf/jndi.properties","opt/[jboss]/server/default/conf/log4j.xml","opt/[jboss]/server/default/conf/login-config.xml","opt/[jboss]/server/default/conf/standardjaws.xml","opt/[jboss]/server/default/conf/standardjboss.xml","opt/[jboss]/server/default/conf/server.log.properties","opt/[jboss]/server/default/deploy/jboss-logging.xml","usr/local/[jboss]/server/default/conf/jboss-minimal.xml","usr/local/[jboss]/server/default/conf/jboss-service.xml","usr/local/[jboss]/server/default/conf/jndi.properties","usr/local/[jboss]/server/default/conf/log4j.xml","usr/local/[jboss]/server/default/conf/login-config.xml","usr/local/[jboss]/server/default/conf/standardjaws.xml","usr/local/[jboss]/server/default/conf/standardjboss.xml","usr/local/[jboss]/server/default/conf/server.log.properties","usr/local/[jboss]/server/default/deploy/jboss-logging.xml","private/tmp/[jboss]/server/default/conf/jboss-minimal.xml","private/tmp/[jboss]/server/default/conf/jboss-service.xml","private/tmp/[jboss]/server/default/conf/jndi.properties","private/tmp/[jboss]/server/default/conf/log4j.xml","private/tmp/[jboss]/server/default/conf/login-config.xml","private/tmp/[jboss]/server/default/conf/standardjaws.xml","private/tmp/[jboss]/server/default/conf/standardjboss.xml","private/tmp/[jboss]/server/default/conf/server.log.properties","private/tmp/[jboss]/server/default/deploy/jboss-logging.xml","tmp/[jboss]/server/default/conf/jboss-minimal.xml","tmp/[jboss]/server/default/conf/jboss-service.xml","tmp/[jboss]/server/default/conf/jndi.properties","tmp/[jboss]/server/default/conf/log4j.xml","tmp/[jboss]/server/default/conf/login-config.xml","tmp/[jboss]/server/default/conf/standardjaws.xml","tmp/[jboss]/server/default/conf/standardjboss.xml","tmp/[jboss]/server/default/conf/server.log.properties","tmp/[jboss]/server/default/deploy/jboss-logging.xml","program files/[jboss]/server/default/conf/jboss-minimal.xml","program files/[jboss]/server/default/conf/jboss-service.xml","program files/[jboss]/server/default/conf/jndi.properties","program files/[jboss]/server/default/conf/log4j.xml","program files/[jboss]/server/default/conf/login-config.xml","program files/[jboss]/server/default/conf/standardjaws.xml","program files/[jboss]/server/default/conf/standardjboss.xml","program files/[jboss]/server/default/conf/server.log.properties","program files/[jboss]/server/default/deploy/jboss-logging.xml","[jboss]/server/default/conf/jboss-minimal.xml","[jboss]/server/default/conf/jboss-service.xml","[jboss]/server/default/conf/jndi.properties","[jboss]/server/default/conf/log4j.xml","[jboss]/server/default/conf/login-config.xml","[jboss]/server/default/conf/standardjaws.xml","[jboss]/server/default/conf/standardjboss.xml","[jboss]/server/default/conf/server.log.properties","[jboss]/server/default/deploy/jboss-logging.xml","opt/[jboss]/server/default/log/server.log","opt/[jboss]/server/default/log/boot.log","usr/local/[jboss]/server/default/log/server.log","usr/local/[jboss]/server/default/log/boot.log","private/tmp/[jboss]/server/default/log/server.log","private/tmp/[jboss]/server/default/log/boot.log","tmp/[jboss]/server/default/log/server.log","tmp/[jboss]/server/default/log/boot.log","program files/[jboss]/server/default/log/server.log","program files/[jboss]/server/default/log/boot.log","[jboss]/server/default/log/server.log","[jboss]/server/default/log/boot.log","var/lighttpd.log","var/logs/access.log","usr/local/apache2/logs/lighttpd.error.log","usr/local/apache2/logs/lighttpd.log","usr/local/apache/logs/lighttpd.error.log","usr/local/apache/logs/lighttpd.log","usr/local/lighttpd/log/lighttpd.error.log","usr/local/lighttpd/log/access.log","usr/home/user/var/log/lighttpd.error.log","usr/home/user/var/log/apache.log","home/user/lighttpd/lighttpd.conf","usr/home/user/lighttpd/lighttpd.conf","etc/lighttpd/lighthttpd.conf","usr/local/etc/lighttpd.conf","usr/local/lighttpd/conf/lighttpd.conf","usr/local/etc/lighttpd.conf.new","var/www/.lighttpdpassword","logs/access_log","logs/error_log","etc/nginx/nginx.conf","usr/local/etc/nginx/nginx.conf","usr/local/nginx/conf/nginx.conf","usr/local/zeus/web/global.cfg","usr/local/zeus/web/log/errors","opt/lsws/conf/httpd_conf.xml","usr/local/lsws/conf/httpd_conf.xml","opt/lsws/logs/error.log","opt/lsws/logs/access.log","usr/local/lsws/logs/error.log","usr/local/logs/access.log","usr/local/samba/lib/log.user","usr/local/logs/samba.log","etc/samba/netlogon","etc/smbpasswd","etc/smb.conf","etc/samba/dhcp.conf","etc/samba/smb.conf","etc/samba/samba.conf","etc/samba/smb.conf.user","etc/samba/smbpasswd","etc/samba/smbusers","etc/samba/private/smbpasswd","usr/local/etc/smb.conf","usr/local/samba/lib/smb.conf.user","etc/dhcp3/dhclient.conf","etc/dhcp3/dhcpd.conf","etc/dhcp/dhclient.conf","program files/vidalia bundle/polipo/polipo.conf","etc/tor/tor-tsocks.conf","etc/stunnel/stunnel.conf","etc/tsocks.conf","etc/tinyproxy/tinyproxy.conf","etc/miredo-server.conf","etc/miredo.conf","etc/miredo/miredo-server.conf","etc/miredo/miredo.conf","etc/wicd/dhclient.conf.template.default","etc/wicd/manager-settings.conf","etc/wicd/wired-settings.conf","etc/wicd/wireless-settings.conf","etc/ipfw.rules","etc/ipfw.conf","etc/firewall.rules","winnt/system32/logfiles/firewall/pfirewall.log","winnt/system32/logfiles/firewall/pfirewall.log.old","windows/system32/logfiles/firewall/pfirewall.log","windows/system32/logfiles/firewall/pfirewall.log.old","etc/clamav/clamd.conf","etc/clamav/freshclam.conf","etc/x11/xorg.conf","etc/x11/xorg.conf-vesa","etc/x11/xorg.conf-vmware","etc/x11/xorg.conf.beforevmwaretoolsinstall","etc/x11/xorg.conf.orig","etc/bluetooth/input.conf","etc/bluetooth/main.conf","etc/bluetooth/network.conf","etc/bluetooth/rfcomm.conf","etc/bash_completion.d/debconf","root/.bash_logout","root/.bash_history","root/.bash_config","root/.bashrc","etc/bash.bashrc","var/adm/syslog","var/adm/sulog","var/adm/utmp","var/adm/utmpx","var/adm/wtmp","var/adm/wtmpx","var/adm/lastlog/username","usr/spool/lp/log","var/adm/lp/lpd-errs","usr/lib/cron/log","var/adm/loginlog","var/adm/pacct","var/adm/dtmp","var/adm/acct/sum/loginlog","var/adm/x0msgs","var/adm/crash/vmcore","var/adm/crash/unix","etc/newsyslog.conf","var/adm/qacct","var/adm/ras/errlog","var/adm/ras/bootlog","var/adm/cron/log","etc/utmp","etc/security/lastlog","etc/security/failedlogin","usr/spool/mqueue/syslog","var/adm/messages","var/adm/aculogs","var/adm/aculog","var/adm/vold.log","var/adm/log/asppp.log","var/lp/logs/lpsched","var/lp/logs/lpnet","var/lp/logs/requests","var/cron/log","var/saf/_log","var/saf/port/log","tmp/access.log","etc/sensors.conf","etc/sensors3.conf","etc/host.conf","etc/pam.conf","etc/resolv.conf","etc/apt/apt.conf","etc/inetd.conf","etc/syslog.conf","etc/sysctl.conf","etc/sysctl.d/10-console-messages.conf","etc/sysctl.d/10-network-security.conf","etc/sysctl.d/10-process-security.conf","etc/sysctl.d/wine.sysctl.conf","etc/security/access.conf","etc/security/group.conf","etc/security/limits.conf","etc/security/namespace.conf","etc/security/pam_env.conf","etc/security/sepermit.conf","etc/security/time.conf","etc/ssh/sshd_config","etc/adduser.conf","etc/deluser.conf","etc/avahi/avahi-daemon.conf","etc/ca-certificates.conf","etc/ca-certificates.conf.dpkg-old","etc/casper.conf","etc/chkrootkit.conf","etc/debconf.conf","etc/dns2tcpd.conf","etc/e2fsck.conf","etc/esound/esd.conf","etc/etter.conf","etc/fuse.conf","etc/foremost.conf","etc/hdparm.conf","etc/kernel-img.conf","etc/kernel-pkg.conf","etc/ld.so.conf","etc/ltrace.conf","etc/mail/sendmail.conf","etc/manpath.config","etc/kbd/config","etc/ldap/ldap.conf","etc/logrotate.conf","etc/mtools.conf","etc/smi.conf","etc/updatedb.conf","etc/pulse/client.conf","usr/share/adduser/adduser.conf","etc/hostname","etc/networks","etc/timezone","etc/modules","etc/passwd","etc/shadow","etc/fstab","etc/motd","etc/hosts","etc/group","etc/alias","etc/crontab","etc/crypttab","etc/exports","etc/mtab","etc/hosts.allow","etc/hosts.deny","etc/os-release","etc/password.master","etc/profile","etc/default/grub","etc/resolvconf/update-libc.d/sendmail","etc/inittab","etc/issue","etc/issue.net","etc/login.defs","etc/sudoers","etc/sysconfig/network-scripts/ifcfg-eth0","etc/redhat-release","etc/scw-release","etc/system-release-cpe","etc/debian_version","etc/fedora-release","etc/mandrake-release","etc/slackware-release","etc/suse-release","etc/security/group","etc/security/passwd","etc/security/user","etc/security/environ","etc/security/limits","etc/security/opasswd","boot/grub/grub.cfg","boot/grub/menu.lst","root/.ksh_history","root/.xauthority","usr/lib/security/mkuser.default","var/lib/squirrelmail/prefs/squirrelmail.log","etc/squirrelmail/apache.conf","etc/squirrelmail/config_local.php","etc/squirrelmail/default_pref","etc/squirrelmail/index.php","etc/squirrelmail/config_default.php","etc/squirrelmail/config.php","etc/squirrelmail/filters_setup.php","etc/squirrelmail/sqspell_config.php","etc/squirrelmail/config/config.php","etc/httpd/conf.d/squirrelmail.conf","usr/share/squirrelmail/config/config.php","private/etc/squirrelmail/config/config.php","srv/www/htdos/squirrelmail/config/config.php","var/www/squirrelmail/config/config.php","var/www/html/squirrelmail/config/config.php","var/www/html/squirrelmail-1.2.9/config/config.php","usr/share/squirrelmail/plugins/squirrel_logger/setup.php","usr/local/squirrelmail/www/readme","windows/system32/drivers/etc/hosts","windows/system32/drivers/etc/lmhosts.sam","windows/system32/drivers/etc/networks","windows/system32/drivers/etc/protocol","windows/system32/drivers/etc/services","/boot.ini","windows/debug/netsetup.log","windows/comsetup.log","windows/repair/setup.log","windows/setupact.log","windows/setupapi.log","windows/setuperr.log","windows/updspapi.log","windows/wmsetup.log","windows/windowsupdate.log","windows/odbc.ini","usr/local/psa/admin/htdocs/domains/databases/phpmyadmin/libraries/config.default.php","etc/apache2/conf.d/phpmyadmin.conf","etc/phpmyadmin/config.inc.php","etc/openldap/ldap.conf","etc/cups/acroread.conf","etc/cups/cupsd.conf","etc/cups/cupsd.conf.default","etc/cups/pdftops.conf","etc/cups/printers.conf","windows/system32/macromed/flash/flashinstall.log","windows/system32/macromed/flash/install.log","etc/cvs-cron.conf","etc/cvs-pserver.conf","etc/subversion/config","etc/modprobe.d/vmware-tools.conf","etc/updatedb.conf.beforevmwaretoolsinstall","etc/vmware-tools/config","etc/vmware-tools/tpvmlp.conf","etc/vmware-tools/vmware-tools-libraries.conf","var/log","var/log/sw-cp-server/error_log","var/log/sso/sso.log","var/log/dpkg.log","var/log/btmp","var/log/utmp","var/log/wtmp","var/log/mysql/mysql-bin.log","var/log/mysql/mysql-bin.index","var/log/mysql/data/mysql-bin.index","var/log/mysql.log","var/log/mysql.err","var/log/mysqlderror.log","var/log/mysql/mysql.log","var/log/mysql/mysql-slow.log","var/log/mysql-bin.index","var/log/data/mysql-bin.index","var/log/postgresql/postgresql.log","var/log/postgres/pg_backup.log","var/log/postgres/postgres.log","var/log/postgresql.log","var/log/pgsql/pgsql.log","var/log/postgresql/postgresql-8.1-main.log","var/log/postgresql/postgresql-8.3-main.log","var/log/postgresql/postgresql-8.4-main.log","var/log/postgresql/postgresql-9.0-main.log","var/log/postgresql/postgresql-9.1-main.log","var/log/pgsql8.log","var/log/postgresql/postgres.log","var/log/pgsql_log","var/log/postgresql/main.log","var/log/cron","var/log/postgres.log","var/log/proftpd","var/log/proftpd/xferlog.legacy","var/log/proftpd.access_log","var/log/proftpd.xferlog","var/log/vsftpd.log","var/log/xferlog","var/log/pure-ftpd/pure-ftpd.log","var/log/pureftpd.log","var/log/muddleftpd","var/log/muddleftpd.conf","var/log/ftp-proxy/ftp-proxy.log","var/log/ftp-proxy","var/log/ftplog","var/log/exim_mainlog","var/log/exim/mainlog","var/log/maillog","var/log/exim_paniclog","var/log/exim/paniclog","var/log/exim/rejectlog","var/log/exim_rejectlog","var/log/webmin/miniserv.log","var/log/httpd/access_log","var/log/httpd/error_log","var/log/httpd/access.log","var/log/httpd/error.log","var/log/apache/access_log","var/log/apache/access.log","var/log/apache/error_log","var/log/apache/error.log","var/log/apache2/access_log","var/log/apache2/access.log","var/log/apache2/error_log","var/log/apache2/error.log","var/log/access_log","var/log/access.log","var/log/error_log","var/log/error.log","var/log/tomcat6/catalina.out","var/log/lighttpd.error.log","var/log/lighttpd.access.log","var/logs/access.log","var/log/lighttpd/","var/log/lighttpd/error.log","var/log/lighttpd/access.www.log","var/log/lighttpd/error.www.log","var/log/lighttpd/access.log","var/log/lighttpd/{domain}/access.log","var/log/lighttpd/{domain}/error.log","var/log/nginx/access_log","var/log/nginx/error_log","var/log/nginx/access.log","var/log/nginx/error.log","var/log/nginx.access_log","var/log/nginx.error_log","var/log/samba/log.smbd","var/log/samba/log.nmbd","var/log/samba.log","var/log/samba.log1","var/log/samba.log2","var/log/log.smb","var/log/ipfw.log","var/log/ipfw","var/log/ipfw/ipfw.log","var/log/ipfw.today","var/log/poplog","var/log/authlog","var/log/news.all","var/log/news/news.all","var/log/news/news.crit","var/log/news/news.err","var/log/news/news.notice","var/log/news/suck.err","var/log/news/suck.notice","var/log/messages","var/log/messages.1","var/log/user.log","var/log/user.log.1","var/log/auth.log","var/log/pm-powersave.log","var/log/xorg.0.log","var/log/daemon.log","var/log/daemon.log.1","var/log/kern.log","var/log/kern.log.1","var/log/mail.err","var/log/mail.info","var/log/mail.warn","var/log/ufw.log","var/log/boot.log","var/log/syslog","var/log/syslog.1","var/log/squirrelmail.log","var/log/apache2/squirrelmail.log","var/log/apache2/squirrelmail.err.log","var/log/mail.log","var/log/vmware/hostd.log","var/log/vmware/hostd-1.log","/wp-config.php","/wp-config.bak","/wp-config.old","/wp-config.temp","/wp-config.tmp","/wp-config.txt","/config.yml","/config_dev.yml","/config_prod.yml","/config_test.yml","/parameters.yml","/routing.yml","/security.yml","/services.yml","sites/default/default.settings.php","sites/default/settings.php","sites/default/settings.local.php","app/etc/local.xml","/sftp-config.json","/web.config","includes/config.php","includes/configure.php","/config.inc.php","/localsettings.php","inc/config.php","typo3conf/localconf.php","config/app.php","config/custom.php","config/database.php","/configuration.php","/config.php","var/mail/www-data","etc/network/","etc/init/","inetpub/wwwroot/global.asa","system32/inetsrv/config/applicationhost.config","system32/inetsrv/config/administration.config","system32/inetsrv/config/redirection.config","system32/config/default","system32/config/sam","system32/config/system","system32/config/software","winnt/repair/sam._","/package.json","/package-lock.json","/gruntfile.js","/npm-debug.log","/ormconfig.json","/tsconfig.json","/webpack.config.js","/yarn.lock","proc/0","proc/1","proc/2","proc/3","proc/4","proc/5","proc/6","proc/7","proc/8","proc/9","proc/acpi","proc/asound","proc/bootconfig","proc/buddyinfo","proc/bus","proc/cgroups","proc/cmdline","proc/config.gz","proc/consoles","proc/cpuinfo","proc/crypto","proc/devices","proc/diskstats","proc/dma","proc/docker","proc/driver","proc/dynamic_debug","proc/execdomains","proc/fb","proc/filesystems","proc/fs","proc/interrupts","proc/iomem","proc/ioports","proc/ipmi","proc/irq","proc/kallsyms","proc/kcore","proc/keys","proc/keys","proc/key-users","proc/kmsg","proc/kpagecgroup","proc/kpagecount","proc/kpageflags","proc/latency_stats","proc/loadavg","proc/locks","proc/mdstat","proc/meminfo","proc/misc","proc/modules","proc/mounts","proc/mpt","proc/mtd","proc/mtrr","proc/net","proc/net/tcp","proc/net/udp","proc/pagetypeinfo","proc/partitions","proc/pressure","proc/sched_debug","proc/schedstat","proc/scsi","proc/self","proc/self/cmdline","proc/self/environ","proc/self/fd/0","proc/self/fd/1","proc/self/fd/10","proc/self/fd/11","proc/self/fd/12","proc/self/fd/13","proc/self/fd/14","proc/self/fd/15","proc/self/fd/2","proc/self/fd/3","proc/self/fd/4","proc/self/fd/5","proc/self/fd/6","proc/self/fd/7","proc/self/fd/8","proc/self/fd/9","proc/self/mounts","proc/self/stat","proc/self/status","proc/slabinfo","proc/softirqs","proc/stat","proc/swaps","proc/sys","proc/sysrq-trigger","proc/sysvipc","proc/thread-self","proc/timer_list","proc/timer_stats","proc/tty","proc/uptime","proc/version","proc/version_signature","proc/vmallocinfo","proc/vmstat","proc/zoneinfo","sys/block","sys/bus","sys/class","sys/dev","sys/devices","sys/firmware","sys/fs","sys/hypervisor","sys/kernel","sys/module","sys/power"]},operator:"phrase_match"}],transformers:["lowercase","normalizePath"]},{id:"crs-931-110",name:"RFI: Common RFI Vulnerable Parameter Name used w/ URL Payload",tags:{type:"rfi",crs_id:"931110",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"}],regex:"(?:\\binclude\\s*\\([^)]*|mosConfig_absolute_path|_CONF\\[path\\]|_SERVER\\[DOCUMENT_ROOT\\]|GALLERY_BASEDIR|path\\[docroot\\]|appserv_root|config\\[root_dir\\])=(?:file|ftps?|https?)://",options:{min_length:15}},operator:"match_regex"}],transformers:[]},{id:"crs-931-120",name:"RFI: URL Payload Used w/Trailing Question Mark Character (?)",tags:{type:"rfi",crs_id:"931120",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"}],regex:"^(?i:file|ftps?)://.*?\\?+$",options:{case_sensitive:!0,min_length:4}},operator:"match_regex"}],transformers:[]},{id:"crs-932-160",name:"Remote Command Execution: Unix Shell Code Found",tags:{type:"command_injection",crs_id:"932160",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],list:["${cdpath}","${dirstack}","${home}","${hostname}","${ifs}","${oldpwd}","${ostype}","${path}","${pwd}","$cdpath","$dirstack","$home","$hostname","$ifs","$oldpwd","$ostype","$path","$pwd","dev/fd/","dev/null","dev/stderr","dev/stdin","dev/stdout","dev/tcp/","dev/udp/","dev/zero","etc/master.passwd","etc/pwd.db","etc/shells","etc/spwd.db","proc/self/","bin/7z","bin/7za","bin/7zr","bin/ab","bin/agetty","bin/ansible-playbook","bin/apt","bin/apt-get","bin/ar","bin/aria2c","bin/arj","bin/arp","bin/as","bin/ascii-xfr","bin/ascii85","bin/ash","bin/aspell","bin/at","bin/atobm","bin/awk","bin/base32","bin/base64","bin/basenc","bin/bash","bin/bpftrace","bin/bridge","bin/bundler","bin/bunzip2","bin/busctl","bin/busybox","bin/byebug","bin/bzcat","bin/bzcmp","bin/bzdiff","bin/bzegrep","bin/bzexe","bin/bzfgrep","bin/bzgrep","bin/bzip2","bin/bzip2recover","bin/bzless","bin/bzmore","bin/bzz","bin/c89","bin/c99","bin/cancel","bin/capsh","bin/cat","bin/cc","bin/certbot","bin/check_by_ssh","bin/check_cups","bin/check_log","bin/check_memory","bin/check_raid","bin/check_ssl_cert","bin/check_statusfile","bin/chmod","bin/choom","bin/chown","bin/chroot","bin/clang","bin/clang++","bin/cmp","bin/cobc","bin/column","bin/comm","bin/composer","bin/core_perl/zipdetails","bin/cowsay","bin/cowthink","bin/cp","bin/cpan","bin/cpio","bin/cpulimit","bin/crash","bin/crontab","bin/csh","bin/csplit","bin/csvtool","bin/cupsfilter","bin/curl","bin/cut","bin/dash","bin/date","bin/dd","bin/dev/fd/","bin/dev/null","bin/dev/stderr","bin/dev/stdin","bin/dev/stdout","bin/dev/tcp/","bin/dev/udp/","bin/dev/zero","bin/dialog","bin/diff","bin/dig","bin/dmesg","bin/dmidecode","bin/dmsetup","bin/dnf","bin/docker","bin/dosbox","bin/dpkg","bin/du","bin/dvips","bin/easy_install","bin/eb","bin/echo","bin/ed","bin/efax","bin/emacs","bin/env","bin/eqn","bin/es","bin/esh","bin/etc/group","bin/etc/master.passwd","bin/etc/passwd","bin/etc/pwd.db","bin/etc/shadow","bin/etc/shells","bin/etc/spwd.db","bin/ex","bin/exiftool","bin/expand","bin/expect","bin/expr","bin/facter","bin/fetch","bin/file","bin/find","bin/finger","bin/fish","bin/flock","bin/fmt","bin/fold","bin/fping","bin/ftp","bin/gawk","bin/gcc","bin/gcore","bin/gdb","bin/gem","bin/genie","bin/genisoimage","bin/ghc","bin/ghci","bin/gimp","bin/ginsh","bin/git","bin/grc","bin/grep","bin/gtester","bin/gunzip","bin/gzexe","bin/gzip","bin/hd","bin/head","bin/hexdump","bin/highlight","bin/hping3","bin/iconv","bin/id","bin/iftop","bin/install","bin/ionice","bin/ip","bin/irb","bin/ispell","bin/jjs","bin/join","bin/journalctl","bin/jq","bin/jrunscript","bin/knife","bin/ksh","bin/ksshell","bin/latex","bin/ld","bin/ldconfig","bin/less","bin/lftp","bin/ln","bin/loginctl","bin/logsave","bin/look","bin/lp","bin/ls","bin/ltrace","bin/lua","bin/lualatex","bin/luatex","bin/lwp-download","bin/lwp-request","bin/lz","bin/lz4","bin/lz4c","bin/lz4cat","bin/lzcat","bin/lzcmp","bin/lzdiff","bin/lzegrep","bin/lzfgrep","bin/lzgrep","bin/lzless","bin/lzma","bin/lzmadec","bin/lzmainfo","bin/lzmore","bin/mail","bin/make","bin/man","bin/mawk","bin/mkfifo","bin/mknod","bin/more","bin/mosquitto","bin/mount","bin/msgattrib","bin/msgcat","bin/msgconv","bin/msgfilter","bin/msgmerge","bin/msguniq","bin/mtr","bin/mv","bin/mysql","bin/nano","bin/nasm","bin/nawk","bin/nc","bin/ncat","bin/neofetch","bin/nice","bin/nl","bin/nm","bin/nmap","bin/node","bin/nohup","bin/npm","bin/nroff","bin/nsenter","bin/octave","bin/od","bin/openssl","bin/openvpn","bin/openvt","bin/opkg","bin/paste","bin/pax","bin/pdb","bin/pdflatex","bin/pdftex","bin/pdksh","bin/perf","bin/perl","bin/pg","bin/php","bin/php-cgi","bin/php5","bin/php7","bin/pic","bin/pico","bin/pidstat","bin/pigz","bin/pip","bin/pkexec","bin/pkg","bin/pr","bin/printf","bin/proc/self/","bin/pry","bin/ps","bin/psed","bin/psftp","bin/psql","bin/ptx","bin/puppet","bin/pxz","bin/python","bin/python2","bin/python3","bin/rake","bin/rbash","bin/rc","bin/readelf","bin/red","bin/redcarpet","bin/restic","bin/rev","bin/rlogin","bin/rlwrap","bin/rpm","bin/rpmquery","bin/rsync","bin/ruby","bin/run-mailcap","bin/run-parts","bin/rview","bin/rvim","bin/sash","bin/sbin/capsh","bin/sbin/logsave","bin/sbin/service","bin/sbin/start-stop-daemon","bin/scp","bin/screen","bin/script","bin/sed","bin/service","bin/setarch","bin/sftp","bin/sg","bin/sh","bin/shuf","bin/sleep","bin/slsh","bin/smbclient","bin/snap","bin/socat","bin/soelim","bin/sort","bin/split","bin/sqlite3","bin/ss","bin/ssh","bin/ssh-keygen","bin/ssh-keyscan","bin/sshpass","bin/start-stop-daemon","bin/stdbuf","bin/strace","bin/strings","bin/su","bin/sysctl","bin/systemctl","bin/systemd-resolve","bin/tac","bin/tail","bin/tar","bin/task","bin/taskset","bin/tbl","bin/tclsh","bin/tcpdump","bin/tcsh","bin/tee","bin/telnet","bin/tex","bin/tftp","bin/tic","bin/time","bin/timedatectl","bin/timeout","bin/tmux","bin/top","bin/troff","bin/tshark","bin/ul","bin/uname","bin/uncompress","bin/unexpand","bin/uniq","bin/unlz4","bin/unlzma","bin/unpigz","bin/unrar","bin/unshare","bin/unxz","bin/unzip","bin/unzstd","bin/update-alternatives","bin/uudecode","bin/uuencode","bin/valgrind","bin/vi","bin/view","bin/vigr","bin/vim","bin/vimdiff","bin/vipw","bin/virsh","bin/volatility","bin/wall","bin/watch","bin/wc","bin/wget","bin/whiptail","bin/who","bin/whoami","bin/whois","bin/wireshark","bin/wish","bin/xargs","bin/xelatex","bin/xetex","bin/xmodmap","bin/xmore","bin/xpad","bin/xxd","bin/xz","bin/xzcat","bin/xzcmp","bin/xzdec","bin/xzdiff","bin/xzegrep","bin/xzfgrep","bin/xzgrep","bin/xzless","bin/xzmore","bin/yarn","bin/yelp","bin/yes","bin/yum","bin/zathura","bin/zip","bin/zipcloak","bin/zipcmp","bin/zipdetails","bin/zipgrep","bin/zipinfo","bin/zipmerge","bin/zipnote","bin/zipsplit","bin/ziptool","bin/zsh","bin/zsoelim","bin/zstd","bin/zstdcat","bin/zstdgrep","bin/zstdless","bin/zstdmt","bin/zypper"]},operator:"phrase_match"}],transformers:["lowercase"]},{id:"crs-932-171",name:"Remote Command Execution: Shellshock (CVE-2014-6271)",tags:{type:"command_injection",crs_id:"932171",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"}],regex:"^\\(\\s*\\)\\s+{",options:{case_sensitive:!0,min_length:4}},operator:"match_regex"}],transformers:[]},{id:"crs-932-180",name:"Restricted File Upload Attempt",tags:{type:"command_injection",crs_id:"932180",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["x-filename"]},{address:"server.request.headers.no_cookies",key_path:["x_filename"]},{address:"server.request.headers.no_cookies",key_path:["x-file-name"]}],list:[".htaccess",".htdigest",".htpasswd","wp-config.php","config.yml","config_dev.yml","config_prod.yml","config_test.yml","parameters.yml","routing.yml","security.yml","services.yml","default.settings.php","settings.php","settings.local.php","local.xml",".env"]},operator:"phrase_match"}],transformers:["lowercase"]},{id:"crs-933-111",name:"PHP Injection Attack: PHP Script File Upload Found",tags:{type:"unrestricted_file_upload",crs_id:"933111",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["x-filename"]},{address:"server.request.headers.no_cookies",key_path:["x_filename"]},{address:"server.request.headers.no_cookies",key_path:["x.filename"]},{address:"server.request.headers.no_cookies",key_path:["x-file-name"]}],regex:".*\\.(?:php\\d*|phtml)\\..*$",options:{case_sensitive:!0,min_length:5}},operator:"match_regex"}],transformers:["lowercase"]},{id:"crs-933-130",name:"PHP Injection Attack: Global Variables Found",tags:{type:"php_code_injection",crs_id:"933130",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],list:["$globals","$_cookie","$_env","$_files","$_get","$_post","$_request","$_server","$_session","$argc","$argv","$http_\\u200bresponse_\\u200bheader","$php_\\u200berrormsg","$http_cookie_vars","$http_env_vars","$http_get_vars","$http_post_files","$http_post_vars","$http_raw_post_data","$http_request_vars","$http_server_vars"]},operator:"phrase_match"}],transformers:["lowercase"]},{id:"crs-933-131",name:"PHP Injection Attack: HTTP Headers Values Found",tags:{type:"php_code_injection",crs_id:"933131",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"(?:HTTP_(?:ACCEPT(?:_(?:ENCODING|LANGUAGE|CHARSET))?|(?:X_FORWARDED_FO|REFERE)R|(?:USER_AGEN|HOS)T|CONNECTION|KEEP_ALIVE)|PATH_(?:TRANSLATED|INFO)|ORIG_PATH_INFO|QUERY_STRING|REQUEST_URI|AUTH_TYPE)",options:{case_sensitive:!0,min_length:9}},operator:"match_regex"}],transformers:[]},{id:"crs-933-140",name:"PHP Injection Attack: I/O Stream Found",tags:{type:"php_code_injection",crs_id:"933140",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"php://(?:std(?:in|out|err)|(?:in|out)put|fd|memory|temp|filter)",options:{min_length:8}},operator:"match_regex"}],transformers:[]},{id:"crs-933-150",name:"PHP Injection Attack: High-Risk PHP Function Name Found",tags:{type:"php_code_injection",crs_id:"933150",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],list:["__halt_compiler","apache_child_terminate","base64_decode","bzdecompress","call_user_func","call_user_func_array","call_user_method","call_user_method_array","convert_uudecode","file_get_contents","file_put_contents","fsockopen","get_class_methods","get_class_vars","get_defined_constants","get_defined_functions","get_defined_vars","gzdecode","gzinflate","gzuncompress","include_once","invokeargs","pcntl_exec","pcntl_fork","pfsockopen","posix_getcwd","posix_getpwuid","posix_getuid","posix_uname","reflectionfunction","require_once","shell_exec","str_rot13","sys_get_temp_dir","wp_remote_fopen","wp_remote_get","wp_remote_head","wp_remote_post","wp_remote_request","wp_safe_remote_get","wp_safe_remote_head","wp_safe_remote_post","wp_safe_remote_request","zlib_decode"]},operator:"phrase_match"}],transformers:["lowercase"]},{id:"crs-933-160",name:"PHP Injection Attack: High-Risk PHP Function Call Found",tags:{type:"php_code_injection",crs_id:"933160",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:`\\b(?:s(?:e(?:t(?:_(?:e(?:xception|rror)_handler|magic_quotes_runtime|include_path)|defaultstub)|ssion_s(?:et_save_handler|tart))|qlite_(?:(?:(?:unbuffered|single|array)_)?query|create_(?:aggregate|function)|p?open|exec)|tr(?:eam_(?:context_create|socket_client)|ipc?slashes|rev)|implexml_load_(?:string|file)|ocket_c(?:onnect|reate)|h(?:ow_sourc|a1_fil)e|pl_autoload_register|ystem)|p(?:r(?:eg_(?:replace(?:_callback(?:_array)?)?|match(?:_all)?|split)|oc_(?:(?:terminat|clos|nic)e|get_status|open)|int_r)|o(?:six_(?:get(?:(?:e[gu]|g)id|login|pwnam)|mk(?:fifo|nod)|ttyname|kill)|pen)|hp(?:_(?:strip_whitespac|unam)e|version|info)|g_(?:(?:execut|prepar)e|connect|query)|a(?:rse_(?:ini_file|str)|ssthru)|utenv)|r(?:unkit_(?:function_(?:re(?:defin|nam)e|copy|add)|method_(?:re(?:defin|nam)e|copy|add)|constant_(?:redefine|add))|e(?:(?:gister_(?:shutdown|tick)|name)_function|ad(?:(?:gz)?file|_exif_data|dir))|awurl(?:de|en)code)|i(?:mage(?:createfrom(?:(?:jpe|pn)g|x[bp]m|wbmp|gif)|(?:jpe|pn)g|g(?:d2?|if)|2?wbmp|xbm)|s_(?:(?:(?:execut|write?|read)ab|fi)le|dir)|ni_(?:get(?:_all)?|set)|terator_apply|ptcembed)|g(?:et(?:_(?:c(?:urrent_use|fg_va)r|meta_tags)|my(?:[gpu]id|inode)|(?:lastmo|cw)d|imagesize|env)|z(?:(?:(?:defla|wri)t|encod|fil)e|compress|open|read)|lob)|a(?:rray_(?:u(?:intersect(?:_u?assoc)?|diff(?:_u?assoc)?)|intersect_u(?:assoc|key)|diff_u(?:assoc|key)|filter|reduce|map)|ssert(?:_options)?|lert|tob)|h(?:tml(?:specialchars(?:_decode)?|_entity_decode|entities)|(?:ash(?:_(?:update|hmac))?|ighlight)_file|e(?:ader_register_callback|x2bin))|f(?:i(?:le(?:(?:[acm]tim|inod)e|(?:_exist|perm)s|group)?|nfo_open)|tp_(?:nb_(?:ge|pu)|connec|ge|pu)t|(?:unction_exis|pu)ts|write|open)|o(?:b_(?:get_(?:c(?:ontents|lean)|flush)|end_(?:clean|flush)|clean|flush|start)|dbc_(?:result(?:_all)?|exec(?:ute)?|connect)|pendir)|m(?:b_(?:ereg(?:_(?:replace(?:_callback)?|match)|i(?:_replace)?)?|parse_str)|(?:ove_uploaded|d5)_file|ethod_exists|ysql_query|kdir)|e(?:x(?:if_(?:t(?:humbnail|agname)|imagetype|read_data)|ec)|scapeshell(?:arg|cmd)|rror_reporting|val)|c(?:url_(?:file_create|exec|init)|onvert_uuencode|reate_function|hr)|u(?:n(?:serialize|pack)|rl(?:de|en)code|[ak]?sort)|b(?:(?:son_(?:de|en)|ase64_en)code|zopen|toa)|(?:json_(?:de|en)cod|debug_backtrac|tmpfil)e|var_dump)(?:\\s|/\\*.*\\*/|//.*|#.*|\\"|')*\\((?:(?:\\s|/\\*.*\\*/|//.*|#.*)*(?:\\$\\w+|[A-Z\\d]\\w*|\\w+\\(.*\\)|\\\\?"(?:[^"]|\\\\"|""|"\\+")*\\\\?"|\\\\?'(?:[^']|''|'\\+')*\\\\?')(?:\\s|/\\*.*\\*/|//.*|#.*)*(?:(?:::|\\.|->)(?:\\s|/\\*.*\\*/|//.*|#.*)*\\w+(?:\\(.*\\))?)?,)*(?:(?:\\s|/\\*.*\\*/|//.*|#.*)*(?:\\$\\w+|[A-Z\\d]\\w*|\\w+\\(.*\\)|\\\\?"(?:[^"]|\\\\"|""|"\\+")*\\\\?"|\\\\?'(?:[^']|''|'\\+')*\\\\?')(?:\\s|/\\*.*\\*/|//.*|#.*)*(?:(?:::|\\.|->)(?:\\s|/\\*.*\\*/|//.*|#.*)*\\w+(?:\\(.*\\))?)?)?\\)`,options:{case_sensitive:!0,min_length:5}},operator:"match_regex"}],transformers:[]},{id:"crs-933-170",name:"PHP Injection Attack: Serialized Object Injection",tags:{type:"php_code_injection",crs_id:"933170",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies"},{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:'[oOcC]:\\d+:\\".+?\\":\\d+:{[\\W\\w]*}',options:{case_sensitive:!0,min_length:12}},operator:"match_regex"}],transformers:[]},{id:"crs-933-200",name:"PHP Injection Attack: Wrapper scheme detected",tags:{type:"php_code_injection",crs_id:"933200",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"(?:(?:bzip|ssh)2|z(?:lib|ip)|(?:ph|r)ar|expect|glob|ogg)://",options:{case_sensitive:!0,min_length:6}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-934-100",name:"Node.js Injection Attack 1/2",tags:{type:"js_code_injection",crs_id:"934100",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"\\b(?:(?:l(?:(?:utimes|chmod)(?:Sync)?|(?:stat|ink)Sync)|w(?:rite(?:(?:File|v)(?:Sync)?|Sync)|atchFile)|u(?:n(?:watchFile|linkSync)|times(?:Sync)?)|s(?:(?:ymlink|tat)Sync|pawn(?:File|Sync))|ex(?:ec(?:File(?:Sync)?|Sync)|istsSync)|a(?:ppendFile|ccess)(?:Sync)?|(?:Caveat|Inode)s|open(?:dir)?Sync|new\\s+Function|Availability|\\beval)\\s*\\(|m(?:ain(?:Module\\s*(?:\\W*\\s*(?:constructor|require)|\\[)|\\s*(?:\\W*\\s*(?:constructor|require)|\\[))|kd(?:temp(?:Sync)?|irSync)\\s*\\(|odule\\.exports\\s*=)|c(?:(?:(?:h(?:mod|own)|lose)Sync|reate(?:Write|Read)Stream|p(?:Sync)?)\\s*\\(|o(?:nstructor\\s*(?:\\W*\\s*_load|\\[)|pyFile(?:Sync)?\\s*\\())|f(?:(?:(?:s(?:(?:yncS)?|tatS)|datas(?:yncS)?)ync|ch(?:mod|own)(?:Sync)?)\\s*\\(|u(?:nction\\s*\\(\\s*\\)\\s*{|times(?:Sync)?\\s*\\())|r(?:e(?:(?:ad(?:(?:File|link|dir)?Sync|v(?:Sync)?)|nameSync)\\s*\\(|quire\\s*(?:\\W*\\s*main|\\[))|m(?:Sync)?\\s*\\()|process\\s*(?:\\W*\\s*(?:mainModule|binding)|\\[)|t(?:his\\.constructor|runcateSync\\s*\\()|_(?:\\$\\$ND_FUNC\\$\\$_|_js_function)|global\\s*(?:\\W*\\s*process|\\[)|String\\s*\\.\\s*fromCharCode|binding\\s*\\[)",options:{case_sensitive:!0,min_length:3}},operator:"match_regex"}],transformers:[]},{id:"crs-934-101",name:"Node.js Injection Attack 2/2",tags:{type:"js_code_injection",crs_id:"934101",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"\\b(?:w(?:atch|rite)|(?:spaw|ope)n|exists|close|fork|read)\\s*\\(",options:{case_sensitive:!0,min_length:5}},operator:"match_regex"}],transformers:[]},{id:"crs-941-110",name:"XSS Filter - Category 1: Script Tag Vector",tags:{type:"xss",crs_id:"941110",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]},{address:"server.request.headers.no_cookies",key_path:["referer"]},{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"<script[^>]*>[\\s\\S]*?",options:{min_length:8}},operator:"match_regex"}],transformers:["removeNulls","urlDecodeUni"]},{id:"crs-941-120",name:"XSS Filter - Category 2: Event Handler Vector",tags:{type:"xss",crs_id:"941120",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]},{address:"server.request.headers.no_cookies",key_path:["referer"]},{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"[\\s\\\"'`;\\/0-9=\\x0B\\x09\\x0C\\x3B\\x2C\\x28\\x3B]on(?:d(?:r(?:ag(?:en(?:ter|d)|leave|start|over)?|op)|urationchange|blclick)|s(?:e(?:ek(?:ing|ed)|arch|lect)|u(?:spend|bmit)|talled|croll|how)|m(?:ouse(?:(?:lea|mo)ve|o(?:ver|ut)|enter|down|up)|essage)|p(?:a(?:ge(?:hide|show)|(?:st|us)e)|lay(?:ing)?|rogress)|c(?:anplay(?:through)?|o(?:ntextmenu|py)|hange|lick|ut)|a(?:nimation(?:iteration|start|end)|(?:fterprin|bor)t)|t(?:o(?:uch(?:cancel|start|move|end)|ggle)|imeupdate)|f(?:ullscreen(?:change|error)|ocus(?:out|in)?)|(?:(?:volume|hash)chang|o(?:ff|n)lin)e|b(?:efore(?:unload|print)|lur)|load(?:ed(?:meta)?data|start)?|r(?:es(?:ize|et)|atechange)|key(?:press|down|up)|w(?:aiting|heel)|in(?:valid|put)|e(?:nded|rror)|unload)[\\s\\x0B\\x09\\x0C\\x3B\\x2C\\x28\\x3B]*?=[^=]",options:{min_length:8}},operator:"match_regex"}],transformers:["removeNulls","urlDecodeUni"]},{id:"crs-941-140",name:"XSS Filter - Category 4: Javascript URI Vector",tags:{type:"xss",crs_id:"941140",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]},{address:"server.request.headers.no_cookies",key_path:["referer"]},{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"[a-z]+=(?:[^:=]+:.+;)*?[^:=]+:url\\(javascript",options:{min_length:18}},operator:"match_regex"}],transformers:["removeNulls","urlDecodeUni"]},{id:"crs-941-170",name:"NoScript XSS InjectionChecker: Attribute Injection",tags:{type:"xss",crs_id:"941170",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]},{address:"server.request.headers.no_cookies",key_path:["referer"]},{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"}],regex:`(?:\\W|^)(?:javascript:(?:[\\s\\S]+[=\\x5c\\(\\[\\.<]|[\\s\\S]*?(?:\\bname\\b|\\x5c[ux]\\d)))|@\\W*?i\\W*?m\\W*?p\\W*?o\\W*?r\\W*?t\\W*?(?:/\\*[\\s\\S]*?)?(?:[\\"']|\\W*?u\\W*?r\\W*?l[\\s\\S]*?\\()|[^-]*?-\\W*?m\\W*?o\\W*?z\\W*?-\\W*?b\\W*?i\\W*?n\\W*?d\\W*?i\\W*?n\\W*?g[^:]*?:\\W*?u\\W*?r\\W*?l[\\s\\S]*?\\(`,options:{min_length:6}},operator:"match_regex"}],transformers:["removeNulls","urlDecodeUni"]},{id:"crs-941-180",name:"Node-Validator Deny List Keywords",tags:{type:"xss",crs_id:"941180",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],list:["document.cookie","document.write",".parentnode",".innerhtml","window.location","-moz-binding"]},operator:"phrase_match"}],transformers:["removeNulls","lowercase"]},{id:"crs-941-200",name:"IE XSS Filters - Attack Detected via vmlframe tag",tags:{type:"xss",crs_id:"941200",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"(?i:<.*[:]?vmlframe.*?[\\s/+]*?src[\\s/+]*=)",options:{case_sensitive:!0,min_length:13}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-941-210",name:"IE XSS Filters - Obfuscated Attack Detected via javascript injection",tags:{type:"xss",crs_id:"941210",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"(?i:(?:j|&#x?0*(?:74|4A|106|6A);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:a|&#x?0*(?:65|41|97|61);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:v|&#x?0*(?:86|56|118|76);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:a|&#x?0*(?:65|41|97|61);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:s|&#x?0*(?:83|53|115|73);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:c|&#x?0*(?:67|43|99|63);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:r|&#x?0*(?:82|52|114|72);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:i|&#x?0*(?:73|49|105|69);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:p|&#x?0*(?:80|50|112|70);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:t|&#x?0*(?:84|54|116|74);?)(?:\\t|\\n|\\r|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?::|&(?:#x?0*(?:58|3A);?|colon;)).)",options:{case_sensitive:!0,min_length:12}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-941-220",name:"IE XSS Filters - Obfuscated Attack Detected via vbscript injection",tags:{type:"xss",crs_id:"941220",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"(?i:(?:v|&#x?0*(?:86|56|118|76);?)(?:\\t|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:b|&#x?0*(?:66|42|98|62);?)(?:\\t|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:s|&#x?0*(?:83|53|115|73);?)(?:\\t|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:c|&#x?0*(?:67|43|99|63);?)(?:\\t|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:r|&#x?0*(?:82|52|114|72);?)(?:\\t|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:i|&#x?0*(?:73|49|105|69);?)(?:\\t|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:p|&#x?0*(?:80|50|112|70);?)(?:\\t|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?:t|&#x?0*(?:84|54|116|74);?)(?:\\t|&(?:#x?0*(?:9|13|10|A|D);?|tab;|newline;))*(?::|&(?:#x?0*(?:58|3A);?|colon;)).)",options:{case_sensitive:!0,min_length:10}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-941-230",name:"IE XSS Filters - Attack Detected via embed tag",tags:{type:"xss",crs_id:"941230",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"<EMBED[\\s/+].*?(?:src|type).*?=",options:{min_length:11}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-941-240",name:"IE XSS Filters - Attack Detected via import tag",tags:{type:"xss",crs_id:"941240",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"<[?]?import[\\s/+\\S]*?implementation[\\s/+]*?=",options:{case_sensitive:!0,min_length:22}},operator:"match_regex"}],transformers:["lowercase","removeNulls"]},{id:"crs-941-270",name:"IE XSS Filters - Attack Detected via link tag",tags:{type:"xss",crs_id:"941270",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"<LINK[\\s/+].*?href[\\s/+]*=",options:{min_length:11}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-941-280",name:"IE XSS Filters - Attack Detected via base tag",tags:{type:"xss",crs_id:"941280",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"<BASE[\\s/+].*?href[\\s/+]*=",options:{min_length:11}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-941-290",name:"IE XSS Filters - Attack Detected via applet tag",tags:{type:"xss",crs_id:"941290",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"<APPLET[\\s/+>]",options:{min_length:8}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-941-300",name:"IE XSS Filters - Attack Detected via object tag",tags:{type:"xss",crs_id:"941300",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"<OBJECT[\\s/+].*?(?:type|codetype|classid|code|data)[\\s/+]*=",options:{min_length:13}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"crs-941-350",name:"UTF-7 Encoding IE XSS - Attack Detected",tags:{type:"xss",crs_id:"941350",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"\\+ADw-.*(?:\\+AD4-|>)|<.*\\+AD4-",options:{case_sensitive:!0,min_length:6}},operator:"match_regex"}],transformers:[]},{id:"crs-941-360",name:"JSFuck / Hieroglyphy obfuscation detected",tags:{type:"xss",crs_id:"941360",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"![!+ ]\\[\\]",options:{case_sensitive:!0,min_length:4}},operator:"match_regex"}],transformers:[]},{id:"crs-941-390",name:"Javascript method detected",tags:{type:"xss",crs_id:"941390",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"\\b(?i:eval|settimeout|setinterval|new\\s+Function|alert|prompt)[\\s+]*\\([^\\)]",options:{case_sensitive:!0,min_length:5}},operator:"match_regex"}],transformers:[]},{id:"crs-942-100",name:"SQL Injection Attack Detected via libinjection",tags:{type:"sql_injection",crs_id:"942100",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}]},operator:"is_sqli"}],transformers:["removeNulls"]},{id:"crs-942-160",name:"Detects blind sqli tests using sleep() or benchmark()",tags:{type:"sql_injection",crs_id:"942160",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"(?i:sleep\\(\\s*?\\d*?\\s*?\\)|benchmark\\(.*?\\,.*?\\))",options:{case_sensitive:!0,min_length:7}},operator:"match_regex"}],transformers:[]},{id:"crs-942-240",name:"Detects MySQL charset switch and MSSQL DoS attempts",tags:{type:"sql_injection",crs_id:"942240",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"(?:[\\\"'`](?:;*?\\s*?waitfor\\s+(?:delay|time)\\s+[\\\"'`]|;.*?:\\s*?goto)|alter\\s*?\\w+.*?cha(?:racte)?r\\s+set\\s+\\w+)",options:{min_length:7}},operator:"match_regex"}],transformers:[]},{id:"crs-942-250",name:"Detects MATCH AGAINST, MERGE and EXECUTE IMMEDIATE injections",tags:{type:"sql_injection",crs_id:"942250",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"(?i:merge.*?using\\s*?\\(|execute\\s*?immediate\\s*?[\\\"'`]|match\\s*?[\\w(?:),+-]+\\s*?against\\s*?\\()",options:{case_sensitive:!0,min_length:11}},operator:"match_regex"}],transformers:[]},{id:"crs-942-270",name:"Basic SQL injection",tags:{type:"sql_injection",crs_id:"942270",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"union.*?select.*?from",options:{min_length:15}},operator:"match_regex"}],transformers:[]},{id:"crs-942-280",name:"SQL Injection with delay functions",tags:{type:"sql_injection",crs_id:"942280",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"(?:;\\s*?shutdown\\s*?(?:[#;{]|\\/\\*|--)|waitfor\\s*?delay\\s?[\\\"'`]+\\s?\\d|select\\s*?pg_sleep)",options:{min_length:10}},operator:"match_regex"}],transformers:[]},{id:"crs-942-290",name:"Finds basic MongoDB SQL injection attempts",tags:{type:"nosql_injection",crs_id:"942290",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"(?i:(?:\\[?\\$(?:(?:s(?:lic|iz)|wher)e|e(?:lemMatch|xists|q)|n(?:o[rt]|in?|e)|l(?:ike|te?)|t(?:ext|ype)|a(?:ll|nd)|jsonSchema|between|regex|x?or|div|mod)\\]?)\\b)",options:{case_sensitive:!0,min_length:3}},operator:"match_regex"}],transformers:["keys_only"]},{id:"crs-942-360",name:"Detects concatenated basic SQL injection and SQLLFI attempts",tags:{type:"sql_injection",crs_id:"942360",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"(?:^[\\W\\d]+\\s*?(?:alter\\s*(?:a(?:(?:pplication\\s*rol|ggregat)e|s(?:ymmetric\\s*ke|sembl)y|u(?:thorization|dit)|vailability\\s*group)|c(?:r(?:yptographic\\s*provider|edential)|o(?:l(?:latio|um)|nversio)n|ertificate|luster)|s(?:e(?:rv(?:ice|er)|curity|quence|ssion|arch)|y(?:mmetric\\s*key|nonym)|togroup|chema)|m(?:a(?:s(?:ter\\s*key|k)|terialized)|e(?:ssage\\s*type|thod)|odule)|l(?:o(?:g(?:file\\s*group|in)|ckdown)|a(?:ngua|r)ge|ibrary)|t(?:(?:abl(?:espac)?|yp)e|r(?:igger|usted)|hreshold|ext)|p(?:a(?:rtition|ckage)|ro(?:cedur|fil)e|ermission)|d(?:i(?:mension|skgroup)|atabase|efault|omain)|r(?:o(?:l(?:lback|e)|ute)|e(?:sourc|mot)e)|f(?:u(?:lltext|nction)|lashback|oreign)|e(?:xte(?:nsion|rnal)|(?:ndpoi|ve)nt)|in(?:dex(?:type)?|memory|stance)|b(?:roker\\s*priority|ufferpool)|x(?:ml\\s*schema|srobject)|w(?:ork(?:load)?|rapper)|hi(?:erarchy|stogram)|o(?:perator|utline)|(?:nicknam|queu)e|us(?:age|er)|group|java|view)|union\\s*(?:(?:distin|sele)ct|all))\\b|\\b(?:(?:(?:trunc|cre|upd)at|renam)e|(?:inser|selec)t|de(?:lete|sc)|alter|load)\\s+(?:group_concat|load_file|char)\\b\\s*\\(?|[\\s(]load_file\\s*?\\(|[\\\"'`]\\s+regexp\\W)",options:{min_length:5}},operator:"match_regex"}],transformers:[]},{id:"crs-942-500",name:"MySQL in-line comment detected",tags:{type:"sql_injection",crs_id:"942500",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"(?i:/\\*[!+](?:[\\w\\s=_\\-(?:)]+)?\\*/)",options:{case_sensitive:!0,min_length:5}},operator:"match_regex"}],transformers:[]},{id:"crs-943-100",name:"Possible Session Fixation Attack: Setting Cookie Values in HTML",tags:{type:"http_protocol_violation",crs_id:"943100",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"}],regex:"(?i:\\.cookie\\b.*?;\\W*?(?:expires|domain)\\W*?=|\\bhttp-equiv\\W+set-cookie\\b)",options:{case_sensitive:!0,min_length:15}},operator:"match_regex"}],transformers:[]},{id:"crs-944-100",name:"Remote Command Execution: Suspicious Java class detected",tags:{type:"java_code_injection",crs_id:"944100",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"}],regex:"java\\.lang\\.(?:runtime|processbuilder)",options:{case_sensitive:!0,min_length:17}},operator:"match_regex"}],transformers:["lowercase"]},{id:"crs-944-110",name:"Remote Command Execution: Java process spawn (CVE-2017-9805)",tags:{type:"java_code_injection",crs_id:"944110",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"}],regex:"(?:runtime|processbuilder)",options:{case_sensitive:!0,min_length:7}},operator:"match_regex"},{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"}],regex:"(?:unmarshaller|base64data|java\\.)",options:{case_sensitive:!0,min_length:5}},operator:"match_regex"}],transformers:["lowercase"]},{id:"crs-944-130",name:"Suspicious Java class detected",tags:{type:"java_code_injection",crs_id:"944130",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"}],list:["com.opensymphony.xwork2","com.sun.org.apache","java.io.bufferedinputstream","java.io.bufferedreader","java.io.bytearrayinputstream","java.io.bytearrayoutputstream","java.io.chararrayreader","java.io.datainputstream","java.io.file","java.io.fileoutputstream","java.io.filepermission","java.io.filewriter","java.io.filterinputstream","java.io.filteroutputstream","java.io.filterreader","java.io.inputstream","java.io.inputstreamreader","java.io.linenumberreader","java.io.objectoutputstream","java.io.outputstream","java.io.pipedoutputstream","java.io.pipedreader","java.io.printstream","java.io.pushbackinputstream","java.io.reader","java.io.stringreader","java.lang.class","java.lang.integer","java.lang.number","java.lang.object","java.lang.process","java.lang.reflect","java.lang.string","java.lang.stringbuilder","java.lang.system","javax.script.scriptenginemanager","org.apache.commons","org.apache.struts","org.apache.struts2","org.omg.corba","java.beans.xmldecode"]},operator:"phrase_match"}],transformers:["lowercase"]},{id:"crs-944-260",name:"Remote Command Execution: Malicious class-loading payload",tags:{type:"java_code_injection",crs_id:"944260",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"}],regex:"(?:class\\.module\\.classLoader\\.resources\\.context\\.parent\\.pipeline|springframework\\.context\\.support\\.FileSystemXmlApplicationContext)",options:{case_sensitive:!0,min_length:58}},operator:"match_regex"}],transformers:[]},{id:"dog-000-001",name:"Look for Cassandra injections",tags:{type:"nosql_injection",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"}],regex:"\\ballow\\s+filtering\\b"},operator:"match_regex"}],transformers:["removeComments"]},{id:"dog-000-002",name:"OGNL - Look for formatting injection patterns",tags:{type:"java_code_injection",category:"attack_attempt"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"},{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"[#%$]{(?:[^}]+[^\\w\\s}\\-_][^}]+|\\d+-\\d+)}",options:{case_sensitive:!0}}}],transformers:[]},{id:"dog-000-003",name:"OGNL - Detect OGNL exploitation primitives",tags:{type:"java_code_injection",category:"attack_attempt",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"}],regex:"[@#]ognl",options:{case_sensitive:!0}}}],transformers:[]},{id:"dog-000-004",name:"Spring4Shell - Attempts to exploit the Spring4shell vulnerability",tags:{type:"exploit_detection",category:"attack_attempt",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.request.body"}],regex:"^class\\.module\\.classLoader\\.",options:{case_sensitive:!1}}}],transformers:["keys_only"]},{id:"dog-000-005",name:"Node.js: Prototype pollution through __proto__",tags:{type:"js_code_injection",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"}],regex:"^__proto__$"},operator:"match_regex"}],transformers:["keys_only"]},{id:"dog-000-006",name:"Node.js: Prototype pollution through constructor.prototype",tags:{type:"js_code_injection",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"}],regex:"^constructor$"},operator:"match_regex"},{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"}],regex:"^prototype$"},operator:"match_regex"}],transformers:["keys_only"]},{id:"dog-000-007",name:"Server side template injection: Velocity & Freemarker",tags:{type:"java_code_injection",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"}],regex:"#(?:set|foreach|macro|parse|if)\\(.*\\)|<#assign.*>"},operator:"match_regex"}],transformers:[]},{id:"dog-931-001",name:"RFI: URL Payload to well known RFI target",tags:{type:"rfi",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"}],regex:"^(?i:file|ftps?|https?).*/rfiinc\\.txt\\?+$",options:{case_sensitive:!0,min_length:17}},operator:"match_regex"}],transformers:[]},{id:"dog-934-001",name:"XXE - XML file loads external entity",tags:{type:"xxe",category:"attack_attempt",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.body"},{address:"grpc.server.request.message"}],regex:"(?:<\\?xml[^>]*>.*)<!ENTITY[^>]+SYSTEM\\s+[^>]+>",options:{case_sensitive:!1,min_length:24}},operator:"match_regex"}],transformers:[]},{id:"dog-942-001",name:"Blind XSS callback domains",tags:{type:"xss",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"}],regex:"https?:\\/\\/(?:.*\\.)?(?:bxss\\.in|xss\\.ht|js\\.rip)",options:{case_sensitive:!1}},operator:"match_regex"}],transformers:[]},{id:"nfd-000-001",name:"Detect common directory discovery scans",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"phrase_match",parameters:{inputs:[{address:"server.request.uri.raw"}],list:["/wordpress/","/etc/","/login.php","/install.php","/administrator","/admin.php","/wp-config","/phpmyadmin","/fckeditor","/mysql","/manager/html",".htaccess","/config.php","/configuration","/cgi-bin/php","/search.php","/tinymce","/tiny_mce","/settings.php","../../..","/install/","/download.php","/webdav","/forum.php","/user.php","/style.php","/jmx-console","/modules.php","/include.php","/default.asp","/help.php","/database.yml","/database.yml.pgsql","/database.yml.sqlite3","/database.yml.sqlite","/database.yml.mysql",".%2e/","/view.php","/header.php","/search.asp","%5c%5c","/server/php/","/invoker/jmxinvokerservlet","/phpmyadmin/index.php","/data/admin/allowurl.txt","/verify.php","/misc/ajax.js","/.idea","/module.php","/backup.rar","/backup.tar","/backup.zip","/backup.7z","/backup.gz","/backup.tgz","/backup.tar.gz","waitfor%20delay","/calendar.php","/news.php","/dompdf.php","))))))))))))))))","/web.config","tree.php","/cgi-bin-sdb/printenv","/comments.php","/detail.asp","/license.txt","/admin.asp","/auth.php","/list.php","/content.php","/mod.php","/mini.php","/install.pgsql","/install.mysql","/install.sqlite","/install.sqlite3","/install.txt","/install.md","/doku.php","/main.asp","/myadmin","/force-download.php","/iisprotect/admin","/.gitignore","/print.php","/common.php","/mainfile.php","/functions.php","/scripts/setup.php","/faq.php","/op/op.login.php","/home.php","/includes/hnmain.inc.php3","/preview.php","/dump.rar","/dump.tar","/dump.zip","/dump.7z","/dump.gz","/dump.tgz","/dump.tar.gz","/thumbnail.php","/sendcard.php","/global.asax","/directory.php","/footer.php","/error.asp","/forum.asp","/save.php","/htmlsax3.php","/adm/krgourl.php","/includes/converter.inc.php","/nucleus/libs/pluginadmin.php","/base_qry_common.php","/fileadmin","/bitrix/admin/","/adm.php","/util/barcode.php","/action.php","/rss.asp","/downloads.php","/page.php","/snarf_ajax.php","/fck/editor","/sendmail.php","/detail.php","/iframe.php","/swfupload.swf","/jenkins/login","/phpmyadmin/main.php","/phpmyadmin/scripts/setup.php","/user/index.php","/checkout.php","/process.php","/ks_inc/ajax.js","/export.php","/register.php","/cart.php","/console.php","/friend.php","/readmsg.php","/install.asp","/dagent/downloadreport.asp","/system/index.php","/core/changelog.txt","/js/util.js","/interna.php","/gallery.php","/links.php","/data/admin/ver.txt","/language/zh-cn.xml","/productdetails.asp","/admin/template/article_more/config.htm","/components/com_moofaq/includes/file_includer.php","/licence.txt","/rss.xsl","/vtigerservice.php","/mysql/main.php","/passwiki.php","/scr/soustab.php","/global.php","/email.php","/user.asp","/msd","/products.php","/cultbooking.php","/cron.php","/static/js/admincp.js","/comment.php","/maintainers","/modules/plain/adminpart/addplain.php","/wp-content/plugins/ungallery/source_vuln.php","/upgrade.txt","/category.php","/index_logged.php","/members.asp","/script/html.js","/images/ad.js","/awstats/awstats.pl","/includes/esqueletos/skel_null.php","/modules/profile/user.php","/window_top.php","/openbrowser.php","/thread.php","tinfoil_xss","/includes/include.php","/urheber.php","/header.inc.php","/mysqldumper","/display.php","/website.php","/stats.php","/assets/plugins/mp3_id/mp3_id.php","/siteminderagent/forms/smpwservices.fcc"]}}],transformers:["lowercase"]},{id:"nfd-000-002",name:"Detect failed attempt to fetch readme files",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"readme\\.[\\.a-z0-9]+$",options:{case_sensitive:!1}}}],transformers:[]},{id:"nfd-000-003",name:"Detect failed attempt to fetch Java EE resource files",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"^(?:.*web\\-inf)(?:.*web\\.xml).*$",options:{case_sensitive:!1}}}],transformers:[]},{id:"nfd-000-004",name:"Detect failed attempt to fetch code files",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"\\.(java|pyc?|rb|class)\\b",options:{case_sensitive:!1}}}],transformers:[]},{id:"nfd-000-005",name:"Detect failed attempt to fetch source code archives",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"\\.(sql|log|ndb|gz|zip|tar\\.gz|tar|regVV|reg|conf|bz2|ini|db|war|bat|inc|btr|server|ds|conf|config|admin|master|sln|bak)\\b(?:[^.]|$)",options:{case_sensitive:!1}}}],transformers:[]},{id:"nfd-000-006",name:"Detect failed attempt to fetch sensitive files",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"\\.(cgi|bat|dll|exe|key|cert|crt|pem|der|pkcs|pkcs|pkcs[0-9]*|nsf|jsa|war|java|class|vb|vba|so|git|svn|hg|cvs)([^a-zA-Z0-9_]|$)",options:{case_sensitive:!1}}}],transformers:[]},{id:"nfd-000-007",name:"Detect failed attempt to fetch archives",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"/[\\d\\-_]*\\.(rar|tar|zip|7z|gz|tgz|tar.gz)",options:{case_sensitive:!1}}}],transformers:[]},{id:"nfd-000-008",name:"Detect failed attempt to trigger incorrect application behavior",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"(/(administrator/components/com.*\\.php|response\\.write\\(.+\\))|select\\(.+\\)from|\\(.*sleep\\(.+\\)|(%[a-zA-Z0-9]{2}[a-zA-Z]{0,1})+\\))",options:{case_sensitive:!1}}}],transformers:[]},{id:"nfd-000-009",name:"Detect failed attempt to leak the structure of the application",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{operator:"match_regex",parameters:{inputs:[{address:"server.response.status"}],regex:"^404$",options:{case_sensitive:!0}}},{operator:"match_regex",parameters:{inputs:[{address:"server.request.uri.raw"}],regex:"/(login\\.rol|LICENSE|[\\w-]+\\.(plx|pwd))$",options:{case_sensitive:!1}}}],transformers:[]},{id:"sqr-000-001",name:"SSRF: Try to access the credential manager of the main cloud services",tags:{type:"ssrf",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"(?i)^\\W*((http|ftp)s?://)?\\W*((::f{4}:)?(169|(0x)?0*a9|0+251)\\.?(254|(0x)?0*fe|0+376)[0-9a-fx\\.:]+|metadata\\.google\\.internal|metadata\\.goog)\\W*/",options:{min_length:4}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"sqr-000-002",name:"Server-side Javascript injection: Try to detect obvious JS injection",tags:{type:"js_code_injection",category:"attack_attempt"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:`require\\(['"][\\w\\.]+['"]\\)|process\\.\\w+\\([\\w\\.]*\\)|\\.toString\\(\\)`,options:{min_length:4}},operator:"match_regex"}],transformers:["removeNulls"]},{id:"sqr-000-008",name:"Windows: Detect attempts to exfiltrate .ini files",tags:{type:"command_injection",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"}],regex:"(?i)[&|]\\s*type\\s+%\\w+%\\\\+\\w+\\.ini\\s*[&|]"},operator:"match_regex"}],transformers:[]},{id:"sqr-000-009",name:"Linux: Detect attempts to exfiltrate passwd files",tags:{type:"command_injection",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"}],regex:"(?i)[&|]\\s*cat\\s+\\/etc\\/[\\w\\.\\/]*passwd\\s*[&|]"},operator:"match_regex"}],transformers:[]},{id:"sqr-000-010",name:"Windows: Detect attempts to timeout a shell",tags:{type:"command_injection",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"}],regex:"(?i)[&|]\\s*timeout\\s+/t\\s+\\d+\\s*[&|]"},operator:"match_regex"}],transformers:[]},{id:"sqr-000-011",name:"SSRF: Try to access internal OMI service (CVE-2021-38647)",tags:{type:"ssrf",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"http(s?):\\/\\/([A-Za-z0-9\\.\\-\\_]+|\\[[A-Fa-f0-9\\:]+\\]|):5986\\/wsman",options:{min_length:4}},operator:"match_regex"}],transformers:[]},{id:"sqr-000-012",name:"SSRF: Detect SSRF attempt on internal service",tags:{type:"ssrf",category:"attack_attempt",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"^(jar:)?(http|https):\\/\\/([0-9oq]{1,5}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}|[0-9]{1,10})(:[0-9]{1,5})?(\\/[^:@]*)?$"},operator:"match_regex"}],transformers:["lowercase"]},{id:"sqr-000-013",name:"SSRF: Detect SSRF attempts using IPv6 or octal/hexdecimal obfuscation",tags:{type:"ssrf",category:"attack_attempt",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"grpc.server.request.message"}],regex:"^(jar:)?(http|https):\\/\\/((\\[)?[:0-9a-f\\.x]{2,}(\\])?)(:[0-9]{1,5})?(\\/[^:@]*)?$"},operator:"match_regex"}],transformers:["lowercase"]},{id:"sqr-000-014",name:"SSRF: Detect SSRF domain redirection bypass",tags:{type:"ssrf",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"}],regex:"(http|https):\\/\\/(?:.*\\.)?(?:burpcollaborator\\.net|localtest\\.me|mail\\.ebc\\.apple\\.com|bugbounty\\.dod\\.network|.*\\.[nx]ip\\.io|oastify\\.com|oast\\.(?:pro|live|site|online|fun|me)|sslip\\.io|requestbin\\.com|requestbin\\.net|hookbin\\.com|webhook\\.site|canarytokens\\.com|interact\\.sh|ngrok\\.io|bugbounty\\.click|prbly\\.win|qualysperiscope\\.com|vii.one|act1on3.ru)"},operator:"match_regex"}],transformers:[]},{id:"sqr-000-015",name:"SSRF: Detect SSRF attempt using non HTTP protocol",tags:{type:"ssrf",category:"attack_attempt",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"}],regex:"^(jar:)?((file|netdoc):\\/\\/[\\\\\\/]+|(dict|gopher|ldap|sftp|tftp):\\/\\/.*:[0-9]{1,5})"},operator:"match_regex"}],transformers:["lowercase"]},{id:"sqr-000-017",name:"Log4shell: Attempt to exploit log4j CVE-2021-44228",tags:{type:"exploit_detection",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.uri.raw"},{address:"server.request.query"},{address:"server.request.body"},{address:"server.request.path_params"},{address:"server.request.headers.no_cookies"},{address:"grpc.server.request.message"}],regex:"\\${[^j]*j[^n]*n[^d]*d[^i]*i[^:]*:[^}]*}"},operator:"match_regex"}],transformers:["unicode_normalize"]},{id:"ua0-600-0xx",name:"Joomla exploitation tool",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"JDatabaseDriverMysqli"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-10x",name:"Nessus",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)^Nessus(/|([ :]+SOAP))"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-12x",name:"Arachni",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"^Arachni\\/v"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-13x",name:"Jorgee",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bJorgee\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-14x",name:"Probely",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bProbely\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-15x",name:"Metis",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bmetis\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-16x",name:"SQL power injector",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"sql power injector"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-18x",name:"N-Stealth",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bn-stealth\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-19x",name:"Brutus",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bbrutus\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-1xx",name:"Shellshock exploitation tool",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"\\(\\) \\{ :; *\\}"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-20x",name:"Netsparker",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)(<script>netsparker\\(0x0|ns:netsparker.*=vuln)"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-22x",name:"JAASCois",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bjaascois\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-23x",name:"PMAFind",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bpmafind\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-25x",name:"Webtrends",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"webtrends security analyzer"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-26x",name:"Nsauditor",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bnsauditor\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-27x",name:"Paros",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)Mozilla/.* Paros/"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-28x",name:"DirBuster",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bdirbuster\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-29x",name:"Pangolin",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bpangolin\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-2xx",name:"Qualys",tags:{type:"security_scanner",category:"attack_attempt",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bqualys\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-30x",name:"SQLNinja",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bsqlninja\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-31x",name:"Nikto",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"\\(Nikto/[\\d\\.]+\\)"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-32x",name:"WebInspect",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bwebinspect\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-33x",name:"BlackWidow",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bblack\\s?widow\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-34x",name:"Grendel-Scan",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bgrendel-scan\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-35x",name:"Havij",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bhavij\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-36x",name:"w3af",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bw3af\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-37x",name:"Nmap",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"nmap (nse|scripting engine)"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-39x",name:"Nessus Scripted",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)^'?[a-z0-9]+\\.nasl'?$"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-3xx",name:"Evil Scanner",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bevilScanner\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-40x",name:"WebFuck",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bWebFuck\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-42x",name:"OpenVAS",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)OpenVAS\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-43x",name:"Spider-Pig",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"Powered by Spider-Pig by tinfoilsecurity\\.com"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-44x",name:"Zgrab",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"Mozilla/\\d+.\\d+ zgrab"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-45x",name:"Zmeu",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bZmEu\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-46x",name:"Crowdstrike",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bcrowdstrike\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-47x",name:"GoogleSecurityScanner",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bGoogleSecurityScanner\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-48x",name:"Commix",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"^commix\\/"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-49x",name:"Gobuster",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"^gobuster\\/"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-4xx",name:"CGIchk",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bcgichk\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-51x",name:"FFUF",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)^Fuzz Faster U Fool\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-52x",name:"Nuclei",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)^Nuclei\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-53x",name:"Tsunami",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bTsunamiSecurityScanner\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-54x",name:"Nimbostratus",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bnimbostratus-bot\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-55x",name:"Datadog test scanner: user-agent",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]},{address:"grpc.server.request.metadata",key_path:["dd-canary"]}],regex:"^dd-test-scanner-log$"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-56x",name:"Datadog test scanner - blocking version: user-agent",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]},{address:"grpc.server.request.metadata",key_path:["dd-canary"]}],regex:"^dd-test-scanner-log-block$"},operator:"match_regex"}],transformers:[],on_match:["block"]},{id:"ua0-600-57x",name:"AlertLogic",tags:{type:"security_scanner",category:"attack_attempt",confidence:"0"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"\\bAlertLogic-MDR-"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-5xx",name:"Blind SQL Injection Brute Forcer",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)\\bbsqlbf\\b"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-6xx",name:"Suspicious user agent",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"mozilla/4\\.0 \\(compatible(; msie 6\\.0; win32)?\\)"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-7xx",name:"SQLmap",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"^sqlmap/"},operator:"match_regex"}],transformers:[]},{id:"ua0-600-9xx",name:"Skipfish",tags:{type:"security_scanner",category:"attack_attempt",confidence:"1"},conditions:[{parameters:{inputs:[{address:"server.request.headers.no_cookies",key_path:["user-agent"]}],regex:"(?i)mozilla/5\\.0 sf/"},operator:"match_regex"}],transformers:[]}]}});var Wy=p((uZ,zy)=>{"use strict";var Fy=require("fs"),yU=require("os"),Bc=require("url").URL,os=E(),By=Sa(),y=require("koalas"),is=ta(),{isTrue:O,isFalse:Hc}=te(),vU=require("crypto-randomuuid"),SU=Object.fromEntries||(t=>t.reduce((e,[r,s])=>Object.assign(e,{[r]:s}),{})),qU='(?:p(?:ass)?w(?:or)?d|pass(?:_?phrase)?|secret|(?:api_?|private_?|public_?|access_?|secret_?)key(?:_?id)?|token|consumer_?(?:id|key|secret)|sign(?:ed|ature)?|auth(?:entication|orization)?)(?:(?:\\s|%20)*(?:=|%3D)[^&]+|(?:"|%22)(?:\\s|%20)*(?::|%3A)(?:\\s|%20)*(?:"|%22)(?:%2[^2]|%[^2]|[^"%])+(?:"|%22))|bearer(?:\\s|%20)+[a-z0-9\\._\\-]+|token(?::|%3A)[a-z0-9]{13}|gh[opsu]_[0-9a-zA-Z]{36}|ey[I-L](?:[\\w=-]|%3D)+\\.ey[I-L](?:[\\w=-]|%3D)+(?:\\.(?:[\\w.+\\/=-]|%3D|%2F|%2B)+)?|[\\-]{5}BEGIN(?:[a-z\\s]|%20)+PRIVATE(?:\\s|%20)KEY[\\-]{5}[^\\-]+[\\-]{5}END(?:[a-z\\s]|%20)+PRIVATE(?:\\s|%20)KEY|ssh-rsa(?:\\s|%20)*(?:[a-z0-9\\/\\.+]|%2F|%5C|%2B){100,}';function sr(t){if(t)try{return Fy.readFileSync(t,"utf8")}catch(e){os.error(e);return}}function Kn(t){try{return JSON.parse(t)}catch{return}}function $y(t,e){if(!t)return;let r={};for(let[s,n]of Object.entries(t))r[s in e?e[s]:s]=n;return r}function Gy(t,e,r){if(typeof e=="object"&&!Array.isArray(e)&&(e=e[t]),Array.isArray(e))return e.map(i=>i.toLowerCase());typeof e<"u"&&os.warn("Unexpected input for config.tracePropagationStyle");let s=`DD_TRACE_PROPAGATION_STYLE_${t.toUpperCase()}`,n=y(process.env[s],process.env.DD_TRACE_PROPAGATION_STYLE);return typeof n<"u"?n.split(",").filter(i=>i!=="").map(i=>i.trim().toLowerCase()):r}var $c=class{constructor(e){e=e||{},this.debug=O(y(process.env.DD_TRACE_DEBUG,!1)),this.logger=e.logger,this.logLevel=y(e.logLevel,process.env.DD_TRACE_LOG_LEVEL,"debug"),os.use(this.logger),os.toggle(this.debug,this.logLevel,this),this.tags={},is.add(this.tags,process.env.DD_TAGS),is.add(this.tags,process.env.DD_TRACE_TAGS),is.add(this.tags,process.env.DD_TRACE_GLOBAL_TAGS),is.add(this.tags,e.tags);let r=y(process.env.DD_TRACING_ENABLED,!0),s=y(e.profiling,process.env.DD_EXPERIMENTAL_PROFILING_ENABLED,process.env.DD_PROFILING_ENABLED,!1),n=y(process.env.DD_PROFILING_EXPORTERS,"agent"),i=process.env.DD_PROFILING_SOURCE_MAP,o=y(e.logInjection,process.env.DD_LOGS_INJECTION,!1),a=y(e.runtimeMetrics,process.env.DD_RUNTIME_METRICS_ENABLED,!1),c=y(e.dbmPropagationMode,process.env.DD_DBM_PROPAGATION_MODE,"disabled"),u=y(e.hostname,process.env.DD_AGENT_HOST,process.env.DD_TRACE_AGENT_HOSTNAME,"127.0.0.1"),l=y(e.port,process.env.DD_TRACE_AGENT_PORT,"8126"),d=y(e.url,process.env.DD_TRACE_AGENT_URL,process.env.DD_TRACE_URL,null),h=y(e.isCiVisibility,!1),f=process.env.DD_CIVISIBILITY_AGENTLESS_URL,g=y(process.env.DD_CIVISIBILITY_ITR_ENABLED,!0),v=e.service||process.env.DD_SERVICE||process.env.DD_SERVICE_NAME||this.tags.service||process.env.AWS_LAMBDA_FUNCTION_NAME||By.name||"node",q=y(e.serviceMapping,process.env.DD_SERVICE_MAPPING?SU(process.env.DD_SERVICE_MAPPING.split(",").map(Hr=>Hr.trim().split(":"))):{}),_=y(e.env,process.env.DD_ENV,this.tags.env),S=y(e.version,process.env.DD_VERSION,this.tags.version,By.version),T=y(e.startupLogs,process.env.DD_TRACE_STARTUP_LOGS,!1),x=y(process.env.DD_TRACE_TELEMETRY_ENABLED,!process.env.AWS_LAMBDA_FUNCTION_NAME),R=y(process.env.DD_TELEMETRY_DEBUG_ENABLED,!1),ue=y(e.protocolVersion,process.env.DD_TRACE_AGENT_PROTOCOL_VERSION,"0.4"),z=y(parseInt(e.flushMinSpans),parseInt(process.env.DD_TRACE_PARTIAL_FLUSH_MIN_SPANS),1e3),Me=y(process.env.DD_TRACE_OBFUSCATION_QUERY_STRING_REGEXP,qU),Le=y(e.clientIpEnabled,process.env.DD_TRACE_CLIENT_IP_ENABLED&&O(process.env.DD_TRACE_CLIENT_IP_ENABLED),!1),pe=y(e.clientIpHeader,process.env.DD_TRACE_CLIENT_IP_HEADER,null),wo=y(e.experimental&&e.experimental.b3,process.env.DD_TRACE_EXPERIMENTAL_B3_ENABLED,!1),Jt=["tracecontext","datadog"];O(wo)&&(Jt.push("b3"),Jt.push("b3 single header")),process.env.DD_TRACE_PROPAGATION_STYLE&&(process.env.DD_TRACE_PROPAGATION_STYLE_INJECT||process.env.DD_TRACE_PROPAGATION_STYLE_EXTRACT)&&os.warn("Use either the DD_TRACE_PROPAGATION_STYLE environment variable or separate DD_TRACE_PROPAGATION_STYLE_INJECT and DD_TRACE_PROPAGATION_STYLE_EXTRACT environment variables");let xo=Gy("inject",e.tracePropagationStyle,Jt),Io=Gy("extract",e.tracePropagationStyle,Jt),Ao=y(e.experimental&&e.experimental.runtimeId,process.env.DD_TRACE_EXPERIMENTAL_RUNTIME_ID_ENABLED,!1),on=y(e.experimental&&e.experimental.exporter,process.env.DD_TRACE_EXPERIMENTAL_EXPORTER),an=y(e.experimental&&e.experimental.enableGetRumData,process.env.DD_TRACE_EXPERIMENTAL_GET_RUM_DATA_ENABLED,!1),ko=y(process.env.DD_TRACE_X_DATADOG_TAGS_MAX_LENGTH,"512"),Ro=y(e.stats,process.env.DD_TRACE_STATS_COMPUTATION_ENABLED,!1),Co=y(e.traceId128BitGenerationEnabled,process.env.DD_TRACE_128_BIT_TRACEID_GENERATION_ENABLED,!1),Oo=y(e.traceId128BitLoggingEnabled,process.env.DD_TRACE_128_BIT_TRACEID_LOGGING_ENABLED,!1),U=e.appsec!=null?e.appsec:e.experimental&&e.experimental.appsec;typeof U=="boolean"?U={enabled:U}:U==null&&(U={});let eP=y(U.enabled,process.env.DD_APPSEC_ENABLED&&O(process.env.DD_APPSEC_ENABLED)),Po=y(U.rules,process.env.DD_APPSEC_RULES),tP=y(parseInt(U.rateLimit),parseInt(process.env.DD_APPSEC_TRACE_RATE_LIMIT),100),rP=y(parseInt(U.wafTimeout),parseInt(process.env.DD_APPSEC_WAF_TIMEOUT),5e3),sP=y(U.obfuscatorKeyRegex,process.env.DD_APPSEC_OBFUSCATION_PARAMETER_KEY_REGEXP,"(?i)(?:p(?:ass)?w(?:or)?d|pass(?:_?phrase)?|secret|(?:api_?|private_?|public_?)key)|token|consumer_?(?:id|key|secret)|sign(?:ed|ature)|bearer|authorization"),nP=y(U.obfuscatorValueRegex,process.env.DD_APPSEC_OBFUSCATION_PARAMETER_VALUE_REGEXP,'(?i)(?:p(?:ass)?w(?:or)?d|pass(?:_?phrase)?|secret|(?:api_?|private_?|public_?|access_?|secret_?)key(?:_?id)?|token|consumer_?(?:id|key|secret)|sign(?:ed|ature)?|auth(?:entication|orization)?)(?:\\s*=[^;]|"\\s*:\\s*"[^"]+")|bearer\\s+[a-z0-9\\._\\-]+|token:[a-z0-9]{13}|gh[opsu]_[0-9a-zA-Z]{36}|ey[I-L][\\w=-]+\\.ey[I-L][\\w=-]+(?:\\.[\\w.+\\/=-]+)?|[\\-]{5}BEGIN[a-z\\s]+PRIVATE\\sKEY[\\-]{5}[^\\-]+[\\-]{5}END[a-z\\s]+PRIVATE\\sKEY|ssh-rsa\\s*[a-z0-9\\/\\.+]{100,}'),iP=y(sr(U.blockedTemplateHtml),sr(process.env.DD_APPSEC_HTTP_BLOCKED_TEMPLATE_HTML)),oP=y(sr(U.blockedTemplateJson),sr(process.env.DD_APPSEC_HTTP_BLOCKED_TEMPLATE_JSON)),pg=process.env.AWS_LAMBDA_FUNCTION_NAME!==void 0,aP=e.remoteConfig||{},cP=y(process.env.DD_REMOTE_CONFIGURATION_ENABLED&&O(process.env.DD_REMOTE_CONFIGURATION_ENABLED),!pg),uP=y(parseInt(aP.pollInterval),parseInt(process.env.DD_REMOTE_CONFIG_POLL_INTERVAL_SECONDS),5),le=e.experimental&&e.experimental.iast,lg=y(le&&(le===!0||le.enabled===!0),process.env.DD_IAST_ENABLED,!1),pP=y(process.env.DD_TELEMETRY_LOG_COLLECTION_ENABLED,lg),dg=30,No=y(parseInt(le&&le.requestSampling),parseInt(process.env.DD_IAST_REQUEST_SAMPLING),dg),lP=No<0||No>100?dg:No,dP=y(parseInt(le&&le.maxConcurrentRequests),parseInt(process.env.DD_IAST_MAX_CONCURRENT_REQUESTS),2),hP=y(parseInt(le&&le.maxContextOperations),parseInt(process.env.DD_IAST_MAX_CONTEXT_OPERATIONS),2),fP=y(le&&le.deduplicationEnabled,process.env.DD_IAST_DEDUPLICATION_ENABLED&&O(process.env.DD_IAST_DEDUPLICATION_ENABLED),!0),gP=y(process.env.DD_CIVISIBILITY_GIT_UPLOAD_ENABLED,!0),hg=e.ingestion||{},fg=y(e.dogstatsd,{}),gg={sampleRate:y(e.sampleRate,process.env.DD_TRACE_SAMPLE_RATE,hg.sampleRate),rateLimit:y(e.rateLimit,process.env.DD_TRACE_RATE_LIMIT,hg.rateLimit),rules:y(e.samplingRules,Kn(process.env.DD_TRACE_SAMPLING_RULES),[]).map(Hr=>$y(Hr,{sample_rate:"sampleRate"})),spanSamplingRules:y(e.spanSamplingRules,Kn(sr(process.env.DD_SPAN_SAMPLING_RULES_FILE)),Kn(process.env.DD_SPAN_SAMPLING_RULES),[]).map(Hr=>$y(Hr,{sample_rate:"sampleRate",max_per_second:"maxPerSecond"}))},mP=pg?0:2e3;this.tracing=!Hc(r),this.dbmPropagationMode=c,this.logInjection=O(o),this.env=_,this.url=f?new Bc(f):EU(d,e),this.site=y(e.site,process.env.DD_SITE,"datadoghq.com"),this.hostname=u||this.url&&this.url.hostname,this.port=String(l||this.url&&this.url.port),this.flushInterval=y(parseInt(e.flushInterval,10),mP),this.flushMinSpans=z,this.sampleRate=y(Math.min(Math.max(gg.sampleRate,0),1),1),this.queryStringObfuscation=Me,this.clientIpEnabled=Le,this.clientIpHeader=pe,this.plugins=!!y(e.plugins,!0),this.service=v,this.serviceMapping=q,this.version=S,this.dogstatsd={hostname:y(fg.hostname,process.env.DD_DOGSTATSD_HOSTNAME,this.hostname),port:String(y(fg.port,process.env.DD_DOGSTATSD_PORT,8125))},this.runtimeMetrics=O(a),this.tracePropagationStyle={inject:xo,extract:Io},this.experimental={runtimeId:O(Ao),exporter:on,enableGetRumData:O(an)},this.sampler=gg,this.reportHostname=O(y(e.reportHostname,process.env.DD_TRACE_REPORT_HOSTNAME,!1)),this.scope=process.env.DD_TRACE_SCOPE,this.profiling={enabled:O(s),sourceMap:!Hc(i),exporters:n},this.lookup=e.lookup,this.startupLogs=O(T),this.telemetry={enabled:on!=="datadog"&&O(x),logCollection:O(pP),debug:O(R)},this.protocolVersion=ue,this.tagsHeaderMaxLength=parseInt(ko),this.appsec={enabled:eP,rules:Po?Kn(sr(Po)):Hy(),customRulesProvided:!!Po,rateLimit:tP,wafTimeout:rP,obfuscatorKeyRegex:sP,obfuscatorValueRegex:nP,blockedTemplateHtml:iP,blockedTemplateJson:oP},this.remoteConfig={enabled:cP,pollInterval:uP},this.iast={enabled:O(lg),requestSampling:lP,maxConcurrentRequests:dP,maxContextOperations:hP,deduplicationEnabled:fP},this.isCiVisibility=O(h),this.isIntelligentTestRunnerEnabled=this.isCiVisibility&&O(g),this.isGitUploadEnabled=this.isCiVisibility&&this.isIntelligentTestRunnerEnabled&&!Hc(gP),this.stats={enabled:O(Ro)},this.traceId128BitGenerationEnabled=O(Co),this.traceId128BitLoggingEnabled=O(Oo),is.add(this.tags,{service:this.service,env:this.env,version:this.version,"runtime-id":vU()})}};function EU(t,e){if(t)return new Bc(t);if(yU.type()!=="Windows_NT"&&!e.hostname&&!e.port&&!process.env.DD_AGENT_HOST&&!process.env.DD_TRACE_AGENT_HOSTNAME&&!process.env.DD_TRACE_AGENT_PORT&&Fy.existsSync("/var/run/datadog/apm.socket"))return new Bc("unix:///var/run/datadog/apm.socket")}zy.exports=$c});var Fc=p((pZ,Ky)=>{"use strict";var Gc=require("path"),Vy=require("fs");function TU(t,e){if(Gc.isAbsolute(t)){let r=Gc.join(t,"package.json");return JSON.parse(Vy.readFileSync(r,"utf8"))}for(let r of e.paths){let s=Gc.join(r,t,"package.json");try{return JSON.parse(Vy.readFileSync(s,"utf8"))}catch{continue}}throw new Error(`could not find ${t}/package.json`)}Ky.exports=TU});var Yn=p((lZ,Yy)=>{var wU=X(),xU=0;function IU(t,e,r,s,n={}){let{hostname:i,port:o,url:a}=t,{logger:c,tags:u,serviceMapping:l,...d}=n,h={url:a,hostname:i,port:o,method:"POST",path:"/telemetry/proxy/api/v2/apmtelemetry",headers:{"content-type":"application/json","dd-telemetry-api-version":"v1","dd-telemetry-request-type":s}},f=JSON.stringify({api_version:"v1",request_type:s,tracer_time:Math.floor(Date.now()/1e3),runtime_id:t.tags["runtime-id"],seq_id:++xU,payload:d,application:e,host:r});wU(f,h,()=>{})}Yy.exports={sendData:IU}});var Zy=p((dZ,Jc)=>{"use strict";var AU=require("path"),kU=require("module-details-from-path"),RU=Fc(),{sendData:CU}=Yn(),OU=H(),{fileURLToPath:PU}=require("url"),nr=new Set,zc=new Set,NU="file://",Wc=OU.channel("dd-trace:moduleLoadStart"),Jn,Vc,Kc,Yc;function Xy(t,e,r){Jn||(Jn=setImmediate(()=>{if(Jn=null,nr.size>0){let s=Array.from(nr.values()).splice(0,1e3).map(n=>{nr.delete(n);let[i,o]=n.split(" ");return{name:i,version:o}});CU(t,e,r,"app-dependencies-loaded",{dependencies:s}),nr.size>0&&Xy(t,e,r)}}),Jn.unref())}function Qy(t){if(t){let e=t.filename;if(e&&e.startsWith(NU))try{e=PU(e)}catch{}let r=e&&kU(e),s=t.request||r&&r.name;if(e&&s&&MU(e,s)&&!zc.has(s)&&(zc.add(s),r)){let{name:n,basedir:i}=r;if(i)try{let{version:o}=RU(i,Jc);nr.add(`${n} ${o}`),Xy(Vc,Kc,Yc)}catch{}}}}function DU(t,e,r){Vc=t,Kc=e,Yc=r,Wc.subscribe(Qy)}function MU(t,e){let r=Jy(t,e,"/");return r&&process.platform==="win32"?Jy(t,e,AU.sep):r}function Jy(t,e,r){return e.indexOf(`..${r}`)!==0&&e.indexOf(`.${r}`)!==0&&e.indexOf(r)!==0&&e.indexOf(`:${r}`)!==1}function LU(){Vc=null,Kc=null,Yc=null,zc.clear(),nr.clear(),Wc.hasSubscribers&&Wc.unsubscribe(Qy)}Jc.exports={start:DU,stop:LU}});var av=p((hZ,ov)=>{"use strict";var jU=Ie().version,tv=H(),Be=require("os"),UU=Zy(),{sendData:Xn}=Yn(),rv=process.env.DD_TELEMETRY_HEARTBEAT_INTERVAL?Number(process.env.DD_TELEMETRY_HEARTBEAT_INTERVAL)*1e3:6e4,HU=tv.channel("datadog:telemetry:start"),BU=tv.channel("datadog:telemetry:stop"),G,Xc,Ct,Ot,Qc,ev=new Set;function sv(){let t=[];for(let e in Xc._pluginsByName)ev.has(e)||(t.push({name:e,enabled:Xc._pluginsByName[e]._enabled,auto_enabled:!0}),ev.add(e));return t}function nv(t,e=[],r=[],s=null){if(s=s||new WeakSet,!s.has(t)){s.add(t);for(let[n,i]of Object.entries(t))typeof i=="object"&&i!==null?nv(i,e,[...r,n],s):e.push({name:[...r,n].join("."),value:i});return e}}function $U(){return{integrations:sv(),dependencies:[],configuration:nv(G),additional_payload:[]}}function Zc(){process.removeListener("beforeExit",Zc),Xn(G,Ct,Ot,"app-closing")}function GU(){return{service_name:G.service,env:G.env,service_version:G.version,tracer_version:jU,language_name:"nodejs",language_version:process.versions.node}}function FU(){let t=Be.type();return t==="Linux"||t==="Darwin"?{hostname:Be.hostname(),os:t,architecture:Be.arch(),kernel_version:Be.version(),kernel_release:Be.release(),kernel_name:t}:t==="Windows_NT"?{hostname:Be.hostname(),os:t,architecture:Be.arch(),os_version:Be.version()}:{hostname:Be.hostname(),os:t}}function iv(){return{config:G,application:Ct,host:Ot,heartbeatInterval:rv}}function zU(t,e){t.telemetry.enabled&&(G=t,Xc=e,Ct=GU(),Ot=FU(),UU.start(G,Ct,Ot),Xn(G,Ct,Ot,"app-started",$U()),Qc=setInterval(()=>{Xn(G,Ct,Ot,"app-heartbeat")},rv),Qc.unref(),process.on("beforeExit",Zc),HU.publish(iv()))}function WU(){G&&(clearInterval(Qc),process.removeListener("beforeExit",Zc),BU.publish(iv()),G=void 0)}function VU(){if(!G||!G.telemetry.enabled)return;let t=sv();t.length!==0&&Xn(G,Ct,Ot,"app-integrations-change",{integrations:t})}ov.exports={start:zU,stop:WU,updateIntegrations:VU}});var N=p((gZ,cv)=>{"use strict";var KU=H(),{storage:as}=I(),eu=class{constructor(e,r){this._channel=KU.channel(e),this._handler=(s,n)=>{let i=as.getStore();(!i||!i.noop)&&r(s,n)}}enable(){this._channel.subscribe(this._handler)}disable(){this._channel.unsubscribe(this._handler)}};cv.exports=class{constructor(e){this._subscriptions=[],this._enabled=!1,this._tracer=e}get tracer(){return this._tracer._tracer}enter(e,r){r=r||as.getStore(),as.enterWith({...r,span:e})}skip(){as.enterWith({noop:!0})}addSub(e,r){this._subscriptions.push(new eu(e,r))}addError(e){let r=as.getStore();!r||!r.span||r.span._spanContext._tags.error||r.span.setTag("error",e||1)}configure(e){typeof e=="boolean"&&(e={enabled:e}),this.config=e,e.enabled&&!this._enabled?(this._enabled=!0,this._subscriptions.forEach(r=>r.enable())):!e.enabled&&this._enabled&&(this._enabled=!1,this._subscriptions.forEach(r=>r.disable()))}}});var $e=p((mZ,pv)=>{"use strict";var{MEASURED:uv}=B();pv.exports={sample(t,e,r){typeof e=="object"?this.sample(t,e[t.context()._name],r):e!==void 0?t.setTag(uv,!!e):r&&t.setTag(uv,!0)}}});var Se=p((_Z,lv)=>{"use strict";var YU=$e(),JU=N(),{storage:tu}=I(),{isTrue:XU}=te(),ru=class extends JU{static get id(){return"aws"}get serviceIdentifier(){let e=this.constructor.id.toLowerCase();return Object.defineProperty(this,"serviceIdentifier",{configurable:!0,writable:!0,enumerable:!0,value:e}),e}constructor(...e){super(...e),this.addSub(`apm:aws:request:start:${this.serviceIdentifier}`,({request:r,operation:s,awsRegion:n,awsService:i})=>{if(!this.isEnabled(r))return;let o=this.getServiceName(),a=this.tracer.scope().active(),c={"span.kind":"client","service.name":o,"aws.operation":s,"aws.region":n,"aws.service":i,component:"aws-sdk"};this.requestTags&&this.requestTags.set(r,c);let u=this.tracer.startSpan("aws.request",{childOf:a,tags:c});YU.sample(u,this.config.measured),this.requestInject(u,r);let l=tu.getStore();this.enter(u,l)}),this.addSub(`apm:aws:request:region:${this.serviceIdentifier}`,r=>{let s=tu.getStore();if(!s)return;let{span:n}=s;n&&n.setTag("aws.region",r)}),this.addSub(`apm:aws:request:complete:${this.serviceIdentifier}`,({response:r})=>{let s=tu.getStore();if(!s)return;let{span:n}=s;n&&(this.addResponseTags(n,r),this.finish(n,r,r.error))})}requestInject(e,r){}isEnabled(e){let r=this.serviceIdentifier.toUpperCase(),s=process.env[`DD_TRACE_AWS_SDK_${r}_ENABLED`];return s?XU(s):!0}addResponseTags(e,r){if(!e||!r.request)return;let s=r.request.params,n=r.request.operation,i=this.generateTags(s,n,r)||{},o=Object.assign({"aws.response.request_id":r.requestId,"resource.name":n,"span.kind":"client"},i);e.addTags(o)}generateTags(){}finish(e,r,s){s&&(e.setTag("error",s),s.requestId&&e.addTags({"aws.response.request_id":s.requestId})),r&&this.config.hooks.request(e,r),e.finish()}configure(e){super.configure(QU(e,this.serviceIdentifier))}getServiceName(){return this.config.service?this.config.service:`${this.tracer._service}-aws-${this.serviceIdentifier}`}};function QU(t,e){let r=ZU(t),s=t[e];switch(typeof s){case"undefined":s={};break;case"boolean":s={enabled:s};break}return Object.assign({},t,s,{splitByAwsService:t.splitByAwsService!==!1,hooks:r})}function ZU(t){let e=()=>{};return{request:t.hooks&&t.hooks.request||e}}lv.exports=ru});var hv=p((bZ,dv)=>{"use strict";var eH=Se(),su=class extends eH{static get id(){return"cloudwatchlogs"}generateTags(e,r){let s={};return!e||!e.logGroupName?s:Object.assign(s,{"resource.name":`${r} ${e.logGroupName}`,"aws.cloudwatch.logs.log_group_name":e.logGroupName})}};dv.exports=su});var gv=p((yZ,fv)=>{"use strict";var tH=Se(),nu=class extends tH{static get id(){return"dynamodb"}generateTags(e,r,s){let n={};if(e&&(e.TableName&&Object.assign(n,{"resource.name":`${r} ${e.TableName}`,"aws.dynamodb.table_name":e.TableName}),e.RequestItems&&typeof e.RequestItems=="object"&&Object.keys(e.RequestItems).length===1)){let i=Object.keys(e.RequestItems)[0];Object.assign(n,{"resource.name":`${r} ${i}`,"aws.dynamodb.table_name":i})}return Object.assign(n,{"span.type":"dynamodb"}),n}};fv.exports=nu});var bv=p((vZ,_v)=>{"use strict";var mv=E(),rH=Se(),iu=class extends rH{static get id(){return"eventbridge"}generateTags(e,r,s){return!e||!e.source?{}:{"resource.name":`${r} ${e.source}`,"aws.eventbridge.source":e.source}}requestInject(e,r){if(r.operation==="putEvents"&&r.params&&r.params.Entries&&r.params.Entries.length>0&&r.params.Entries[0].Detail)try{let n=JSON.parse(r.params.Entries[0].Detail);n._datadog={},this.tracer.inject(e,"text_map",n._datadog);let i=JSON.stringify(n);if(Buffer.byteLength(i)>=1024*256){mv.info("Payload size too large to pass context");return}r.params.Entries[0].Detail=i}catch(n){mv.error(n)}}};_v.exports=iu});var vv=p((SZ,yv)=>{"use strict";var Qn=E(),sH=Se(),ou=class extends sH{static get id(){return"kinesis"}generateTags(e,r,s){return!e||!e.StreamName?{}:{"resource.name":`${r} ${e.StreamName}`,"aws.kinesis.stream_name":e.StreamName}}_tryParse(e){try{return JSON.parse(e)}catch{Qn.info("Not JSON string. Trying Base64 encoded JSON string")}try{return JSON.parse(Buffer.from(e,"base64").toString("ascii"),!0)}catch{return null}}requestInject(e,r){let s=r.operation;if(s==="putRecord"||s==="putRecords"){if(!r.params)return;let n={};this.tracer.inject(e,"text_map",n);let i;if(r.params.Records&&r.params.Records.length>0)i=r.params.Records[0];else if(r.params.Data)i=r.params;else{Qn.error("No valid payload passed, unable to pass trace context");return}let o=this._tryParse(i.Data);if(o){o._datadog=n;let a=Buffer.from(JSON.stringify(o));if(a.length>=1048576){Qn.info("Payload size too large to pass context");return}i.Data=a}else Qn.error("Unable to parse payload, unable to pass trace context")}}};yv.exports=ou});var qv=p((qZ,Sv)=>{"use strict";var nH=E(),iH=Se(),au=class extends iH{static get id(){return"lambda"}generateTags(e,r,s){let n={};return!e||!e.FunctionName?n:Object.assign(n,{"resource.name":`${r} ${e.FunctionName}`,"aws.lambda":e.FunctionName})}requestInject(e,r){if(r.operation==="invoke"&&(r.params||(r.params={}),!r.params.InvocationType||r.params.InvocationType==="RequestResponse"))try{let i={};if(r.params.ClientContext){let a=Buffer.from(r.params.ClientContext,"base64").toString("utf-8");i=JSON.parse(a)}i.custom||(i.custom={}),this.tracer.inject(e,"text_map",i.custom);let o=Buffer.from(JSON.stringify(i)).toString("base64");r.params.ClientContext=o}catch(i){nH.error(i)}}};Sv.exports=au});var Tv=p((EZ,Ev)=>{"use strict";var oH=Se(),cu=class extends oH{static get id(){return"redshift"}generateTags(e,r,s){let n={};return!e||!e.ClusterIdentifier?n:Object.assign(n,{"resource.name":`${r} ${e.ClusterIdentifier}`,"aws.redshift.cluster_identifier":e.ClusterIdentifier})}};Ev.exports=cu});var xv=p((TZ,wv)=>{"use strict";var aH=Se(),uu=class extends aH{static get id(){return"s3"}generateTags(e,r,s){let n={};return!e||!e.Bucket?n:Object.assign(n,{"resource.name":`${r} ${e.Bucket}`,"aws.s3.bucket_name":e.Bucket})}};wv.exports=uu});var Av=p((wZ,Iv)=>{"use strict";var cH=E(),uH=Se(),pu=class extends uH{static get id(){return"sns"}generateTags(e,r,s){return e?!e.TopicArn&&!(s.data&&s.data.TopicArn)?{}:{"resource.name":`${r} ${e.TopicArn||s.data.TopicArn}`,"aws.sns.topic_arn":e.TopicArn||s.data.TopicArn}:{}}requestInject(e,r){let{operation:s,params:n}=r;if(n)switch(s){case"publish":this._injectMessageAttributes(e,n);break;case"publishBatch":n.PublishBatchRequestEntries&&n.PublishBatchRequestEntries.length>0&&this._injectMessageAttributes(e,n.PublishBatchRequestEntries[0]);break}}_injectMessageAttributes(e,r){if(r.MessageAttributes||(r.MessageAttributes={}),Object.keys(r.MessageAttributes).length>=10){cH.info("Message attributes full, skipping trace context injection");return}let s={};this.tracer.inject(e,"text_map",s),r.MessageAttributes._datadog={DataType:"Binary",BinaryValue:Buffer.from(JSON.stringify(s))}}};Iv.exports=pu});var Cv=p((xZ,Rv)=>{"use strict";var pH=E(),lH=Se(),{storage:kv}=I(),lu=class extends lH{static get id(){return"sqs"}constructor(...e){super(...e),this.requestTags=new WeakMap,this.addSub("apm:aws:response:start:sqs",r=>{let{request:s,response:n}=r,i=kv.getStore(),o=this,a=this.responseExtract(s.params,s.operation,n);if(a){r.needsFinish=!0;let c={childOf:a,tags:Object.assign({},this.requestTags.get(s)||{},{"span.kind":"server"})},u=o.tracer.startSpan("aws.response",c);this.enter(u,i)}}),this.addSub("apm:aws:response:finish:sqs",r=>{let{span:s}=kv.getStore();this.finish(s,null,r)})}isEnabled(e){let r=this.config;switch(e.operation){case"receiveMessage":return r.consumer!==!1;case"sendMessage":case"sendMessageBatch":return r.producer!==!1;default:return!0}}generateTags(e,r,s){let n={};if(!e||!e.QueueName&&!e.QueueUrl)return n;switch(Object.assign(n,{"resource.name":`${r} ${e.QueueName||e.QueueUrl}`,"aws.sqs.queue_name":e.QueueName||e.QueueUrl}),r){case"receiveMessage":n["span.type"]="worker",n["span.kind"]="consumer";break;case"sendMessage":case"sendMessageBatch":n["span.kind"]="producer";break}return n}responseExtract(e,r,s){if(r!=="receiveMessage"||e.MaxNumberOfMessages&&e.MaxNumberOfMessages!==1||!s||!s.Messages||!s.Messages[0])return;let n=s.Messages[0];if(n.Body)try{let o=JSON.parse(n.Body);o.Type==="Notification"&&(n=o)}catch{}if(!n.MessageAttributes||!n.MessageAttributes._datadog)return;let i=n.MessageAttributes._datadog;try{if(i.StringValue){let o=i.StringValue;return this.tracer.extract("text_map",JSON.parse(o))}else if(i.Type==="Binary"){let o=Buffer.from(i.Value,"base64");return this.tracer.extract("text_map",JSON.parse(o))}}catch(o){pH.error(o)}}requestInject(e,r){if(r.operation==="sendMessage"){if(r.params||(r.params={}),!r.params.MessageAttributes)r.params.MessageAttributes={};else if(Object.keys(r.params.MessageAttributes).length>=10)return;let n={};this.tracer.inject(e,"text_map",n),r.params.MessageAttributes._datadog={DataType:"String",StringValue:JSON.stringify(n)}}}};Rv.exports=lu});var Pv=p((IZ,Ov)=>{"use strict";var dH=Se(),du=class extends dH{};Ov.exports=du});var Nv=p(qe=>{"use strict";qe.cloudwatchlogs=hv();qe.dynamodb=gv();qe.eventbridge=bv();qe.kinesis=vv();qe.lambda=qv();qe.redshift=Tv();qe.s3=xv();qe.sns=Av();qe.sqs=Cv();qe.default=Pv()});var fu=p((kZ,Mv)=>{"use strict";var hH=N(),Dv=Nv(),hu=class extends hH{static get id(){return"aws-sdk"}constructor(...e){super(...e),this.services={};for(let r in Dv){let s=Dv[r];this.services[r]=new s(...e)}}configure(e){for(let r of Object.values(this.services))r.configure(e)}};Mv.exports=hu});var cs=p((CZ,Hv)=>{var{getTestEnvironmentMetadata:fH,getCodeOwnersFileEntries:gH,getTestParentSpan:Lv,getTestCommonTags:mH,getCodeOwnersForFilename:_H,TEST_CODE_OWNERS:bH,CI_APP_ORIGIN:yH,getTestSessionCommonTags:vH,getTestModuleCommonTags:SH,TEST_SUITE_ID:qH,TEST_MODULE_ID:EH,TEST_SESSION_ID:TH,TEST_COMMAND:jv,TEST_MODULE:wH}=ve(),xH=N(),{COMPONENT:gu}=A(),Uv=E();Hv.exports=class extends xH{constructor(...e){super(...e),this.addSub(`ci:${this.constructor.id}:itr-configuration`,({onDone:r})=>{if(!this.tracer._exporter||!this.tracer._exporter.getItrConfiguration)return r({err:new Error("CI Visibility was not initialized correctly")});this.tracer._exporter.getItrConfiguration(this.testConfiguration,(s,n)=>{s?Uv.error(`Intelligent Test Runner configuration could not be fetched. ${s.message}`):this.itrConfig=n,r({err:s,itrConfig:n})})}),this.addSub(`ci:${this.constructor.id}:test-suite:skippable`,({onDone:r})=>{if(!this.tracer._exporter||!this.tracer._exporter.getSkippableSuites)return r({err:new Error("CI Visibility was not initialized correctly")});this.tracer._exporter.getSkippableSuites(this.testConfiguration,(s,n)=>{s&&Uv.error(`Skippable suites could not be fetched. ${s.message}`),r({err:s,skippableSuites:n})})}),this.addSub(`ci:${this.constructor.id}:session:start`,({command:r,frameworkVersion:s,rootDir:n})=>{let i=Lv(this.tracer),o=vH(r,s,this.constructor.id),a=SH(r,s,this.constructor.id);this.command=r,this.frameworkVersion=s,this.rootDir=n,this.testSessionSpan=this.tracer.startSpan(`${this.constructor.id}.test_session`,{childOf:i,tags:{[gu]:this.constructor.id,...this.testEnvironmentMetadata,...o}}),this.testModuleSpan=this.tracer.startSpan(`${this.constructor.id}.test_module`,{childOf:this.testSessionSpan,tags:{[gu]:this.constructor.id,...this.testEnvironmentMetadata,...a}})})}configure(e){super.configure(e),this.testEnvironmentMetadata=fH(this.constructor.id,this.config),this.codeOwnersEntries=gH();let{"git.repository_url":r,"git.commit.sha":s,"os.version":n,"os.platform":i,"os.architecture":o,"runtime.name":a,"runtime.version":c,"git.branch":u}=this.testEnvironmentMetadata;this.testConfiguration={repositoryUrl:r,sha:s,osVersion:n,osPlatform:i,osArchitecture:o,runtimeName:a,runtimeVersion:c,branch:u}}startTestSpan(e,r,s,n={}){let i=Lv(this.tracer),o={...mH(e,r,this.frameworkVersion),[gu]:this.constructor.id,...n},a=_H(r,this.codeOwnersEntries);if(a&&(o[bH]=a),s){i._trace.startTime=s.context()._trace.startTime,i._trace.ticks=s.context()._trace.ticks;let u={[qH]:s.context().toSpanId(),[TH]:s.context().toTraceId(),[jv]:s.context()._tags[jv],[wH]:this.constructor.id};s.context()._parentId&&(u[EH]=s.context()._parentId.toString(10)),o={...o,...u}}let c=this.tracer.startSpan(`${this.constructor.id}.test`,{childOf:i,tags:{...this.testEnvironmentMetadata,...o}});return c.context()._trace.origin=yH,c}}});var Fv=p((OZ,Gv)=>{"use strict";var IH=cs(),{storage:Zn}=I(),{TEST_SKIP_REASON:AH,TEST_STATUS:ei,TEST_SOURCE_START:kH,finishAllTraceSpans:Bv,getTestSuitePath:mu,getTestSuiteCommonTags:RH,addIntelligentTestRunnerSpanTags:CH}=ve(),{RESOURCE_NAME:OH}=B(),{COMPONENT:$v,ERROR_MESSAGE:PH}=A(),_u=class extends IH{static get id(){return"cucumber"}constructor(...e){super(...e),this.sourceRoot=process.cwd(),this.addSub("ci:cucumber:session:finish",({status:r,isSuitesSkipped:s,testCodeCoverageLinesTotal:n})=>{let{isSuitesSkippingEnabled:i,isCodeCoverageEnabled:o}=this.itrConfig||{};CH(this.testSessionSpan,this.testModuleSpan,{isSuitesSkipped:s,isSuitesSkippingEnabled:i,isCodeCoverageEnabled:o,testCodeCoverageLinesTotal:n}),this.testSessionSpan.setTag(ei,r),this.testModuleSpan.setTag(ei,r),this.testModuleSpan.finish(),this.testSessionSpan.finish(),Bv(this.testSessionSpan),this.itrConfig=null,this.tracer._exporter.flush()}),this.addSub("ci:cucumber:test-suite:start",r=>{let s=RH(this.command,this.frameworkVersion,mu(r,this.sourceRoot),"cucumber");this.testSuiteSpan=this.tracer.startSpan("cucumber.test_suite",{childOf:this.testModuleSpan,tags:{[$v]:this.constructor.id,...this.testEnvironmentMetadata,...s}})}),this.addSub("ci:cucumber:test-suite:finish",r=>{this.testSuiteSpan.setTag(ei,r),this.testSuiteSpan.finish()}),this.addSub("ci:cucumber:test-suite:code-coverage",({coverageFiles:r,suiteFile:s})=>{if(!this.itrConfig||!this.itrConfig.isCodeCoverageEnabled)return;let n=[...r,s].map(o=>mu(o,this.sourceRoot)),i={traceId:this.testSuiteSpan.context()._traceId,spanId:this.testSuiteSpan.context()._spanId,files:n};this.tracer._exporter.exportCoverage(i)}),this.addSub("ci:cucumber:test:start",({testName:r,fullTestSuite:s,testSourceLine:n})=>{let i=Zn.getStore(),o=mu(s,this.sourceRoot),a=this.startTestSpan(r,o,n);this.enter(a,i)}),this.addSub("ci:cucumber:test-step:start",({resource:r})=>{let s=Zn.getStore(),n=s&&s.span,i=this.tracer.startSpan("cucumber.step",{childOf:n,tags:{[$v]:this.constructor.id,"cucumber.step":r,[OH]:r}});this.enter(i,s)}),this.addSub("ci:cucumber:test:finish",({isStep:r,status:s,skipReason:n,errorMessage:i})=>{let o=Zn.getStore().span,a=r?"step.status":ei;o.setTag(a,s),n&&o.setTag(AH,n),i&&o.setTag(PH,i),o.finish(),r||Bv(o)}),this.addSub("ci:cucumber:error",r=>{r&&Zn.getStore().span.setTag("error",r)})}startTestSpan(e,r,s){return super.startTestSpan(e,r,this.testSuiteSpan,{[kH]:s})}};Gv.exports=_u});var Yv=p((PZ,Kv)=>{"use strict";var{storage:ti}=I(),NH=cs(),{TEST_STATUS:ri,finishAllTraceSpans:zv,getTestSuitePath:Wv,getTestSuiteCommonTags:DH,TEST_SOURCE_START:MH}=ve(),{RESOURCE_NAME:LH}=B(),{COMPONENT:Vv}=A(),bu=class extends NH{static get id(){return"playwright"}constructor(...e){super(...e),this._testSuites=new Map,this.addSub("ci:playwright:session:finish",({status:r,onDone:s})=>{this.testModuleSpan.setTag(ri,r),this.testSessionSpan.setTag(ri,r),this.testModuleSpan.finish(),this.testSessionSpan.finish(),zv(this.testSessionSpan),this.tracer._exporter.flush(s)}),this.addSub("ci:playwright:test-suite:start",r=>{let s=ti.getStore(),n=Wv(r,this.rootDir),i=DH(this.command,this.frameworkVersion,n,"playwright"),o=this.tracer.startSpan("playwright.test_suite",{childOf:this.testModuleSpan,tags:{[Vv]:this.constructor.id,...this.testEnvironmentMetadata,...i}});this.enter(o,s),this._testSuites.set(n,o)}),this.addSub("ci:playwright:test-suite:finish",r=>{let s=ti.getStore(),n=s&&s.span;n&&(n.setTag(ri,r),n.finish())}),this.addSub("ci:playwright:test:start",({testName:r,testSuiteAbsolutePath:s,testSourceLine:n})=>{let i=ti.getStore(),o=Wv(s,this.rootDir),a=this.startTestSpan(r,o,n);this.enter(a,i)}),this.addSub("ci:playwright:test:finish",({testStatus:r,steps:s,error:n})=>{let i=ti.getStore(),o=i&&i.span;o&&(o.setTag(ri,r),n&&o.setTag("error",n),s.forEach(a=>{let c=a.startTime.getTime(),u=this.tracer.startSpan("playwright.step",{childOf:o,startTime:c,tags:{[Vv]:this.constructor.id,"playwright.step":a.title,[LH]:a.title}});a.error&&u.setTag("error",a.error),u.finish(c+a.duration)}),o.finish(),zv(o))})}startTestSpan(e,r,s){let n=this._testSuites.get(r);return super.startTestSpan(e,r,n,{[MH]:s})}};Kv.exports=bu});var Pt=p((NZ,Jv)=>{"use strict";var jH=N(),{storage:yu}=I(),UH=$e(),{COMPONENT:HH}=A(),vu=class extends jH{constructor(...e){super(...e),this.component=this.constructor.component||this.constructor.id,this.operation=this.constructor.operation,this.addTraceSub("start",r=>{this.start(r)}),this.addTraceSub("error",r=>{this.error(r)}),this.addTraceSub("finish",r=>{this.finish(r)})}get activeSpan(){let e=yu.getStore();return e&&e.span}configure(e){return super.configure({...e,hooks:{[this.operation]:()=>{},...e.hooks}})}start(){}finish(){this.activeSpan.finish()}error(e){this.addError(e)}addTraceSub(e,r){this.addSub(`apm:${this.component}:${this.operation}:${e}`,r)}addError(e){let r=this.activeSpan;r._spanContext._tags.error||r.setTag("error",e||1)}startSpan(e,{childOf:r,kind:s,meta:n,metrics:i,service:o,resource:a,type:c}={}){let u=yu.getStore();u&&r===void 0&&(r=u.span);let l=this.tracer.startSpan(e,{childOf:r,tags:{[HH]:this.component,"service.name":o||this.tracer._service,"resource.name":a,"span.kind":s,"span.type":c,...n,...i}});return UH.sample(l,this.config.measured),yu.enterWith({...u,span:l}),l}};Jv.exports=vu});var qu=p((DZ,Xv)=>{"use strict";var{CLIENT_PORT_KEY:BH}=A(),$H=Pt(),Su=class extends $H{constructor(...e){super(...e),this.addTraceSub("connect",r=>{this.connect(r)})}connect(e){this.addHost(e.hostname,e.port)}addHost(e,r){let s=this.activeSpan;s&&s.addTags({"out.host":e,[BH]:r})}};Xv.exports=Su});var ae=p((MZ,Qv)=>{"use strict";var GH=qu(),Eu=class extends GH{static get operation(){return"request"}};Qv.exports=Eu});var wu=p((LZ,Zv)=>{"use strict";var FH=ae(),Tu=class extends FH{constructor(...e){super(...e),this.system=this.constructor.system||this.component}startSpan(e,r){return!r.service&&this.system&&(r.service=`${this.tracer._service}-${this.system}`),super.startSpan(e,r)}};Zv.exports=Tu});var dt=p((jZ,eS)=>{"use strict";var zH=wu(),xu=class extends zH{static get operation(){return"query"}constructor(...e){super(...e),this.serviceTags={dddbs:"",encodedDddbs:"",dde:"",encodedDde:"",ddps:"",encodedDdps:"",ddpv:"",encodedDdpv:""}}encodingServiceTags(e,r,s){e!==s&&(this.serviceTags[e]=s,this.serviceTags[r]=encodeURIComponent(s))}createDBMPropagationCommentService(e){this.encodingServiceTags("dddbs","encodedDddbs",e),this.encodingServiceTags("dde","encodedDde",this.tracer._env),this.encodingServiceTags("ddps","encodedDdps",this.tracer._service),this.encodingServiceTags("ddpv","encodedDdpv",this.tracer._version);let{encodedDddbs:r,encodedDde:s,encodedDdps:n,encodedDdpv:i}=this.serviceTags;return`dddbs='${r}',dde='${s}',ddps='${n}',ddpv='${i}'`}injectDbmQuery(e,r){if(this.config.dbmPropagationMode==="disabled")return e;let s=this.createDBMPropagationCommentService(r);if(this.config.dbmPropagationMode==="service")return`/*${s}*/ ${e}`;if(this.config.dbmPropagationMode==="full"){this.activeSpan.setTag("_dd.dbm_trace_injected","true");let n=this.activeSpan._spanContext.toTraceparent();return`/*${s},traceparent='${n}'*/ ${e}`}}};eS.exports=xu});var us=p((UZ,tS)=>{"use strict";var WH=dt(),Iu=class extends WH{static get id(){return"elasticsearch"}start({params:e}){let r=VH(e.body||e.bulkBody);this.startSpan(`${this.system}.query`,{service:this.config.service,resource:`${e.method} ${KH(e.path)}`,type:"elasticsearch",kind:"client",meta:{"db.type":this.system,[`${this.system}.url`]:e.path,[`${this.system}.method`]:e.method,[`${this.system}.body`]:r,[`${this.system}.params`]:JSON.stringify(e.querystring||e.query)}})}finish({params:e}){let r=this.activeSpan;this.config.hooks.query(r,e),super.finish({params:e})}};function VH(t){return t&&JSON.stringify(t)}function KH(t){return t&&t.replace(/[0-9]+/g,"?")}tS.exports=Iu});var ir=p((HZ,rS)=>{"use strict";var YH=qu(),Au=class extends YH{static get operation(){return"publish"}};rS.exports=Au});var nS=p((BZ,sS)=>{"use strict";var JH=ir(),ku=class extends JH{static get id(){return"google-cloud-pubsub"}static get operation(){return"request"}start({request:e,api:r,projectId:s}){if(r!=="publish")return;let n=e.messages||[],i=e.topic,o=this.startSpan("pubsub.request",{service:this.config.service||`${this.tracer._service}-pubsub`,resource:`${r} ${i}`,kind:"producer",meta:{"gcloud.project_id":s,"pubsub.method":r,"pubsub.topic":i}});for(let a of n)a.attributes||(a.attributes={}),this.tracer.inject(o,"text_map",a.attributes)}};sS.exports=ku});var Cu=p(($Z,iS)=>{"use strict";var XH=Pt(),Ru=class extends XH{};iS.exports=Ru});var or=p((GZ,oS)=>{"use strict";var QH=Cu(),Ou=class extends QH{static get operation(){return"receive"}};oS.exports=Ou});var cS=p((FZ,aS)=>{"use strict";var ZH=or(),Pu=class extends ZH{static get id(){return"google-cloud-pubsub"}static get operation(){return"receive"}start({message:e}){let r=e._subscriber._subscription,s=r.metadata&&r.metadata.topic,n=this.tracer.extract("text_map",e.attributes)||null;this.startSpan("pubsub.receive",{childOf:n,service:this.config.service,resource:s,kind:"consumer",type:"worker",meta:{"gcloud.project_id":r.pubsub.projectId,"pubsub.topic":s},metrics:{"pubsub.ack":0}})}finish(e){let r=this.activeSpan;e.message._handled&&r.setTag("pubsub.ack",1),r.finish()}};aS.exports=Pu});var pS=p((zZ,uS)=>{"use strict";var eB=ae(),Nu=class extends eB{static get id(){return"google-cloud-pubsub"}static get operation(){return"request"}start({request:e,api:r,projectId:s}){r!=="publish"&&this.startSpan("pubsub.request",{service:this.config.service||`${this.tracer._service}-pubsub`,resource:[r,e.name].filter(n=>n).join(" "),kind:"client",meta:{"pubsub.method":r,"gcloud.project_id":s}})}};uS.exports=Nu});var ce=p((WZ,lS)=>{"use strict";var tB=N(),Du=class extends tB{constructor(...e){super(...e);for(let[r,s]of Object.entries(this.constructor.plugins))this[r]=new s(...e)}configure(e){for(let r in this.constructor.plugins){let s=e[r]===!1?!1:{...e,...e[r]};this[r].configure(s)}}};lS.exports=Du});var hS=p((VZ,dS)=>{"use strict";var rB=nS(),sB=cS(),nB=pS(),iB=ce(),Mu=class extends iB{static get id(){return"google-cloud-pubsub"}static get plugins(){return{producer:rB,consumer:sB,client:nB}}};dS.exports=Mu});var si=p((KZ,fS)=>{"use strict";var oB=Cu(),Lu=class extends oB{static get operation(){return"request"}};fS.exports=Lu});var ju=p((YZ,gS)=>{"use strict";var aB=require("lodash.pick"),cB=E();gS.exports={getMethodMetadata(t,e){let r={path:t,kind:e,name:"",service:"",package:""};if(typeof t!="string")return r;let s=t.split("/");if(s.length>2){let n=s[1].split("."),i=s[2],o=n.pop(),a=n.join(".");r.name=i,r.service=o,r.package=a}else r.name=s[s.length-1];return r},addMetadataTags(t,e,r,s){if(!e||typeof e.getMap!="function")return;let n=r(e.getMap());for(let i in n)t.setTag(`grpc.${s}.metadata.${i}`,n[i])},getFilter(t,e){return typeof t[e]=="function"?t[e]:t[e]instanceof Array?r=>aB(r,t[e]):(t.hasOwnProperty(e)&&cB.error(`Expected '${e}' to be an array or function.`),()=>({}))}}});var bS=p((JZ,_S)=>{"use strict";var uB=si(),{TEXT_MAP:pB}=fe(),{addMetadataTags:mS,getFilter:lB,getMethodMetadata:dB}=ju(),Uu=class extends uB{static get id(){return"grpc"}static get operation(){return"server:request"}constructor(...e){super(...e),this.addTraceSub("update",({code:r})=>{let s=this.activeSpan;s&&this.addCode(s,r)})}start({name:e,metadata:r,type:s}){let n=this.config.metadataFilter,i=hB(this.tracer,r),o=dB(e,s),a=this.startSpan("grpc.server",{childOf:i,service:this.config.service,resource:e,kind:"server",type:"web",meta:{component:"grpc","grpc.method.kind":o.kind,"grpc.method.path":o.path,"grpc.method.name":o.name,"grpc.method.service":o.service,"grpc.method.package":o.package},metrics:{"grpc.status.code":0}});mS(a,r,n,"request")}error(e){let r=this.activeSpan;r&&(this.addCode(r,e.code),this.addError(e))}finish({code:e,trailer:r}={}){let s=this.activeSpan;if(!s)return;let n=this.config.metadataFilter;this.addCode(s,e),r&&n&&mS(s,r,n,"response"),s.finish()}configure(e){let r=lB(e,"metadata");return super.configure({...e,metadataFilter:r})}addCode(e,r){r!==void 0&&e.setTag("grpc.status.code",r)}};function hB(t,e){return!e||typeof e.getMap!="function"?null:t.extract(pB,e.getMap())}_S.exports=Uu});var SS=p((XZ,vS)=>{"use strict";var fB=ae(),{TEXT_MAP:gB}=fe(),{addMetadataTags:yS,getFilter:mB,getMethodMetadata:_B}=ju(),Hu=class extends fB{static get id(){return"grpc"}static get operation(){return"client:request"}start({metadata:e,path:r,type:s}){let n=this.config.metadataFilter,i=_B(r,s),o=this.startSpan("grpc.client",{service:this.config.service,resource:r,kind:"client",type:"http",meta:{component:"grpc","grpc.method.kind":i.kind,"grpc.method.path":i.path,"grpc.method.name":i.name,"grpc.method.service":i.service,"grpc.method.package":i.package},metrics:{"grpc.status.code":0}});e&&(yS(o,e,n,"request"),bB(this.tracer,o,e))}error(e){let r=this.activeSpan;r&&(this.addCode(r,e.code),this.addError(e))}finish({code:e,metadata:r}){let s=this.activeSpan;if(!s)return;let n=this.config.metadataFilter;this.addCode(s,e),r&&n&&yS(s,r,n,"response"),s.finish()}configure(e){let r=mB(e,"metadata");return super.configure({...e,metadataFilter:r})}addCode(e,r){r!==void 0&&e.setTag("grpc.status.code",r)}};function bB(t,e,r){if(typeof r.set!="function")return;let s={};t.inject(e,gB,s);for(let n in s)r.set(n,s[n])}vS.exports=Hu});var $u=p((QZ,qS)=>{"use strict";var yB=bS(),vB=SS(),SB=ce(),Bu=class extends SB{static get id(){return"grpc"}static get plugins(){return{server:yB,client:vB}}};qS.exports=Bu});var ps=p((ZZ,ES)=>{"use strict";var qB=E(),EB={getFilter(t){if(typeof t.filter=="function")return t.filter;t.hasOwnProperty("filter")&&qB.error("Expected `filter` to be a function. Overriding filter property to default.");let e=t.allowlist||t.whitelist||/.*/,r=t.blocklist||t.blacklist||[];return n=>{let i=s(e,n),o=s(r,n);return i&&!o};function s(n,i){return typeof n=="function"?n(i):n instanceof RegExp?n.test(i):n instanceof Array?n.some(o=>s(o,i)):n===i}}};ES.exports=EB});var TS=p((tee,Gu)=>{"use strict";var TB=require("semver");if(TB.satisfies(process.version,">=14.18.0")){let t=require("net");Gu.exports=t.BlockList}else{let t=require("ipaddr.js");Gu.exports=class{constructor(){this.v4Ranges=[],this.v6Ranges=[]}addSubnet(r,s,n){this[n==="ipv4"?"v4Ranges":"v6Ranges"].push(t.parseCIDR(`${r}/${s}`))}check(r,s){try{let n=t.parse(r);if(s=n.kind(),s==="ipv6"){for(let i of this.v6Ranges)if(n.match(i))return!0;n.isIPv4MappedAddress()&&(n=n.toIPv4Address(),s=n.kind())}if(s==="ipv4"){for(let i of this.v4Ranges)if(n.match(i))return!0}return!1}catch{return!1}}}}});var Fu=p((ree,kS)=>{"use strict";var wB=TS(),IS=require("net"),wS=["x-forwarded-for","x-real-ip","true-client-ip","x-client-ip","x-forwarded","forwarded-for","x-cluster-client-ip","fastly-client-ip","cf-connecting-ip","cf-connecting-ipv6"],xB=["127.0.0.0/8","10.0.0.0/8","172.16.0.0/12","192.168.0.0/16","169.254.0.0/16","::1/128","fec0::/10","fe80::/10","fc00::/7","fd00::/8"],AS=new wB;for(let t of xB){let[e,r]=t.split("/");AS.addSubnet(e,parseInt(r),IS.isIPv6(e)?"ipv6":"ipv4")}function IB(t,e){let r=e.headers;if(t.clientIpHeader){if(!r)return;let n=xS(r[t.clientIpHeader]);return n.public||n.private}let s;if(r)for(let n=0;n<wS.length;n++){let i=xS(r[wS[n]]);if(i.public)return i.public;!s&&i.private&&(s=i.private)}return s||e.socket&&e.socket.remoteAddress}function xS(t){let e={};if(!t)return e;let r=t.split(",");for(let s=0;s<r.length;s++){let n=r[s].trim(),i=IS.isIP(n);if(i){if(!AS.check(n,i===6?"ipv6":"ipv4")){e.public=n;break}e.private||(e.private=n)}}return e}kS.exports={extractIp:IB}});var K=p((see,MS)=>{"use strict";var AB=require("lodash.uniq"),RS=$e(),kB="http_headers",ar=E(),V=B(),RB=fa(),CB=Sn(),OB=ps(),{extractIp:PB}=Fu(),{ERROR_MESSAGE:CS,ERROR_TYPE:NB,ERROR_STACK:DB}=A(),MB=RB.WEB,LB=CB.SERVER,NS=V.RESOURCE_NAME,jB=V.SERVICE_NAME,UB=V.SPAN_TYPE,HB=V.SPAN_KIND,BB=V.ERROR,$B=V.HTTP_METHOD,GB=V.HTTP_URL,FB=V.HTTP_STATUS_CODE,DS=V.HTTP_ROUTE,zB=V.HTTP_REQUEST_HEADERS,WB=V.HTTP_RESPONSE_HEADERS,VB=V.HTTP_USERAGENT,OS=V.HTTP_CLIENT_IP,KB=V.MANUAL_DROP,YB=":authority",JB=":scheme",XB=":path",D=new WeakMap,zu=new WeakMap,Re={normalizeConfig(t){let e=a$(t),r=c$(t),s=u$(t),n=OB.getFilter(t),i=p$(t),o=l$(t);return{...t,headers:e,validateStatus:r,hooks:s,filter:n,middleware:i,queryStringObfuscation:o}},setFramework(t,e,r){let n=this.patch(t).span;n&&(n.context()._name=`${e}.request`,n.context()._tags.component=e,Re.setConfig(t,r))},setConfig(t,e){let r=D.get(t),s=r.span;r.config=e,e.filter(t.url)||(s.setTag(KB,!0),s.context()._trace.isRecording=!1),e.service&&s.setTag(jB,e.service),RS.sample(s,e.measured,!0)},startSpan(t,e,r,s,n){let i=this.patch(r),o;return i.span?(i.span.context()._name=n,o=i.span):o=Re.startChildSpan(t,n,r.headers),i.tracer=t,i.span=o,i.res=s,this.setConfig(r,e),o},wrap(t){let e=D.get(t);e.instrumented||(this.wrapEnd(e),e.instrumented=!0)},instrument(t,e,r,s,n,i){let o=this.startSpan(t,e,r,s,n);return this.wrap(r),i&&t.scope().activate(o,()=>i(o))},reactivate(t,e){return e$(t,e)},enterRoute(t,e){typeof e=="string"&&D.get(t).paths.push(e)},setRoute(t,e){let r=D.get(t);r&&(r.paths=[e])},exitRoute(t){D.get(t).paths.pop()},wrapMiddleware(t,e,r,s){if(!this.active(t))return s();let n=D.get(t),i=n.tracer,o=this.active(t),a=n.config;if(a.middleware===!1)return this.bindAndWrapMiddlewareErrors(s,t,i,o);let c=i.startSpan(r,{childOf:o});return RS.sample(c,a.measured),c.addTags({[NS]:e._name||e.name||"<anonymous>"}),n.middleware.push(c),i.scope().activate(c,s)},bindAndWrapMiddlewareErrors(t,e,r,s){try{return r.scope().bind(t,s).apply(this,arguments)}catch(n){throw Re.addError(e,n),n}},finish(t,e){if(!this.active(t))return;let s=D.get(t).middleware.pop();s&&(e&&s.addTags({[NB]:e.name,[CS]:e.message,[DB]:e.stack}),s.finish())},beforeEnd(t,e){D.get(t).beforeEnd.push(e)},patch(t){let e=D.get(t);return e||(e=t.stream&&D.get(t.stream),e?(D.set(t,e),e):(e={req:t,span:null,paths:[],middleware:[],beforeEnd:[],config:{}},D.set(t,e),e))},root(t){let e=D.get(t);return e?e.span:null},active(t){let e=D.get(t);return e?e.middleware.length===0?e.span||null:e.middleware.slice(-1)[0]:null},startChildSpan(t,e,r){let s=t.extract(kB,r);return t.startSpan(e,{childOf:s})},addStatusError(t,e){let r=D.get(t),s=r.span,n=r.error;!(s.context()._tags.error||s.context()._tags[CS])&&!r.config.validateStatus(e)&&s.setTag(BB,n||!0)},addError(t,e){if(e instanceof Error){let r=D.get(t);r&&(r.error=e)}},finishMiddleware(t){if(t.finished)return;let e;for(;e=t.middleware.pop();)e.finish()},finishSpan(t){let{req:e,res:r}=t;t.finished&&!e.stream||(t$(t),r$(t),t.config.hooks.request(t.span,e,r),s$(t),t.span.finish(),t.finished=!0)},finishAll(t){for(let e of t.beforeEnd)e();Re.finishMiddleware(t),Re.finishSpan(t)},obfuscateQs(t,e){let{queryStringObfuscation:r}=t;if(r===!1)return e;let s=e.indexOf("?");if(s===-1)return e;let n=e.slice(0,s);if(r===!0)return n;let i=e.slice(s+1);return i=i.replace(r,"<redacted>"),`${n}?${i}`},wrapWriteHead(t){let{req:e,res:r}=t,s=r.writeHead;return function(n,i,o){return o=typeof i=="string"?o:i,o=Object.assign(r.getHeaders(),o),e.method.toLowerCase()==="options"&&ZB(e,o)&&QB(e,r,o),s.apply(this,arguments)}},getContext(t){return D.get(t)},wrapRes(t,e,r,s){return function(){return Re.finishAll(t),s.apply(r,arguments)}},wrapEnd(t){let e=t.tracer.scope(),r=t.req,s=t.res,n=s.end;s.writeHead=Re.wrapWriteHead(t),zu.set(s,this.wrapRes(t,r,s,n)),Object.defineProperty(s,"end",{configurable:!0,get(){return zu.get(this)},set(i){zu.set(this,e.bind(i,t.span))}})}};function QB(t,e,r){let s=PS(r["access-control-allow-headers"]),n=PS(t.headers["access-control-request-headers"]),i=["x-datadog-origin","x-datadog-parent-id","x-datadog-sampled","x-datadog-sampling-priority","x-datadog-trace-id","x-datadog-tags"];for(let o of i)~n.indexOf(o)&&s.push(o);s.length>0&&e.setHeader("access-control-allow-headers",AB(s).join(","))}function ZB(t,e){let r=t.headers.origin,s=e["access-control-allow-origin"];return r&&(s==="*"||s===r)}function PS(t){return typeof t=="string"?t.split(/\s*,\s*/):[]}function e$(t,e){let r=D.get(t);return r?r.tracer.scope().activate(r.span,e):e()}function t$(t){let{req:e,span:r,config:s}=t,n=i$(e);if(r.addTags({[GB]:Re.obfuscateQs(s,n),[$B]:e.method,[HB]:LB,[UB]:MB,[VB]:e.headers["user-agent"]}),s.clientIpEnabled&&!r.context()._tags.hasOwnProperty(OS)){let i=PB(s,e);i&&r.setTag(OS,i)}n$(t)}function r$(t){let{req:e,res:r,paths:s,span:n}=t;s.length>0&&n.setTag(DS,s.join("")),n.addTags({[FB]:r.statusCode}),Re.addStatusError(e,r.statusCode)}function s$(t){let{req:e,span:r}=t,s=r.context()._tags;if(s["resource.name"])return;let n=[e.method,s[DS]].filter(i=>i).join(" ");r.setTag(NS,n)}function n$(t){let{req:e,res:r,config:s,span:n}=t;s.headers.forEach(i=>{let o=e.headers[i],a=r.getHeader(i);o&&n.setTag(`${zB}.${i}`,o),a&&n.setTag(`${WB}.${i}`,a)})}function i$(t){let e=t.headers;return t.stream?`${e[JB]}://${e[YB]}${e[XB]}`:`${o$(t)}://${t.headers.host}${t.originalUrl||t.url}`}function o$(t){return t.socket&&t.socket.encrypted||t.connection&&t.connection.encrypted?"https":"http"}function a$(t){if(Array.isArray(t.headers))try{return t.headers.map(e=>e.toLowerCase())}catch(e){ar.error(e)}else t.hasOwnProperty("headers")&&ar.error("Expected `headers` to be an array of strings.");return[]}function c$(t){return typeof t.validateStatus=="function"?t.validateStatus:(t.hasOwnProperty("validateStatus")&&ar.error("Expected `validateStatus` to be a function."),e=>e<500)}function u$(t){let e=()=>{};return{request:t.hooks&&t.hooks.request||e}}function p$(t){return t&&typeof t.middleware=="boolean"?t.middleware:(t&&t.hasOwnProperty("middleware")&&ar.error("Expected `middleware` to be a boolean."),!0)}function l$(t){let e=t.queryStringObfuscation;if(typeof e=="boolean")return e;if(typeof e=="string"){if(e==="")return!1;if(e===".*")return!0;try{return new RegExp(e,"gi")}catch(r){ar.error(r)}}return t.hasOwnProperty("queryStringObfuscation")&&ar.error("Expected `queryStringObfuscation` to be a regex string or boolean."),!0}MS.exports=Re});var US=p((nee,jS)=>{"use strict";var d$=N(),LS=K(),Wu=class extends d${static get id(){return"web"}configure(e){return super.configure(LS.normalizeConfig(e))}setFramework(e,r,s){LS.setFramework(e,r,s)}};jS.exports=Wu});var Ce=p((iee,BS)=>{"use strict";var Vu=K(),h$=US(),f$=$e(),{storage:HS}=I(),{COMPONENT:g$}=A(),Ku=class extends h${static get id(){return"router"}constructor(...e){super(...e),this._storeStack=[],this._contexts=new WeakMap,this.addSub(`apm:${this.constructor.id}:middleware:enter`,({req:r,name:s,route:n})=>{let i=this._getActive(r)||this._getStoreSpan();if(!i)return;let o=this._getMiddlewareSpan(s,i),a=this._createContext(r,n,i);i!==o&&a.middleware.push(o);let c=HS.getStore();this._storeStack.push(c),this.enter(o,c),Vu.patch(r),Vu.setRoute(r,a.route)}),this.addSub(`apm:${this.constructor.id}:middleware:next`,({req:r})=>{let s=this._contexts.get(r);s&&s.stack.pop()}),this.addSub(`apm:${this.constructor.id}:middleware:finish`,({req:r})=>{let s=this._contexts.get(r);!s||s.middleware.length===0||s.middleware.pop().finish()}),this.addSub(`apm:${this.constructor.id}:middleware:exit`,({req:r})=>{let s=this._storeStack.pop(),n=s&&s.span;this.enter(n,s)}),this.addSub(`apm:${this.constructor.id}:middleware:error`,({req:r,error:s})=>{if(Vu.addError(r,s),!this.config.middleware)return;let n=this._getActive(r);n&&n.setTag("error",s)}),this.addSub("apm:http:server:request:finish",({req:r})=>{let s=this._contexts.get(r);if(!s)return;let n;for(;n=s.middleware.pop();)n.finish()})}_getActive(e){let r=this._contexts.get(e);if(r)return r.middleware.length===0?r.span:r.middleware[r.middleware.length-1]}_getStoreSpan(){let e=HS.getStore();return e&&e.span}_getMiddlewareSpan(e,r){if(this.config.middleware===!1)return r;let s=this.tracer.startSpan(`${this.constructor.id}.middleware`,{childOf:r,tags:{[g$]:this.constructor.id,"resource.name":e||"<anonymous>"}});return f$.sample(s,this.config.measured),s}_createContext(e,r,s){let n=this._contexts.get(e);return(!r||r==="/"||r==="*")&&(r=""),n?(n.stack.push(r),r=n.stack.join(""),r.length>n.route.length&&(n.route=r)):(n={span:s,stack:[r],route:r,middleware:[]},this._contexts.set(e,n)),n}};BS.exports=Ku});var Ju=p((oee,$S)=>{"use strict";var{storage:m$}=I(),_$=Ce(),b$=K(),Yu=class extends _${static get id(){return"hapi"}constructor(...e){super(...e),this._requestSpans=new WeakMap,this.addSub("apm:hapi:request:handle",({req:r})=>{let s=m$.getStore(),n=s&&s.span;this.setFramework(r,"hapi",this.config),this._requestSpans.set(r,n)}),this.addSub("apm:hapi:request:route",({req:r,route:s})=>{b$.setRoute(r,s)}),this.addSub("apm:hapi:request:error",r=>{(!r||!r.isBoom||!this.config.validateStatus(r.output.statusCode))&&this.addError(r)}),this.addSub("apm:hapi:extension:enter",({req:r})=>{this.enter(this._requestSpans.get(r))})}};$S.exports=Yu});var ht=p((aee,FS)=>{var y$=cs(),{storage:Xu}=I(),{TEST_STATUS:cr,JEST_TEST_RUNNER:v$,finishAllTraceSpans:ni,getTestSuiteCommonTags:S$,addIntelligentTestRunnerSpanTags:q$,TEST_PARAMETERS:E$,TEST_COMMAND:T$,TEST_FRAMEWORK_VERSION:w$,TEST_SOURCE_START:x$}=ve(),{COMPONENT:I$}=A(),ls=de(),GS=!!process.env.JEST_WORKER_ID,A$=2,Qu=class extends y${static get id(){return"jest"}constructor(...e){if(super(...e),GS){let r=([s])=>{s===A$&&(this.testSuiteSpan&&(this.testSuiteSpan.finish(),ni(this.testSuiteSpan)),this.tracer._exporter.flush(),process.removeListener("message",r))};process.on("message",r)}this.addSub("ci:jest:session:finish",({status:r,isSuitesSkipped:s,isSuitesSkippingEnabled:n,isCodeCoverageEnabled:i,testCodeCoverageLinesTotal:o})=>{this.testSessionSpan.setTag(cr,r),this.testModuleSpan.setTag(cr,r),q$(this.testSessionSpan,this.testModuleSpan,{isSuitesSkipped:s,isSuitesSkippingEnabled:n,isCodeCoverageEnabled:i,testCodeCoverageLinesTotal:o}),this.testModuleSpan.finish(),this.testSessionSpan.finish(),ni(this.testSessionSpan),this.tracer._exporter.flush()}),this.addSub("ci:jest:session:configuration",r=>{r.forEach(s=>{s._ddTestSessionId=this.testSessionSpan.context().toTraceId(),s._ddTestModuleId=this.testModuleSpan.context().toSpanId(),s._ddTestCommand=this.testSessionSpan.context()._tags[T$]})}),this.addSub("ci:jest:test-suite:start",({testSuite:r,testEnvironmentOptions:s,frameworkVersion:n})=>{let{_ddTestSessionId:i,_ddTestCommand:o,_ddTestModuleId:a}=s,c=this.tracer.extract("text_map",{"x-datadog-trace-id":i,"x-datadog-parent-id":a}),u=S$(o,n,r,"jest");this.testSuiteSpan=this.tracer.startSpan("jest.test_suite",{childOf:c,tags:{[I$]:this.constructor.id,...this.testEnvironmentMetadata,...u}})}),this.addSub("ci:jest:worker-report:trace",r=>{JSON.parse(r).map(n=>n.map(i=>({...i,span_id:ls(i.span_id),trace_id:ls(i.trace_id),parent_id:ls(i.parent_id)}))).forEach(n=>{this.tracer._exporter.export(n)})}),this.addSub("ci:jest:worker-report:coverage",r=>{JSON.parse(r).map(n=>({traceId:ls(n.traceId),spanId:ls(n.spanId),files:n.files})).forEach(n=>{this.tracer._exporter.exportCoverage(n)})}),this.addSub("ci:jest:test-suite:finish",({status:r,errorMessage:s})=>{this.testSuiteSpan.setTag(cr,r),s&&this.testSuiteSpan.setTag("error",new Error(s)),this.testSuiteSpan.finish(),ni(this.testSuiteSpan),GS&&this.tracer._exporter.flush()}),this.addSub("ci:jest:test-suite:code-coverage",r=>{let s={traceId:this.testSuiteSpan.context()._traceId,spanId:this.testSuiteSpan.context()._spanId,files:r};this.tracer._exporter.exportCoverage(s)}),this.addSub("ci:jest:test:start",r=>{let s=Xu.getStore(),n=this.startTestSpan(r);this.enter(n,s)}),this.addSub("ci:jest:test:finish",r=>{let s=Xu.getStore().span;s.setTag(cr,r),s.finish(),ni(s)}),this.addSub("ci:jest:test:err",r=>{if(r){let s=Xu.getStore();if(s&&s.span){let n=s.span;n.setTag(cr,"fail"),n.setTag("error",r)}}}),this.addSub("ci:jest:test:skip",r=>{let s=this.startTestSpan(r);s.setTag(cr,"skip"),s.finish()})}startTestSpan(e){let{suite:r,name:s,runner:n,testParameters:i,frameworkVersion:o,testStartLine:a}=e,c={[v$]:n,[E$]:i,[w$]:o,[x$]:a};return super.startTestSpan(s,r,this.testSuiteSpan,c)}};FS.exports=Qu});var ii=p((cee,zS)=>{"use strict";var k$=Ce(),R$=K(),Zu=class extends k${static get id(){return"koa"}constructor(...e){super(...e),this.addSub("apm:koa:request:handle",({req:r})=>{this.setFramework(r,"koa",this.config)}),this.addSub("apm:koa:request:route",({req:r,route:s})=>{R$.setRoute(r,s)})}};zS.exports=Zu});var tp=p((uee,WS)=>{"use strict";var C$=wu(),ep=class extends C${static get operation(){return"command"}};WS.exports=ep});var ds=p((pee,KS)=>{"use strict";var{CLIENT_PORT_KEY:O$}=A(),P$=tp(),N$=ps(),rp=class extends P${static get id(){return"redis"}static get system(){return"redis"}start({db:e,command:r,args:s,connectionOptions:n={},connectionName:i}){let o=r,a=r.toUpperCase();if(!this.config.filter(a))return this.skip();this.startSpan("redis.command",{service:D$(this.config,i),resource:o,type:"redis",kind:"client",meta:{"db.type":"redis","db.name":e||"0","redis.raw_command":M$(a,s),"out.host":n.host,[O$]:n.port}})}configure(e){super.configure(j$(e))}};function D$(t,e){return t.splitByInstance&&e?t.service?`${t.service}-${e}`:e:t.service}function M$(t,e){if(!e||t==="AUTH")return t;for(let r=0,s=e.length;r<s;r++)if(typeof e[r]!="function"&&(t=`${t} ${L$(e[r])}`,t.length>1e3))return VS(t,1e3);return t}function L$(t){switch(typeof t){case"string":case"number":return VS(String(t),100);default:return"?"}}function VS(t,e){return t.length>e&&(t=t.substr(0,e-3)+"..."),t}function j$(t){t.allowlist&&oi(t.allowlist),t.whitelist&&oi(t.whitelist),t.blocklist&&oi(t.blocklist),t.blacklist&&oi(t.blacklist);let e=N$.getFilter(t);return Object.assign({},t,{filter:e})}function oi(t){for(let e=0;e<t.length;e++)t[e]=String(t[e]).toUpperCase()}KS.exports=rp});var JS=p((lee,YS)=>{"use strict";var U$=us(),sp=class extends U${static get id(){return"opensearch"}};YS.exports=sp});var np=p((dee,XS)=>{"use strict";function H$(t){return!t||!t.session||!t.session.connection?{}:t.session.connection.address||{}}function B$(t){return!t||!t.name?null:t.name.split("_").slice(0,-1).join("_")}XS.exports={getAddress:H$,getShortName:B$}});var ZS=p((hee,QS)=>{"use strict";var $$=ir(),{CLIENT_PORT_KEY:G$}=A(),{getAddress:F$,getShortName:z$}=np(),ip=class extends $${static get id(){return"amqp10"}static get operation(){return"send"}static get system(){return"amqp"}start({link:e}){let r=F$(e),s=z$(e);this.startSpan("amqp.send",{service:this.config.service||`${this.tracer._service}-amqp`,resource:["send",s].filter(n=>n).join(" "),kind:"producer",meta:{"amqp.link.target.address":s,"amqp.link.role":"sender","out.host":r.host,[G$]:r.port,"amqp.link.name":e.name,"amqp.link.handle":e.handle,"amqp.connection.host":r.host,"amqp.connection.port":r.port,"amqp.connection.user":r.user}})}};QS.exports=ip});var tq=p((fee,eq)=>{"use strict";var W$=or(),{getAddress:V$,getShortName:K$}=np(),op=class extends W${static get id(){return"amqp10"}static get system(){return"amqp"}start({link:e}){let r=K$(e),s=V$(e);this.startSpan("amqp.receive",{service:this.config.service||`${this.tracer._service}-amqp`,resource:["receive",r].filter(n=>n).join(" "),type:"worker",kind:"consumer",meta:{"amqp.link.source.address":r,"amqp.link.role":"receiver","amqp.link.name":e.name,"amqp.link.handle":e.handle,"amqp.connection.host":s.host,"amqp.connection.port":s.port,"amqp.connection.user":s.user}})}};eq.exports=op});var sq=p((gee,rq)=>{"use strict";var Y$=ZS(),J$=tq(),X$=ce(),ap=class extends X${static get id(){return"amqp10"}static get plugins(){return{producer:Y$,consumer:J$}}};rq.exports=ap});var ai=p((mee,nq)=>{"use strict";function Q$(t,e={}){return[t,e.exchange,e.routingKey,e.queue,e.source,e.destination].filter(r=>r).join(" ")}nq.exports={getResourceName:Q$}});var oq=p((_ee,iq)=>{"use strict";var{TEXT_MAP:Z$}=fe(),{CLIENT_PORT_KEY:eG}=A(),tG=ir(),{getResourceName:rG}=ai(),cp=class extends tG{static get id(){return"amqplib"}static get operation(){return"command"}start({channel:e={},method:r,fields:s}){if(r!=="basic.publish")return;let n=e.connection&&e.connection.stream||{},i=this.startSpan("amqp.command",{service:this.config.service||`${this.tracer._service}-amqp`,resource:rG(r,s),kind:"producer",meta:{"out.host":n._host,[eG]:n.remotePort,"amqp.queue":s.queue,"amqp.exchange":s.exchange,"amqp.routingKey":s.routingKey,"amqp.consumerTag":s.consumerTag,"amqp.source":s.source,"amqp.destination":s.destination}});s.headers=s.headers||{},this.tracer.inject(i,Z$,s.headers)}};iq.exports=cp});var cq=p((bee,aq)=>{"use strict";var{TEXT_MAP:sG}=fe(),nG=or(),{getResourceName:iG}=ai(),up=class extends nG{static get id(){return"amqplib"}static get operation(){return"command"}start({method:e,fields:r,message:s}){if(e!=="basic.deliver"&&e!=="basic.get")return;let n=oG(this.tracer,s);this.startSpan("amqp.command",{childOf:n,service:this.config.service||`${this.tracer._service}-amqp`,resource:iG(e,r),kind:"consumer",type:"worker",meta:{"amqp.queue":r.queue,"amqp.exchange":r.exchange,"amqp.routingKey":r.routingKey,"amqp.consumerTag":r.consumerTag,"amqp.source":r.source,"amqp.destination":r.destination}})}};function oG(t,e){return e?t.extract(sG,e.properties.headers):null}aq.exports=up});var pq=p((yee,uq)=>{"use strict";var{TEXT_MAP:aG}=fe(),{CLIENT_PORT_KEY:cG}=A(),uG=ae(),{getResourceName:pG}=ai(),pp=class extends uG{static get id(){return"amqplib"}static get operation(){return"command"}start({channel:e={},method:r,fields:s}){if(r==="basic.deliver"||r==="basic.get"||r==="basic.publish")return;let n=e.connection&&e.connection.stream||{},i=this.startSpan("amqp.command",{service:this.config.service||`${this.tracer._service}-amqp`,resource:pG(r,s),kind:"client",meta:{"out.host":n._host,[cG]:n.remotePort,"amqp.queue":s.queue,"amqp.exchange":s.exchange,"amqp.routingKey":s.routingKey,"amqp.consumerTag":s.consumerTag,"amqp.source":s.source,"amqp.destination":s.destination}});s.headers=s.headers||{},this.tracer.inject(i,aG,s.headers)}};uq.exports=pp});var dq=p((vee,lq)=>{"use strict";var lG=oq(),dG=cq(),hG=pq(),fG=ce(),lp=class extends fG{static get id(){return"amqplib"}static get plugins(){return{producer:lG,consumer:dG,client:hG}}};lq.exports=lp});var hs=p((qee,fq)=>{"use strict";var{LOG:gG}=fe(),mG=N(),{storage:_G}=I(),bG=(t,e)=>Object.prototype.hasOwnProperty.call(t,e);function yG(t,e){return new Proxy(t,{get(r,s,n){return s===Symbol.toStringTag?Object.prototype.toString.call(r).slice(8,-1):hq(r,s)?e.dd:Reflect.get(r,s,n)},ownKeys(r){let s=Reflect.ownKeys(r);return bG(r,"dd")||!Reflect.isExtensible(r)?s:["dd",...s]},getOwnPropertyDescriptor(r,s){return Reflect.getOwnPropertyDescriptor(hq(r,s)?e:r,s)}})}function hq(t,e){return e==="dd"&&!Reflect.has(t,e)&&Reflect.isExtensible(t)}fq.exports=class extends mG{constructor(...e){super(...e),this.addSub(`apm:${this.constructor.id}:log`,r=>{let s=_G.getStore(),n=s&&s.span,i={};this.tracer.inject(n,gG,i),r.message=yG(r.message,i)})}configure(e){return super.configure({...e,enabled:e.enabled&&e.logInjection})}}});var mq=p((Eee,gq)=>{"use strict";var vG=hs(),dp=class extends vG{static get id(){return"bunyan"}};gq.exports=dp});var bq=p((Tee,_q)=>{"use strict";var{CLIENT_PORT_KEY:SG}=A(),qG=dt(),hp=class extends qG{static get id(){return"cassandra-driver"}static get system(){return"cassandra"}start({keyspace:e,query:r,connectionOptions:s={}}){Array.isArray(r)&&(r=EG(r)),this.startSpan("cassandra.query",{service:this.config.service,resource:TG(r,5e3),type:"cassandra",kind:"client",meta:{"db.type":"cassandra","cassandra.query":r,"cassandra.keyspace":e,"out.host":s.host,[SG]:s.port}})}};function EG(t){return t.map(e=>(e.query||e).replace(/;?$/,";")).join(" ")}function TG(t,e){return!t||t.length<=e?t:`${t.substr(0,e-3)}...`}_q.exports=hp});var vq=p((wee,yq)=>{"use strict";var wG=Ce(),fp=class extends wG{static get id(){return"connect"}constructor(...e){super(...e),this.addSub("apm:connect:request:handle",({req:r})=>{this.setFramework(r,"connect",this.config)})}};yq.exports=fp});var qq=p((xee,Sq)=>{"use strict";var xG=N(),{storage:gp}=I(),IG=$e(),mp=class extends xG{static get id(){return"couchbase"}addSubs(e,r,s=AG){this.addSub(`apm:couchbase:${e}:start`,r),this.addSub(`apm:couchbase:${e}:error`,this.addError),this.addSub(`apm:couchbase:${e}:finish`,s)}startSpan(e,r,s,{bucket:n,collection:i}){let o={"db.type":"couchbase",component:"couchbase","service.name":this.config.service||`${this.tracer._service}-couchbase`,"resource.name":`couchbase.${e}`,"span.kind":"client"};for(let c in r)o[c]=r[c];let a=this.tracer.startSpan(`couchbase.${e}`,{childOf:s?s.span:null,tags:o});return n&&a.setTag("couchbase.bucket.name",n.name),i&&a.setTag("couchbase.collection.name",i.name),IG.sample(a,this.config.measured),a}constructor(...e){super(...e),this.addSubs("query",({resource:r,bucket:s})=>{let n=gp.getStore(),i=this.startSpan("query",{"span.type":"sql","resource.name":r},n,{bucket:s});this.enter(i,n)}),this._addCommandSubs("upsert"),this._addCommandSubs("insert"),this._addCommandSubs("replace"),this._addCommandSubs("append"),this._addCommandSubs("prepend")}_addCommandSubs(e){this.addSubs(e,({bucket:r,collection:s})=>{let n=gp.getStore(),i=this.startSpan(e,{},n,{bucket:r,collection:s});this.enter(i,n)})}};function AG(){gp.getStore().span.finish()}Sq.exports=mp});var Tq=p((Iee,Eq)=>{var kG=N(),_p=class extends kG{static get id(){return"cypress"}};Eq.exports=_p});var xq=p((Aee,wq)=>{"use strict";var RG=ae(),bp=class extends RG{static get id(){return"dns"}static get operation(){return"lookup"}start([e]){this.startSpan("dns.lookup",{service:this.config.service,resource:e,kind:"client",meta:{"dns.hostname":e,"dns.address":"","dns.addresses":""}})}finish(e){let r=this.activeSpan;if(Array.isArray(e)){let s=Array.isArray(e)?e.map(n=>n.address).sort():[e];r.setTag("dns.address",s[0]),r.setTag("dns.addresses",s.join(","))}else r.setTag("dns.address",e);r.finish()}};wq.exports=bp});var Aq=p((kee,Iq)=>{"use strict";var CG=ae(),yp=class extends CG{static get id(){return"dns"}static get operation(){return"lookup_service"}start([e,r]){this.startSpan("dns.lookup_service",{service:this.config.service,resource:`${e}:${r}`,kind:"client",meta:{"dns.address":e},metrics:{"dns.port":r}})}};Iq.exports=yp});var Rq=p((Ree,kq)=>{"use strict";var OG=ae(),vp=class extends OG{static get id(){return"dns"}static get operation(){return"resolve"}start([e,r]){let s=typeof r=="string"?r:"A";this.startSpan("dns.resolve",{service:this.config.service,resource:`${s} ${e}`,kind:"client",meta:{"dns.hostname":e,"dns.rrtype":s}})}};kq.exports=vp});var Oq=p((Cee,Cq)=>{"use strict";var PG=ae(),Sp=class extends PG{static get id(){return"dns"}static get operation(){return"reverse"}start([e]){this.startSpan("dns.reverse",{service:this.config.service,resource:e,kind:"client",meta:{"dns.ip":e}})}};Cq.exports=Sp});var Nq=p((Oee,Pq)=>{"use strict";var NG=ce(),DG=xq(),MG=Aq(),LG=Rq(),jG=Oq(),qp=class extends NG{static get id(){return"dns"}static get plugins(){return{lookup:DG,lookup_service:MG,resolve:LG,reverse:jG}}};Pq.exports=qp});var Mq=p((Pee,Dq)=>{"use strict";var UG=Ce(),Ep=class extends UG{static get id(){return"express"}constructor(...e){super(...e),this.addSub("apm:express:request:handle",({req:r})=>{this.setFramework(r,"express",this.config)})}};Dq.exports=Ep});var jq=p((Nee,Lq)=>{"use strict";var HG=Ce(),Tp=class extends HG{static get id(){return"fastify"}constructor(...e){super(...e),this.addSub("apm:fastify:request:handle",({req:r})=>{this.setFramework(r,"fastify",this.config)})}};Lq.exports=Tp});var Hq=p((Dee,Uq)=>{"use strict";var BG=N(),$G=K(),wp=class extends BG{static get id(){return"find-my-way"}constructor(...e){super(...e),this.addSub("apm:find-my-way:request:route",({req:r,route:s})=>{$G.setRoute(r,s)})}};Uq.exports=wp});var $q=p(Oe=>{"use strict";var GG=Oe&&Oe.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(Oe,"__esModule",{value:!0});var fs=require("graphql/language/visitor"),FG=require("graphql/language/printer"),zG=require("graphql/utilities"),Bq=GG(require("lodash.sortby"));function WG(t){return fs.visit(t,{IntValue(e){return Object.assign({},e,{value:"0"})},FloatValue(e){return Object.assign({},e,{value:"0"})},StringValue(e){return Object.assign({},e,{value:"",block:!1})},ListValue(e){return Object.assign({},e,{values:[]})},ObjectValue(e){return Object.assign({},e,{fields:[]})}})}Oe.hideLiterals=WG;function VG(t){return fs.visit(t,{IntValue(e){return Object.assign({},e,{value:"0"})},FloatValue(e){return Object.assign({},e,{value:"0"})},StringValue(e){return Object.assign({},e,{value:"",block:!1})}})}Oe.hideStringAndNumericLiterals=VG;function KG(t,e){let r=zG.separateOperations(t)[e];return r||t}Oe.dropUnusedDefinitions=KG;function Nt(t){if(t)return Bq.default.apply(null,arguments)}function YG(t){return fs.visit(t,{OperationDefinition(e){return Object.assign({},e,{variableDefinitions:Nt(e.variableDefinitions,"variable.name.value")})},SelectionSet(e){return Object.assign({},e,{selections:Bq.default(e.selections,"kind","name.value")})},Field(e){return Object.assign({},e,{arguments:Nt(e.arguments,"name.value")})},FragmentSpread(e){return Object.assign({},e,{directives:Nt(e.directives,"name.value")})},InlineFragment(e){return Object.assign({},e,{directives:Nt(e.directives,"name.value")})},FragmentDefinition(e){return Object.assign({},e,{directives:Nt(e.directives,"name.value"),variableDefinitions:Nt(e.variableDefinitions,"variable.name.value")})},Directive(e){return Object.assign({},e,{arguments:Nt(e.arguments,"name.value")})}})}Oe.sortAST=YG;function JG(t){return fs.visit(t,{Field(e){return Object.assign({},e,{alias:void 0})}})}Oe.removeAliases=JG;function XG(t){let e=fs.visit(t,{StringValue(n){return Object.assign({},n,{value:Buffer.from(n.value,"utf8").toString("hex"),block:!1})}});return FG.print(e).replace(/\s+/g," ").replace(/([^_a-zA-Z0-9]) /g,(n,i)=>i).replace(/ ([^_a-zA-Z0-9])/g,(n,i)=>i).replace(/"([a-f0-9]+)"/g,(n,i)=>JSON.stringify(Buffer.from(i,"hex").toString("utf8")))}Oe.printWithReducedWhitespace=XG});var Gq=p(xp=>{"use strict";Object.defineProperty(xp,"__esModule",{value:!0});var gs=$q();function QG(t,e){return gs.printWithReducedWhitespace(gs.sortAST(gs.removeAliases(gs.hideLiterals(gs.dropUnusedDefinitions(t,e)))))}xp.defaultEngineReportingSignature=QG});var Fq=p(Ip=>{"use strict";Object.defineProperty(Ip,"__esModule",{value:!0});var ZG=Gq();Ip.defaultEngineReportingSignature=ZG.defaultEngineReportingSignature});var Wq=p((Uee,zq)=>{"use strict";var eF=Pt(),ms,Ap=class extends eF{static get id(){return"graphql"}static get operation(){return"execute"}start({operation:e,args:r,docSource:s}){let n=e&&e.operation,i=e&&e.name&&e.name.value,o=r.document,a=this.config.source&&o&&s,c=this.startSpan("graphql.execute",{service:this.config.service,resource:rF(o,i,n,this.config.signature),kind:"server",type:"graphql",meta:{"graphql.operation.type":n,"graphql.operation.name":i,"graphql.source":a}});tF(this.config,c,r.variableValues)}finish({res:e,args:r}){let s=this.activeSpan;this.config.hooks.execute(s,r,e),s.finish()}};function tF(t,e,r){let s={};if(r&&t.variables){let n=t.variables(r);for(let i in n)s[`graphql.variables.${i}`]=n[i]}e.addTags(s)}function rF(t,e,r,s){if(s!==!1&&ms!==!1)try{try{ms=ms||Fq()}catch(n){throw ms=!1,n}return ms.defaultEngineReportingSignature(t,e)}catch{}return[r,e].filter(n=>n).join(" ")}zq.exports=Ap});var Kq=p((Hee,Vq)=>{"use strict";var sF=Pt(),kp=class extends sF{static get id(){return"graphql"}static get operation(){return"parser"}start(){this.startSpan("graphql.parse",{service:this.config.service,type:"graphql",meta:{"graphql.source":""}})}finish({source:e,document:r,docSource:s}){let n=this.activeSpan;this.config.source&&r&&n.setTag("graphql.source",s),this.config.hooks.parse(n,e,r),n.finish()}};Vq.exports=kp});var Jq=p((Bee,Yq)=>{"use strict";var nF=Pt(),Rp=class extends nF{static get id(){return"graphql"}static get operation(){return"validate"}start({docSource:e,document:r}){let s=this.config.source&&r&&e;this.startSpan("graphql.validate",{service:this.config.service,type:"graphql",meta:{"graphql.source":s}})}finish({document:e,errors:r}){let s=this.activeSpan;this.config.hooks.validate(s,e,r),s.finish()}};Yq.exports=Rp});var tE=p(($ee,eE)=>{"use strict";var iF=Pt(),ci=Symbol("collapsedPaths"),Cp=class extends iF{static get id(){return"graphql"}static get operation(){return"resolve"}start({info:e,context:r}){let s=Qq(e,this.config);if(!Xq(this.config,s))return;let n=s.join(".");if(this.config.collapse){if(r[ci]||(r[ci]={}),r.fields[n]||r[ci][n])return;r[ci][n]=!0}let i=r.source,o=e.fieldNodes.find(l=>l.kind==="Field"),a=this.config.source&&i&&o&&o.loc,c=a&&i.substring(a.start,a.end),u=this.startSpan("graphql.resolve",{service:this.config.service,resource:`${e.fieldName}:${e.returnType}`,type:"graphql",meta:{"graphql.field.name":e.fieldName,"graphql.field.path":n,"graphql.field.type":e.returnType.name,"graphql.source":c}});if(o&&this.config.variables&&o.arguments){let l=this.config.variables(e.variableValues);o.arguments.filter(d=>d.value&&d.value.kind==="Variable").filter(d=>d.value.name&&l[d.value.name.value]).map(d=>d.value.name.value).forEach(d=>{u.setTag(`graphql.variables.${d}`,l[d])})}}finish(e){this.activeSpan.finish(e)}constructor(...e){super(...e),this.addTraceSub("updateField",({field:r,info:s,err:n})=>{let i=Qq(s,this.config);if(!Xq(this.config,i))return;let o=this.activeSpan;r.finishTime=o._getTime?o._getTime():0,r.error=r.error||n})}configure(e){super.configure(e.depth===0?!1:e)}};function Xq(t,e){let r=e.filter(s=>typeof s=="string").length;return t.depth<0||t.depth>=r}function Qq(t,e){return(e.collapse?oF(Zq):Zq)(t&&t.path)}function Zq(t){let e=[],r=t;for(;r;)e.push(r.key),r=r.prev;return e.reverse()}function oF(t){return function(){return t.apply(this,arguments).map(e=>typeof e=="number"?"*":e)}}eE.exports=Cp});var nE=p((Gee,sE)=>{"use strict";var aF=ce(),rE=E(),cF=Wq(),uF=Kq(),pF=Jq(),lF=tE(),Op=class extends aF{static get id(){return"graphql"}static get plugins(){return{execute:cF,parse:uF,validate:pF,resolve:lF}}configure(e){return super.configure(dF(e))}};function dF(t){return Object.assign({},t,{depth:hF(t),variables:fF(t),collapse:t.collapse===void 0||!!t.collapse,hooks:gF(t)})}function hF(t){return typeof t.depth=="number"?t.depth:(t.hasOwnProperty("depth")&&rE.error("Expected `depth` to be a integer."),-1)}function fF(t){return typeof t.variables=="function"?t.variables:t.variables instanceof Array?e=>mF(e,t.variables):(t.hasOwnProperty("variables")&&rE.error("Expected `variables` to be an array or function."),null)}function gF(t){let e=()=>{},r=t.hooks&&t.hooks.execute||e,s=t.hooks&&t.hooks.parse||e,n=t.hooks&&t.hooks.validate||e;return{execute:r,parse:s,validate:n}}function mF(t,e){return Object.fromEntries(Object.entries(t).filter(([r])=>e.includes(r)))}sE.exports=Op});var ui=p((Fee,oE)=>{"use strict";var iE=H();oE.exports={incomingHttpRequestStart:iE.channel("dd-trace:incomingHttpRequestStart"),incomingHttpRequestEnd:iE.channel("dd-trace:incomingHttpRequestEnd")}});var pE=p((zee,uE)=>{"use strict";var _F=N(),{storage:bF}=I(),Dt=K(),{incomingHttpRequestStart:aE,incomingHttpRequestEnd:cE}=ui(),{COMPONENT:yF}=A(),Pp=class extends _F{static get id(){return"http"}constructor(...e){super(...e),this._parentStore=void 0,this.addSub("apm:http:server:request:start",({req:r,res:s,abortController:n})=>{let i=bF.getStore(),o=Dt.startSpan(this.tracer,this.config,r,s,"web.request");o.setTag(yF,this.constructor.id),this._parentStore=i,this.enter(o,{...i,req:r,res:s});let a=Dt.getContext(r);a.instrumented||(a.res.writeHead=Dt.wrapWriteHead(a),a.instrumented=!0),aE.hasSubscribers&&aE.publish({req:r,res:s,abortController:n})}),this.addSub("apm:http:server:request:error",r=>{Dt.addError(r)}),this.addSub("apm:http:server:request:exit",({req:r})=>{let s=this._parentStore&&this._parentStore.span;this.enter(s,this._parentStore),this._parentStore=void 0}),this.addSub("apm:http:server:request:finish",({req:r})=>{let s=Dt.getContext(r);!s||!s.res||(cE.hasSubscribers&&cE.publish({req:r,res:s.res}),Dt.finishAll(s))})}configure(e){return super.configure(Dt.normalizeConfig(e))}};uE.exports=Pp});var hE=p((Wee,dE)=>{"use strict";var vF=N(),{storage:Np}=I(),Mp=B(),SF=$e(),qF=fe(),EF=qF.HTTP_HEADERS,TF=ps(),wF=E(),xF=require("url"),{COMPONENT:IF,ERROR_MESSAGE:AF,ERROR_TYPE:kF,ERROR_STACK:RF}=A(),CF=Mp.HTTP_STATUS_CODE,OF=Mp.HTTP_REQUEST_HEADERS,PF=Mp.HTTP_RESPONSE_HEADERS,Dp=class extends vF{static get id(){return"http"}constructor(...e){super(...e),this.addSub("apm:http:client:request:start",({args:r,http:s})=>{let n=Np.getStore(),i=r.options,o=i.agent||i._defaultAgent||s.globalAgent,a=i.protocol||o.protocol||"http:",c=i.hostname||i.host||"localhost",u=i.port?`${c}:${i.port}`:c,l=i.path?i.path.split(/[?#]/)[0]:"/",d=`${a}//${u}${l}`,h=this.config.filter(d),f=(i.method||"GET").toUpperCase(),g=n&&h?n.span:null,v=this.tracer.startSpan("http.request",{childOf:g,tags:{[IF]:this.constructor.id,"span.kind":"client","service.name":$F(this.tracer,this.config,i),"resource.name":f,"span.type":"http","http.method":f,"http.url":d}});h||(v._spanContext._trace.record=!1),BF(i)||!this.config.propagationFilter(d)||this.tracer.inject(v,EF,i.headers),SF.sample(v,this.config.measured),this.enter(v,n)}),this.addSub("apm:http:client:request:finish",({req:r,res:s})=>{let n=Np.getStore().span;s&&(n.setTag(CF,s.statusCode),this.config.validateStatus(s.statusCode)||n.setTag("error",1),DF(s,n,this.config)),MF(r,n,this.config),this.config.hooks.request(n,r,s),n.finish()}),this.addSub("apm:http:client:request:error",NF)}configure(e){return super.configure(LF(e))}};function NF(t){let e=Np.getStore().span;t?e.addTags({[kF]:t.name,[AF]:t.message||t.code,[RF]:t.stack}):e.setTag("error",1)}function DF(t,e,r){r.headers.forEach(s=>{let n=t.headers[s];n&&e.setTag(`${PF}.${s}`,n)})}function MF(t,e,r){r.headers.forEach(s=>{let n=t.getHeader(s);n&&e.setTag(`${OF}.${s}`,Array.isArray(n)?n.toString():n)})}function LF(t){let e=jF(t),r=lE(t),s=lE({blocklist:t.propagationBlocklist}),n=UF(t),i=HF(t);return Object.assign({},t,{validateStatus:e,filter:r,propagationFilter:s,headers:n,hooks:i})}function jF(t){return typeof t.validateStatus=="function"?t.validateStatus:(t.hasOwnProperty("validateStatus")&&wF.error("Expected `validateStatus` to be a function."),e=>e<400||e>=500)}function lE(t){return t=Object.assign({},t,{blocklist:t.blocklist||[]}),TF.getFilter(t)}function UF(t){return Array.isArray(t.headers)?t.headers.filter(e=>typeof e=="string").map(e=>e.toLowerCase()):[]}function HF(t){let e=()=>{};return{request:t.hooks&&t.hooks.request||e}}function BF(t){if(!t)return!1;if(t.headers){let e=Object.keys(t.headers).reduce((r,s)=>Object.assign(r,{[s.toLowerCase()]:t.headers[s]}),{});if(e["x-amz-signature"]||[].concat(e.authorization).some(FF("AWS4-HMAC-SHA256")))return!0}return t.path&&t.path.toLowerCase().indexOf("x-amz-signature=")!==-1}function $F(t,e,r){return e.splitByDomain?GF(r):e.service?e.service:t._service}function GF(t){if(typeof t=="string")return xF.parse(t).host;let e=t.hostname||t.host||"localhost",r=t.port;return[e,r].filter(s=>s).join(":")}function FF(t){return e=>String(e).startsWith(t)}dE.exports=Dp});var jp=p((Vee,fE)=>{"use strict";var zF=pE(),WF=hE(),VF=ce(),Lp=class extends VF{static get id(){return"http"}static get plugins(){return{server:zF,client:WF}}};fE.exports=Lp});var _E=p((Kee,mE)=>{"use strict";var KF=N(),{storage:YF}=I(),Mt=K(),{incomingHttpRequestStart:gE}=ui(),{COMPONENT:JF}=A(),Up=class extends KF{static get id(){return"http2"}constructor(...e){super(...e),this.addSub("apm:http2:server:request:start",({req:r,res:s})=>{let n=YF.getStore(),i=Mt.startSpan(this.tracer,this.config,r,s,"web.request");i.setTag(JF,this.constructor.id),this.enter(i,{...n,req:r,res:s});let o=Mt.getContext(r);o.instrumented||(o.res.writeHead=Mt.wrapWriteHead(o),o.instrumented=!0),gE.hasSubscribers&&gE.publish({req:r,res:s})}),this.addSub("apm:http2:server:request:error",r=>{Mt.addError(r)}),this.addSub("apm:http2:server:request:finish",({req:r})=>{let s=Mt.getContext(r);!s||!s.res||Mt.finishAll(s)})}configure(e){return super.configure(Mt.normalizeConfig(e))}};mE.exports=Up});var vE=p((Yee,yE)=>{"use strict";var{storage:Hp}=I(),XF=N(),QF=require("url").URL,ZF=E(),pi=B(),e3=Sn(),t3=fe(),r3=$e(),{COMPONENT:s3,CLIENT_PORT_KEY:n3}=A(),i3=ps(),o3=t3.HTTP_HEADERS,a3=pi.HTTP_STATUS_CODE,c3=pi.HTTP_REQUEST_HEADERS,u3=pi.HTTP_RESPONSE_HEADERS,p3=pi.SPAN_KIND,l3=e3.CLIENT,d3=":method",h3=":path",f3=":status",g3="GET",Bp=class extends XF{static get id(){return"http2"}constructor(...e){super(...e),this.addSub("apm:http2:client:request:start",({authority:r,options:s,headers:n={}})=>{let i=m3(r,s),o=n[h3]||"/",a=o.split(/[?#]/)[0],c=n[d3]||g3,u=`${i.protocol}//${i.host}:${i.port}${a}`,l=this.config.filter(u),d=Hp.getStore(),h=d&&l?d.span:null,f=this.tracer.startSpan("http.request",{childOf:h,tags:{[s3]:this.constructor.id,[n3]:parseInt(i.port),[p3]:l3,"service.name":b3(this.tracer,this.config,i),"resource.name":c,"span.type":"http","http.method":c,"http.url":u}});l||(f._spanContext._trace.record=!1),bE(f,n,c3,this.config),y3(n,o)||this.tracer.inject(f,o3,n),r3.sample(f,this.config.measured),this.enter(f,d)}),this.addSub("apm:http2:client:response",r=>{let s=Hp.getStore().span,n=r&&r[f3];s.setTag(a3,n),this.config.validateStatus(n)||this.addError(),bE(s,r,u3,this.config)}),this.addSub("apm:http2:client:request:finish",()=>{Hp.getStore().span.finish()}),this.addSub("apm:http2:client:request:error",this.addError)}configure(e){return super.configure(q3(e))}};function m3(t,e){typeof t=="string"&&(t=new QF(t));let r=t.protocol||e.protocol||"https:",s=""+(t.port!==""?t.port:t.protocol==="http:"?80:443),n=t.hostname||t.host||"localhost";return r==="https:"&&e&&(s=e.port||s,n=e.host||n),{protocol:r,port:s,host:n}}function _3(t,e){return[t,e].filter(r=>r).join(":")}function b3(t,e,r){return e.splitByDomain?_3(r.host,r.port):e.service?e.service:t._service}function y3(t,e){return t&&(t=Object.keys(t).reduce((r,s)=>Object.assign(r,{[s.toLowerCase()]:t[s]}),{}),t["x-amz-signature"]||[].concat(t.authorization).some(v3("AWS4-HMAC-SHA256")))?!0:e&&e.toLowerCase().indexOf("x-amz-signature=")!==-1}function v3(t){return e=>String(e).startsWith(t)}function S3(t){return typeof t.validateStatus=="function"?t.validateStatus:(t.hasOwnProperty("validateStatus")&&ZF.error("Expected `validateStatus` to be a function."),e=>e<400||e>=500)}function q3(t){let e=S3(t),r=E3(t),s=T3(t);return Object.assign({},t,{validateStatus:e,filter:r,headers:s})}function E3(t){return t=Object.assign({},t,{blocklist:t.blocklist||[]}),i3.getFilter(t)}function bE(t,e,r,s){e&&s.headers.forEach(n=>{let i=e[n];i&&t.setTag(`${r}.${n}`,i)})}function T3(t){return Array.isArray(t.headers)?t.headers.filter(e=>typeof e=="string").map(e=>e.toLowerCase()):[]}yE.exports=Bp});var qE=p((Jee,SE)=>{"use strict";var w3=_E(),x3=vE(),I3=ce(),$p=class extends I3{static get id(){return"http2"}static get plugins(){return{server:w3,client:x3}}};SE.exports=$p});var TE=p((Xee,EE)=>{"use strict";var A3=ds(),Gp=class extends A3{static get id(){return"ioredis"}};EE.exports=Gp});var xE=p((Qee,wE)=>{"use strict";var k3=ir(),Fp=class extends k3{static get id(){return"kafkajs"}static get operation(){return"produce"}start({topic:e,messages:r}){let s=this.startSpan("kafka.produce",{service:this.config.service||`${this.tracer._service}-kafka`,resource:e,kind:"producer",meta:{component:"kafkajs","kafka.topic":e},metrics:{"kafka.batch_size":r.length}});for(let n of r)typeof n=="object"&&this.tracer.inject(s,"text_map",n.headers)}};wE.exports=Fp});var AE=p((Zee,IE)=>{"use strict";var R3=or(),zp=class extends R3{static get id(){return"kafkajs"}static get operation(){return"consume"}start({topic:e,partition:r,message:s}){let n=C3(this.tracer,s.headers);this.startSpan("kafka.consume",{childOf:n,service:this.config.service||`${this.tracer._service}-kafka`,resource:e,kind:"consumer",type:"worker",meta:{component:"kafkajs","kafka.topic":e,"kafka.message.offset":s.offset},metrics:{"kafka.partition":r}})}};function C3(t,e){if(!e)return null;let r={};for(let s of Object.keys(e))r[s]=e[s].toString();return t.extract("text_map",r)}IE.exports=zp});var RE=p((ete,kE)=>{"use strict";var O3=xE(),P3=AE(),N3=ce(),Wp=class extends N3{static get id(){return"kafkajs"}static get plugins(){return{producer:O3,consumer:P3}}};kE.exports=Wp});var li=p((tte,CE)=>{"use strict";var D3=A(),M3=dt(),Vp=class extends M3{static get id(){return"mysql"}static get system(){return"mysql"}start(e){let r=L3(this.config,e.conf);this.startSpan(`${this.system}.query`,{service:r,resource:e.sql,type:"sql",kind:"client",meta:{"db.type":this.system,"db.user":e.conf.user,"db.name":e.conf.database,"out.host":e.conf.host,[D3]:e.conf.port}}),e.sql=this.injectDbmQuery(e.sql,r)}};function L3(t,e){return typeof t.service=="function"?t.service(e):t.service}CE.exports=Vp});var PE=p((rte,OE)=>{"use strict";var{storage:Kp}=I(),j3=li(),Yp,Jp=class extends j3{static get id(){return"mariadb"}static get system(){return"mariadb"}constructor(...e){super(...e),this.addSub(`apm:${this.component}:pool:skip`,()=>{Yp=Kp.getStore(),Kp.enterWith({noop:!0})}),this.addSub(`apm:${this.component}:pool:unskip`,()=>{Kp.enterWith(Yp),Yp=void 0})}};OE.exports=Jp});var DE=p((ste,NE)=>{"use strict";var{CLIENT_PORT_KEY:U3}=A(),H3=tp(),Xp=class extends H3{static get id(){return"memcached"}start({client:e,server:r,query:s}){let n=B3(e,r,s);this.startSpan("memcached.command",{service:this.config.service,resource:s.type,type:"memcached",kind:"client",meta:{"memcached.command":s.command,"out.host":n[0],[U3]:n[1]}})}};function B3(t,e,r){if(!e)if(t.servers.length===1)e=t.servers[0];else{let s=t.redundancy&&t.redundancy<t.servers.length,n=r.redundancyEnabled;s&&n?(s=t.HashRing.range(r.key,t.redundancy+1,!0),e=s.shift()):e=t.HashRing.get(r.key)}return e&&e.split(":")}NE.exports=Xp});var LE=p((nte,ME)=>{"use strict";var $3=Ce(),G3=K(),Qp=class extends $3{static get id(){return"microgateway-core"}constructor(...e){super(...e),this.addSub("apm:microgateway-core:request:handle",({req:r})=>{this.setFramework(r,"microgateway",this.config)}),this.addSub("apm:microgateway-core:request:route",({req:r,route:s})=>{G3.setRoute(r,s)}),this.addSub("apm:microgateway-core:request:error",this.addError)}};ME.exports=Qp});var tl=p((ite,UE)=>{"use strict";var F3=cs(),{storage:Pe}=I(),{TEST_STATUS:ft,TEST_PARAMETERS:z3,finishAllTraceSpans:jE,getTestSuitePath:Zp,getTestParametersString:W3,getTestSuiteCommonTags:V3,addIntelligentTestRunnerSpanTags:K3,TEST_SOURCE_START:Y3}=ve(),{COMPONENT:J3}=A(),el=class extends F3{static get id(){return"mocha"}constructor(...e){super(...e),this._testSuites=new Map,this._testNameToParams={},this.sourceRoot=process.cwd(),this.addSub("ci:mocha:test-suite:code-coverage",({coverageFiles:r,suiteFile:s})=>{if(!this.itrConfig||!this.itrConfig.isCodeCoverageEnabled)return;let n=this._testSuites.get(s),i=[...r,s].map(a=>Zp(a,this.sourceRoot)),o={traceId:n.context()._traceId,spanId:n.context()._spanId,files:i};this.tracer._exporter.exportCoverage(o)}),this.addSub("ci:mocha:test-suite:start",r=>{let s=Pe.getStore(),n=V3(this.command,this.frameworkVersion,Zp(r.file,this.sourceRoot),"mocha"),i=this.tracer.startSpan("mocha.test_suite",{childOf:this.testModuleSpan,tags:{[J3]:this.constructor.id,...this.testEnvironmentMetadata,...n}});this.enter(i,s),this._testSuites.set(r.file,i)}),this.addSub("ci:mocha:test-suite:finish",r=>{let s=Pe.getStore();if(s&&s.span){let n=Pe.getStore().span;n.context()._tags[ft]||n.setTag(ft,r),n.finish()}}),this.addSub("ci:mocha:test-suite:error",r=>{let s=Pe.getStore();if(s&&s.span){let n=Pe.getStore().span;n.setTag("error",r),n.setTag(ft,"fail")}}),this.addSub("ci:mocha:test:start",({test:r,testStartLine:s})=>{let n=Pe.getStore(),i=this.startTestSpan(r,s);this.enter(i,n)}),this.addSub("ci:mocha:test:finish",r=>{let s=Pe.getStore();if(s&&s.span){let n=Pe.getStore().span;n.setTag(ft,r),n.finish(),jE(n)}}),this.addSub("ci:mocha:test:skip",r=>{let s=Pe.getStore();if(!s){let n=this.startTestSpan(r);this.enter(n,s)}}),this.addSub("ci:mocha:test:error",r=>{let s=Pe.getStore();if(r&&s&&s.span){let n=s.span;r.constructor.name==="Pending"&&!this.forbidPending?n.setTag(ft,"skip"):(n.setTag(ft,"fail"),n.setTag("error",r))}}),this.addSub("ci:mocha:test:parameterize",({name:r,params:s})=>{this._testNameToParams[r]=s}),this.addSub("ci:mocha:session:finish",({status:r,isSuitesSkipped:s,testCodeCoverageLinesTotal:n})=>{if(this.testSessionSpan){let{isSuitesSkippingEnabled:i,isCodeCoverageEnabled:o}=this.itrConfig||{};this.testSessionSpan.setTag(ft,r),this.testModuleSpan.setTag(ft,r),K3(this.testSessionSpan,this.testModuleSpan,{isSuitesSkipped:s,isSuitesSkippingEnabled:i,isCodeCoverageEnabled:o,testCodeCoverageLinesTotal:n}),this.testModuleSpan.finish(),this.testSessionSpan.finish(),jE(this.testSessionSpan)}this.itrConfig=null,this.tracer._exporter.flush()})}startTestSpan(e,r){let s=e.fullTitle(),{file:n,title:i}=e,o={},a=W3(this._testNameToParams,i);a&&(o[z3]=a),r&&(o[Y3]=r);let c=Zp(n,this.sourceRoot),u=this._testSuites.get(n);return super.startTestSpan(s,c,u,o)}};UE.exports=el});var rl=p((ote,HE)=>{"use strict";function X3(t,e,r){let s=e.service||{},n=e.action||{},i=r.meta&&e.meta;return{"moleculer.context.action":n.name,"moleculer.context.meta":i,"moleculer.context.node_id":e.nodeID,"moleculer.context.request_id":e.requestID,"moleculer.context.service":s.name,"moleculer.namespace":t.namespace,"moleculer.node_id":t.nodeID}}HE.exports={moleculerTags:X3}});var $E=p((ate,BE)=>{"use strict";var Q3=si(),{moleculerTags:Z3}=rl(),sl=class extends Q3{static get id(){return"moleculer"}static get operation(){return"action"}start({action:e,ctx:r,broker:s}){let n=this.tracer.extract("text_map",r.meta);this.startSpan("moleculer.action",{childOf:n||this.activeSpan,service:this.config.service,resource:e.name,kind:"server",type:"web",meta:{"resource.name":e.name,...Z3(s,r,this.config)}})}};BE.exports=sl});var FE=p((cte,GE)=>{"use strict";var e4=ae(),{moleculerTags:t4}=rl(),nl=class extends e4{static get id(){return"moleculer"}static get operation(){return"call"}start({actionName:e,opts:r}){let s=this.startSpan("moleculer.call",{service:this.config.service,resource:e,kind:"client"});this.tracer.inject(s,"text_map",r.meta)}finish({broker:e,ctx:r}){let s=this.activeSpan;if(r){let i=(r.endpoint||{}).node||{};this.addHost(i.hostname,i.port),s.addTags(t4(e,r,this.config))}s.finish()}};GE.exports=nl});var WE=p((ute,zE)=>{"use strict";var r4=$E(),s4=FE(),n4=ce(),il=class extends n4{static get id(){return"moleculer"}static get plugins(){return{server:r4,client:s4}}};zE.exports=il});var al=p((pte,QE)=>{"use strict";var i4=dt(),ol=class extends i4{static get id(){return"mongodb-core"}static get component(){return"mongodb"}start({ns:e,ops:r,options:s={},name:n}){let i=o4(r),o=c4(a4(this,e,i,n));this.startSpan("mongodb.query",{service:this.config.service,resource:o,type:"mongodb",kind:"client",meta:{"db.name":e,"mongodb.query":i,"out.host":s.host,"out.port":s.port}})}};function o4(t){if(!(!t||typeof t!="object"||Array.isArray(t))){if(t.query)return JSON.stringify(YE(t.query));if(t.filter)return JSON.stringify(YE(t.filter))}}function a4(t,e,r,s){let n=[s,e];return t.config.queryInResourceName&&r&&n.push(r),n.join(" ")}function c4(t){return t.slice(0,Math.min(t.length,1e4))}function VE(t){return!u4(t)}function KE(t){return Buffer.isBuffer(t)||typeof t=="function"||XE(t)}function YE(t){if(JE(t)&&(t=t.toJSON()),KE(t))return"?";if(VE(t))return t;let e={},r=[{input:t,output:e,depth:0}];for(;r.length;){let{input:s,output:n,depth:i}=r.pop(),o=i+1;for(let a in s){if(typeof s[a]=="function")continue;let c=s[a];JE(c)&&(c=typeof c.toJSON=="function"?c.toJSON():"?"),i>=10||KE(c)?n[a]="?":VE(c)?n[a]=c:r.push({input:c,output:n[a]={},depth:o})}}return e}function u4(t){return typeof t=="object"&&t!==null&&!(t instanceof Array)}function JE(t){return t&&t._bsontype&&!XE(t)}function XE(t){return t&&t._bsontype==="Binary"}QE.exports=ol});var eT=p((lte,ZE)=>{"use strict";var p4=li(),cl=class extends p4{static get id(){return"mysql2"}};ZE.exports=cl});var rT=p((dte,tT)=>{"use strict";var l4=ae(),ul=class extends l4{static get id(){return"net"}static get operation(){return"ipc"}start({options:e}){this.startSpan("ipc.connect",{service:this.config.service,resource:e.path,kind:"client",meta:{"ipc.path":e.path}})}};tT.exports=ul});var nT=p((hte,sT)=>{"use strict";var{CLIENT_PORT_KEY:d4}=A(),h4=ae(),pl=class extends h4{static get id(){return"net"}static get operation(){return"tcp"}constructor(...e){super(...e),this.addTraceSub("connection",({socket:r})=>{this.activeSpan.addTags({"tcp.local.address":r.localAddress,"tcp.local.port":r.localPort})})}start({options:e}){let r=e.host||"localhost",s=e.port||0,n=e.family||4;this.startSpan("tcp.connect",{service:this.config.service,resource:[r,s].filter(i=>i).join(":"),kind:"client",meta:{"tcp.remote.host":r,"tcp.family":`IPv${n}`,"tcp.local.address":"","out.host":r},metrics:{"tcp.remote.port":s,"tcp.local.port":0,[d4]:s}})}};sT.exports=pl});var oT=p((fte,iT)=>{"use strict";var f4=N(),g4=rT(),m4=nT(),ll=class extends f4{static get id(){return"net"}constructor(...e){super(...e),this._ipc=new g4(...e),this._tcp=new m4(...e)}configure(e){this._ipc.configure(e),this._tcp.configure(e)}};iT.exports=ll});var uT=p((gte,cT)=>{"use strict";var _4=N(),{storage:dl}=I(),b4=$e(),{COMPONENT:aT}=A(),hl=class extends _4{static get id(){return"next"}constructor(...e){super(...e),this._requests=new WeakMap,this.addSub("apm:next:request:start",({req:r,res:s})=>{let n=dl.getStore(),i=n&&n.span,o=this.tracer.startSpan("next.request",{childOf:i,tags:{[aT]:this.constructor.id,"service.name":this.config.service||this.tracer._service,"resource.name":r.method,"span.type":"web","span.kind":"server","http.method":r.method}});b4.sample(o,this.config.measured,!0),this.enter(o,n),this._requests.set(o,r)}),this.addSub("apm:next:request:error",this.addError),this.addSub("apm:next:request:finish",({req:r,res:s})=>{let n=dl.getStore();if(!n)return;let i=n.span,o=i.context()._tags.error;!this.config.validateStatus(s.statusCode)&&!o&&i.setTag("error",!0),i.addTags({"http.status_code":s.statusCode}),this.config.hooks.request(i,r,s),i.finish()}),this.addSub("apm:next:page:load",({page:r})=>{let s=dl.getStore();if(!s)return;let n=s.span,i=this._requests.get(n);n.context()._tags["next.page"]&&(r==="/404"||r==="/500"||r==="/_error")||n.addTags({[aT]:this.constructor.id,"resource.name":`${i.method} ${r}`.trim(),"next.page":r})})}configure(e){return super.configure(y4(e))}};function y4(t){let e=v4(t),r=typeof t.validateStatus=="function"?t.validateStatus:s=>s<500;return Object.assign({},t,{hooks:e,validateStatus:r})}function v4(t){let e=()=>{};return{request:t.hooks&&t.hooks.request||e}}cT.exports=hl});var lT=p((mte,pT)=>{"use strict";var{CLIENT_PORT_KEY:S4}=A(),q4=dt(),E4=E(),fl=class extends q4{static get id(){return"oracledb"}static get system(){return"oracle"}start({query:e,connAttrs:r}){let s=T4(this.config,r),n=w4(r.connectString);this.startSpan("oracle.query",{service:s,resource:e,type:"sql",kind:"client",meta:{"db.user":this.config.user,"db.instance":n.pathname&&n.pathname.substring(1),"db.hostname":n.hostname,[S4]:n.port}})}};function T4(t,e){return typeof t.service=="function"?t.service(e):t.service}function w4(t){try{return new URL(`http://${t}`)}catch(e){return E4.error(e),{}}}pT.exports=fl});var hT=p((_te,dT)=>{"use strict";var x4=hs(),gl=class extends x4{static get id(){return"paperplane"}};dT.exports=gl});var gT=p((bte,fT)=>{"use strict";var I4=Ce(),A4=K(),ml=class extends I4{static get id(){return"paperplane"}constructor(...e){super(...e),this.addSub("apm:paperplane:request:handle",r=>{this.setFramework(r,"paperplane",this.config)}),this.addSub("apm:paperplane:request:route",({req:r,route:s})=>{A4.setRoute(r,s)})}};fT.exports=ml});var _T=p((yte,mT)=>{"use strict";var k4=N(),R4=hT(),C4=gT(),_l=class extends k4{static get id(){return"paperplane"}constructor(...e){super(...e),this.server=new C4(...e),this.logger=new R4(...e)}configure(e){this.server.configure(e),this.logger.configure(e)}};mT.exports=_l});var yT=p((vte,bT)=>{"use strict";var{CLIENT_PORT_KEY:O4}=A(),P4=dt(),bl=class extends P4{static get id(){return"pg"}static get operation(){return"query"}static get system(){return"postgres"}start({params:e={},query:r,processId:s}){let n=N4(this.config,e),i=r.text;this.startSpan("pg.query",{service:n,resource:i,type:"sql",kind:"client",meta:{"db.type":"postgres","db.pid":s,"db.name":e.database,"db.user":e.user,"out.host":e.host,[O4]:e.port}}),r.text=this.injectDbmQuery(r.text,n)}};function N4(t,e){return typeof t.service=="function"?t.service(e):t.service}bT.exports=bl});var vl=p((Ste,vT)=>{"use strict";var D4=hs(),yl=class extends D4{static get id(){return"pino"}};vT.exports=yl});var qT=p((qte,ST)=>{"use strict";var M4=Ce(),L4=K(),Sl=class extends M4{static get id(){return"restify"}constructor(...e){super(...e),this.addSub("apm:restify:request:handle",({req:r})=>{this.setFramework(r,"restify",this.config)}),this.addSub("apm:restify:request:route",({req:r,route:s})=>{L4.setRoute(r,s)})}configure(e){return super.configure({...e,middleware:!1})}};ST.exports=Sl});var TT=p((Ete,ET)=>{"use strict";var{CLIENT_PORT_KEY:j4}=A(),U4=ir(),ql=class extends U4{static get id(){return"rhea"}static get operation(){return"send"}constructor(...e){super(...e),this.addTraceSub("encode",this.encode.bind(this))}start({targetAddress:e,host:r,port:s}){let n=e||"amq.topic";this.startSpan("amqp.send",{service:this.config.service||`${this.tracer._service}-amqp-producer`,resource:n,kind:"producer",meta:{component:"rhea","amqp.link.target.address":n,"amqp.link.role":"sender","out.host":r,[j4]:s}})}encode(e){H4(e,this.tracer,this.activeSpan)}};function H4(t,e,r){t&&(t.delivery_annotations=t.delivery_annotations||{},e.inject(r,"text_map",t.delivery_annotations))}ET.exports=ql});var xT=p((Tte,wT)=>{"use strict";var B4=or(),{storage:$4}=I(),El=class extends B4{static get id(){return"rhea"}constructor(...e){super(...e),this.addTraceSub("dispatch",({state:r})=>{$4.getStore().span.setTag("amqp.delivery.state",r)})}start({msgObj:e}){let r=G4(e),s=F4(e,this.tracer);this.startSpan("amqp.receive",{childOf:s,service:this.config.service,resource:r,type:"worker",kind:"consumer",meta:{component:"rhea","amqp.link.source.address":r,"amqp.link.role":"receiver"}})}};function G4(t){let e="amq.topic",r={};return t.receiver&&t.receiver.options&&(r=t.receiver.options),r.source&&r.source.address&&(e=r.source.address),e}function F4(t,e){if(t.message)return e.extract("text_map",t.message.delivery_annotations)}wT.exports=El});var AT=p((wte,IT)=>{"use strict";var z4=TT(),W4=xT(),V4=ce(),Tl=class extends V4{static get id(){return"rhea"}static get plugins(){return{producer:z4,consumer:W4}}};IT.exports=Tl});var CT=p((xte,RT)=>{"use strict";var K4=si(),wl=class extends K4{static get id(){return"sharedb"}start({actionName:e,request:r}){let s=this.startSpan("sharedb.request",{service:this.config.service,resource:Y4(e,r.c,r.q),kind:"server",meta:{"sharedb.action":e}});this.config.hooks&&this.config.hooks.receive&&this.config.hooks.receive(s,r)}finish({request:e,res:r}){let s=this.activeSpan;this.config.hooks&&this.config.hooks.reply&&this.config.hooks.reply(s,e,r),s.finish()}};function Y4(t,e,r){return e&&(t+=" "+e),r&&(t+=" "+JSON.stringify(kT(r))),t}function kT(t){let e={};if(!J4(t)||Buffer.isBuffer(t))return"?";for(let r in t)typeof t[r]!="function"&&(e[r]=kT(t[r]));return e}function J4(t){return typeof t=="object"&&t!==null&&!(t instanceof Array)}RT.exports=wl});var PT=p((Ite,OT)=>{"use strict";var{CLIENT_PORT_KEY:X4}=A(),Q4=dt(),xl=class extends Q4{static get id(){return"tedious"}static get operation(){return"request"}static get system(){return"mssql"}start({queryOrProcedure:e,connectionConfig:r}){this.startSpan("tedious.request",{service:this.config.service,resource:e,type:"sql",kind:"client",meta:{"db.type":"mssql",component:"tedious","out.host":r.server,[X4]:r.options.port,"db.user":r.userName||r.authentication.options.userName,"db.name":r.options.database,"db.instance":r.options.instanceName}})}};OT.exports=xl});var DT=p((Ate,NT)=>{"use strict";var Z4=hs(),Il=class extends Z4{static get id(){return"winston"}};NT.exports=Il});var LT=p((kte,MT)=>{"use strict";MT.exports={get"@aws-sdk/smithy-client"(){return fu()},get"@cucumber/cucumber"(){return Fv()},get"@playwright/test"(){return Yv()},get"@elastic/elasticsearch"(){return us()},get"@elastic/transport"(){return us()},get"@google-cloud/pubsub"(){return hS()},get"@grpc/grpc-js"(){return $u()},get"@hapi/hapi"(){return Ju()},get"@jest/core"(){return ht()},get"@koa/router"(){return ii()},get"@node-redis/client"(){return ds()},get"@opensearch-project/opensearch"(){return JS()},get"@redis/client"(){return ds()},get amqp10(){return sq()},get amqplib(){return dq()},get"aws-sdk"(){return fu()},get bunyan(){return mq()},get"cassandra-driver"(){return bq()},get connect(){return vq()},get couchbase(){return qq()},get cypress(){return Tq()},get dns(){return Nq()},get elasticsearch(){return us()},get express(){return Mq()},get fastify(){return jq()},get"find-my-way"(){return Hq()},get graphql(){return nE()},get grpc(){return $u()},get hapi(){return Ju()},get http(){return jp()},get http2(){return qE()},get https(){return jp()},get ioredis(){return TE()},get"jest-circus"(){return ht()},get"jest-config"(){return ht()},get"jest-environment-node"(){return ht()},get"jest-environment-jsdom"(){return ht()},get"jest-jasmine2"(){return ht()},get"jest-worker"(){return ht()},get koa(){return ii()},get"koa-router"(){return ii()},get kafkajs(){return RE()},get mariadb(){return PE()},get memcached(){return DE()},get"microgateway-core"(){return LE()},get mocha(){return tl()},get"mocha-each"(){return tl()},get moleculer(){return WE()},get mongodb(){return al()},get"mongodb-core"(){return al()},get mysql(){return li()},get mysql2(){return eT()},get net(){return oT()},get next(){return uT()},get oracledb(){return lT()},get paperplane(){return _T()},get pg(){return yT()},get pino(){return vl()},get"pino-pretty"(){return vl()},get redis(){return ds()},get restify(){return qT()},get rhea(){return AT()},get router(){return Ce()},get sharedb(){return CT()},get tedious(){return PT()},get winston(){return DT()}}});var jT=p((Rte,_s)=>{"use strict";var ez=require("semver"),tz=E(),{addHook:rz}=require("import-in-the-middle"),sz=H();if(ez.satisfies(process.versions.node,">=14.13.1")){let t=sz.channel("dd-trace:moduleLoadStart");rz((e,r)=>{t.hasSubscribers&&t.publish({filename:e,module:r})}),_s.exports=require("import-in-the-middle")}else tz.warn("ESM is not fully supported by this version of Node.js, so dd-trace will not intercept ESM loading."),_s.exports=()=>({unhook:()=>{}}),_s.exports.addHook=()=>{},_s.exports.removeHook=()=>{}});var GT=p((Cte,$T)=>{"use strict";var di=require("path"),ur=require("module"),nz=require("module-details-from-path"),BT=H(),Al=ur.prototype.require;$T.exports=pr;var Fe=Object.create(null),Ge=Object.create(null),hi=Object.create(null),kl=null,UT=BT.channel("dd-trace:moduleLoadStart"),HT=BT.channel("dd-trace:moduleLoadEnd");function pr(t,e,r){if(!(this instanceof pr))return new pr(t,e,r);if(typeof t=="function"?(r=t,t=null,e={}):typeof e=="function"&&(r=e,e={}),t=t||[],e=e||{},this.modules=t,this.options=e,this.onrequire=r,Array.isArray(t))for(let s of t){let n=Fe[s];n?n.push(r):Fe[s]=[r]}kl||(kl=ur.prototype.require=function(s){let n=ur._resolveFilename(s,this),i=n.indexOf(di.sep)===-1,o,a,c;if(Ge[n])return require.cache[n]&&require.cache[n].exports!==Ge[n].original?require.cache[n].exports:Ge[n].exports;if(hi[n])return Al.apply(this,arguments);hi[n]=!0;let l={filename:n,request:s};UT.hasSubscribers&&UT.publish(l);let d=Al.apply(this,arguments);if(l.module=d,HT.hasSubscribers&&HT.publish(l),delete hi[n],i){if(c=Fe[n],!c)return d;o=n}else{let h=process.env.AWS_LAMBDA_FUNCTION_NAME!==void 0,f=process.env.DD_LAMBDA_HANDLER!==void 0,v=n.split(di.sep).lastIndexOf("node_modules")!==-1,q=h&&f&&!v?{name:n}:nz(n);if(!q||(o=q.name,a=q.basedir,c=Fe[o],!c))return d;let _=ur._resolveLookupPaths(o,this,!0);if(!_)return d;ur._findPath(o,[a,..._])!==n&&(o=o+di.sep+di.relative(a,n))}Ge[n]={exports:d},Ge[n].original=d;for(let h of c)Ge[n].exports=h(Ge[n].exports,o,a);return Ge[n].exports})}pr.reset=function(){ur.prototype.require=Al,kl=null,hi=Object.create(null),Ge=Object.create(null),Fe=Object.create(null)};pr.prototype.unhook=function(){for(let t of this.modules){let e=(Fe[t]||[]).filter(r=>r!==this.onrequire);e.length>0?Fe[t]=e:delete Fe[t]}Object.keys(Fe).length===0&&pr.reset()}});var WT=p((Ote,zT)=>{"use strict";var ze=require("diagnostics_channel"),FT="dd-trace:bundledModuleLoadStart";ze.subscribe||(ze.subscribe=(t,e)=>{ze.channel(t).subscribe(e)});ze.unsubscribe||(ze.unsubscribe=(t,e)=>{ze.channel(t).hasSubscribers&&ze.channel(t).unsubscribe(e)});zT.exports=Rl;function Rl(t,e,r){if(!(this instanceof Rl))return new Rl(t,e,r);function s(n){n.module=r(n.module,n.path,void 0,n.version)}for(let n of t)ze.subscribe(`${FT}:${n}`,s);this.unhook=function(){for(let i of t)ze.unsubscribe(`${FT}:${i}`,s)}}});var Cl=p((Pte,VT)=>{"use strict";var iz=require("path"),oz=jT(),az=GT(),cz=WT();function fi(t,e){if(!(this instanceof fi))return new fi(t,e);this._patched=Object.create(null);let r=(s,n,i,o)=>{let a=[i,n].filter(u=>u),c=iz.join(...a);return this._patched[c]?s:(this._patched[c]=!0,e(s,n,i,o))};this._ritmHook=az(t,{},r),this._iitmHook=oz(t,{},(s,n,i)=>s&&s.default?(s.default=r(s.default,n,i),s):r(s,n,i)),this._dcitmHook=cz(t,{},r)}fi.prototype.unhook=function(){this._ritmHook.unhook(),this._iitmHook.unhook(),this._dcitmHook.unhook(),this._patched=Object.create(null)};VT.exports=fi});var gi=p((Nte,KT)=>{"use strict";var Ol=Symbol.for("_ddtrace_instrumentations");global[Ol]=global[Ol]||{};KT.exports=global[Ol]});var m=p(lr=>{"use strict";var uz=H(),pz=require("semver"),Pl=gi(),{AsyncResource:YT}=require("async_hooks"),JT={};lr.channel=function(t){let e=JT[t];if(e)return e;let r=uz.channel(t);return JT[t]=r,r};lr.addHook=function({name:e,versions:r,file:s},n){Pl[e]||(Pl[e]=[]),Pl[e].push({name:e,versions:r,file:s,hook:n})};pz.satisfies(process.versions.node,">=17.8.0")?lr.AsyncResource=YT:lr.AsyncResource=class extends YT{static bind(t,e,r){return e=e||t.name,new lr.AsyncResource(e||"bound-anonymous-fn").bind(t,r)}bind(t,e){let r;if(e===void 0){let s=this;r=function(...n){return n.unshift(t,this),Reflect.apply(s.runInAsyncScope,s,n)}}else r=this.runInAsyncScope.bind(this,t,e);return Object.defineProperties(r,{length:{configurable:!0,enumerable:!1,value:t.length,writable:!1},asyncResource:{configurable:!0,enumerable:!0,value:this,writable:!0}}),r}}});var rw=p((Lte,tw)=>{"use strict";var mi=new WeakMap;function XT(t,e){Object.setPrototypeOf(e,t);let r=Object.getOwnPropertyDescriptors(t),s=Reflect.ownKeys(r);for(let n of s)try{Object.defineProperty(e,n,r[n])}catch{}}function lz(t,e){ew(e),mz(t);let r=function(){return e.apply(this,arguments)};return mi.set(r,()=>{e=t}),XT(t,r),r}function dz(t,e,r){gz(t,e),ew(r);let s=t[e],n=r(s),i=Object.getOwnPropertyDescriptor(t,e),o={configurable:!0,...i};if(XT(s,n),i){if(mi.set(n,()=>Object.defineProperty(t,e,i)),i.get||i.set?o.get=()=>n:o.value=n,i.configurable===!1)return Object.create(t,{[e]:o})}else mi.set(n,()=>delete t[e]),o.value=n,o.writable=!0;return Object.defineProperty(t,e,o),t}function QT(t,e,r){return typeof e=="function"?lz(t,e):dz(t,e,r)}function ZT(t,e){if(!t)return t;let r=mi.get(e?t[e]:t);return r&&r(),t}function hz(t,e,r){t=_i(t),e=_i(e);for(let s of t)for(let n of e)QT(s,n,r)}function fz(t,e){t=_i(t),e=_i(e);for(let r of t)for(let s of e)ZT(r,s)}function _i(t){return Array.isArray(t)?t:[t]}function gz(t,e){if(!t)throw new Error("No target object provided.");if(typeof t!="object"&&typeof t!="function")throw new Error("Invalid target.");if(!t[e])throw new Error(`No original method ${e}.`);if(typeof t[e]!="function")throw new Error(`Original method ${e} is not a function.`)}function ew(t){if(!t)throw new Error("No function provided.");if(typeof t!="function")throw new Error("Target is not a function.")}function mz(t){if(Function.prototype.toString.call(t).startsWith("class"))throw new Error("Target is a native class constructor and cannot be wrapped.")}tw.exports={wrap:QT,massWrap:hz,unwrap:ZT,massUnwrap:fz}});var b=p((jte,sw)=>{"use strict";sw.exports=rw()});var Ll=p(()=>{"use strict";var{channel:We,addHook:Ml,AsyncResource:bi}=m(),bs=b();function Dl(t){return function(r){if(!this.service)return t.apply(this,arguments);let s=this.service.serviceIdentifier,n=nw(s),i=We(`apm:aws:request:start:${n}`);if(!i.hasSubscribers)return t.apply(this,arguments);let o=new bi("apm:aws:request:inner"),a=new bi("apm:aws:request:outer");return o.runInAsyncScope(()=>(this.on("complete",o.bind(c=>{We(`apm:aws:request:complete:${n}`).publish({response:c})})),i.publish({serviceIdentifier:s,operation:this.operation,awsRegion:this.service.config&&this.service.config.region,awsService:this.service.api&&this.service.api.className,request:this}),typeof r=="function"&&(arguments[0]=bz(r,n,this,a)),t.apply(this,arguments)))}}function _z(t){return function(e,...r){let s=r[r.length-1],n=new bi("apm:aws:request:inner"),i=new bi("apm:aws:request:outer"),o=this.config.serviceId.toLowerCase(),a=nw(o),c=e.constructor.name,u=this.constructor.name.replace(/Client$/,""),l=`${c[0].toLowerCase()}${c.slice(1).replace(/Command$/,"")}`,d={operation:l,params:e.input},h=We(`apm:aws:request:start:${a}`),f=We(`apm:aws:request:region:${a}`),g=We(`apm:aws:request:complete:${a}`),v=We(`apm:aws:response:start:${a}`),q=We(`apm:aws:response:finish:${a}`);return n.runInAsyncScope(()=>{if(h.publish({serviceIdentifier:o,operation:l,awsService:u,request:d}),this.config.region().then(_=>{f.publish(_)}),typeof s=="function")r[r.length-1]=function(_,S){let T=Nl(d,_,S);g.publish(T),i.runInAsyncScope(()=>{v.publish(T),s.apply(this,arguments),T.needsFinish&&q.publish(T.response.error)})};else return t.call(this,e,...r).then(_=>{let S=Nl(d,null,_);return g.publish(S),_},_=>{let S=Nl(d,_);throw g.publish(S),_});return t.call(this,e,...r)})}}function bz(t,e,r,s){return function(i,o){let a={request:r,response:o};return s.runInAsyncScope(()=>{if(We(`apm:aws:response:start:${e}`).publish(a),!a.needsFinish)return t.apply(this,arguments);let c=We(`apm:aws:response:finish:${e}`);try{let u=t.apply(this,arguments);return u&&u.then?u=u.then(l=>(c.publish(),l),l=>{throw c.publish(l),l}):c.publish(),u}catch(u){throw c.publish(u),u}})}}function Nl(t,e,r){let s={request:t,error:e,...r};return r&&r.$metadata&&(s.requestId=r.$metadata.requestId),{request:t,response:s}}function nw(t){return["cloudwatchlogs","dynamodb","eventbridge","kinesis","lambda","redshift","s3","sns","sqs"].includes(t)?t:"default"}Ml({name:"@aws-sdk/smithy-client",versions:[">=3"]},t=>(bs.wrap(t.Client.prototype,"send",_z),t));Ml({name:"aws-sdk",versions:[">=2.3.0"]},t=>(bs.wrap(t.Request.prototype,"promise",Dl),bs.wrap(t.config,"setPromisesDependency",e=>function(s){let n=e.apply(this,arguments);return bs.wrap(t.Request.prototype,"promise",Dl),n}),t));Ml({name:"aws-sdk",versions:[">=2.1.35"]},t=>(bs.wrap(t.Request.prototype,"send",Dl),t))});var fw=p(()=>{"use strict";var{createCoverageMap:yz}=require("istanbul-lib-coverage"),{addHook:Bl,channel:Ee,AsyncResource:jl}=m(),Ul=b(),iw=Ee("ci:cucumber:test:start"),ow=Ee("ci:cucumber:test:finish"),aw=Ee("ci:cucumber:test-step:start"),cw=Ee("ci:cucumber:error"),vz=Ee("ci:cucumber:test-suite:start"),Sz=Ee("ci:cucumber:test-suite:finish"),qz=Ee("ci:cucumber:test-suite:code-coverage"),Ez=Ee("ci:cucumber:itr-configuration"),Tz=Ee("ci:cucumber:test-suite:skippable"),wz=Ee("ci:cucumber:session:start"),xz=Ee("ci:cucumber:session:finish"),{getCoveredFilenamesFromCoverage:Iz,resetCoverage:Az,mergeCoverage:kz,fromCoverageMapToCoverage:Rz,getTestSuitePath:Cz}=ve(),Hl=yz(),uw=new WeakSet,dw={},dr={};function Oz(t){return t.some(e=>e==="fail")?"fail":t.every(e=>e==="skip")?"skip":"pass"}function pw(t){return t.status===1?{status:"pass"}:t.status===2?{status:"skip"}:t.status===4?{status:"skip",skipReason:"not implemented"}:{status:"fail",errorMessage:t.message}}function lw(t){return t.status==="PASSED"?{status:"pass"}:t.status==="SKIPPED"||t.status==="PENDING"?{status:"skip"}:t.status==="UNDEFINED"?{status:"skip",skipReason:"not implemented"}:{status:"fail",errorMessage:t.message}}function hw(t,e){uw.has(t)||(uw.add(t),Ul.wrap(t.prototype,"run",r=>function(){return iw.hasSubscribers?new jl("bound-anonymous-fn").runInAsyncScope(()=>{let n=this.pickle.uri;dr[n]||vz.publish(n);let i=this.gherkinDocument&&this.gherkinDocument.feature&&this.gherkinDocument.feature.location&&this.gherkinDocument.feature.location.line;iw.publish({testName:this.pickle.name,fullTestSuite:n,testSourceLine:i});try{let o=r.apply(this,arguments);return o.finally(()=>{let a=this.getWorstStepResult(),{status:c,skipReason:u,errorMessage:l}=e?lw(a):pw(a);if(dr[n]?dr[n].push(c):dr[n]=[c],ow.publish({status:c,skipReason:u,errorMessage:l}),dr[n].length===dw[n].length){let d=Oz(dr[n]);if(global.__coverage__){let h=Iz(global.__coverage__);qz.publish({coverageFiles:h,suiteFile:n}),kz(global.__coverage__,Hl),Az(global.__coverage__)}Sz.publish(d)}}),o}catch(o){throw cw.publish(o),o}}):r.apply(this,arguments)}),Ul.wrap(t.prototype,"runStep",r=>function(){if(!aw.hasSubscribers)return r.apply(this,arguments);let s=arguments[0],n;return e?n=s.text:n=s.isHook?"hook":s.pickleStep.text,new jl("bound-anonymous-fn").runInAsyncScope(()=>{aw.publish({resource:n});try{let o=r.apply(this,arguments);return o.then(a=>{let{status:c,skipReason:u,errorMessage:l}=e?lw(a):pw(a);ow.publish({isStep:!0,status:c,skipReason:u,errorMessage:l})}),o}catch(o){throw cw.publish(o),o}})}))}function Pz(t){let e=t.default;return hw(e,!1),t}function Nz(t){let e=t.default;return hw(e,!0),t}Bl({name:"@cucumber/cucumber",versions:["7.0.0 - 7.2.1"],file:"lib/runtime/pickle_runner.js"},Pz);Bl({name:"@cucumber/cucumber",versions:[">=7.3.0"],file:"lib/runtime/test_case_runner.js"},Nz);function Dz(t,e){return t.pickleIds.filter(r=>{let s=t.eventDataCollector.getPickle(r);return!e.includes(Cz(s.uri,process.cwd()))},{})}function Mz(t){return t.pickleIds.reduce((e,r)=>{let s=t.eventDataCollector.getPickle(r);return e[s.uri]?e[s.uri].push(s):e[s.uri]=[s],e},{})}Bl({name:"@cucumber/cucumber",versions:[">=7.0.0"],file:"lib/runtime/index.js"},(t,e)=>(Ul.wrap(t.default.prototype,"start",r=>async function(){let s=new jl("bound-anonymous-fn"),n,i=new Promise(f=>{n=f});s.runInAsyncScope(()=>{Ez.publish({onDone:n})}),await i;let o=new Promise(f=>{n=f});s.runInAsyncScope(()=>{Tz.publish({onDone:n})});let{err:a,skippableSuites:c}=await o;a||(this.pickleIds=Dz(this,c)),dw=Mz(this);let u=process.argv.slice(2).join(" "),l=process.env.npm_lifecycle_script||`cucumber-js ${u}`;s.runInAsyncScope(()=>{wz.publish({command:l,frameworkVersion:e})});let d=await r.apply(this,arguments),h;if(global.__coverage__){try{h=Hl.getCoverageSummary().lines.pct}catch{}global.__coverage__=Rz(Hl)}return s.runInAsyncScope(()=>{xz.publish({status:d?"pass":"fail",isSuitesSkipped:c?!!c.length:!1,testCodeCoverageLinesTotal:h})}),d}),t))});var qw=p(()=>{var{addHook:vs,channel:fr,AsyncResource:$l}=m(),ys=b(),Lz=fr("ci:playwright:test:start"),jz=fr("ci:playwright:test:finish"),Uz=fr("ci:playwright:session:start"),Hz=fr("ci:playwright:session:finish"),Bz=fr("ci:playwright:test-suite:start"),$z=fr("ci:playwright:test-suite:finish"),gw=new WeakMap,mw=new Map,yi=new Map,Gl=[],Fl={passed:"pass",failed:"fail",timedOut:"fail",skipped:"skip"},hr={};function Gz(t){return t.reduce((e,{requireFile:r,tests:s})=>(e[r]?e[r]=e[r].concat(s):e[r]=s,e),{})}function Fz(t){let e={};for(let{test:r}of t.values()){let{_requireFile:s}=r;r._type==="beforeAll"||r._type==="afterAll"||(e[s]?e[s].push(r):e[s]=[r])}return e}function zz(t){try{return t._configLoader.fullConfig()}catch{try{return t._loader.fullConfig()}catch{return t._config||{}}}}function Wz(t){let e=zz(t);return e.rootDir?e.rootDir:t._configDir?t._configDir:process.cwd()}function _w(t){let{_requireFile:e,title:r,_type:s,location:{line:n}}=t;if(s==="beforeAll"||s==="afterAll")return;if(!Gl.includes(e)){Gl.push(e);let a=new $l("bound-anonymous-fn");mw.set(e,a),a.runInAsyncScope(()=>{Bz.publish(e)})}let o=new $l("bound-anonymous-fn");gw.set(t,o),o.runInAsyncScope(()=>{Lz.publish({testName:r,testSuiteAbsolutePath:e,testSourceLine:n})})}function bw(t,e,r){let{_requireFile:s,results:n,_type:i}=t;if(i==="beforeAll"||i==="afterAll")return;let o=n[n.length-1];if(gw.get(t).runInAsyncScope(()=>{jz.publish({testStatus:e,steps:o.steps,error:r})}),yi.has(s)?yi.get(s).push(e):yi.set(s,[e]),hr[s]=hr[s].filter(c=>c!==t),!hr[s].length){let c=yi.get(s),u="pass";c.some(d=>d==="fail")?u="fail":c.every(d=>d==="skip")&&(u="skip"),mw.get(s).runInAsyncScope(()=>{$z.publish(u)})}}function yw(t){return function(){return hr=Fz(this._testById),t.apply(this,arguments)}}function Vz(t){return function(){return hr=Gz(arguments[0]),t.apply(this,arguments)}}function Kz(t){return ys.wrap(t.Dispatcher.prototype,"run",yw),ys.wrap(t.Dispatcher.prototype,"_createWorker",e=>function(){let r=this,s=e.apply(this,arguments);return s.process.on("message",({method:n,params:i})=>{if(n==="testBegin"){let{test:o}=r._testById.get(i.testId);_w(o)}else if(n==="testEnd"){let{test:o}=r._testById.get(i.testId),{results:a}=o,c=a[a.length-1];bw(o,Fl[c.status],c.error)}}),s}),t}function vw(t,e){return ys.wrap(t.Dispatcher.prototype,"run",e),ys.wrap(t.Dispatcher.prototype,"_createWorker",r=>function(){let s=this,n=r.apply(this,arguments);return n.on("testBegin",({testId:i})=>{let{test:o}=s._testById.get(i);_w(o)}),n.on("testEnd",({testId:i,status:o,errors:a})=>{let{test:c}=s._testById.get(i);bw(c,Fl[o],a&&a[0])}),n}),t}function Sw(t,e){return ys.wrap(t.Runner.prototype,"runAllTests",r=>async function(){let s=new $l("bound-anonymous-fn"),n=Wz(this),o=`playwright ${process.argv.slice(2).join(" ")}`;s.runInAsyncScope(()=>{Uz.publish({command:o,frameworkVersion:e,rootDir:n})});let a=await r.apply(this,arguments),c=a.status||a,u,l=new Promise(d=>{u=d});return s.runInAsyncScope(()=>{Hz.publish({status:Fl[c],onDone:u})}),await l,Gl=[],hr={},a}),t}vs({name:"@playwright/test",file:"lib/runner.js",versions:[">=1.18.0 <1.30.0"]},Sw);vs({name:"@playwright/test",file:"lib/dispatcher.js",versions:[">=1.18.0  <1.30.0"]},Kz);vs({name:"@playwright/test",file:"lib/dispatcher.js",versions:[">=1.30.0 <1.31.0"]},t=>vw(t,yw));vs({name:"@playwright/test",file:"lib/runner/dispatcher.js",versions:[">=1.31.0"]},t=>vw(t,Vz));vs({name:"@playwright/test",file:"lib/runner/runner.js",versions:[">=1.31.0"]},Sw)});var Ss=p((zte,Tw)=>{"use strict";var{channel:zl,addHook:Wl,AsyncResource:Ew}=m(),Vl=b();Wl({name:"@elastic/transport",file:"lib/Transport.js",versions:[">=8"]},t=>(Vl.wrap(t.default.prototype,"request",vi("elasticsearch")),t));Wl({name:"@elastic/elasticsearch",file:"lib/Transport.js",versions:[">=5.6.16 <8",">=8"]},t=>(Vl.wrap(t.prototype,"request",vi("elasticsearch")),t));Wl({name:"elasticsearch",file:"src/lib/transport.js",versions:[">=10"]},t=>(Vl.wrap(t.prototype,"request",vi("elasticsearch")),t));function vi(t){let e=zl(`apm:${t}:query:start`),r=zl(`apm:${t}:query:finish`),s=zl(`apm:${t}:query:error`);return function(o){return function(a,c,u){if(!e.hasSubscribers)return o.apply(this,arguments);if(!a)return o.apply(this,arguments);let l=new Ew("bound-anonymous-fn"),d=new Ew("bound-anonymous-fn");return d.runInAsyncScope(()=>{e.publish({params:a});try{let h=arguments.length-1;if(u=arguments[h],typeof u=="function")return u=l.bind(u),arguments[h]=d.bind(function(f){return n(a,f),u.apply(null,arguments)}),o.apply(this,arguments);{let f=o.apply(this,arguments);if(f&&typeof f.then=="function"){let g=d.bind(()=>n(a)),v=d.bind(q=>n(a,q));f.then(g,v)}else n(a);return f}}catch(h){throw h.stack,s.publish(h),h}})}};function n(i,o){o&&s.publish(o),r.publish({params:i})}}Tw.exports={createWrapRequest:vi}});var kw=p(()=>{"use strict";var{channel:gr,addHook:Ql,AsyncResource:Xl}=m(),qs=b(),ww=gr("apm:google-cloud-pubsub:request:start"),Kl=gr("apm:google-cloud-pubsub:request:finish"),xw=gr("apm:google-cloud-pubsub:request:error"),Iw=gr("apm:google-cloud-pubsub:receive:start"),Aw=gr("apm:google-cloud-pubsub:receive:finish"),Yz=gr("apm:google-cloud-pubsub:receive:error"),Jz=["createTopic","updateTopic","publish","getTopic","listTopics","listTopicSubscriptions","listTopicSnapshots","deleteTopic","detachSubscription"],Xz=["createSchema","getSchema","listSchemas","listSchemaRevisions","commitSchema","rollbackSchema","deleteSchemaRevision","deleteSchema","validateSchema","validateMessage"],Qz=["createSubscription","getSubscription","updateSubscription","listSubscriptions","deleteSubscription","modifyAckDeadline","acknowledge","pull","streamingPull","modifyPushConfig","getSnapshot","listSnapshots","createSnapshot","updateSnapshot","deleteSnapshot","seek"];function Yl(t){let e=t.name;return function(r){if(!ww.hasSubscribers)return t.apply(this,arguments);let s=new Xl("bound-anonymous-fn");return s.runInAsyncScope(()=>{let n=this.auth._cachedProjectId,i=arguments[arguments.length-1];if(ww.publish({request:r,api:e,projectId:n}),typeof i=="function"){let o=new Xl("bound-anonymous-fn");return arguments[arguments.length-1]=s.bind(function(a){return a&&xw.publish(a),Kl.publish(),o.runInAsyncScope(()=>i.apply(this,arguments))}),t.apply(this,arguments)}else return t.apply(this,arguments).then(o=>(Kl.publish(),o),o=>{throw xw.publish(o),Kl.publish(),o})})}}function Jl(t,e,r){for(let s of e)typeof t[s]=="function"&&qs.wrap(t,s,r)}Ql({name:"@google-cloud/pubsub",versions:[">=1.2"]},t=>{let e=t.Subscription;return qs.wrap(e.prototype,"emit",r=>function(s,n){return s!=="message"||!n?r.apply(this,arguments):new Xl("bound-anonymous-fn").runInAsyncScope(()=>{try{return r.apply(this,arguments)}catch(o){throw Yz.publish(o),o}})}),t});Ql({name:"@google-cloud/pubsub",versions:[">=1.2"],file:"build/src/lease-manager.js"},t=>{let e=t.LeaseManager;return qs.wrap(e.prototype,"_dispense",r=>function(s){return Iw.hasSubscribers&&Iw.publish({message:s}),r.apply(this,arguments)}),qs.wrap(e.prototype,"remove",r=>function(s){return Aw.publish({message:s}),r.apply(this,arguments)}),qs.wrap(e.prototype,"clear",r=>function(){for(let s of this._messages)Aw.publish({message:s});return r.apply(this,arguments)}),t});Ql({name:"@google-cloud/pubsub",versions:[">=1.2"]},t=>{let{PublisherClient:e,SchemaServiceClient:r,SubscriberClient:s}=t.v1;return Jl(e.prototype,Jz,Yl),Jl(s.prototype,Qz,Yl),r&&Jl(r.prototype,Xz,Yl),t})});var Zl=p((Kte,Rw)=>{"use strict";Rw.exports={unary:"unary",bidi:"bidi_streaming",client_stream:"client_streaming",clientStream:"client_streaming",server_stream:"server_streaming",serverStream:"server_streaming"}});var Fw=p(()=>{"use strict";var Ne=Zl(),{addHook:qi,channel:ed,AsyncResource:Cw}=m(),gt=b(),Ow=new WeakSet,Mw=new WeakMap,Pw=ed("apm:grpc:client:request:start"),Lw=ed("apm:grpc:client:request:error"),Zz=ed("apm:grpc:client:request:finish");function Si(t){return function(r){return function(s){let n=$w(this,arguments,4);return Bw(this,r,n,s,n[4],t)}}}function eW(){return function(e){return function(r){let s=e.apply(this,arguments);return s&&(Uw(s),s)}}}function jw(){return function(e){return function(r){let s=e.apply(this,arguments);return Hw(s,r),s}}}function Uw(t){for(let e in t)t[e].format||(t[e].service&&t[e].prototype?Hw(t[e],t[e].service):Uw(t[e]))}function Hw(t,e){let r=t.prototype;typeof e!="object"||"format"in e||Object.keys(e).forEach(s=>{if(!e[s])return;let n=e[s].originalName,i=e[s].path,o=rW(e[s]);e[s]&&(r[s]=Nw(r[s],i,o)),n&&(r[n]=Nw(r[n],i,o))})}function Nw(t,e,r){if(typeof t!="function"||Ow.has(t))return t;let s=function(){let n=$w(this,arguments,1);return Bw(this,t,n,e,n[1],r)};return Object.assign(s,t),Ow.add(s),s}function Dw(t,e,r){return function(s){if(s&&t.runInAsyncScope(()=>{Lw.publish(s)}),r)return e.runInAsyncScope(()=>r.apply(this,arguments))}}function tW(t,e,r){!t||typeof t.emit!="function"||gt.wrap(t,"emit",s=>function(n,...i){return e.runInAsyncScope(()=>{switch(n){case"error":Lw.publish(i[0]);break;case"status":Zz.publish(i[0]);break}}),r.runInAsyncScope(()=>s.apply(this,arguments))})}function Bw(t,e,r,s,n,i){if(!Pw.hasSubscribers)return e.apply(t,r);let o=r.length,a=r[o-1],c=new Cw("bound-anonymous-fn"),u=new Cw("bound-anonymous-fn");return u.runInAsyncScope(()=>{Pw.publish({metadata:n,path:s,type:i}),(i===Ne.unary||i===Ne.client_stream)&&(typeof a=="function"?r[o-1]=Dw(u,c,a):r[o]=Dw(u,c));let l=e.apply(t,r);return tW(l,u,c),l})}function $w(t,e,r){let s=sW(t);if(!t||!s)return e;let n=e[r],i=[];for(let o=0;o<r;o++)i.push(e[o]);(!n||!n.constructor||n.constructor.name!=="Metadata")&&i.push(new s.Metadata),n&&i.push(n);for(let o=r+1;o<e.length;o++)i.push(e[o]);return i}function rW(t){return t.requestStream?t.responseStream?Ne.bidi:Ne.client_stream:t.responseStream?Ne.server_stream:Ne.unary}function sW(t){let e=t;do{let r=Mw.get(e);if(r)return r}while(e=Object.getPrototypeOf(e))}function Gw(t){let e=t.Client.prototype;return Mw.set(e,t),gt.wrap(e,"makeBidiStreamRequest",Si(Ne.bidi)),gt.wrap(e,"makeClientStreamRequest",Si(Ne.clientStream)),gt.wrap(e,"makeServerStreamRequest",Si(Ne.serverStream)),gt.wrap(e,"makeUnaryRequest",Si(Ne.unary)),t}qi({name:"grpc",versions:[">=1.24.3"]},Gw);qi({name:"grpc",versions:[">=1.24.3"],file:"src/client.js"},t=>(gt.wrap(t,"makeClientConstructor",jw()),t));qi({name:"@grpc/grpc-js",versions:[">=1.0.3"]},Gw);qi({name:"@grpc/grpc-js",versions:[">=1.0.3"],file:"build/src/make-client.js"},t=>(gt.wrap(t,"makeClientConstructor",jw()),gt.wrap(t,"loadPackageDefinition",eW()),t))});var Xw=p(()=>{"use strict";var nW=Zl(),{channel:Ei,addHook:Vw,AsyncResource:zw}=m(),Ti=b(),Ww=Ei("apm:grpc:server:request:start"),Kw=Ei("apm:grpc:server:request:error"),Yw=Ei("apm:grpc:server:request:update"),Es=Ei("apm:grpc:server:request:finish"),iW=0,oW=1;function aW(t,e){let r=(s,n)=>!(!Ww.hasSubscribers||!s||!s.type||!n[0]||s.type!=="unary"&&!lW(n[0])||s.type==="unary"&&typeof n[1]!="function");return function(s,n){if(!r(this,arguments))return t.apply(this,arguments);let i=s.metadata,o=nW[this.type],a=o!=="unary",c=new zw("bound-anonymous-fn"),u=new zw("bound-anonymous-fn");return u.runInAsyncScope(()=>{Ww.publish({name:e,metadata:i,type:o});let l=u.bind(()=>{Es.publish({code:oW})});return s.once("cancelled",l),a?cW(s,u,l):arguments[1]=uW(n,s,u,c,l),Ti.wrap(s,"emit",d=>u.bind(d)),t.apply(this,arguments)})}}function Jw(t){return function(e,r,s,n,i){return typeof r=="function"&&(arguments[1]=aW(r,e)),t.apply(this,arguments)}}function cW(t,e,r){t.call&&t.call.sendStatus&&(t.call.sendStatus=pW(t.call.sendStatus,e)),Ti.wrap(t,"emit",s=>function(n,...i){switch(n){case"error":Kw.publish(i[0]),Es.publish({code:i[0].code}),t.removeListener("cancelled",r);break;case"finish":t.status&&Yw.publish(t.status),(!t.status||t.status.code===0)&&Es.publish(),t.removeListener("cancelled",r);break}return s.apply(this,arguments)})}function uW(t,e,r,s,n){return function(i,o,a,c){if(r.runInAsyncScope(()=>{i instanceof Error?(Kw.publish(i),Es.publish(i)):Es.publish({code:iW,trailer:a}),e.removeListener("cancelled",n)}),t)return s.runInAsyncScope(()=>t.apply(this,arguments))}}function pW(t,e){return function(r){return e.runInAsyncScope(()=>{Yw.publish(r)}),t.apply(this,arguments)}}function lW(t){return typeof t.emit=="function"&&typeof t.once=="function"}Vw({name:"grpc",versions:[">=1.24.3"],file:"src/server.js"},t=>(Ti.wrap(t.Server.prototype,"register",Jw),t));Vw({name:"@grpc/grpc-js",versions:[">=1.0.3"],file:"build/src/server.js"},t=>(Ti.wrap(t.Server.prototype,"register",Jw),t))});var td=p(()=>{"use strict";Fw();Xw()});var sd=p(()=>{"use strict";var Ve=b(),{addHook:mt,channel:wi,AsyncResource:dW}=m(),hW=wi("apm:hapi:request:handle"),fW=wi("apm:hapi:request:route"),gW=wi("apm:hapi:request:error"),mW=wi("apm:hapi:extension:enter");function Zw(t){return function(e){let r=t.apply(this,arguments);return r&&(typeof r.ext=="function"&&(r.ext=tx(r.ext)),typeof r.start=="function"&&(r.start=ex(r.start)),r)}}function ex(t){return function(){return this&&typeof this.ext=="function"&&this.ext("onPreResponse",bW),t.apply(this,arguments)}}function tx(t){return function(e,r,s){return typeof e=="object"?arguments[0]=_W(e):arguments[1]=sx(r),t.apply(this,arguments)}}function rd(t){return function(e){let r=t.apply(this,arguments);return typeof r!="function"?r:function(s,n){return hW.publish({req:s,res:n}),r.apply(this,arguments)}}}function rx(t){return function(e){let r=t.apply(this,arguments);return this&&Array.isArray(this._cycle)&&(this._cycle=this._cycle.map(nx)),r}}function sx(t){return[].concat(t).map(nx)}function _W(t){return[].concat(t).map(e=>!e||!e.method?e:Object.assign({},e,{method:sx(e.method)}))}function nx(t){return typeof t!="function"?t:function(e,r){let s=e&&e.raw&&e.raw.req;return s?new dW("bound-anonymous-fn").runInAsyncScope(()=>(mW.publish({req:s}),t.apply(this,arguments))):t.apply(this,arguments)}}function bW(t,e){if(!t||!t.raw)return Qw(t,e);let r=t.raw.req;return t.response instanceof Error&&gW.publish(t.response),t.route&&fW.publish({req:r,route:t.route.path}),Qw(t,e)}function Qw(t,e){if(e.continue)return typeof e.continue=="function"?e.continue():e.continue;if(typeof e=="function")return e()}mt({name:"@hapi/hapi",versions:[">=17.9"]},t=>(Ve.massWrap(t,["server","Server"],Zw),t));mt({name:"@hapi/hapi",versions:[">=17.9"],file:"lib/core.js"},t=>(Ve.wrap(t.prototype,"_dispatch",rd),t));mt({name:"@hapi/hapi",versions:[">=17.9"],file:"lib/route.js"},t=>(Ve.wrap(t.prototype,"rebuild",rx),t));mt({name:"hapi",versions:[">=17"]},t=>(Ve.massWrap(t,["server","Server"],Zw),t));mt({name:"hapi",versions:["16"]},t=>(Ve.wrap(t.Server.prototype,"start",ex),Ve.wrap(t.Server.prototype,"ext",tx),t));mt({name:"hapi",versions:["16"],file:"lib/connection.js"},t=>(Ve.wrap(t.prototype,"_dispatch",rd),t));mt({name:"hapi",versions:[">=17"],file:"lib/core.js"},t=>(Ve.wrap(t.prototype,"_dispatch",rd),t));mt({name:"hapi",versions:[">=16"],file:"lib/route.js"},t=>(Ve.wrap(t.prototype,"rebuild",rx),t))});var ox=p((sre,ix)=>{function yW(t){if(!t||!t.length)return;let[e,...r]=t;if(r.length===0)return e;let s=e[0].split("|").map(i=>i.trim()),n=[];for(let i=0;i<r.length;i++){let o=r[i],a=i%s.length;a||n.push({});let c=s[a],u=n[n.length-1];u[c]=o}return n}function vW(t){let e=[],r=t;do e.unshift(r.name);while(r=r.parent);return e.shift(),e.join(" ")}ix.exports={getFormattedJestTestParameters:yW,getJestTestName:vW}});var Ye=p(()=>{"use strict";var{addHook:Te,channel:Y,AsyncResource:xs}=m(),Ke=b(),ax=E(),{getCoveredFilenamesFromCoverage:SW,JEST_WORKER_TRACE_PAYLOAD_CODE:qW,JEST_WORKER_COVERAGE_PAYLOAD_CODE:EW,getTestLineStart:cx}=ve(),TW=Y("ci:jest:session:start"),wW=Y("ci:jest:session:finish"),xW=Y("ci:jest:session:configuration"),IW=Y("ci:jest:test-suite:start"),AW=Y("ci:jest:test-suite:finish"),kW=Y("ci:jest:worker-report:trace"),RW=Y("ci:jest:worker-report:coverage"),CW=Y("ci:jest:test-suite:code-coverage"),fx=Y("ci:jest:test:start"),OW=Y("ci:jest:test:skip"),gx=Y("ci:jest:test:finish"),mx=Y("ci:jest:test:err"),PW=Y("ci:jest:test-suite:skippable"),ux=Y("ci:jest:itr-configuration"),Ts=[],xi=!1,ws=!1,{getTestSuitePath:nd,getTestParametersString:NW}=ve(),{getFormattedJestTestParameters:DW,getJestTestName:px}=ox(),Lt=new xs("bound-anonymous-fn"),MW={pending:"skip",disabled:"skip",todo:"skip",passed:"pass",failed:"fail"},lx=new WeakMap,dx=new WeakMap;function _x(t){let e;if(Array.isArray(t)){let[r,s]=t;r===null||!r.stack?(e=s,e.message=r):e=r}else e=t;return e}function LW(t){return t.projectConfig&&t.projectConfig.testEnvironmentOptions?t.projectConfig.testEnvironmentOptions:t.testEnvironmentOptions?t.testEnvironmentOptions:{}}function hx(t,e){return class extends t{constructor(s,n){super(s,n);let i=s.globalConfig?s.globalConfig.rootDir:s.rootDir;this.rootDir=i,this.testSuite=nd(n.testPath,i),this.nameToParams={},this.global._ddtrace=global._ddtrace,this.testEnvironmentOptions=LW(s)}async handleTestEvent(s,n){super.handleTestEvent&&await super.handleTestEvent(s,n);let i=(o,a)=>{this.nameToParams[o]=a};if(s.name==="setup"&&this.global.test&&Ke.wrap(this.global.test,"each",o=>function(){let a=DW(arguments),c=o.apply(this,arguments);return function(){let[u]=arguments;return i(u,a),c.apply(this,arguments)}}),s.name==="test_start"){let o=NW(this.nameToParams,s.test.name),a=new xs("bound-anonymous-fn");lx.set(s.test,a),a.runInAsyncScope(()=>{fx.publish({name:px(s.test),suite:this.testSuite,runner:"jest-circus",testParameters:o,frameworkVersion:e,testStartLine:cx(s.test.asyncError,this.testSuite)}),dx.set(s.test,s.test.fn),s.test.fn=a.bind(s.test.fn)})}s.name==="test_done"&&lx.get(s.test).runInAsyncScope(()=>{let a="pass";if(s.test.errors&&s.test.errors.length){a="fail";let c=_x(s.test.errors[0]);mx.publish(c)}gx.publish(a),s.test.fn=dx.get(s.test)}),(s.name==="test_skip"||s.name==="test_todo")&&new xs("bound-anonymous-fn").runInAsyncScope(()=>{OW.publish({name:px(s.test),suite:this.testSuite,runner:"jest-circus",frameworkVersion:e,testStartLine:cx(s.test.asyncError,this.testSuite)})})}}}function bx(t,e){if(t.default){let r=hx(t.default,e);return t.default=r,t.TestEnvironment=r,t}return hx(t,e)}Te({name:"jest-environment-node",versions:[">=24.8.0"]},bx);Te({name:"jest-environment-jsdom",versions:[">=24.8.0"]},bx);function jW(t,e){let r=Ke.wrap(t,"runCLI",s=>async function(){let n,i=new Promise(h=>{n=h});if(!ux.hasSubscribers)return s.apply(this,arguments);Lt.runInAsyncScope(()=>{ux.publish({onDone:n})});try{let{err:h,itrConfig:f}=await i;h||(xi=f.isCodeCoverageEnabled,ws=f.isSuitesSkippingEnabled)}catch(h){ax.error(h)}if(ws){let h=new Promise(f=>{n=f});Lt.runInAsyncScope(()=>{PW.publish({onDone:n})});try{let{err:f,skippableSuites:g}=await h;f||(Ts=g)}catch(f){ax.error(f)}}let o=!!Ts.length,a=process.argv.slice(2).join(" ");Lt.runInAsyncScope(()=>{TW.publish({command:`jest ${a}`,frameworkVersion:e})});let c=await s.apply(this,arguments),{results:{success:u,coverageMap:l}}=c,d;try{let{pct:h,total:f}=l.getCoverageSummary().lines;d=f!==0?h:0}catch{}return Lt.runInAsyncScope(()=>{wW.publish({status:u?"pass":"fail",isSuitesSkipped:o,isSuitesSkippingEnabled:ws,isCodeCoverageEnabled:xi,testCodeCoverageLinesTotal:d})}),c});return t.runCLI=r.runCLI,t}function yx(t){let e=t.default?t.default:t;return Ke.wrap(e.prototype,"_addUntestedFiles",r=>async function(){return ws?Promise.resolve():r.apply(this,arguments)}),t}Te({name:"@jest/reporters",file:"build/coverage_reporter.js",versions:[">=24.8.0 <26.6.2"]},yx);Te({name:"@jest/reporters",file:"build/CoverageReporter.js",versions:[">=26.6.2"]},yx);Te({name:"@jest/core",file:"build/cli/index.js",versions:[">=24.8.0"]},jW);function UW(t,e){let r=t.default?t.default:t,s=Ke.wrap(r,function(){let n=arguments[2];if(!n)return r.apply(this,arguments);let i=new xs("bound-anonymous-fn");return i.runInAsyncScope(()=>(IW.publish({testSuite:n.testSuite,testEnvironmentOptions:n.testEnvironmentOptions,frameworkVersion:e}),r.apply(this,arguments).then(o=>{let{numFailingTests:a,skipped:c,failureMessage:u}=o,l="pass";c?l="skipped":a!==0&&(l="fail");let d=SW(n.global.__coverage__).map(h=>nd(h,n.rootDir));return d&&n.testEnvironmentOptions&&n.testEnvironmentOptions._ddTestCodeCoverageEnabled&&i.runInAsyncScope(()=>{CW.publish([...d,n.testSuite])}),AW.publish({status:l,errorMessage:u}),o})))});return t.default?t.default=s:t=s,t}Te({name:"jest-circus",file:"build/legacy-code-todo-rewrite/jestAdapter.js",versions:[">=24.8.0"]},UW);function vx(t){let{configs:e}=t;if(Lt.runInAsyncScope(()=>{xW.publish(e.map(r=>r.testEnvironmentOptions))}),e.forEach(r=>{r.testEnvironmentOptions._ddTestCodeCoverageEnabled=xi}),xi){let r={...t.globalConfig,collectCoverage:!0};t.globalConfig=r}if(ws){let r={...t.globalConfig,coverageReporters:["none"],passWithNoTests:!0};t.globalConfig=r}return t}function HW(t){return Ke.wrap(t,"readConfigs",e=>async function(){let r=await e.apply(this,arguments);return vx(r),r}),t}function BW(t){return Ke.wrap(t,"readConfigs",e=>function(){let r=e.apply(this,arguments);return vx(r),r}),t}Te({name:"@jest/core",versions:[">=24.8.0"],file:"build/SearchSource.js"},t=>{let e=t.default?t.default:t;return Ke.wrap(e.prototype,"getTestPaths",r=>async function(){if(!Ts.length)return r.apply(this,arguments);let[{rootDir:s}]=arguments,n=await r.apply(this,arguments),{tests:i}=n,o=i.filter(({path:a})=>{let c=a.replace(`${s}/`,"");return!Ts.includes(c)});return Ts=[],{...n,tests:o}}),t});Te({name:"jest-config",versions:[">=25.1.0"]},HW);Te({name:"jest-config",versions:["24.8.0 - 24.9.0"]},BW);function $W(t,e){return function(r,s){return s._ddtrace=global._ddtrace,Ke.wrap(s.jasmine.Spec.prototype,"execute",n=>function(i){let o=new xs("bound-anonymous-fn");o.runInAsyncScope(()=>{let a=nd(this.result.testPath,r.rootDir);fx.publish({name:this.getFullName(),suite:a,runner:"jest-jasmine2",frameworkVersion:e});let c=this,u=o.bind(function(){if(c.result.failedExpectations&&c.result.failedExpectations.length){let l=_x(c.result.failedExpectations[0].error);mx.publish(l)}gx.publish(MW[c.result.status]),i.apply(this,arguments)});arguments[0]=u,n.apply(this,arguments)})}),t.default(r,s)}}Te({name:"jest-jasmine2",versions:[">=24.8.0"],file:"build/jasmineAsyncInstall.js"},$W);Te({name:"jest-worker",versions:[">=24.9.0"],file:"build/workers/ChildProcessWorker.js"},t=>{let e=t.default;return Ke.wrap(e.prototype,"_onMessage",r=>function(){let[s,n]=arguments[0];if(s===qW){Lt.runInAsyncScope(()=>{kW.publish(n)});return}if(s===EW){Lt.runInAsyncScope(()=>{RW.publish(n)});return}return r.apply(this,arguments)}),t})});var Ai=p(()=>{"use strict";var jt=b(),{addHook:id,channel:Ut}=m(),Sx=Ut("apm:koa:middleware:enter"),GW=Ut("apm:koa:middleware:exit"),FW=Ut("apm:koa:middleware:error"),zW=Ut("apm:koa:middleware:next"),WW=Ut("apm:koa:middleware:finish"),VW=Ut("apm:koa:request:handle"),KW=Ut("apm:koa:request:route"),qx=new WeakMap;function YW(t){return function(){let r=t.apply(this,arguments);return typeof r!="function"?r:function(n,i){return VW.publish({req:n,res:i}),r.apply(this,arguments)}}}function JW(t){return function(){let r=t.apply(this,arguments);if(!Array.isArray(this.middleware))return r;let s=this.middleware.pop();return this.middleware.push(xx(s)),r}}function Ex(t){return function(r,s,n,i){let o=t.apply(this,arguments);return!Array.isArray(r)&&o&&Array.isArray(o.stack)&&wx(o),o}}function Tx(t){return function(){let r=t.apply(this,arguments);return r.stack.forEach(wx),r}}function wx(t){t.stack=t.stack.map(e=>{if(typeof e!="function")return e;e=qx.get(e)||e;let s=jt.wrap(e,xx(e,t));return qx.set(s,e),s})}function xx(t,e){if(typeof t!="function")return t;let r=t.name;return function(s,n){if(!s||!Sx.hasSubscribers)return t.apply(this,arguments);let i=s.req,o=e&&e.path,a=typeof o=="string"&&!o.endsWith("(.*)")&&!o.endsWith("([^/]*)")&&o;Sx.publish({req:i,name:r,route:a}),typeof n=="function"&&(arguments[1]=XW(i,n));try{let c=t.apply(this,arguments);return c&&typeof c.then=="function"?c.then(u=>(Ii(s),u),u=>{throw Ii(s,u),u}):(Ii(s),c)}catch(c){throw Ii(s,c),c}finally{GW.publish({req:i})}}}function Ii(t,e){let r=t.req,s=t.routePath;e&&FW.publish({req:r,error:e}),s&&KW.publish({req:r,route:s}),WW.publish({req:r})}function XW(t,e){return function(){return zW.publish({req:t}),e.apply(this,arguments)}}id({name:"koa",versions:[">=2"]},t=>(jt.wrap(t.prototype,"callback",YW),jt.wrap(t.prototype,"use",JW),t));id({name:"@koa/router",versions:[">=8"]},t=>(jt.wrap(t.prototype,"register",Ex),jt.wrap(t.prototype,"use",Tx),t));id({name:"koa-router",versions:[">=7"]},t=>(jt.wrap(t.prototype,"register",Ex),jt.wrap(t.prototype,"use",Tx),t))});var Pi=p(()=>{"use strict";var{channel:ad,addHook:Ri,AsyncResource:Is}=m(),Ci=b(),Oi=ad("apm:redis:command:start"),mr=ad("apm:redis:command:finish"),_t=ad("apm:redis:command:error");function Ix(t){return function(e){if(!Oi.hasSubscribers)return t.apply(this,arguments);let r=e[0],s=e.slice(1),n=new Is("bound-anonymous-fn");return n.runInAsyncScope(()=>{cd(this,r,s);let i=t.apply(this,arguments),o=n.bind(()=>od(mr,_t)),a=n.bind(c=>od(mr,_t,c));return i.then(o,a),i})}}Ri({name:"@redis/client",file:"dist/lib/client/commands-queue.js",versions:[">=1.1"]},t=>(Ci.wrap(t.default.prototype,"addCommand",Ix),t));Ri({name:"@node-redis/client",file:"dist/lib/client/commands-queue.js",versions:[">=1"]},t=>(Ci.wrap(t.default.prototype,"addCommand",Ix),t));Ri({name:"redis",versions:[">=2.6 <4"]},t=>(Ci.wrap(t.RedisClient.prototype,"internal_send_command",e=>function(r){if(!Oi.hasSubscribers)return e.apply(this,arguments);if(!r.callback)return e.apply(this,arguments);let s=new Is("bound-anonymous-fn"),n=new Is("bound-anonymous-fn"),i=s.bind(r.callback);return n.runInAsyncScope(()=>{cd(this,r.command,r.args),r.callback=n.bind(ki(mr,_t,i));try{return e.apply(this,arguments)}catch(o){throw _t.publish(o),o}})}),t));Ri({name:"redis",versions:[">=0.12 <2.6"]},t=>(Ci.wrap(t.RedisClient.prototype,"send_command",e=>function(r,s,n){if(!Oi.hasSubscribers)return e.apply(this,arguments);let i=new Is("bound-anonymous-fn"),o=new Is("bound-anonymous-fn");return o.runInAsyncScope(()=>{if(cd(this,r,s),typeof n=="function"){let a=i.bind(n);arguments[2]=o.bind(ki(mr,_t,a))}else if(Array.isArray(s)&&typeof s[s.length-1]=="function"){let a=i.bind(s[s.length-1]);s[s.length-1]=o.bind(ki(mr,_t,a))}else arguments[2]=o.bind(ki(mr,_t));try{return e.apply(this,arguments)}catch(a){throw _t.publish(a),a}})}),t));function cd(t,e,r){let s=t.selected_db,n=t.connection_options||t.connection_option||t.connectionOption||{};Oi.publish({db:s,command:e,args:r,connectionOptions:n})}function ki(t,e,r){return function(s){if(od(t,e,s),r)return r.apply(this,arguments)}}function od(t,e,r){r&&e.publish(r),t.publish()}});var Ax=p(()=>{"use strict";var{addHook:QW}=m(),ZW=b(),{createWrapRequest:eV}=Ss();QW({name:"@opensearch-project/opensearch",file:"lib/Transport.js",versions:[">=1"]},t=>(ZW.wrap(t.prototype,"request",eV("opensearch")),t))});var Ox=p(()=>{"use strict";var{channel:_r,addHook:kx,AsyncResource:Rx}=m(),Cx=b();kx({name:"amqp10",file:"lib/sender_link.js",versions:[">=3"]},t=>{let e=_r("apm:amqp10:send:start"),r=_r("apm:amqp10:send:finish"),s=_r("apm:amqp10:send:error");return Cx.wrap(t.prototype,"send",n=>function(i,o){if(!e.hasSubscribers)return n.apply(this,arguments);let a=new Rx("bound-anonymous-fn");return a.runInAsyncScope(()=>{e.publish({link:this});try{let c=n.apply(this,arguments);return c?(c.then(a.bind(()=>Ni(r,s)),a.bind(u=>Ni(r,s,u))),c):(Ni(r,s),c)}catch(c){throw Ni(r,s,c),c}})}),t});kx({name:"amqp10",file:"lib/receiver_link.js",versions:[">=3"]},t=>{let e=_r("apm:amqp10:receive:start"),r=_r("apm:amqp10:receive:finish"),s=_r("apm:amqp10:receive:error");return Cx.wrap(t.prototype,"_messageReceived",n=>function(i){return!i||i.aborted||i.more?n.apply(this,arguments):new Rx("bound-anonymous-fn").runInAsyncScope(()=>{e.publish({link:this});try{return n.apply(this,arguments)}catch(a){throw s.publish(a),a}finally{r.publish()}})}),t});function Ni(t,e,r){r&&e.publish(r),t.publish()}});var Mx=p(()=>{"use strict";var{channel:ld,addHook:Nx,AsyncResource:tV}=m(),rV=require("lodash.kebabcase"),ud=b(),Px=ld("apm:amqplib:command:start"),sV=ld("apm:amqplib:command:finish"),nV=ld("apm:amqplib:command:error"),Dx={};Nx({name:"amqplib",file:"lib/defs.js",versions:[">=0.5"]},t=>(Dx=Object.keys(t).filter(e=>Number.isInteger(t[e])).filter(e=>iV(e)).reduce((e,r)=>Object.assign(e,{[t[r]]:rV(r).replace("-",".")}),{}),t));Nx({name:"amqplib",file:"lib/channel.js",versions:[">=0.5"]},t=>(ud.wrap(t.Channel.prototype,"sendImmediately",e=>function(r,s){return pd(e,this,arguments,Dx[r],s)}),ud.wrap(t.Channel.prototype,"sendMessage",e=>function(r){return pd(e,this,arguments,"basic.publish",r)}),ud.wrap(t.BaseChannel.prototype,"dispatchMessage",e=>function(r,s){return pd(e,this,arguments,"basic.deliver",r,s)}),t));function pd(t,e,r,s,n,i){return Px.hasSubscribers?new tV("bound-anonymous-fn").runInAsyncScope(()=>{Px.publish({channel:e,method:s,fields:n,message:i});try{return t.apply(e,r)}catch(a){throw nV.publish(a),a}finally{sV.publish()}}):t.apply(e,r)}function iV(t){return/([A-Z][a-z0-9]+)+/.test(t)}});var Ht=p(Lx=>{"use strict";var{AsyncResource:oV}=require("async_hooks");Lx.wrapThen=function(e){return function(s,n,i){let o=new oV("bound-anonymous-fn");return arguments[0]=dd(o,s),arguments[1]=dd(o,n),i&&(arguments[2]=dd(o,i)),e.apply(this,arguments)}};function dd(t,e){return typeof e!="function"?e:function(){return t.runInAsyncScope(()=>e.apply(this,arguments))}}});var Bx=p(()=>{"use strict";var{addHook:jx}=m(),{wrapThen:Ux}=Ht(),Di=b();function Hx(t){return function(r){return function(){let n=r.apply(this,arguments);return Di.wrap(n.prototype,"_then",Ux),Di.wrap(n,"getNewLibraryCopy",Hx(t)),n}}}jx({name:"bluebird",versions:[">=2.0.2"]},t=>(Di.wrap(t.prototype,"_then",Ux),t));jx({name:"bluebird",versions:["^2.11.0","^3.4.1"]},t=>(Di.wrap(t,"getNewLibraryCopy",Hx(t)),t))});var Gx=p(()=>{"use strict";var{channel:aV,addHook:cV,AsyncResource:uV}=m(),$x=aV("datadog:body-parser:read:finish");function pV(t,e){return function(){$x.hasSubscribers&&t&&$x.publish({request:t}),e.apply(this,arguments)}}cV({name:"body-parser",file:"lib/read.js",versions:[">=1"]},t=>function(e,r,s){let n=new uV("bound-anonymous-fn");arguments[2]=n.bind(pV(e,s)),t.apply(this,arguments)})});var Fx=p(()=>{"use strict";var{channel:lV,addHook:dV}=m(),hV=b();dV({name:"bunyan",versions:[">=1"]},t=>{let e=lV("apm:bunyan:log");return hV.wrap(t.prototype,"_emit",r=>function(n){if(e.hasSubscribers){let i={message:n};e.publish(i),arguments[0]=i.message}return r.apply(this,arguments)}),t})});var Wx=p(()=>{"use strict";var{channel:Mi,addHook:br,AsyncResource:we}=m(),yr=b(),Qe=Mi("apm:cassandra-driver:query:start"),Je=Mi("apm:cassandra-driver:query:finish"),Xe=Mi("apm:cassandra-driver:query:error"),fd=Mi("apm:cassandra-driver:query:connect");br({name:"cassandra-driver",versions:[">=3.0.0"]},t=>(yr.wrap(t.Client.prototype,"batch",e=>function(r,s,n){if(!Qe.hasSubscribers)return e.apply(this,arguments);let i=new we("bound-anonymous-fn"),o=new we("bound-anonymous-fn"),a=arguments.length-1,c=arguments[a];return typeof c=="function"&&(c=i.bind(c),arguments[a]=hd(Je,Xe,o,c)),o.runInAsyncScope(()=>{Qe.publish({keyspace:this.keyspace,query:r});try{let u=e.apply(this,arguments);if(typeof u=="function"||!u)return hd(Je,Xe,o,u);{let l=new we("bound-anonymous-fn");return u.then(l.bind(()=>Bt(Je,Xe)),l.bind(d=>Bt(Je,Xe,d)))}}catch(u){throw Bt(Je,Xe,u),u}})}),t));br({name:"cassandra-driver",versions:[">=4.4"]},t=>(yr.wrap(t.Client.prototype,"_execute",e=>function(r,s,n,i){return Qe.hasSubscribers?new we("bound-anonymous-fn").runInAsyncScope(()=>{Qe.publish({keyspace:this.keyspace,query:r});let a=e.apply(this,arguments),c=new we("bound-anonymous-fn");return a.then(c.bind(()=>Bt(Je,Xe)),c.bind(u=>Bt(Je,Xe,u))),a}):e.apply(this,arguments)}),t));br({name:"cassandra-driver",versions:["3 - 4.3"]},t=>(yr.wrap(t.Client.prototype,"_innerExecute",e=>function(r,s,n,i){if(!Qe.hasSubscribers)return e.apply(this,arguments);let o=new we("bound-anonymous-fn"),a=new we("bound-anonymous-fn");return(u=>u.length===4||typeof u[3]=="function")(arguments)?a.runInAsyncScope(()=>{Qe.publish({keyspace:this.keyspace,query:r});let u=arguments.length-1,l=arguments[u];typeof l=="function"&&(l=o.bind(l),arguments[u]=hd(Je,Xe,a,l));try{return e.apply(this,arguments)}catch(d){throw Bt(Je,Xe,d),d}}):e.apply(this,arguments)}),t));br({name:"cassandra-driver",versions:[">=3.3"],file:"lib/request-execution.js"},t=>(yr.wrap(t.prototype,"_sendOnConnection",e=>function(){return Qe.hasSubscribers?(fd.publish({hostname:this._connection.address,port:this._connection.port}),e.apply(this,arguments)):e.apply(this,arguments)}),t));br({name:"cassandra-driver",versions:["3.3 - 4.3"],file:"lib/request-execution.js"},t=>(yr.wrap(t.prototype,"start",e=>function(r){if(!Qe.hasSubscribers)return r.apply(this,arguments);let s=new we("bound-anonymous-fn"),n=this;return zx(this,arguments,1)?(r=s.bind(r),arguments[0]=we.bind(function(){return fd.publish({hostname:n._connection.address,port:n._connection.port}),r.apply(this,arguments)}),e.apply(this,arguments)):e.apply(this,arguments)}),t));br({name:"cassandra-driver",versions:["3 - 3.2"],file:"lib/request-handler.js"},t=>(yr.wrap(t.prototype,"send",e=>function(r,s,n){if(!Qe.hasSubscribers)return e.apply(this,arguments);let i=this;return zx(this,arguments,3)?(n=new we("bound-anonymous-fn").bind(n),arguments[2]=we.bind(function(){return fd.publish({hostname:i.connection.address,port:i.connection.port}),n.apply(this,arguments)}),e.apply(this,arguments)):e.apply(this,arguments)}),t));function Bt(t,e,r){r&&e.publish(r),t.publish(void 0)}function hd(t,e,r,s){return r.bind(function(n){if(Bt(t,e,n),s)return s.apply(this,arguments)})}function zx(t,e,r){return!(!t||e.length!==r||typeof e[r-1]!="function")}});var gd=p(()=>{"use strict";var{channel:fV,addHook:gV}=m(),mV=b(),Vx=fV("datadog:child_process:execution:start"),_V=["exec","execFile","fork","spawn","execFileSync","execSync","spawnSync"],bV=["child_process","node:child_process"];bV.forEach(t=>{gV({name:t},e=>(mV.massWrap(e,_V,yV()),e))});function yV(){function t(e){return function(){if(Vx.hasSubscribers&&arguments.length>0){let r=arguments[0];Vx.publish({command:r})}return e.apply(this,arguments)}}return t}});var rI=p(()=>{"use strict";var vr=b(),{addHook:Jx,channel:Sr}=m(),Kx=Sr("apm:connect:middleware:enter"),vV=Sr("apm:connect:middleware:exit"),Xx=Sr("apm:connect:middleware:error"),Qx=Sr("apm:connect:middleware:next"),Zx=Sr("apm:connect:middleware:finish"),Yx=Sr("apm:connect:request:handle");function SV(t){return typeof t!="function"?t:function(){let r=t();return r&&(vr.wrap(r,"use",eI),vr.wrap(r,"handle",tI),r)}}function eI(t){return typeof t!="function"?t:function(r,s){let n=t.apply(this,arguments);if(!this||!Array.isArray(this.stack))return n;let i=this.stack.length-1,o=this.stack[i];return o&&o.handle&&(this.stack[i].handle=qV(o)),n}}function tI(t){return function(r,s){return Yx.hasSubscribers&&Yx.publish({req:r,res:s}),t.apply(this,arguments)}}function qV(t){if(typeof t.handle!="function")return t.handle;let e=t.handle;return vr.wrap(e,function(){if(!Kx.hasSubscribers)return e.apply(this,arguments);let r=arguments.length-1,s=e._name||e.name,n=arguments[arguments.length>3?1:0],i=arguments[r];typeof i=="function"&&(arguments[r]=EV(n,i));let o=t.route;Kx.publish({name:s,req:n,route:o});try{return e.apply(this,arguments)}catch(a){throw Xx.publish({req:n,error:a}),Qx.publish({req:n}),Zx.publish({req:n}),a}finally{vV.publish({req:n})}})}function EV(t,e){return function(r){r&&Xx.publish({req:t,error:r}),Qx.publish({req:t}),Zx.publish({req:t}),e.apply(this,arguments)}}Jx({name:"connect",versions:[">=3"]},t=>vr.wrap(t,SV(t)));Jx({name:"connect",versions:["2.2.2"]},t=>(vr.wrap(t.proto,"use",eI),vr.wrap(t.proto,"handle",tI),t))});var pI=p(()=>{"use strict";var{channel:Ze,addHook:qr,AsyncResource:$t}=m(),bt=b();function sI(t,e=2){for(let r=t.length-1;r>=e;r--)if(typeof t[r]=="function")return r;return-1}function nI(t){return t&&(typeof t=="string"?t:t.statement)}function md(t,e){t.forEach(r=>e(r))}function iI(t){let e=function(r,s){if(!Array.isArray(s))return t.apply(this,arguments);let n=s.length-1,i=s[n];return i instanceof Function&&(s[n]=$t.bind(i)),t.apply(this,arguments)};return bt.wrap(t,e)}function oI(t){let e=function(r,s,n){return n=$t.bind(arguments[arguments.length-1]),typeof n=="function"&&(arguments[arguments.length-1]=n),t.apply(this,arguments)};return bt.wrap(t,e)}function TV(t,e){let r=Ze(t+":start"),s=Ze(t+":finish"),n=Ze(t+":error"),i=function(){if(!r.hasSubscribers)return e.apply(this,arguments);let o=sI(arguments);if(o<0)return e.apply(this,arguments);let a=new $t("bound-anonymous-fn"),c=new $t("bound-anonymous-fn");return c.runInAsyncScope(()=>{let u=a.bind(arguments[o]);r.publish({bucket:{name:this.name||this._name}}),arguments[o]=c.bind(function(l,d){return l&&n.publish(l),s.publish(d),u.apply(this,arguments)});try{return e.apply(this,arguments)}catch(l){throw l.stack,n.publish(l),l}})};return bt.wrap(e,i)}function aI(t,e,r,s,n){let i=Ze(`apm:couchbase:${e}:start`),o=Ze(`apm:couchbase:${e}:finish`),a=Ze(`apm:couchbase:${e}:error`);if(!i.hasSubscribers)return t.apply(s,n);let c=new $t("bound-anonymous-fn"),u=new $t("bound-anonymous-fn");return c.runInAsyncScope(()=>{i.publish(r);try{let l=sI(n,1);if(l>=0){let h=u.bind(n[l]);n[l]=c.bind(function(f,g){return f&&a.publish(f),o.publish({result:g}),h.apply(s,arguments)})}let d=t.apply(s,n);return d.then(c.bind(h=>o.publish({result:h})),c.bind(h=>a.publish(h))),d}catch(l){throw l.stack,a.publish(l),l}})}function cI(t){return function(e){return function(){return aI(e,t,{collection:{name:this._name||"_default"},bucket:{name:this._scope._bucket._name}},this,arguments)}}}function uI(t){return function(e){let r=nI(e);return aI(t,"query",{resource:r},this,arguments)}}qr({name:"couchbase",file:"lib/bucket.js",versions:["^2.6.5"]},t=>{let e=Ze("apm:couchbase:query:start"),r=Ze("apm:couchbase:query:finish"),s=Ze("apm:couchbase:query:error");return t.prototype._maybeInvoke=iI(t.prototype._maybeInvoke),t.prototype.query=oI(t.prototype.query),bt.wrap(t.prototype,"_n1qlReq",n=>function(i,o,a,c){if(!e.hasSubscribers)return n.apply(this,arguments);if(!c||!c.once)return n.apply(this,arguments);let u=nI(o),l=new $t("bound-anonymous-fn");return l.runInAsyncScope(()=>{e.publish({resource:u,bucket:{name:this.name||this._name}}),c.once("rows",l.bind(()=>{r.publish(void 0)})),c.once("error",l.bind(d=>{s.publish(d),r.publish(void 0)}));try{return n.apply(this,arguments)}catch(d){throw d.stack,s.publish(d),d}})}),md(["upsert","insert","replace","append","prepend"],n=>{t.prototype[n]=TV(`apm:couchbase:${n}`,t.prototype[n])}),t});qr({name:"couchbase",file:"lib/cluster.js",versions:["^2.6.5"]},t=>(t.prototype._maybeInvoke=iI(t.prototype._maybeInvoke),t.prototype.query=oI(t.prototype.query),t));qr({name:"couchbase",file:"lib/collection.js",versions:[">=3.0.0 <3.2.0"]},t=>(md(["upsert","insert","replace"],e=>{bt.wrap(t.prototype,e,cI(e))}),t));qr({name:"couchbase",file:"lib/cluster.js",versions:[">=3.0.0 <3.2.0"]},t=>(bt.wrap(t.prototype,"query",uI),t));qr({name:"couchbase",file:"dist/collection.js",versions:[">=3.2.0"]},t=>{let e=t.Collection;return md(["upsert","insert","replace"],r=>{bt.wrap(e.prototype,r,cI(r))}),t});qr({name:"couchbase",file:"dist/cluster.js",versions:["3.2.0 - 3.2.1",">=3.2.2"]},t=>{let e=t.Cluster;return bt.wrap(e.prototype,"query",uI),t})});var fI=p(()=>{"use strict";var{channel:hI,addHook:wV}=m(),lI=b(),xV=hI("datadog:crypto:hashing:start"),IV=hI("datadog:crypto:cipher:start"),AV=["createHash","createHmac","createSign","createVerify","sign","verify"],kV=["createCipheriv","createDecipheriv"];wV({name:"crypto"},t=>(lI.massWrap(t,AV,dI(xV)),lI.massWrap(t,kV,dI(IV)),t));function dI(t){function e(r){return function(){if(t.hasSubscribers&&arguments.length>0){let s=arguments[0];t.publish({algorithm:s})}return r.apply(this,arguments)}}return e}});var gI=p(()=>{var{addHook:RV}=m();RV({name:"cypress",versions:[">=6.7.0"]},t=>t)});var bI=p(()=>{"use strict";var{channel:_d,addHook:CV,AsyncResource:mI}=m(),OV=b(),bd={resolveAny:"ANY",resolve4:"A",resolve6:"AAAA",resolveCname:"CNAME",resolveMx:"MX",resolveNs:"NS",resolveTxt:"TXT",resolveSrv:"SRV",resolvePtr:"PTR",resolveNaptr:"NAPTR",resolveSoa:"SOA"},PV=new WeakMap;CV({name:"dns"},t=>(t.lookup=Gt("apm:dns:lookup",t.lookup,2),t.lookupService=Gt("apm:dns:lookup_service",t.lookupService,3),t.resolve=Gt("apm:dns:resolve",t.resolve,2),t.reverse=Gt("apm:dns:reverse",t.reverse,2),_I(t),t.Resolver&&(t.Resolver.prototype.resolve=Gt("apm:dns:resolve",t.Resolver.prototype.resolve,2),t.Resolver.prototype.reverse=Gt("apm:dns:reverse",t.Resolver.prototype.reverse,2),_I(t.Resolver.prototype)),t));function _I(t){Object.keys(bd).filter(e=>!!t[e]).forEach(e=>{PV.set(t[e],bd[e]),t[e]=Gt("apm:dns:resolve",t[e],2,bd[e])})}function Gt(t,e,r,s){let n=_d(t+":start"),i=_d(t+":finish"),o=_d(t+":error"),a=function(){let c=mI.bind(arguments[arguments.length-1]);if(!n.hasSubscribers||arguments.length<r||typeof c!="function")return e.apply(this,arguments);let u=Array.from(arguments);u.pop(),s&&u.push(s);let l=new mI("bound-anonymous-fn");return l.runInAsyncScope(()=>{n.publish(u),arguments[arguments.length-1]=l.bind(function(d,h){d&&o.publish(d),i.publish(h),c.apply(this,arguments)});try{return e.apply(this,arguments)}catch(d){throw d.stack,o.publish(d),d}})};return OV.wrap(e,a)}});var vd=p((jre,SI)=>{"use strict";var NV=require("methods").concat("all"),DV=require("path-to-regexp"),yd=b(),{addHook:MV,channel:As}=m();function vI(t){let e=As(`apm:${t}:middleware:enter`),r=As(`apm:${t}:middleware:exit`),s=As(`apm:${t}:middleware:finish`),n=As(`apm:${t}:middleware:error`),i=As(`apm:${t}:middleware:next`),o=new WeakMap,a=Object.create(null);function c(_,S){S._name=S._name||_.name;let T=yd.wrap(S,function(){if(!e.hasSubscribers)return S.apply(this,arguments);let x=o.get(_),R=arguments.length-1,ue=S._name||S.name,z=arguments[arguments.length>3?1:0],Me=arguments[R];typeof Me=="function"&&(arguments[R]=l(z,Me));let Le;if(x){for(let pe=0;pe<x.length;pe++)if(x[pe].test(_)){Le=x[pe].path;break}}e.publish({name:ue,req:z,route:Le});try{return S.apply(this,arguments)}catch(pe){throw n.publish({req:z,error:pe}),i.publish({req:z}),s.publish({req:z}),pe}finally{r.publish({req:z})}});return T._datadog_orig=S,T}function u(_,S,T){[].concat(_).slice(S).forEach(x=>{x.__handle?x.__handle=c(x,x.__handle):x.handle=c(x,x.handle),o.set(x,T),x.route&&NV.forEach(R=>{typeof x.route.stack=="function"&&(x.route.stack=[{handle:x.route.stack}]),x.route[R]=q(x.route[R])})})}function l(_,S){return function(T){T&&T!=="route"&&T!=="router"&&n.publish({req:_,error:T}),i.publish({req:_}),s.publish({req:_}),S.apply(this,arguments)}}function d(_){let S=g([].concat(_));return typeof S[0]=="function"?[]:S.map(T=>({path:T instanceof RegExp?`(${T})`:T,test:x=>{let R=o.get(x);return!h(x,R)&&!f(x,R)&&v(T).test(x.path)}}))}function h(_,S){return _.regexp.fast_star!==void 0?_.regexp.fast_star:S.some(T=>T.path==="*")}function f(_,S){return _.regexp.fast_slash!==void 0?_.regexp.fast_slash:S.some(T=>T.path==="/")}function g(_){return _.reduce((S,T)=>Array.isArray(T)?S.concat(g(T)):S.concat(T),[])}function v(_){let S=a[_];if(S)return S;let T=DV(_);return a[_]=T,T}function q(_){return function(T){let x=this.stack?[].concat(this.stack).length:0,R=_.apply(this,arguments);return typeof this.stack=="function"&&(this.stack=[{handle:this.stack}]),u(this.stack,x,d(T)),R}}return q}var yI=vI("router");MV({name:"router",versions:[">=1"]},t=>(yd.wrap(t.prototype,"use",yI),yd.wrap(t.prototype,"route",yI),t));SI.exports={createWrapRouterMethod:vI}});var TI=p(()=>{"use strict";var{createWrapRouterMethod:LV}=vd(),Sd=b(),{addHook:jV,channel:UV}=m(),qI=UV("apm:express:request:handle");function HV(t){return function(r,s){return qI.hasSubscribers&&qI.publish({req:r}),t.apply(this,arguments)}}var EI=LV("express");jV({name:"express",versions:[">=4"]},t=>(Sd.wrap(t.application,"handle",HV),Sd.wrap(t.Router,"use",EI),Sd.wrap(t.Router,"route",EI),t))});var RI=p(()=>{"use strict";var Li=b(),{addHook:Ed,channel:II,AsyncResource:AI}=m(),kI=II("apm:fastify:middleware:error"),BV=II("apm:fastify:request:handle"),Td=new WeakMap;function wd(t,e){return typeof t!="function"?t:function(){let s=t.apply(this,arguments);return!s||typeof s.addHook!="function"||(s.addHook("onRequest",GV),s.addHook("preHandler",FV),e?(s.addHook("preParsing",xI),s.addHook("preValidation",wI)):(s.addHook("onRequest",xI),s.addHook("preHandler",wI)),s.addHook=$V(s.addHook)),s}}function $V(t){return function(r,s){return s=arguments[arguments.length-1],typeof s!="function"?t.apply(this,arguments):(arguments[arguments.length-1]=Li.wrap(s,function(n,i,o){let a=ks(n);try{if(typeof o=="function")return o=arguments[arguments.length-1],arguments[arguments.length-1]=function(c){if(qd(c,a),r==="onRequest"||r==="preParsing"){let u=new AI("bound-anonymous-fn");return Td.set(a,u),u.runInAsyncScope(()=>o.apply(this,arguments))}else return o.apply(this,arguments)},s.apply(this,arguments);{let c=s.apply(this,arguments);return c&&typeof c.catch=="function"?c.catch(u=>qd(u,a)):c}}catch(c){throw qd(c,a)}}),t.apply(this,arguments))}}function GV(t,e,r){if(typeof r!="function")return;let s=ks(t),n=WV(e);return BV.publish({req:s,res:n}),r()}function FV(t,e,r){if(typeof r!="function")return;if(!e||typeof e.send!="function")return r();let s=ks(t);e.send=zV(e.send,s),r()}function wI(t,e,r){let s=ks(t),n=Td.get(s);if(!n)return r();n.runInAsyncScope(()=>r())}function xI(t,e,r,s){typeof s!="function"&&(s=r);let n=ks(t),i=new AI("bound-anonymous-fn");Td.set(n,i),i.runInAsyncScope(()=>s())}function zV(t,e){return function(s){return s instanceof Error&&kI.publish({req:e,error:s}),t.apply(this,arguments)}}function ks(t){return t&&(t.raw||t.req||t)}function WV(t){return t&&(t.raw||t.res||t)}function qd(t,e){return t&&kI.publish({error:t,req:e}),t}Ed({name:"fastify",versions:[">=3"]},t=>{let e=Li.wrap(t,wd(t,!0));return e.fastify=e,e.default=e,e});Ed({name:"fastify",versions:["2"]},t=>Li.wrap(t,wd(t,!0)));Ed({name:"fastify",versions:["1"]},t=>Li.wrap(t,wd(t,!1)))});var CI=p(()=>{"use strict";var VV=b(),{addHook:KV,channel:YV}=m(),JV=YV("apm:find-my-way:request:route");function XV(t){return function(r,s,n){let i=typeof n=="function"?2:3,o=arguments[i],a=function(c){return JV.publish({req:c,route:s}),o.apply(this,arguments)};return typeof o=="function"&&(arguments[i]=a),t.apply(this,arguments)}}KV({name:"find-my-way",versions:[">=1"]},t=>(VV.wrap(t.prototype,"on",XV),t))});var Rd=p(()=>{"use strict";var{channel:Ad,addHook:QV,AsyncResource:ji}=m(),ZV=b(),Tr=Ad("apm:fs:operation:start"),et=Ad("apm:fs:operation:finish"),Er=Ad("apm:fs:operation:error"),OI=Symbol("ddFileHandle"),Os,Rs,Cs,DI={access:["path","mode"],appendFile:["path","data","options"],chmod:["path","mode"],chown:["path","uid","gid"],close:["fd"],copyFile:["src","dest","mode"],cp:["src","dest","options"],exists:["path"],fchmod:["fd","mode"],fchown:["fd","uid","gid"],fdatasync:["fd"],fstat:["fd","options"],fsync:["fd"],ftruncate:["fd","len"],futimes:["fd","atime","mtime"],lchmod:["path","mode"],lchown:["path","uid","gid"],link:["existingPath","newPath"],lstat:["path","options"],lutimes:["path","atime","mtime"],mkdir:["path","options"],mkdtemp:["prefix","options"],open:["path","flag","mode"],opendir:["path","options"],read:["fd"],readdir:["path","options"],readFile:["path","options"],readlink:["path","options"],readv:["fd"],realpath:["path","options"],rename:["oldPath","newPath"],rmdir:["path","options"],rm:["path","options"],stat:["path","options"],symlink:["target","path","type"],truncate:["path","len"],unlink:["path"],utimes:["path","atime","mtime"],write:["fd"],writeFile:["file","data","options"],writev:["fd"]},e6={unwatchFile:["path","listener"],watch:["path","options","listener"],watchFile:["path","options","listener"]},t6={appendFile:["data","options"],chmod:["mode"],chown:["uid","gid"],close:[],createReadStream:["options"],createWriteStream:["options"],datasync:[],read:["buffer","offset","length","position"],readableWebStream:[],readFile:["options"],readLines:["options"],readv:["buffers","position"],stat:["options"],sync:[],truncate:["len"],utimes:["atime","mtime"],write:["buffer","offset","length","position"],writeFile:["data","options"],writev:["buffers","position"]},r6=["fs","node:fs"];r6.forEach(t=>{QV({name:t},e=>{let r=Object.keys(DI),s=r.map(n=>`${n}Sync`);return Id(e,r,J()),Id(e,s,J()),Id(e.promises,r,J("promises.")),M(e.realpath,"native",J("","realpath.native")),M(e.realpathSync,"native",J("","realpath.native")),M(e.promises.realpath,"native",J("","realpath.native")),M(e,"createReadStream",NI),M(e,"createWriteStream",NI),e.Dir&&(M(e.Dir.prototype,"close",J("dir.")),M(e.Dir.prototype,"closeSync",J("dir.")),M(e.Dir.prototype,"read",J("dir.")),M(e.Dir.prototype,"readSync",J("dir.")),M(e.Dir.prototype,Symbol.asyncIterator,a6())),M(e,"unwatchFile",xd()),M(e,"watch",xd()),M(e,"watchFile",xd()),e})});function s6(t){return!Os&&t.name==="open"}function n6(t){let e=i6(t),r=Reflect.getOwnPropertyDescriptor(e,Os);(!r||!r.get)&&Reflect.defineProperty(e,Os,{get(){return this[OI]},set(s){this[OI]=s,M(this,"close",J("filehandle."))},configurable:!0});for(let s of Reflect.ownKeys(e))typeof s!="string"||s==="constructor"||s==="fd"||s==="getAsyncId"||M(e,s,J("filehandle."))}function i6(t){return Os||(Os=Reflect.ownKeys(t).find(e=>typeof e=="symbol"&&e.toString().includes("kHandle"))),Object.getPrototypeOf(t)}function PI(t){return t.description||t.toString()}function o6(t){let e=Reflect.ownKeys(t);for(let r of e){if(Rs&&Cs)break;typeof r=="symbol"&&(!Rs&&PI(r).includes("kDirReadPromisified")&&(Rs=r),!Cs&&PI(r).includes("kDirClosePromisified")&&(Cs=r))}}function a6(){return function(e){return function(){return(!Rs||!Cs)&&o6(this),M(this,Rs,J("dir.","read")),M(this,Cs,J("dir.","close")),e.apply(this,arguments)}}}function NI(t){let r={createReadStream:"ReadStream",createWriteStream:"WriteStream"}[t.name];return function(s,n){if(!Tr.hasSubscribers)return t.apply(this,arguments);let i=new ji("bound-anonymous-fn"),o=kd(r,["path","options"],arguments);return i.runInAsyncScope(()=>{Tr.publish(o);try{let a=t.apply(this,arguments),c=i.bind(l=>{Er.publish(l),u()}),u=i.bind(()=>{et.publish(),a.off("close",u),a.off("end",u),a.off("finish",u),a.off("error",c)});return a.once("close",u),a.once("end",u),a.once("finish",u),a.once("error",c),a}catch(a){Er.publish(a),et.publish()}})}}function c6(t){return t==="filehandle."?t6:DI}function xd(t=""){return function(r){let s=t||r.name,n=s,i=s;return function(){if(!Tr.hasSubscribers)return r.apply(this,arguments);let o=kd(n,e6[i],arguments,this);return new ji("bound-anonymous-fn").runInAsyncScope(()=>{Tr.publish(o);try{let c=r.apply(this,arguments);return et.publish(),c}catch(c){throw Er.publish(c),et.publish(),c}})}}}function J(t="",e=""){return function(s){let n=e||s.name,i=`${t}${n}`,o=n.match(/^(.+?)(Sync)?(\.native)?$/)[1];return function(){if(!Tr.hasSubscribers)return s.apply(this,arguments);let a=arguments.length-1,c=typeof arguments[a]=="function"&&arguments[a],u=new ji("bound-anonymous-fn"),l=kd(i,c6(t)[o],arguments,this);if(c){let d=new ji("bound-anonymous-fn");arguments[a]=u.bind(function(h){return typeof h=="object"&&Er.publish(h),et.publish(),d.runInAsyncScope(()=>c.apply(this,arguments))})}return u.runInAsyncScope(()=>{Tr.publish(l);try{let d=s.apply(this,arguments);return c?d:d&&typeof d.then=="function"?d.then(h=>(s6(s)&&n6(h),et.publish(),h),h=>{throw Er.publish(h),et.publish(),h}):(et.publish(),d)}catch(d){throw Er.publish(d),et.publish(),d}})}}}function kd(t,e,r,s){let n={};if(e)for(let i=0;i<e.length;i++)!e[i]||typeof r[i]=="function"||(n[e[i]]=r[i]);return s&&(s.path&&(n.path=s.path),s.fd&&(n.fd=s.fd)),{operation:t,...n}}function Id(t,e,r){for(let s of e)M(t,s,r)}function M(t,e,r){try{ZV.wrap(t,e,r)}catch{}}});var WI=p(()=>{"use strict";var{addHook:Pd,channel:Q,AsyncResource:Ui}=m(),Nd=b(),Cd=new WeakMap,Ps=new WeakMap,MI=new WeakSet,LI=new WeakSet,jI=Q("apm:graphql:execute:start"),u6=Q("apm:graphql:execute:finish"),p6=Q("apm:graphql:execute:error"),$I=Q("apm:graphql:resolve:start"),GI=Q("apm:graphql:resolve:finish"),l6=Q("apm:graphql:resolve:updateField"),d6=Q("apm:graphql:resolve:error"),UI=Q("apm:graphql:parser:start"),h6=Q("apm:graphql:parser:finish"),f6=Q("apm:graphql:parser:error"),HI=Q("apm:graphql:validate:start"),g6=Q("apm:graphql:validate:finish"),BI=Q("apm:graphql:validate:error");function FI(t,e){if(!t||!Array.isArray(t.definitions))return;let r=t.definitions.filter(n=>n),s=["query","mutation","subscription"];return e?r.filter(n=>s.indexOf(n.operation)!==-1).find(n=>e===(n.name&&n.name.value)):r.find(n=>s.indexOf(n.operation)!==-1)}function m6(t,e){return t.length!==1?_6(t,e):(t[0].contextValue=t[0].contextValue||{},t[0].fieldResolver=Dd(t[0].fieldResolver||e),t[0])}function _6(t,e){return t[3]=t[3]||{},t[6]=Dd(t[6]||e),t.length=Math.max(t.length,7),{schema:t[0],document:t[1],rootValue:t[2],contextValue:t[3],variableValues:t[4],operationName:t[5],fieldResolver:t[6]}}function b6(t){return function(e){return UI.hasSubscribers?new Ui("bound-anonymous-fn").runInAsyncScope(()=>{UI.publish();let s;try{return s=t.apply(this,arguments),FI(s)&&e&&Ps.set(s,e.body||e),s}catch(n){throw n.stack,f6.publish(n),n}finally{h6.publish({source:e,document:s,docSource:Ps.get(s)})}}):t.apply(this,arguments)}}function y6(t){return function(e,r,s,n){return HI.hasSubscribers?new Ui("bound-anonymous-fn").runInAsyncScope(()=>{HI.publish({docSource:Ps.get(r),document:r});let o;try{return o=t.apply(this,arguments),o&&o[0]&&BI.publish(o&&o[0]),o}catch(a){throw a.stack,BI.publish(a),a}finally{g6.publish({document:r,errors:o})}}):t.apply(this,arguments)}}function v6(t){return function(e){let r=t.defaultFieldResolver;return function(){if(!jI.hasSubscribers)return e.apply(this,arguments);let s=new Ui("bound-anonymous-fn");return s.runInAsyncScope(()=>{let n=m6(arguments,r),i=n.schema,o=n.document,a=Ps.get(o),c=n.contextValue,u=FI(o,n.operationName);if(Cd.has(c))return e.apply(this,arguments);i&&(Od(i._queryType),Od(i._mutationType)),jI.publish({operation:u,args:n,docSource:Ps.get(o)});let l={source:a,asyncResource:s,fields:{}};return Cd.set(c,l),zI(e,s,this,arguments,(d,h)=>{GI.hasSubscribers&&I6(l);let f=d||h&&h.errors&&h.errors[0];f&&p6.publish(f),u6.publish({res:h,args:n})})})}}}function Dd(t){if(typeof t!="function"||MI.has(t))return t;function e(r,s,n,i){if(!$I.hasSubscribers)return t.apply(this,arguments);let o=Cd.get(n);if(!o)return t.apply(this,arguments);let a=q6(o,i);return zI(t,a.asyncResource,this,arguments,c=>{l6.publish({field:a,info:i,err:c})})}return MI.add(e),e}function zI(t,e,r,s,n){return n=n||(()=>{}),e.runInAsyncScope(()=>{try{let i=t.apply(r,s);return i&&typeof i.then=="function"?i.then(e.bind(o=>n(null,o)),e.bind(o=>n(o))):n(null,i),i}catch(i){throw n(i),i}})}function S6(t){let e=[],r=t;for(;r;)e.push(r.key),r=r.prev;return e.reverse()}function q6(t,e){let r=e&&e.path,s=S6(r),n=s.join("."),i=t.fields,o=i[n];if(!o){let a=E6(t,s);a.asyncResource.runInAsyncScope(()=>{let c=new Ui("bound-anonymous-fn");c.runInAsyncScope(()=>{$I.publish({info:e,context:t})}),o=i[n]={parent:a,asyncResource:c,error:null}})}return o}function E6(t,e){for(let r=e.length-1;r>0;r--){let s=T6(t,e.slice(0,r));if(s)return s}return{asyncResource:t.asyncResource}}function T6(t,e){return t.fields[e.join(".")]}function Od(t){!t||!t._fields||LI.has(t)||(LI.add(t),Object.keys(t._fields).forEach(e=>{let r=t._fields[e];w6(r),x6(r)}))}function w6(t){!t||!t.resolve||(t.resolve=Dd(t.resolve))}function x6(t){if(!t||!t.type)return;let e=t.type;for(;e.ofType;)e=e.ofType;Od(e)}function I6({fields:t}){Object.keys(t).reverse().forEach(e=>{let r=t[e];r.asyncResource.runInAsyncScope(()=>{r.error&&d6.publish(r.error),GI.publish(r.finishTime)})})}Pd({name:"graphql",file:"execution/execute.js",versions:[">=0.10"]},t=>(Nd.wrap(t,"execute",v6(t)),t));Pd({name:"graphql",file:"language/parser.js",versions:[">=0.10"]},t=>(Nd.wrap(t,"parse",b6),t));Pd({name:"graphql",file:"validation/validate.js",versions:[">=0.10"]},t=>(Nd.wrap(t,"validate",y6),t))});var QI=p(()=>{"use strict";var Hi=require("url"),{channel:Md,addHook:JI,AsyncResource:VI}=m(),A6=b(),k6=E(),KI=Md("apm:http:client:request:start"),R6=Md("apm:http:client:request:finish"),C6=Md("apm:http:client:request:error");JI({name:"https"},XI);JI({name:"http"},XI);function XI(t){return YI(t,"request"),YI(t,"get"),t}function YI(t,e){A6.wrap(t,e,r);function r(u){return function(){if(!KI.hasSubscribers)return u.apply(this,arguments);let l;try{l=s.apply(null,arguments)}catch(f){return k6.error(f),u.apply(this,arguments)}let d=new VI("bound-anonymous-fn"),h=new VI("bound-anonymous-fn");return h.runInAsyncScope(()=>{KI.publish({args:l,http:t});let f=!1,g=l.callback;g&&(g=d.bind(g));let v=l.options,q=u.call(this,v,g),_=q.emit,S=(T,x)=>{f||(f=!0,R6.publish({req:T,res:x}))};return q.emit=function(T,x){return h.runInAsyncScope(()=>{switch(T){case"response":{let R=x,ue=h.bind(()=>S(q,R));R.on("end",ue),R.on("error",ue);break}case"connect":case"upgrade":S(q,x);break;case"error":case"timeout":C6.publish(x);case"abort":case"close":S(q)}}),_.apply(this,arguments)},q})}}function s(u,l,d){u=a(u);let[h,f]=o(l,d,u),g=n(u,f);return i(g),{uri:Hi.format(g),options:g,callback:h}}function n(u,l){return typeof l=="object"?Object.assign(u||{},l):u}function i(u){u.headers=u.headers||{}}function o(u,l,d){return typeof u=="function"?[u,d||{}]:[l,u]}function a(u){if(typeof u=="string")try{return c(new Hi.URL(u))}catch{return Hi.parse(u)}else return u instanceof Hi.URL?c(u):u}function c(u){let l=u.agent||t.globalAgent,d={protocol:u.protocol||l.protocol,hostname:typeof u.hostname=="string"&&u.hostname.startsWith("[")?u.hostname.slice(1,-1):u.hostname||u.host||"localhost",hash:u.hash,search:u.search,pathname:u.pathname,path:`${u.pathname||""}${u.search||""}`,href:u.href};return u.port!==""&&(d.port=Number(u.port)),(u.username||u.password)&&(d.auth=`${u.username}:${u.password}`),d}}});var rA=p(()=>{"use strict";var{AbortController:O6}=require("node-abort-controller"),{channel:Bi,addHook:eA}=m(),Ld=b(),jd=Bi("apm:http:server:request:start"),P6=Bi("apm:http:server:request:exit"),N6=Bi("apm:http:server:request:error"),D6=Bi("apm:http:server:request:finish"),ZI=new WeakSet;eA({name:"https"},t=>(Ld.wrap(t.Server.prototype,"emit",tA),t));eA({name:"http"},t=>(Ld.wrap(t.ServerResponse.prototype,"emit",M6),Ld.wrap(t.Server.prototype,"emit",tA),t));function M6(t){return function(e,r){return jd.hasSubscribers?(["finish","close"].includes(e)&&!ZI.has(this)&&(D6.publish({req:this.req}),ZI.add(this)),t.apply(this,arguments)):t.apply(this,arguments)}}function tA(t){return function(e,r,s){if(!jd.hasSubscribers)return t.apply(this,arguments);if(e==="request"){s.req=r;let n=new O6;jd.publish({req:r,res:s,abortController:n});try{return n.signal.aborted?s.end():t.apply(this,arguments)}catch(i){throw N6.publish(i),i}finally{P6.publish({req:r})}}return t.apply(this,arguments)}}});var Ud=p(()=>{"use strict";QI();rA()});var nA=p(()=>{"use strict";var Hd=b(),{addHook:L6,channel:$i,AsyncResource:sA}=m(),j6=$i("apm:http2:client:request:start"),U6=$i("apm:http2:client:request:finish"),H6=$i("apm:http2:client:request:error"),B6=$i("apm:http2:client:response");function $6(t,e){return function(s){return function(n,i){return t.runInAsyncScope(()=>{switch(n){case"response":B6.publish(i);break;case"error":H6.publish(i);case"close":U6.publish();break}}),e.runInAsyncScope(()=>s.apply(this,arguments))}}}function G6(t,e){return function(s){return function(n){let i=new sA("bound-anonymous-fn"),o=new sA("bound-anonymous-fn");return o.runInAsyncScope(()=>{j6.publish({headers:n,authority:t,options:e});let a=s.apply(this,arguments);return Hd.wrap(a,"emit",$6(o,i)),a})}}}function F6(t){return function(e,r){let s=t.apply(this,arguments);return Hd.wrap(s,"request",G6(e,r)),s}}L6({name:"http2"},t=>(Hd.wrap(t,"connect",F6),t))});var uA=p(()=>{"use strict";var{channel:Bd,addHook:z6,AsyncResource:cA}=m(),Gi=b(),iA=Bd("apm:http2:server:request:start"),W6=Bd("apm:http2:server:request:error"),oA=Bd("apm:http2:server:request:finish");z6({name:"http2"},t=>(Gi.wrap(t,"createSecureServer",aA),Gi.wrap(t,"createServer",aA),t));function aA(t){return function(...e){let r=t.apply(this,e);return Gi.wrap(r,"emit",K6),r}}function V6(t){let e=new cA("bound-anonymous-fn");return function(r,s){return e.runInAsyncScope(()=>(r==="close"&&oA.hasSubscribers&&oA.publish({req:this.req}),t.apply(this,arguments)))}}function K6(t){return function(e,r,s){return iA.hasSubscribers?e==="request"?(s.req=r,new cA("bound-anonymous-fn").runInAsyncScope(()=>{iA.publish({req:r,res:s}),Gi.wrap(s,"emit",V6);try{return t.apply(this,arguments)}catch(i){throw W6.publish(i),i}})):t.apply(this,arguments):t.apply(this,arguments)}}});var pA=p(()=>{"use strict";nA();uA()});var fA=p(()=>{"use strict";var{channel:Gd,addHook:Y6,AsyncResource:J6}=m(),X6=b(),lA=Gd("apm:ioredis:command:start"),dA=Gd("apm:ioredis:command:finish"),$d=Gd("apm:ioredis:command:error");Y6({name:"ioredis",versions:[">=2"]},t=>(X6.wrap(t.prototype,"sendCommand",e=>function(r,s){if(!lA.hasSubscribers)return e.apply(this,arguments);if(!r||!r.promise)return e.apply(this,arguments);let n=this.options||{},i=n.connectionName,o=n.db,a={host:n.host,port:n.port},c=new J6("bound-anonymous-fn");return c.runInAsyncScope(()=>{lA.publish({db:o,command:r.name,args:r.args,connectionOptions:a,connectionName:i});let u=c.bind(()=>hA(dA,$d)),l=c.bind(d=>hA(dA,$d,d));r.promise.then(u,l);try{return e.apply(this,arguments)}catch(d){throw $d.publish(d),d}})}),t));function hA(t,e,r){r&&e.publish(r),t.publish()}});var SA=p(()=>{"use strict";var{channel:wr,addHook:Q6,AsyncResource:gA}=m(),mA=b(),_A=wr("apm:kafkajs:produce:start"),Fd=wr("apm:kafkajs:produce:finish"),bA=wr("apm:kafkajs:produce:error"),yA=wr("apm:kafkajs:consume:start"),Fi=wr("apm:kafkajs:consume:finish"),vA=wr("apm:kafkajs:consume:error");Q6({name:"kafkajs",versions:[">=1.4"]},t=>{let e=t.Kafka;return mA.wrap(e.prototype,"producer",r=>function(){let s=r.apply(this,arguments),n=s.send;return s.send=function(){let i=new gA("bound-anonymous-fn");return i.runInAsyncScope(()=>{if(!_A.hasSubscribers)return n.apply(this,arguments);try{let{topic:o,messages:a=[]}=arguments[0];for(let u of a)typeof u=="object"&&(u.headers=u.headers||{});_A.publish({topic:o,messages:a});let c=n.apply(this,arguments);return c.then(i.bind(()=>Fd.publish(void 0)),i.bind(u=>{u&&bA.publish(u),Fd.publish(void 0)})),c}catch(o){throw bA.publish(o),Fd.publish(void 0),o}})},s}),mA.wrap(e.prototype,"consumer",r=>function(){if(!yA.hasSubscribers)return r.apply(this,arguments);let s=r.apply(this,arguments),n=s.run;return s.run=function({eachMessage:i,...o}){return n(typeof i!="function"?{eachMessage:i,...o}:{eachMessage:function(...a){let c=new gA("bound-anonymous-fn");return c.runInAsyncScope(()=>{let{topic:u,partition:l,message:d}=a[0];yA.publish({topic:u,partition:l,message:d});try{let h=i.apply(this,a);return h&&typeof h.then=="function"?h.then(c.bind(()=>Fi.publish(void 0)),c.bind(f=>{f&&vA.publish(f),Fi.publish(void 0)})):Fi.publish(void 0),h}catch(h){throw vA.publish(h),Fi.publish(void 0),h}})},...o})},s}),t})});var EA=p(()=>{"use strict";var{channel:Z6,addHook:e9,AsyncResource:zd}=m(),yt=b();function qA(t){return typeof t=="string"||t instanceof String}function t9(t){let e=-1;for(let r=t.length-1;r>=0;r--)if(typeof t[r]=="function"){e=r;break}return e}function r9(t){let e=new WeakMap,r=n=>function(i,o){if(typeof o=="function"){let a=e.get(o);a||(a=new zd("bound-anonymous-fn").bind(o),e.set(o,a)),arguments[1]=a}return n.apply(this,arguments)};yt.wrap(t,"on",r),yt.wrap(t,"addListener",r);let s=n=>function(i,o){if(typeof o=="function"){let a=e.get(o);a&&(arguments[1]=a)}return n.apply(this,arguments)};yt.wrap(t,"off",s),yt.wrap(t,"removeListener",s)}e9({name:"ldapjs",versions:[">=2"]},t=>{let e=Z6("datadog:ldapjs:client:search");return yt.wrap(t.Client.prototype,"search",r=>function(s,n){if(e.hasSubscribers){let i;qA(n)?i=n:typeof n=="object"&&n.filter&&qA(n.filter)&&(i=n.filter),e.publish({base:s,filter:i})}return r.apply(this,arguments)}),yt.wrap(t.Client.prototype,"_send",r=>function(){let s=t9(arguments);if(s>-1){let n=arguments[s];arguments[s]=yt.wrap(n,function(i,o){typeof o=="object"&&typeof o.on=="function"&&r9(o),n.apply(this,arguments)})}return r.apply(this,arguments)}),yt.wrap(t.Client.prototype,"bind",r=>function(s,n,i,o){return typeof i=="function"?arguments[2]=zd.bind(i):typeof o=="function"&&(arguments[3]=zd.bind(o)),r.apply(this,arguments)}),t})});var xA=p(()=>{"use strict";var{addHook:s9,AsyncResource:n9}=m(),TA=b();function wA(t){return function(){let e=arguments.length-1;return arguments[e]=n9.bind(arguments[e]),t.apply(this,arguments)}}s9({name:"limitd-client",versions:[">=2.8"]},t=>(TA.wrap(t.prototype,"_directRequest",wA),TA.wrap(t.prototype,"_retriedRequest",wA),t))});var RA=p(()=>{"use strict";var{channel:Ms,addHook:Ir,AsyncResource:Ns}=m(),tt=b(),xr=Ms("apm:mariadb:query:start"),Ds=Ms("apm:mariadb:query:finish"),Vd=Ms("apm:mariadb:query:error"),i9=Ms("apm:mariadb:pool:skip"),o9=Ms("apm:mariadb:pool:unskip");function a9(t,e){return function(){if(!xr.hasSubscribers)return t.apply(this,arguments);let r=e.bind(this.resolve),s=e.bind(this.reject),n=e.runInAsyncScope(()=>new Ns("bound-anonymous-fn"));return tt.wrap(this,"resolve",function(){return function(){return n.runInAsyncScope(()=>{Ds.publish()}),r.apply(this,arguments)}}),tt.wrap(this,"reject",function(){return function(o){return n.runInAsyncScope(()=>{Vd.publish(o),Ds.publish()}),s.apply(this,arguments)}}),n.runInAsyncScope(()=>(xr.publish({sql:this.sql,conf:this.opts}),t.apply(this,arguments)))}}function IA(t){return class extends t{constructor(...e){super(...e);let r=new Ns("bound-anonymous-fn");this.start&&(this.start=a9(this.start,r))}}}function AA(t){return function(r){return function(s){return xr.hasSubscribers?new Ns("bound-anonymous-fn").runInAsyncScope(()=>(xr.publish({sql:s,conf:t}),r.apply(this,arguments).then(i=>(Ds.publish(),i),i=>{throw Vd.publish(i),Ds.publish(),i})),"bound-anonymous-fn"):r.apply(this,arguments)}}}function c9(t){return function(r){return function(s){if(!xr.hasSubscribers)return r.apply(this,arguments);let n=arguments[arguments.length-1],i=new Ns("bound-anonymous-fn"),o=new Ns("bound-anonymous-fn");return typeof n!="function"&&(arguments.length=arguments.length+1),arguments[arguments.length-1]=i.bind(function(a){if(a&&Vd.publish(a),Ds.publish(),typeof n=="function")return o.runInAsyncScope(()=>n.apply(this,arguments))}),i.runInAsyncScope(()=>(xr.publish({sql:s,conf:t}),r.apply(this,arguments)),"bound-anonymous-fn")}}}function kA(t,e){return function(r){t.apply(this,arguments),tt.wrap(this,e,AA(r)),tt.wrap(this,"_queryCallback",c9(r))}}function u9(t){return function(e,r,s,n){arguments[1]=Wd(r),arguments[2]=Wd(s),t.apply(this,arguments),tt.wrap(this,"query",AA(e.connOptions))}}function Wd(t){return function(){i9.publish();try{return t.apply(this,arguments)}finally{o9.publish()}}}var Ar="mariadb";Ir({name:Ar,file:"lib/cmd/query.js",versions:[">=3"]},t=>IA(t));Ir({name:Ar,file:"lib/cmd/execute.js",versions:[">=3"]},t=>IA(t));Ir({name:Ar,file:"lib/pool.js",versions:[">=3"]},t=>(tt.wrap(t.prototype,"_createConnection",Wd),t));Ir({name:Ar,file:"lib/connection.js",versions:[">=2.5.2 <3"]},t=>tt.wrap(t,kA(t,"_queryPromise")));Ir({name:Ar,file:"lib/connection.js",versions:[">=2.0.4 <=2.5.1"]},t=>tt.wrap(t,kA(t,"query")));Ir({name:Ar,file:"lib/pool-base.js",versions:[">=2.0.4 <3"]},t=>tt.wrap(t,u9(t)))});var OA=p(()=>{"use strict";var{channel:Kd,addHook:p9,AsyncResource:CA}=m(),l9=b();p9({name:"memcached",versions:[">=2.2"]},t=>{let e=Kd("apm:memcached:command:start"),r=Kd("apm:memcached:command:finish"),s=Kd("apm:memcached:command:error");return l9.wrap(t.prototype,"command",n=>function(i,o){if(!e.hasSubscribers)return n.apply(this,arguments);let a=new CA("bound-anonymous-fn"),c=new CA("bound-anonymous-fn"),u=this,l=c.bind(function(){let d=i.apply(this,arguments),h=a.bind(d.callback);return d.callback=c.bind(function(f){return f&&s.publish(f),r.publish(),h.apply(this,arguments)}),e.publish({client:u,server:o,query:d}),d});return c.runInAsyncScope(()=>(arguments[0]=l,n.apply(this,arguments)))}),t})});var jA=p(()=>{"use strict";var PA=b(),{addHook:NA,channel:Yd,AsyncResource:d9}=m(),h9=Yd("apm:microgateway-core:request:handle"),f9=Yd("apm:microgateway-core:request:route"),g9=Yd("apm:microgateway-core:request:error"),DA="microgateway-core",MA=[">=2.1"],LA=new WeakMap;function m9(t){return function(){let e=t.apply(this,arguments);return function(r,s,n){let i=new d9("bound-anonymous-fn");return LA.set(r,i),h9.publish({req:r,res:s}),e.apply(this,arguments)}}}function _9(t){return function(e){let r=t.apply(this,arguments);return function(n,i,o){return arguments[2]=b9(n,i,o),r.apply(this,arguments)}}}function b9(t,e,r){return function(n){return LA.get(t).runInAsyncScope(()=>{n&&g9.publish(n),e.proxy&&e.proxy.base_path&&f9.publish({req:t,res:e,route:e.proxy.base_path})}),r.apply(this,arguments)}}NA({name:DA,versions:MA,file:"lib/config-proxy-middleware.js"},t=>PA.wrap(t,m9(t)));NA({name:DA,versions:MA,file:"lib/plugins-middleware.js"},t=>PA.wrap(t,_9(t)))});var eh=p(()=>{var{createCoverageMap:y9}=require("istanbul-lib-coverage"),{addHook:Rr,channel:Z,AsyncResource:js}=m(),Cr=b(),v9=E(),{getCoveredFilenamesFromCoverage:S9,resetCoverage:q9,mergeCoverage:E9,getTestSuitePath:T9,fromCoverageMapToCoverage:w9,getTestLineStart:x9}=ve(),Qd=Z("ci:mocha:test:start"),UA=Z("ci:mocha:test:error"),HA=Z("ci:mocha:test:skip"),Jd=Z("ci:mocha:test:finish"),I9=Z("ci:mocha:test:parameterize"),BA=Z("ci:mocha:itr-configuration"),$A=Z("ci:mocha:test-suite:skippable"),A9=Z("ci:mocha:session:start"),k9=Z("ci:mocha:session:finish"),R9=Z("ci:mocha:test-suite:start"),C9=Z("ci:mocha:test-suite:finish"),O9=Z("ci:mocha:test-suite:error"),P9=Z("ci:mocha:test-suite:code-coverage"),zi=new WeakSet,kr=new WeakMap,Zd=new WeakMap,Ls=new Map,FA=new WeakMap,zA=!1,Xd=y9(),Wi=[],WA;function N9(t){let e={};function r(n){n.file&&(e[n.file]?e[n.file].push(n):e[n.file]=[n]),n.suites.forEach(i=>{r(i)})}r(t);let s=Object.keys(e).reduce((n,i)=>(n[i]=e[i].length,n),{});return{suitesByTestFile:e,numSuitesByTestFile:s}}function GA(t){return t.isPending()?"skip":t.isFailed()||t.timedOut?"fail":"pass"}function D9(t){return t._currentRetry!==void 0&&t._currentRetry!==0}function Us(t){if(!t.fn)return kr.get(t);if(!t.fn.asyncResource)return kr.get(t.fn);let e=Zd.get(t.fn);return kr.get(e)}function M9(t){return t.filter(e=>!Wi.includes(T9(e.file,process.cwd())))}function L9(t){return zi.has(t)||(zi.add(t),Cr.wrap(t.prototype,"run",e=>function(){if(!Qd.hasSubscribers||zA)return e.apply(this,arguments);let{suitesByTestFile:r,numSuitesByTestFile:s}=N9(this.suite),n=new js("bound-anonymous-fn");return this.once("end",n.bind(function(){let i="pass";this.stats?i=this.stats.failures===0?"pass":"fail":this.failures!==0&&(i="fail"),Ls.clear();let o=!!Wi.length,a;if(global.__coverage__){try{a=Xd.getCoverageSummary().lines.pct}catch{}global.__coverage__=w9(Xd)}k9.publish({status:i,isSuitesSkipped:o,testCodeCoverageLinesTotal:a})})),this.once("start",n.bind(function(){let o=`mocha ${process.argv.slice(2).join(" ")}`;A9.publish({command:o,frameworkVersion:WA})})),this.on("suite",function(i){if(i.root||!i.tests.length)return;let o=Ls.get(i.file);o||(o=new js("bound-anonymous-fn"),Ls.set(i.file,o),o.runInAsyncScope(()=>{R9.publish(i)}))}),this.on("suite end",function(i){if(i.root)return;let o=r[i.file];if(!(--s[i.file]===0))return;let c="pass";if(o.every(l=>l.pending)?c="skip":o.forEach(l=>{l.eachTest(d=>{(d.state==="failed"||d.timedOut)&&(c="fail")})}),global.__coverage__){let l=S9(global.__coverage__);P9.publish({coverageFiles:l,suiteFile:i.file}),E9(global.__coverage__,Xd),q9(global.__coverage__)}Ls.get(i.file).runInAsyncScope(()=>{C9.publish(c)})}),this.on("test",i=>{if(D9(i))return;let o=FA.get(i),a=new js("bound-anonymous-fn");kr.set(i.fn,a),a.runInAsyncScope(()=>{Qd.publish({test:i,testStartLine:o})})}),this.on("test end",i=>{let o=Us(i),a=GA(i);o&&!i.parent._afterEach.length&&o.runInAsyncScope(()=>{Jd.publish(a)})}),this.on("hook end",i=>{let o=i.ctx.currentTest;if(o&&i.parent._afterEach.includes(i)&&i.parent._afterEach.indexOf(i)===i.parent._afterEach.length-1){let c=GA(o);Us(o).runInAsyncScope(()=>{Jd.publish(c)})}}),this.on("fail",(i,o)=>{let a=i.file,c=i,u=i.type==="hook";u&&i.ctx&&(c=i.ctx.currentTest);let l;c&&(l=Us(c)),l&&l.runInAsyncScope(()=>{u?(o.message=`${i.fullTitle()}: ${o.message}`,UA.publish(o),Jd.publish("fail")):UA.publish(o)});let d=Ls.get(a);if(d){let h=new Error(`"${i.parent.fullTitle()}" failed with message "${o.message}"`);h.stack=o.stack,d.runInAsyncScope(()=>{O9.publish(h)})}}),this.on("pending",i=>{let o=Us(i);if(o)o.runInAsyncScope(()=>{HA.publish(i)});else{let a=new js("bound-anonymous-fn");i.fn?kr.set(i.fn,a):kr.set(i,a),a.runInAsyncScope(()=>{HA.publish(i)})}}),e.apply(this,arguments)})),t}function j9(t){return zi.has(t)?t:(zi.add(t),Cr.wrap(t,function(){let[e]=arguments,{it:r,...s}=t.apply(this,arguments);return{it:function(n){I9.publish({name:n,params:e}),r.apply(this,arguments)},...s}}))}Rr({name:"mocha",versions:[">=5.2.0"],file:"lib/mocha.js"},(t,e)=>{WA=e;let r=new js("bound-anonymous-fn");return Cr.wrap(t.prototype,"run",s=>function(){if(this.options.parallel)return v9.warn("Unable to initialize CI Visibility because Mocha is running in parallel mode."),s.apply(this,arguments);if(!BA.hasSubscribers||this.isWorker)return this.isWorker&&(zA=!0),s.apply(this,arguments);this.options.delay=!0;let n=s.apply(this,arguments),i=({err:a,skippableSuites:c})=>{a?Wi=[]:Wi=c,n.suite.suites=M9(n.suite.suites),global.run()},o=({err:a})=>{if(a||!$A.hasSubscribers)return global.run();$A.publish({onDone:r.bind(i)})};return r.runInAsyncScope(()=>{BA.publish({onDone:r.bind(o)})}),n}),t});Rr({name:"mocha",versions:[">=5.2.0"],file:"lib/suite.js"},t=>(Cr.wrap(t.prototype,"addTest",e=>function(r){let s=x9(new Error,r.file);return FA.set(r,s),e.apply(this,arguments)}),t));Rr({name:"mocha",versions:[">=5.2.0"],file:"lib/runner.js"},L9);Rr({name:"mocha",versions:[">=5.2.0"],file:"lib/cli/run-helpers.js"},t=>(Cr.wrap(t,"runMocha",e=>async function(){let r=arguments[0];return r.options.parallel||(r.options.delay=!0),e.apply(this,arguments)}),t));Rr({name:"mocha",versions:[">=5.2.0"],file:"lib/runnable.js"},t=>(Cr.wrap(t.prototype,"run",e=>function(){if(!Qd.hasSubscribers)return e.apply(this,arguments);let r=this.parent._beforeEach.includes(this),s=this.parent._afterEach.includes(this),n=r||s;if(this.fn.asyncResource){let i=Zd.get(this.fn);this.fn=i}if(n||this.type==="test"){let i=n?this.ctx.currentTest:this,o=Us(i);if(o){let a=o.bind(this.fn);Zd.set(a,this.fn),this.fn=a,this.fn.asyncResource||(this.fn.asyncResource=o)}}return e.apply(this,arguments)}),t));Rr({name:"mocha-each",versions:[">=2.0.1"]},j9)});var KA=p(()=>{"use strict";var{channel:th,addHook:U9,AsyncResource:H9}=m(),B9=b(),$9=th("apm:moleculer:call:start"),VA=th("apm:moleculer:call:finish"),G9=th("apm:moleculer:call:error");function F9(t){return function(e,r,s){let n=new H9("bound-anonymous-fn");return s=arguments[2]=s||{},s.meta=s.meta||{},arguments.length=Math.max(3,arguments.length),n.runInAsyncScope(()=>{$9.publish({actionName:e,params:r,opts:s});let i=t.apply(this,arguments),o=this,a=i.ctx;return i.then(c=>(VA.publish({broker:o,ctx:a}),c),c=>{throw G9.publish(c),VA.publish({broker:o,ctx:a}),c})})}}U9({name:"moleculer",versions:[">=0.14"]},t=>(B9.wrap(t.ServiceBroker.prototype,"call",F9),t))});var JA=p(()=>{"use strict";var{channel:sh,addHook:z9,AsyncResource:W9}=m(),V9=b(),K9=sh("apm:moleculer:action:start"),rh=sh("apm:moleculer:action:finish"),YA=sh("apm:moleculer:action:error");function Y9(t){return function(e){return this.middlewares&&this.middlewares.add&&this.middlewares.add(J9()),t.apply(this,arguments)}}function J9(){return{name:"Datadog",localAction(t,e){let r=this;return function(n){return new W9("bound-anonymous-fn").runInAsyncScope(()=>{K9.publish({action:e,ctx:n,broker:r});try{return t(n).then(o=>(rh.publish(),o),o=>{throw YA.publish(o),rh.publish(),o})}catch(o){YA.publish(o),rh.publish()}})}}}}z9({name:"moleculer",versions:[">=0.14"]},t=>(V9.wrap(t.ServiceBroker.prototype,"registerMiddlewares",Y9),t))});var XA=p(()=>{"use strict";KA();JA()});var ah=p(()=>{"use strict";var{channel:oh,addHook:vt,AsyncResource:nh}=m(),k=b(),Or=oh("apm:mongodb:query:start"),X9=oh("apm:mongodb:query:finish"),QA=oh("apm:mongodb:query:error");vt({name:"mongodb-core",versions:["2 - 3.1.9"]},t=>{let e=t.Server.prototype;k.wrap(e,"command",s=>Vi(s,"command")),k.wrap(e,"insert",s=>Vi(s,"insert","insert")),k.wrap(e,"update",s=>Vi(s,"update","update")),k.wrap(e,"remove",s=>Vi(s,"remove","remove"));let r=t.Cursor.prototype;return k.wrap(r,"_getmore",s=>ZA(s,"getMore","getMore")),k.wrap(r,"_find",s=>Q9(s,"_find")),k.wrap(r,"kill",s=>ZA(s,"killCursors","killCursors")),t});vt({name:"mongodb",versions:[">=4 <4.6.0"],file:"lib/cmap/connection.js"},t=>{let e=t.Connection.prototype;return k.wrap(e,"command",r=>ih(r,"command")),k.wrap(e,"query",r=>ih(r,"query")),t});vt({name:"mongodb",versions:[">=4.6.0"],file:"lib/cmap/connection.js"},t=>{let e=t.Connection.prototype;return k.wrap(e,"command",r=>ih(r,"command")),t});vt({name:"mongodb",versions:[">=3.3 <4"],file:"lib/core/wireprotocol/index.js"},t=>ek(t));vt({name:"mongodb-core",versions:[">=3.2"],file:"lib/wireprotocol/index.js"},t=>ek(t));vt({name:"mongodb-core",versions:["~3.1.10"],file:"lib/wireprotocol/3_2_support.js"},t=>(k.wrap(t.prototype,"command",e=>rt(e,"command")),t));vt({name:"mongodb-core",versions:["~3.1.10"],file:"lib/wireprotocol/2_6_support.js"},t=>(k.wrap(t.prototype,"command",e=>rt(e,"command")),t));vt({name:"mongodb",versions:[">=3.5.4 <4.11.0"],file:"lib/utils.js"},t=>(k.wrap(t,"maybePromise",e=>function(r,s,n){let i=new nh("bound-anonymous-fn"),o=arguments.length-2;return s=arguments[o],typeof s=="function"&&(arguments[o]=i.bind(s)),e.apply(this,arguments)}),t));function ek(t){return k.wrap(t,"command",e=>rt(e,"command")),k.wrap(t,"insert",e=>rt(e,"insert","insert")),k.wrap(t,"update",e=>rt(e,"update","update")),k.wrap(t,"remove",e=>rt(e,"remove","remove")),k.wrap(t,"query",e=>rt(e,"query")),k.wrap(t,"getMore",e=>rt(e,"getMore","getMore")),k.wrap(t,"killCursors",e=>rt(e,"killCursors","killCursors")),t}function rt(t,e,r){let s=function(n,i,o){return Or.hasSubscribers?Hs(e,t,this,arguments,n,i,o,{name:r}):t.apply(this,arguments)};return k.wrap(t,s)}function ih(t,e,r){let s=function(n,i){if(!Or.hasSubscribers)return t.apply(this,arguments);let o=typeof this.address=="string"?this.address.split(":"):"",c={s:{options:o.length===2?{host:o[0],port:o[1]}:{}}};return n=`${n.db}.${n.collection}`,Hs(e,t,this,arguments,c,n,i,{name:r})};return k.wrap(t,s)}function Q9(t,e,r){let s=function(){if(!Or.hasSubscribers)return t.apply(this,arguments);let n=this.server.s.pool,i=this.ns,o=this.cmd;return Hs(e,t,this,arguments,n,i,o)};return k.wrap(t,s)}function ZA(t,e,r){let s=function(){if(!Or.hasSubscribers)return t.apply(this,arguments);let n=this.server.s.pool,i=this.ns;return Hs(e,t,this,arguments,n,i,{},{name:r})};return k.wrap(t,s)}function Vi(t,e,r){let s=function(n,i){return Or.hasSubscribers?Hs(e,t,this,arguments,this,n,i,{name:r}):t.apply(this,arguments)};return k.wrap(t,s)}function Hs(t,e,r,s,n,i,o,a={}){let c=a.name||o&&Object.keys(o)[0],u=s.length-1,l=s[u];if(typeof l!="function")return e.apply(r,s);let d=n&&n.s&&n.s.options,h=new nh("bound-anonymous-fn"),f=new nh("bound-anonymous-fn");return l=h.bind(l),f.runInAsyncScope(()=>{Or.publish({ns:i,ops:o,options:d,name:c}),s[u]=f.bind(function(g,v){if(g&&QA.publish(g),X9.publish(),l)return l.apply(this,arguments)});try{return e.apply(r,s)}catch(g){throw QA.publish(g),g}})}});var sk=p(()=>{"use strict";var{addHook:Z9}=m(),{wrapThen:e5}=Ht(),{AsyncResource:tk}=m(),rk=b();function t5(t){return function(r){return typeof r=="function"?arguments[0]=tk.bind(r):typeof this[r]=="function"&&(arguments[0]=tk.bind((...s)=>this[r](...s))),t.apply(this,arguments)}}Z9({name:"mongoose",versions:[">=4.6.4 <5","5","6",">=7"]},t=>(t.Promise!==global.Promise&&rk.wrap(t.Promise.prototype,"then",e5),rk.wrap(t.Collection.prototype,"addQueue",t5),t))});var ok=p(()=>{"use strict";var{channel:ch,addHook:nk,AsyncResource:uh}=m(),ik=b();nk({name:"mysql",file:"lib/Connection.js",versions:[">=2"]},t=>{let e=ch("apm:mysql:query:start"),r=ch("apm:mysql:query:finish"),s=ch("apm:mysql:query:error");return ik.wrap(t.prototype,"query",n=>function(){if(!e.hasSubscribers)return n.apply(this,arguments);let i=arguments[0].sql?arguments[0].sql:arguments[0],o=this.config,a={sql:i,conf:o},c=new uh("bound-anonymous-fn"),u=new uh("bound-anonymous-fn");return u.runInAsyncScope(()=>{e.publish(a),arguments[0].sql?arguments[0].sql=a.sql:arguments[0]=a.sql;try{let l=n.apply(this,arguments);if(l._callback){let d=c.bind(l._callback);l._callback=u.bind(function(h,f){return h&&s.publish(h),r.publish(f),d.apply(this,arguments)})}else{let d=u.bind(function(){r.publish(void 0)});l.on("end",d)}return l}catch(l){throw l.stack,s.publish(l),l}})}),t});nk({name:"mysql",file:"lib/Pool.js",versions:[">=2"]},t=>(ik.wrap(t.prototype,"getConnection",e=>function(r){return arguments[0]=uh.bind(r),e.apply(this,arguments)}),t))});var ck=p(()=>{"use strict";var{channel:ph,addHook:r5,AsyncResource:ak}=m(),s5=b();r5({name:"mysql2",file:"lib/connection.js",versions:[">=1"]},t=>{let e=ph("apm:mysql2:query:start"),r=ph("apm:mysql2:query:finish"),s=ph("apm:mysql2:query:error");return s5.wrap(t.prototype,"addCommand",o=>function(a){if(!e.hasSubscribers)return o.apply(this,arguments);let c=new ak("bound-anonymous-fn"),u=a&&a.constructor&&a.constructor.name,d=typeof a.execute=="function"&&(u==="Execute"||u==="Query");return a.execute=d?i(a,a.execute,c,this.config):n(a,a.execute,c),c.bind(o,this).apply(this,arguments)}),t;function n(o,a,c){return c.bind(function(l,d){return this.onResult&&(this.onResult=c.bind(this.onResult)),a.apply(this,arguments)},o)}function i(o,a,c,u){let l=new ak("bound-anonymous-fn");return c.bind(function(h,f){let v={sql:o.statement?o.statement.query:o.sql,conf:u};if(e.publish(v),o.statement?o.statement.query=v.sql:o.sql=v.sql,this.onResult){let q=l.bind(this.onResult);this.onResult=c.bind(function(_){_&&s.publish(_),r.publish(void 0),q.apply(this,arguments)},"bound-anonymous-fn",this)}else this.on("error",c.bind(q=>s.publish(q))),this.on("end",c.bind(()=>r.publish(void 0)));this.execute=a;try{return a.apply(this,arguments)}catch(q){s.publish(q)}},o)}})});var mk=p(()=>{"use strict";var{channel:Ft,addHook:n5,AsyncResource:uk}=m(),i5=b(),pk=Ft("apm:net:ipc:start"),o5=Ft("apm:net:ipc:finish"),hk=Ft("apm:net:ipc:error"),lk=Ft("apm:net:tcp:start"),a5=Ft("apm:net:tcp:finish"),fk=Ft("apm:net:tcp:error"),c5=Ft("apm:net:tcp:connection");n5({name:"net"},t=>(require("dns"),i5.wrap(t.Socket.prototype,"connect",e=>function(){if(!pk.hasSubscribers||!lk.hasSubscribers)return e.apply(this,arguments);let r=gk(arguments),s=arguments.length-1,n=arguments[s];if(!r)return e.apply(this,arguments);let i=new uk("bound-anonymous-fn"),o=new uk("bound-anonymous-fn");typeof n=="function"&&(arguments[s]=i.bind(n));let a=r.path?"ipc":"tcp";return o.runInAsyncScope(()=>{a==="ipc"?(pk.publish({options:r}),dk(this,"ipc",o)):(lk.publish({options:r}),dk(this,"tcp",o));let c=this.emit;this.emit=function(u){switch(u){case"ready":case"connect":return i.runInAsyncScope(()=>c.apply(this,arguments));default:return c.apply(this,arguments)}};try{return e.apply(this,arguments)}catch(u){throw a==="ipc"?hk.publish(u):fk.publish(u),u}})}),t));function gk(t){if(t[0])switch(typeof t[0]){case"object":return Array.isArray(t[0])?gk(t[0]):t[0];case"string":if(isNaN(parseFloat(t[0])))return{path:t[0]};case"number":return{port:t[0],host:typeof t[1]=="string"?t[1]:"localhost"}}}function dk(t,e,r){let s=["connect","error","close","timeout"],n=r.bind(function(a){a&&(e==="ipc"?hk.publish(a):fk.publish(a)),e==="ipc"?o5.publish(void 0):a5.publish(void 0)}),i=r.bind(function(){c5.publish({socket:t})}),o=function(){t.removeListener("connect",i),s.forEach(a=>{t.removeListener(a,n),t.removeListener(a,o)})};e==="tcp"&&t.once("connect",i),s.forEach(a=>{t.once(a,n),t.once(a,o)})}});var Sk=p(()=>{"use strict";var{channel:Ki,addHook:hh,AsyncResource:u5}=m(),F=b(),p5=Ki("apm:next:request:start"),l5=Ki("apm:next:request:finish"),d5=Ki("apm:next:request:error"),fh=Ki("apm:next:page:load"),_k=new WeakMap;function gh(t){return function(e,r,s,n){return zt(e,r,()=>t.apply(this,arguments))}}function bk(t){return function(e,r,s,n){return zt(e,r,()=>t.apply(this,arguments).then(o=>o&&this.hasPage(s).then(a=>{let c=a?s:m5(s,this.dynamicRoutes);return fh.publish({page:c}),o})))}}function h5(t){return function(e,r,s,n){return zt(e,r,()=>{let i=typeof n=="object"&&typeof n.definition=="object"?n.definition.pathname:void 0;return fh.publish({page:i}),t.apply(this,arguments)})}}function yk(t){return function(e){return zt(e.req,e.res,()=>t.apply(this,arguments))}}function vk(t){return function(e){return zt(e.req,e.res,()=>t.apply(this,arguments))}}function f5(t){return function(e,r,s,n,i){return zt(e,r,()=>t.apply(this,arguments))}}function g5(t){return function(e,r,s,n,i){return zt(r,s,()=>t.apply(this,arguments))}}function mh(t){return function(e,r){let s=t.apply(this,arguments);return s&&fh.publish({page:dh(e)}),s}}function dh(t){return typeof t=="object"?t.pathname:t}function m5(t,e=[]){for(let r of e)if(r.page.startsWith("/api")&&r.match(t))return dh(r.page);return dh(t)}function zt(t,e,r){if(_k.has(t))return r();let s=new u5("bound-anonymous-fn");return _k.set(t,s),s.runInAsyncScope(()=>{p5.publish({req:t,res:e});try{return r().then(i=>lh(t,e,i),i=>lh(t,e,null,i))}catch(n){return lh(t,e,null,n)}})}function lh(t,e,r,s){if(s&&d5.publish(s),l5.publish({req:t,res:e}),s)throw s;return r}hh({name:"next",versions:[">=13.2"],file:"dist/server/next-server.js"},t=>{let e=t.default;return F.wrap(e.prototype,"handleRequest",gh),F.wrap(e.prototype,"handleApiRequest",h5),F.wrap(e.prototype,"renderToResponse",yk),F.wrap(e.prototype,"renderErrorToResponse",vk),F.wrap(e.prototype,"findPageComponents",mh),t});hh({name:"next",versions:[">=11.1 <13.2"],file:"dist/server/next-server.js"},t=>{let e=t.default;return F.wrap(e.prototype,"handleRequest",gh),F.wrap(e.prototype,"handleApiRequest",bk),F.wrap(e.prototype,"renderToResponse",yk),F.wrap(e.prototype,"renderErrorToResponse",vk),F.wrap(e.prototype,"findPageComponents",mh),t});hh({name:"next",versions:[">=9.5 <11.1"],file:"dist/next-server/server/next-server.js"},t=>{let e=t.default;return F.wrap(e.prototype,"handleRequest",gh),F.wrap(e.prototype,"handleApiRequest",bk),F.wrap(e.prototype,"renderToHTML",f5),F.wrap(e.prototype,"renderErrorToHTML",g5),F.wrap(e.prototype,"findPageComponents",mh),t})});var wk=p(()=>{"use strict";var{channel:bh,addHook:_5,AsyncResource:qk}=m(),Yi=b(),Bs=new WeakMap,Ji=new WeakMap,Ek=bh("apm:oracledb:query:start"),Tk=bh("apm:oracledb:query:error"),b5=bh("apm:oracledb:query:finish");function _h(t){t&&Tk.publish(t),b5.publish(void 0)}_5({name:"oracledb",versions:["5"]},t=>(Yi.wrap(t.Connection.prototype,"execute",e=>function(s,...n){if(!Ek.hasSubscribers)return e.apply(this,arguments);if(arguments.length&&typeof arguments[arguments.length-1]=="function"){let i=arguments[arguments.length-1],o=new qk("apm:oracledb:outer-scope");arguments[arguments.length-1]=function(c,u){return _h(c),o.runInAsyncScope(()=>i.apply(this,arguments))}}return new qk("apm:oracledb:inner-scope").runInAsyncScope(()=>{let i=Bs.get(this);Ek.publish({query:s,connAttrs:i});try{let o=e.apply(this,arguments);return o&&typeof o.then=="function"&&(o=o.then(a=>(_h(),a),a=>{throw _h(a),a})),o}catch(o){throw Tk.publish(o),o}})}),Yi.wrap(t,"getConnection",e=>function(s,n){if(n)arguments[1]=(i,o)=>{o&&Bs.set(o,s),n(i,o)},e.apply(this,arguments);else return e.apply(this,arguments).then(i=>(Bs.set(i,s),i))}),Yi.wrap(t,"createPool",e=>function(s,n){if(n)arguments[1]=(i,o)=>{o&&Ji.set(o,s),n(i,o)},e.apply(this,arguments);else return e.apply(this,arguments).then(i=>(Ji.set(i,s),i))}),Yi.wrap(t.Pool.prototype,"getConnection",e=>function(){let s;if(typeof arguments[arguments.length-1]=="function"&&(s=arguments[arguments.length-1]),s)arguments[arguments.length-1]=(n,i)=>{i&&Bs.set(i,Ji.get(this)),s(n,i)},e.apply(this,arguments);else return e.apply(this,arguments).then(n=>(Bs.set(n,Ji.get(this)),n))}),t))});var kk=p(()=>{"use strict";var{addHook:Xi,channel:vh}=m(),$s=b(),y5=vh("apm:paperplane:log"),v5=vh("apm:paperplane:request:handle"),xk=vh("apm:paperplane:request:route"),yh=Number(process.versions.node.split(".")[0]),Qi="paperplane",Sh=yh<=12?[">=2.3.2"]:yh<=14?[">=3.1.1"]:[],S5=t=>e=>{let{original:r,route:s}=e;return xk.hasSubscribers&&xk.publish({req:r,route:s}),t(e)},q5=t=>e=>{let r={message:e};return y5.publish(r),t(r.message)},Ik=t=>e=>{let r=t(e);return function(s,n){return v5.publish(s),r.apply(this,arguments)}},Ak=t=>e=>{let r={};for(let s in e)r[s]=S5(e[s]);return t(r)};Xi({name:Qi,versions:Sh,file:"lib/logger.js"},t=>($s.wrap(t,"logger",q5),t));Xi({name:Qi,versions:Sh,file:"lib/mount.js"},t=>($s.wrap(t,"mount",Ik),t));Xi({name:Qi,versions:Sh,file:"lib/routes.js"},t=>($s.wrap(t,"routes",Ak),t));yh<=12&&Xi({name:Qi,versions:["2.3.0 - 2.3.1"]},t=>($s.wrap(t,"mount",Ik),$s.wrap(t,"routes",Ak),t))});var Mk=p(()=>{"use strict";var{channel:qh,addHook:Pk,AsyncResource:Rk}=m(),Nk=b(),Ck=qh("apm:pg:query:start"),E5=qh("apm:pg:query:finish"),Ok=qh("apm:pg:query:error");Pk({name:"pg",versions:[">=8.0.3"]},t=>(Nk.wrap(t.Client.prototype,"query",e=>Dk(e)),t));Pk({name:"pg",file:"lib/native/index.js",versions:[">=8.0.3"]},t=>(Nk.wrap(t.prototype,"query",e=>Dk(e)),t));function Dk(t){return function(){if(!Ck.hasSubscribers)return t.apply(this,arguments);let e=new Rk("bound-anonymous-fn"),r=new Rk("bound-anonymous-fn"),s=this.processID,n={text:arguments[0]};return r.runInAsyncScope(()=>{Ck.publish({params:this.connectionParameters,query:n,processId:s}),arguments[0]=n.text;let i=r.bind(function(u){u&&Ok.publish(u),E5.publish()}),o=t.apply(this,arguments),a=this.queryQueue||this._queryQueue,c=this.activeQuery||this._activeQuery;if(n=a[a.length-1]||c,!n)return o;if(n.callback){let u=e.bind(n.callback);n.callback=function(l,d){return i(l),u.apply(this,arguments)}}else n.once?n.once("error",i).once("end",()=>i()):n.then(()=>i(),i);try{return o}catch(u){Ok.publish(u)}})}}});var Th=p(()=>{"use strict";var{channel:Zi,addHook:Gs}=m(),Fs=b();function Eh(t,e,r){return function(){let n=r.apply(this,arguments);return Object.defineProperty(n,t,{configurable:!0,enumerable:!0,writable:!0,value:e(n[t])}),n}}function T5(t){let e=Zi("apm:pino:log");return function(s,n,i,o){s=arguments[0]=s||{};let a={message:s};return e.publish(a),arguments[0]=a.message,t.apply(this,arguments)}}function Lk(t){let e=Zi("apm:pino:log");return function(){let s={};t&&(s=t.apply(this,arguments));let n={message:s};return e.publish(n),n.message}}function w5(t){let e=Zi("apm:pino:log");return function(s){let n={message:s.input};return e.publish(n),s.input=n.message,t.apply(this,arguments)}}function x5(t){let e=Zi("apm:pino:log");return function(){let s=t.apply(this,arguments);return function(i){let o={message:i};return e.publish(o),arguments[0]=o.message,s.apply(this,arguments)}}}Gs({name:"pino",versions:["2 - 3","4",">=5 <5.14.0"]},t=>{let e=t.symbols&&t.symbols.asJsonSym||"asJson";return Fs.wrap(t,Eh(e,T5,t))});Gs({name:"pino",versions:[">=5.14.0 <6.8.0"]},t=>{let e=t.symbols.mixinSym;return Fs.wrap(t,Eh(e,Lk,t))});Gs({name:"pino",versions:[">=6.8.0"]},t=>{let e=t.symbols.mixinSym,r=Fs.wrap(t,Eh(e,Lk,t));return r.pino=r,r.default=r,r});Gs({name:"pino-pretty",file:"lib/utils.js",versions:[">=3"]},t=>(Fs.wrap(t,"prettifyObject",w5),t));Gs({name:"pino-pretty",versions:["1 - 2"]},t=>Fs.wrap(t,x5(t)))});var jk=p(()=>{"use strict";var{addHook:I5}=m(),{wrapThen:A5}=Ht(),k5=b();I5({name:"promise-js",versions:[">=0.0.3"]},t=>(t!==global.Promise&&k5.wrap(t.prototype,"then",A5),t))});var Uk=p(()=>{"use strict";var{addHook:R5}=m(),{wrapThen:C5}=Ht(),O5=b();R5({name:"promise",file:"lib/core.js",versions:[">=7"]},t=>(O5.wrap(t.prototype,"then",C5),t))});var Gk=p(()=>{"use strict";var{addHook:Hk}=m(),{wrapThen:Bk}=Ht(),$k=b();Hk({name:"q",versions:["1"]},t=>($k.wrap(t.makePromise.prototype,"then",Bk),t));Hk({name:"q",versions:[">=2"]},t=>($k.wrap(t.Promise.prototype,"then",Bk),t))});var zk=p(()=>{"use strict";var{addHook:P5,channel:N5}=m(),D5=b(),Fk=N5("datadog:qs:parse:finish");function M5(t){return function(){let e=t.apply(this,arguments);return Fk.hasSubscribers&&e&&Fk.publish({qs:e}),e}}P5({name:"qs",versions:[">=1"]},t=>(D5.wrap(t,"parse",M5),t))});var Kk=p(()=>{"use strict";var wh=b(),{addHook:L5,channel:Pr}=m(),j5=["use","pre"],U5=["del","get","head","opts","post","put","patch"],H5=Pr("apm:restify:request:handle"),B5=Pr("apm:restify:middleware:error"),$5=Pr("apm:restify:middleware:enter"),G5=Pr("apm:restify:middleware:exit"),Wk=Pr("apm:restify:middleware:finish"),Vk=Pr("apm:restify:middleware:next");function F5(t){return function(e,r){return H5.publish({req:e,res:r}),t.apply(this,arguments)}}function z5(t){return function(e){let r=xh(Array.prototype.slice.call(arguments,1));return t.apply(this,[e].concat(r))}}function W5(t){return function(){return t.apply(this,xh(arguments))}}function xh(t){return Array.prototype.map.call(t,V5)}function V5(t){return Array.isArray(t)?xh(t):function(e,r,s){typeof s=="function"&&(arguments[2]=K5(e,s));let n=e.route&&e.route.path;$5.publish({req:e,route:n});try{return t.apply(this,arguments)}catch(i){throw B5.publish({req:e,error:i}),Vk.publish({req:e}),Wk.publish({req:e}),i}finally{G5.publish({req:e})}}}function K5(t,e){return function(){Vk.publish({req:t}),Wk.publish({req:t}),e.apply(this,arguments)}}L5({name:"restify",versions:[">=3"],file:"lib/server.js"},t=>(wh.wrap(t.prototype,"_setupRequest",F5),wh.massWrap(t.prototype,j5,W5),wh.massWrap(t.prototype,U5,z5),t))});var tR=p(()=>{"use strict";var{channel:St,addHook:to,AsyncResource:eo}=m(),zs=b(),Y5=Symbol("circularBufferConstructor"),Nr=Symbol("inFlightDeliveries"),Yk=new WeakSet,J5=St("apm:rhea:send:start"),X5=St("apm:rhea:send:encode"),Q5=St("apm:rhea:send:error"),Z5=St("apm:rhea:send:finish"),eK=St("apm:rhea:receive:start"),Qk=St("apm:rhea:receive:dispatch"),Zk=St("apm:rhea:receive:error"),tK=St("apm:rhea:receive:finish"),Dr=new WeakMap;to({name:"rhea",versions:[">=1"]},t=>(zs.wrap(t.message,"encode",e=>function(r){return X5.publish(r),e.apply(this,arguments)}),t));to({name:"rhea",versions:[">=1"],file:"lib/link.js"},t=>{let e=t.Sender,r=t.Receiver;return zs.wrap(e.prototype,"send",s=>function(n,i,o){if(!Jk(this))return s.apply(this,arguments);let{host:a,port:c}=rK(this.connection),u=this.options&&this.options.target&&this.options.target.address?this.options.target.address:void 0,l=new eo("bound-anonymous-fn");return l.runInAsyncScope(()=>{J5.publish({targetAddress:u,host:a,port:c,msg:n});let d=s.apply(this,arguments),h={asyncResource:l};Dr.set(d,h),Xk(this.connection,d);try{return d}catch(f){throw Q5.publish(f),f}})}),zs.wrap(r.prototype,"dispatch",s=>function(n,i){if(!Jk(this))return s.apply(this,arguments);if(n==="message"&&i){let o=new eo("bound-anonymous-fn");return o.runInAsyncScope(()=>{if(eK.publish({msgObj:i,connection:this.connection}),i.delivery){let a={asyncResource:o};Dr.set(i.delivery,a),i.delivery.update=sK(i.delivery,i.delivery.update),Xk(this.connection,i.delivery)}try{return s.apply(this,arguments)}catch(a){throw Zk.publish(a),a}})}return s.apply(this,arguments)}),t});to({name:"rhea",versions:[">=1"],file:"lib/connection.js"},t=>(zs.wrap(t.prototype,"dispatch",e=>function(r,s){if(r==="disconnected"){let n=s.error||this.saved_error;this[Nr]&&this[Nr].forEach(i=>{let o=Dr.get(i),a=o&&o.asyncResource;a&&a.runInAsyncScope(()=>{Zk.publish(n),eR(i,null),tK.publish()})})}return e.apply(this,arguments)}),t));to({name:"rhea",versions:[">=1"],file:"lib/session.js"},t=>(nK(t.prototype,t),t));function Jk(t){return t.connection&&t.session&&t.session.outgoing}function rK(t){let e,r;return t&&t.options&&(e=t.options.host,r=t.options.port),{host:e,port:r}}function sK(t,e){let s=Dr.get(t).asyncResource;if(t&&s){let n=s.bind(e);return eo.bind(function(o,a){let c=iK(a);return Qk.publish({state:c}),n.apply(this,arguments)})}return function(i,o){return e.apply(this,arguments)}}function nK(t,e){Object.defineProperty(t,"outgoing",{configurable:!0,get(){},set(r){if(delete t.outgoing,this.outgoing=r,r){let s;if(r.deliveries&&(s=r.deliveries.constructor),s&&!Yk.has(s.prototype)){zs.wrap(s.prototype,"pop_if",i=>function(o){return arguments[0]=eo.bind(function(a){let c=Dr.get(a),u=c&&c.asyncResource;if(!u)return o(a);let l=u.runInAsyncScope(()=>o(a));if(l){let d=a.remote_state,h=d&&d.constructor?a.remote_state.constructor.composite_type:void 0;u.runInAsyncScope(()=>{eR(a,h),Z5.publish()})}return l}),i.apply(this,arguments)}),Yk.add(s.prototype);let n=t.constructor;n&&(n[Y5]=s)}}}})}function Xk(t,e){let r=t[Nr];r||(r=new Set,t[Nr]=r),r.add(e)}function eR(t,e){let r=Dr.get(t);r&&(e&&Qk.publish({state:e}),r.connection&&r.connection[Nr]&&r.connection[Nr].delete(t))}function iK(t){if(t&&t.descriptor&&t.descriptor)switch(t.descriptor.value){case 36:return"accepted";case 37:return"rejected";case 38:return"released";case 39:return"modified"}}});var sR=p(()=>{"use strict";var{channel:Ih,addHook:oK,AsyncResource:rR}=m(),aK=b(),cK={hs:"handshake",qf:"query-fetch",qs:"query-subscribe",qu:"query-unsubscribe",bf:"bulk-fetch",bs:"bulk-subscribe",bu:"bulk-unsubscribe",f:"fetch",s:"subscribe",u:"unsubscribe",op:"op",nf:"snapshot-fetch",nt:"snapshot-fetch-by-ts",p:"presence-broadcast",pr:"presence-request",ps:"presence-subscribe",pu:"presence-unsubscribe"};oK({name:"sharedb",versions:[">=1"],file:"lib/agent.js"},t=>{let e=Ih("apm:sharedb:request:start"),r=Ih("apm:sharedb:request:finish"),s=Ih("apm:sharedb:request:error");return aK.wrap(t.prototype,"_handleMessage",n=>function(i,o){let a=new rR("bound-anonymous-fn"),c=new rR("bound-anonymous-fn"),u=i.a,l=uK(u);return c.runInAsyncScope(()=>{e.publish({actionName:l,request:i}),o=a.bind(o),arguments[1]=c.bind(function(d,h){return d&&s.publish(d),r.publish({request:i,res:h}),o.apply(this,arguments)});try{return n.apply(this,arguments)}catch(d){throw s.publish(d),d}})}),t});function uK(t){let e=cK[t];return e===void 0?t:e}});var iR=p(()=>{"use strict";var{channel:Ah,addHook:pK,AsyncResource:nR}=m(),lK=b();pK({name:"tedious",versions:[">=1.0.0"]},t=>{let e=Ah("apm:tedious:request:start"),r=Ah("apm:tedious:request:finish"),s=Ah("apm:tedious:request:error");return lK.wrap(t.Connection.prototype,"makeRequest",n=>function(i){if(!e.hasSubscribers)return n.apply(this,arguments);let o=dK(i);if(!o)return n.apply(this,arguments);let a=new nR("bound-anonymous-fn"),c=new nR("bound-anonymous-fn"),u=this.config;return c.runInAsyncScope(()=>{e.publish({queryOrProcedure:o,connectionConfig:u});let l=a.bind(i.callback,i);i.callback=c.bind(function(d){return d&&s.publish(d),r.publish(void 0),l.apply(this,arguments)},null,i);try{return n.apply(this,arguments)}catch(d){throw s.publish(d),d}})}),t});function dK(t){if(!t.parameters)return;let e=t.parametersByName.statement||t.parametersByName.stmt;return e?e.value:t.sqlTextOrProcedure}});var oR=p(()=>{"use strict";var{addHook:hK}=m(),{wrapThen:fK}=Ht(),gK=b();hK({name:"when",file:"lib/Promise.js",versions:[">=3"]},t=>(gK.wrap(t.prototype,"then",fK),t))});var lR=p(()=>{"use strict";var{channel:uR,addHook:pR}=m(),kh=b(),aR=new WeakSet;pR({name:"winston",file:"lib/winston/logger.js",versions:[">=3"]},t=>{let e=uR("apm:winston:log");return kh.wrap(t.prototype,"write",r=>function(n,i,o){if(e.hasSubscribers){let a={message:n};e.publish(a),arguments[0]=a.message}return r.apply(this,arguments)}),t});pR({name:"winston",file:"lib/winston/logger.js",versions:["1","2"]},t=>{let e=uR("apm:winston:log");return t.Logger.prototype.configure&&kh.wrap(t.Logger.prototype,"configure",r=>cR(r,e)),kh.wrap(t.Logger.prototype,"add",r=>cR(r,e)),t});function cR(t,e){return function(){let s=t.apply(this,arguments);if(e.hasSubscribers)for(let n in this.transports){let i=this.transports[n];if(aR.has(i)||typeof i.log!="function")continue;let o=i.log;i.log=function(c,u,l,d){let h={message:l||{}};e.publish(h),arguments[2]=h.message,o.apply(this,arguments)},aR.add(i)}return s}}});var hR=p((mne,dR)=>{"use strict";dR.exports={"@aws-sdk/smithy-client":()=>Ll(),"@cucumber/cucumber":()=>fw(),"@playwright/test":()=>qw(),"@elastic/elasticsearch":()=>Ss(),"@elastic/transport":()=>Ss(),"@google-cloud/pubsub":()=>kw(),"@grpc/grpc-js":()=>td(),"@hapi/hapi":()=>sd(),"@jest/core":()=>Ye(),"@jest/reporters":()=>Ye(),"@koa/router":()=>Ai(),"@node-redis/client":()=>Pi(),"@opensearch-project/opensearch":()=>Ax(),"@redis/client":()=>Pi(),amqp10:()=>Ox(),amqplib:()=>Mx(),"aws-sdk":()=>Ll(),bluebird:()=>Bx(),"body-parser":()=>Gx(),bunyan:()=>Fx(),"cassandra-driver":()=>Wx(),child_process:()=>gd(),"node:child_process":()=>gd(),connect:()=>rI(),couchbase:()=>pI(),crypto:()=>fI(),cypress:()=>gI(),dns:()=>bI(),elasticsearch:()=>Ss(),express:()=>TI(),fastify:()=>RI(),"find-my-way":()=>CI(),fs:()=>Rd(),"node:fs":()=>Rd(),graphql:()=>WI(),grpc:()=>td(),hapi:()=>sd(),http:()=>Ud(),http2:()=>pA(),https:()=>Ud(),ioredis:()=>fA(),"jest-circus":()=>Ye(),"jest-config":()=>Ye(),"jest-environment-node":()=>Ye(),"jest-environment-jsdom":()=>Ye(),"jest-jasmine2":()=>Ye(),"jest-worker":()=>Ye(),koa:()=>Ai(),"koa-router":()=>Ai(),kafkajs:()=>SA(),ldapjs:()=>EA(),"limitd-client":()=>xA(),mariadb:()=>RA(),memcached:()=>OA(),"microgateway-core":()=>jA(),mocha:()=>eh(),"mocha-each":()=>eh(),moleculer:()=>XA(),mongodb:()=>ah(),"mongodb-core":()=>ah(),mongoose:()=>sk(),mysql:()=>ok(),mysql2:()=>ck(),net:()=>mk(),next:()=>Sk(),oracledb:()=>wk(),paperplane:()=>kk(),pg:()=>Mk(),pino:()=>Th(),"pino-pretty":()=>Th(),"promise-js":()=>jk(),promise:()=>Uk(),q:()=>Gk(),qs:()=>zk(),redis:()=>Pi(),restify:()=>Kk(),rhea:()=>tR(),router:()=>vd(),sharedb:()=>sR(),tedious:()=>iR(),when:()=>oR(),winston:()=>lR()}});var Ch=p((_ne,Rh)=>{"use strict";var{channel:mK}=H(),_K=require("path"),fR=require("semver"),bK=Cl(),yK=Fc(),vK=E(),gR=hR(),SK=gi(),qK=Object.keys(gR),mR=new RegExp(`\\${_K.sep}`,"g"),EK=mK("dd-trace:instrumentation:load");for(let t of qK)bK([t],(e,r,s,n)=>{r=r.replace(mR,"/"),gR[t]();for(let{name:i,file:o,versions:a,hook:c}of SK[t]){let u=_R(i,o);if(r===u){let l=n||wK(s);if(TK(l,a))try{EK.publish({name:i,version:l,file:o}),e=c(e,l)}catch(d){vK.error(d)}}}return e});function TK(t,e){return!t||e&&e.some(r=>fR.satisfies(fR.coerce(t),r))}function wK(t){if(t)return yK(t,Rh).version}function _R(t,e){return[t,e].filter(r=>r).join("/")}Rh.exports={filename:_R,pathSepExpr:mR}});var bR=p(()=>{"use strict";Ch()});var vR=p((vne,yR)=>{"use strict";var Oh=class extends Error{constructor(e){super(e),Object.setPrototypeOf(this,new.target.prototype)}},ro=class extends Oh{};ro.prototype.name="Impending Timeout";yR.exports={ImpendingTimeout:ro}});var xR=p(wR=>{"use strict";var qR=E(),{channel:xK}=m(),{ERROR_MESSAGE:IK,ERROR_TYPE:AK}=A(),{ImpendingTimeout:kK}=vR(),RK=global._ddtrace,SR=RK._tracer,ER=xK("apm:aws:lambda:timeout");ER.subscribe(t=>{OK()});var TR;function CK(t){let e=t.getRemainingTimeInMillis(),r=parseInt(process.env.DD_APM_FLUSH_DEADLINE_MILLISECONDS)||100;r=r<0?100:r,TR=setTimeout(()=>{ER.publish(void 0)},e-r)}function OK(){let t=SR.scope().active();if(t!==null){let e=new kK("Datadog detected an impending timeout");t.addTags({[IK]:e.message,[AK]:e.name})}else qR.debug("An impending timeout was reached, but no root span was found. No error will be tagged.");SR._processor.killAll(),t!==null&&t.finish()}function PK(t){let e=t.length>1?t[1]:void 0;if((e===void 0||e.getRemainingTimeInMillis===void 0)&&(e=t.length>2?t[2]:void 0,e===void 0||e.getRemainingTimeInMillis===void 0))throw Error("Could not extract context");return e}wR.datadog=function(e){return(...r)=>{let s=e.apply(this,r);try{let n=PK(r);CK(n),s&&s.then(i=>clearTimeout(TR))}catch{qR.debug("Error patching AWS Lambda handler. Timeout spans will not be generated.")}return s}}});var Ph=p(()=>{"use strict";var NK=require("path"),{_extractModuleNameAndHandlerPath:DK,_extractModuleRootAndHandler:MK,_getLambdaFilePath:LK}=Nh(),{datadog:kR}=xR(),{addHook:IR}=m(),RR=b(),jK=t=>(RR.wrap(t,"datadog",UK),t);function UK(t){return e=>t(kR(e))}var HK=t=>e=>(RR.wrap(e,t,BK),e);function BK(t){return kR(t)}var $K=process.env.LAMBDA_TASK_ROOT,AR=process.env.DD_LAMBDA_HANDLER;if(AR!==void 0){let[t,e]=MK(AR),[r,s]=DK(e),n=NK.resolve($K,t,r),i=LK(n);IR({name:i},HK(s))}else IR({name:"datadog-lambda-js"},jK)});var Nh=p((Tne,jR)=>{"use strict";var Dh=require("fs"),NR=require("path"),CR=E(),OR=Cl(),PR=gi(),{filename:GK,pathSepExpr:FK}=Ch();function DR(t){let e=NR.basename(t);return[t.substring(0,t.indexOf(e)),e]}function MR(t){let e=/^([^.]*)\.(.*)$/,r=t.match(e);if(!(!r||r.length!==3))return[r[1],r[2]]}function LR(t){let e=t;return Dh.existsSync(t+".js")?e+=".js":Dh.existsSync(t+".mjs")?e+=".mjs":Dh.existsSync(t+".cjs")&&(e+=".cjs"),e}var zK=()=>{let t=process.env.LAMBDA_TASK_ROOT,e=process.env.DD_LAMBDA_HANDLER;if(e!==void 0){let[r,s]=DR(e),[n]=MR(s),i=NR.resolve(t,r,n),o=LR(i);OR([o],a=>{Ph();for(let{hook:c}of PR[o])try{a=c(a)}catch(u){CR.error(u)}return a})}else{let r="datadog-lambda-js";OR([r],(s,n,i)=>{n=n.replace(FK,"/"),Ph();for(let{name:o,file:a,hook:c}of PR[r]){let u=GK(o,a);if(n===u)try{s=c(s)}catch(l){CR.error(l)}}return s})}};jR.exports={_extractModuleRootAndHandler:DR,_extractModuleNameAndHandlerPath:MR,_getLambdaFilePath:LR,registerLambdaHook:zK}});var UR=p(()=>{"use strict";var{registerLambdaHook:WK}=Nh();WK()});var GR=p((Ane,$R)=>{"use strict";var{channel:VK}=H(),{isFalse:KK}=te(),BR=LT(),YK=E(),Mh=VK("dd-trace:instrumentation:load");bR();process.env.AWS_LAMBDA_FUNCTION_NAME!==void 0&&UR();var{DD_TRACE_DISABLED_PLUGINS:HR}=process.env,JK=new Set(HR&&HR.split(",").map(t=>t.trim())),Ws={};Mh.subscribe(({name:t})=>{let e=BR[t];if(!(!e||typeof e!="function")&&!Ws[e.id]){let r=`DD_TRACE_${e.id.toUpperCase()}_ENABLED`,s=process.env[r.replace(/[^a-z0-9_]/ig,"_")];KK(s)||JK.has(e.id)?(YK.debug(`Plugin "${e.id}" was disabled via configuration option.`),Ws[e.id]=null):Ws[e.id]=e}});$R.exports=class{constructor(e){this._tracer=e,this._tracerConfig=null,this._pluginsByName={},this._configsByName={},this._loadedSubscriber=({name:r})=>{let s=BR[r];!s||typeof s!="function"||this.loadPlugin(s.id)},Mh.subscribe(this._loadedSubscriber)}loadPlugin(e){let r=Ws[e];if(!r||(this._pluginsByName[e]||(this._pluginsByName[e]=new r(this._tracer)),!this._tracerConfig))return;let s=this._configsByName[e]||{enabled:this._tracerConfig.plugins!==!1};this._pluginsByName[e].configure({...this._getSharedConfig(e),...s})}configurePlugin(e,r){let s=this._isEnabled(r);this._configsByName[e]={...r,enabled:s},this.loadPlugin(e)}configure(e={}){this._tracerConfig=e;for(let r in Ws)this.loadPlugin(r)}destroy(){for(let e in this._pluginsByName)this._pluginsByName[e].configure({enabled:!1});Mh.unsubscribe(this._loadedSubscriber)}_isEnabled(e){return typeof e=="boolean"?e:e?e.enabled!==!1:!0}_getSharedConfig(e){let{logInjection:r,serviceMapping:s,queryStringObfuscation:n,site:i,url:o,dbmPropagationMode:a}=this._tracerConfig,c={};return r!==void 0&&(c.logInjection=r),n!==void 0&&(c.queryStringObfuscation=n),c.dbmPropagationMode=a,s&&s[e]&&(c.service=s[e]),c.site=i,c.url=o,c}}});var zR=p((kne,FR)=>{"use strict";var Lh=class{constructor(e,r){this._timer=null,this._callback=e,this._interval=r}start(){this._timer||this.runAfterDelay(0)}runAfterDelay(e=this._interval){this._timer=setTimeout(this._callback,e,()=>this.runAfterDelay()),this._timer.unref&&this._timer.unref()}stop(){clearTimeout(this._timer),this._timer=null}};FR.exports=Lh});var YR=p((Rne,KR)=>{"use strict";var XK=require("crypto-randomuuid"),{EventEmitter:QK}=require("events"),ZK=zR(),eY=Ie().version,tY=X(),WR=E(),rY=XK(),sY=Buffer.alloc(1).toString("base64"),jh=class extends QK{constructor(e){super();let r=e.remoteConfig.pollInterval*1e3;this.scheduler=new ZK(s=>this.poll(s),r),this.requestOptions={url:e.url,hostname:e.hostname,port:e.port,method:"POST",path:"/v0.7/config"},this.state={client:{state:{root_version:1,targets_version:0,config_states:[],has_error:!1,error:"",backend_client_state:""},id:rY,products:[],is_tracer:!0,client_tracer:{runtime_id:e.tags["runtime-id"],language:"node",tracer_version:eY,service:e.service,env:e.env,app_version:e.version},capabilities:sY},cached_target_files:[]},this.appliedConfigs=new Map}updateCapabilities(e,r){let s=Buffer.from(this.state.client.capabilities,"base64").toString("hex"),n=BigInt(`0x${s}`);r?n|=e:n&=~e;let i=n.toString(16);i.length%2&&(i=`0${i}`),this.state.client.capabilities=Buffer.from(i,"hex").toString("base64")}on(e,r){return super.on(e,r),this.state.client.products=this.eventNames(),this.scheduler.start(),this}off(e,r){return super.off(e,r),this.state.client.products=this.eventNames(),this.state.client.products.length||this.scheduler.stop(),this}poll(e){tY(JSON.stringify(this.state),this.requestOptions,(r,s,n)=>{if(n===404)return e();if(r)return WR.error(r),e();if(this.state.client.state.has_error&&(this.state.client.state.has_error=!1,this.state.client.state.error=""),s&&s!=="{}")try{this.parseConfig(JSON.parse(s))}catch(i){WR.error(`Could not parse remote config response: ${i}`),this.state.client.state.has_error=!0,this.state.client.state.error=i.toString()}e()})}parseConfig({client_configs:e=[],targets:r,target_files:s=[]}){let n=[],i=[],o=[];for(let a of this.appliedConfigs.values())e.includes(a.path)||n.push(a);if(r=VR(r),r){for(let a of e){let c=r.signed.targets[a];if(!c)throw new Error(`Unable to find target for path ${a}`);let u=this.appliedConfigs.get(a),l={};if(u){if(u.hashes.sha256===c.hashes.sha256)continue;o.push(l)}else i.push(l);let d=s.find(g=>g.path===a);if(!d)throw new Error(`Unable to find file for path ${a}`);let{product:h,id:f}=iY(a);Object.assign(l,{path:a,product:h,id:f,version:c.custom.v,apply_state:1,apply_error:"",length:c.length,hashes:c.hashes,file:VR(d.raw)})}this.state.client.state.targets_version=r.signed.version,this.state.client.state.backend_client_state=r.signed.custom.opaque_backend_state}if(n.length||i.length||o.length){this.dispatch(n,"unapply"),this.dispatch(i,"apply"),this.dispatch(o,"modify"),this.state.client.state.config_states=[],this.state.cached_target_files=[];for(let a of this.appliedConfigs.values())this.state.client.state.config_states.push({id:a.id,version:a.version,product:a.product,apply_state:a.apply_state,apply_error:a.apply_error}),this.state.cached_target_files.push({path:a.path,length:a.length,hashes:Object.entries(a.hashes).map(c=>({algorithm:c[0],hash:c[1]}))})}}dispatch(e,r){for(let s of e){try{this.emit(s.product,r,s.file,s.id),s.apply_state=2}catch(n){s.apply_state=3,s.apply_error=n.toString()}r==="unapply"?this.appliedConfigs.delete(s.path):this.appliedConfigs.set(s.path,s)}}};function VR(t){return t?JSON.parse(Buffer.from(t,"base64").toString()):null}var nY=/^(?:datadog\/\d+|employee)\/([^/]+)\/([^/]+)\/[^/]+$/;function iY(t){let e=nY.exec(t);if(!e||!e[1]||!e[2])throw new Error(`Unable to parse path ${t}`);return{product:e[1],id:e[2]}}KR.exports=jh});var XR=p((Cne,JR)=>{"use strict";JR.exports={ASM_ACTIVATION:1n<<1n,ASM_IP_BLOCKING:1n<<2n,ASM_DD_RULES:1n<<3n,ASM_USER_BLOCKING:1n<<7n}});var Vs=p((One,QR)=>{"use strict";QR.exports={HTTP_INCOMING_BODY:"server.request.body",HTTP_INCOMING_QUERY:"server.request.query",HTTP_INCOMING_HEADERS:"server.request.headers.no_cookies",HTTP_INCOMING_URL:"server.request.uri.raw",HTTP_INCOMING_METHOD:"server.request.method",HTTP_INCOMING_ENDPOINT:"server.request.framework_endpoint",HTTP_INCOMING_PARAMS:"server.request.path_params",HTTP_INCOMING_COOKIES:"server.request.cookies",HTTP_INCOMING_RESPONSE_CODE:"server.response.status",HTTP_INCOMING_RESPONSE_HEADERS:"server.response.headers.no_cookies",HTTP_INCOMING_REMOTE_IP:"server.request.client_ip",HTTP_INCOMING_REMOTE_PORT:"server.request.client_port",HTTP_CLIENT_IP:"http.client_ip",USER_ID:"usr.id"}});var Uh=p((Pne,ZR)=>{"use strict";var{AsyncLocalStorage:oY}=require("async_hooks");ZR.exports=new oY});var tC=p((Nne,eC)=>{"use strict";var aY=Uh(),cY=E(),Hh=!1;function uY(t,e){let r=[];if(Hh||!t.size)return r;Hh=!0;let s=aY.getStore(),n=new Set;for(let i of t){if(n.has(i.callback))continue;n.add(i.callback);let o;try{o=i.callback.method(e,s)}catch(a){cY.warn(`Error running subscription ${a}`)}r.push(o)}return Hh=!1,r}eC.exports={runSubscriptions:uY}});var sC=p((Dne,rC)=>{"use strict";var pY=tC(),lY=1024,Bh=class{constructor(){this.addressToSubscriptions=new Map,this.addresses=new Set,this.subscriptions=new Set}clear(){this.addressToSubscriptions=new Map,this.addresses=new Set,this.subscriptions=new Set}addSubscription(e){if(!(!e.addresses.length||this.subscriptions.has(e))){for(let r=0;r<e.addresses.length;++r){let s=e.addresses[r];this.addresses.add(s);let n=this.addressToSubscriptions.get(s);n===void 0?this.addressToSubscriptions.set(s,[e]):n.push(e)}this.subscriptions.add(e)}}matchSubscriptions(e,r){let s=new Set,n=new Set,i=new Set;return e.forEach(o=>{let a=this.addressToSubscriptions.get(o);if(a!==void 0)for(let c=0;c<a.length;++c){let u=a[c];if(i.has(u)===!0)continue;if(i.add(u),u.addresses.every(r.has,r)===!0){for(let d=0;d<u.addresses.length;++d)s.add(u.addresses[d]);n.add(u)}}}),{addresses:s,subscriptions:n}}dispatch(e,r,s){let n=this.matchSubscriptions(e,r),i={};return n.addresses.forEach(o=>{i[o]=s.resolve(o)}),pY.runSubscriptions(n.subscriptions,i)}},Ks=class{static setManager(e){this.manager=e}constructor(){this.store=new Map,this.allAddresses=new Set,this.newAddresses=new Set}clear(){this.store=new Map,this.allAddresses=new Set,this.newAddresses=new Set}setValue(e,r){return this.allAddresses.size>=lY?this:typeof r!="object"&&this.store.get(e)===r?this:(this.store.set(e,r),this.allAddresses.add(e),this.newAddresses.add(e),this)}dispatch(){if(this.newAddresses.size===0)return[];let e=Ks.manager.dispatch(this.newAddresses,this.allAddresses,this);return this.newAddresses.clear(),e}resolve(e){return this.store.get(e)}};rC.exports={SubscriptionManager:Bh,Context:Ks}});var Ys=p((Mne,cC)=>{"use strict";var{SubscriptionManager:dY,Context:nC}=sC(),iC=Uh(),$h=new dY;nC.setManager($h);function hY(){let t=new Map;return t.set("context",new nC),iC.enterWith(t),t}function oC(){let t=iC.getStore();return t&&t.get("context")}function aC(t){return $h.addresses.has(t)}function fY(t,e=oC()){if(!e)return;let r=Object.keys(t);for(let s=0;s<r.length;++s){let n=r[s];aC(n)&&e.setValue(n,t[n])}return e.dispatch()}cC.exports={manager:$h,startContext:hY,getContext:oC,needsAddress:aC,propagate:fY}});var zh=p((Lne,fC)=>{"use strict";var no=Vs(),uC=qn(),Gh=K(),pC=new uC(100),gY=["accept","accept-encoding","accept-language","content-encoding","content-language","content-length","content-type","forwarded","forwarded-for","host","true-client-ip","user-agent","via","x-client-ip","x-cluster-client-ip","x-forwarded","x-forwarded-for","x-real-ip"],mY=["content-encoding","content-language","content-length","content-type"],so=new Map;function lC(t){if(!t)return{};let e=t.resolve(no.HTTP_INCOMING_HEADERS);return{remote_ip:t.resolve(no.HTTP_INCOMING_REMOTE_IP),headers:Fh(e,gY,"http.request.headers.")}}function dC(t){if(!t)return{};let e=t.resolve(no.HTTP_INCOMING_RESPONSE_HEADERS);return{endpoint:t.resolve(no.HTTP_INCOMING_ENDPOINT),headers:Fh(e,mY,"http.response.headers.")}}function Fh(t,e,r){let s={};if(!t)return s;for(let n=0;n<e.length;++n){let i=e[n];t[i]&&(s[`${r}${hC(i)}`]=t[i]+"")}return s}function hC(t){return t.trim().slice(0,200).replace(/[^a-zA-Z0-9_\-:/]/g,"_").toLowerCase()}function _Y(t,e){let r=e&&e.get("req"),s=Gh.root(r);if(!s)return!1;t.duration&&s.setTag("_dd.appsec.waf.duration",t.duration),t.durationExt&&s.setTag("_dd.appsec.waf.duration_ext",t.durationExt),t.rulesVersion&&s.setTag("_dd.appsec.event_rules.version",t.rulesVersion)}function bY(t,e){let r=e&&e.get("req"),s=Gh.root(r);if(!s)return!1;let n=s.context()._tags,i={"appsec.event":"true"};pC.isAllowed()&&(i["manual.keep"]="true"),n["_dd.origin"]||(i["_dd.origin"]="appsec");let o=n["_dd.appsec.json"];o?i["_dd.appsec.json"]=o.slice(0,-2)+","+t.slice(1,-1)+o.slice(-2):i["_dd.appsec.json"]='{"triggers":'+t+"}";let a=e.get("context");if(a){let c=lC(a);Object.assign(i,c.headers);let u=c.headers["http.request.headers.user-agent"];u&&(i["http.useragent"]=u),i["network.client.ip"]=c.remote_ip}s.addTags(i)}function yY(t,e){let r=Gh.root(t);if(!r||(so.size&&(r.addTags(Object.fromEntries(so)),so.clear()),!e||!r.context()._tags["appsec.event"]))return!1;let s=dC(e),n=s.headers;s.endpoint&&(n["http.endpoint"]=s.endpoint),r.addTags(n)}function vY(t){pC=new uC(t)}fC.exports={metricsQueue:so,resolveHTTPRequest:lC,resolveHTTPResponse:dC,filterHeaders:Fh,formatHeaderName:hC,reportMetrics:_Y,reportAttack:bY,finishRequest:yY,setRateLimit:vY}});var mC=p((jne,gC)=>{"use strict";var Wh=E(),io=Vs(),SY=Ys(),Wt=zh(),qY=new Set(Object.values(io)),Js=class{static loadDDWAF(e,r){try{let{DDWAF:s}=require("@datadog/native-appsec");return new s(e,r)}catch(s){throw Wh.error("AppSec could not load native package. In-app WAF features will not be available."),s}}constructor(e,r){let{wafTimeout:s,obfuscatorKeyRegex:n,obfuscatorValueRegex:i}=r;this.ddwaf=Js.loadDDWAF(e,{obfuscatorKeyRegex:n,obfuscatorValueRegex:i}),this.wafTimeout=s,Wt.metricsQueue.set("_dd.appsec.waf.version",this.ddwaf.constructor.version());let{loaded:o,failed:a,errors:c}=this.ddwaf.rulesInfo;Wt.metricsQueue.set("_dd.appsec.event_rules.loaded",o),Wt.metricsQueue.set("_dd.appsec.event_rules.error_count",a),a&&Wt.metricsQueue.set("_dd.appsec.event_rules.errors",JSON.stringify(c)),Wt.metricsQueue.set("manual.keep","true"),this.wafContextCache=new WeakMap;let u=this,d={method:(f,g)=>u.action(f,g)},h=new Set;for(let f of e.rules)for(let g of f.conditions)for(let v of g.parameters.inputs){let q=v.address.split(":",2)[0];!qY.has(q)||h.has(q)||(h.add(q),SY.manager.addSubscription({addresses:[q],callback:d}))}}action(e,r){let s;if(r){let n=r.get("context");n&&(this.wafContextCache.has(n)?s=this.wafContextCache.get(n):(s=this.ddwaf.createContext(),this.wafContextCache.set(n,s)))}(!s||s.disposed)&&(s=this.ddwaf.createContext()),e[io.HTTP_INCOMING_RESPONSE_CODE]&&(e[io.HTTP_INCOMING_RESPONSE_CODE]=e[io.HTTP_INCOMING_RESPONSE_CODE]+"");try{let n=process.hrtime.bigint(),i=s.run(e,this.wafTimeout);return i.durationExt=parseInt(process.hrtime.bigint()-n),this.applyResult(i,r)}catch(n){Wh.error("Error while running the AppSec WAF"),Wh.error(n)}finally{s.dispose()}}applyResult(e,r){return Wt.reportMetrics({duration:e.totalRuntime/1e3,durationExt:e.durationExt/1e3,rulesVersion:this.ddwaf.rulesInfo.version},r),e.data&&e.data!=="[]"&&Wt.reportAttack(e.data,r),e.actions}updateRuleData(e){this.ddwaf.updateRuleData(e)}clear(){this.ddwaf.dispose(),this.wafContextCache=new WeakMap}};gC.exports=Js});var bC=p((Une,_C)=>{"use strict";_C.exports={get DDWAF(){return mC()}}});var Vh=p((Hne,yC)=>{"use strict";var EY=bC(),TY=Ys(),Xs=new Map,oo=new Map;function wY(t,e){if(Xs.has(t))return;let r=new EY.DDWAF(t,e);Xs.set(t,r)}function xY(t,e,r){t==="unapply"?oo.delete(r):oo.set(r,e);let s=IY(oo.values());for(let n of Xs.values())n.updateRuleData(s)}function IY(t){let e=new Map;for(let r of t)if(r.rules_data)for(let s of r.rules_data){let n=`${s.id}+${s.type}`;if(e.has(n)){let i=e.get(n);s.data.reduce(AY,i.data)}else e.set(n,kY(s))}return[...e.values()]}function AY(t,e){let r=t.find(s=>s.value===e.value);return r&&!("expiration"in r)||(r&&"expiration"in e&&e.expiration>r.expiration?r.expiration=e.expiration:r&&!("expiration"in e)?delete r.expiration:r||t.push({...e})),t}function kY(t){let e={...t};if(e.data){let r=[];e.data.forEach(s=>{r.push({...s})}),e.data=r}return e}function RY(){TY.manager.clear();for(let[t,e]of Xs)e.clear(),Xs.delete(t);oo.clear()}yC.exports={applyRules:wY,clearAllRules:RY,updateAsmData:xY}});var SC=p((Bne,vC)=>{"use strict";var CY=`<!-- Sorry, you've been blocked -->
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>You've been blocked</title>
    <style>
        a,
        body,
        div,
        html,
        span {
            margin: 0;
            padding: 0;
            border: 0;
            font-size: 100%;
            font: inherit;
            vertical-align: baseline
        }

        body {
            background: -webkit-radial-gradient(26% 19%, circle, #fff, #f4f7f9);
            background: radial-gradient(circle at 26% 19%, #fff, #f4f7f9);
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            -ms-flex-line-pack: center;
            align-content: center;
            width: 100%;
            min-height: 100vh;
            line-height: 1;
            flex-direction: column
        }

        p {
            display: block
        }


        main {
            text-align: center;
            flex: 1;
            display: -webkit-box;
            display: -ms-flexbox;
            display: flex;
            -webkit-box-pack: center;
            -ms-flex-pack: center;
            justify-content: center;
            -webkit-box-align: center;
            -ms-flex-align: center;
            align-items: center;
            -ms-flex-line-pack: center;
            align-content: center;
            flex-direction: column
        }

        p {
            font-size: 18px;
            line-height: normal;
            color: #646464;
            font-family: sans-serif;
            font-weight: 400
        }

        a {
            color: #4842b7
        }

        footer {
            width: 100%;
            text-align: center
        }

        footer p {
            font-size: 16px
        }
    </style>
</head>

<body>
    <main>
        <p>Sorry, you cannot access this page. Please contact the customer service team.</p>
    </main>
    <footer>
        <p>Security provided by <a
                href="https://www.datadoghq.com/product/security-platform/application-security-monitoring/"
                target="_blank">Datadog</a></p>
    </footer>
</body>

</html>
`,OY=`{
  "errors": [
    {
      "title": "You've been blocked",
      "detail": "Sorry, you cannot access this page. Please contact the customer service team. Security provided by Datadog."
    }
  ]
}`;vC.exports={html:CY,json:OY}});var ao=p(($ne,wC)=>{"use strict";var PY=E(),qC=SC(),EC=qC.html,TC=qC.json;function NY(t,e,r,s){if(e.headersSent){PY.warn("Cannot send blocking response when headers have already been sent");return}let n,i,o=t.headers.accept&&t.headers.accept.split(",").map(a=>a.split(";",1)[0].trim());o&&o.includes("text/html")&&!o.includes("application/json")?(n="text/html",i=EC):(n="application/json",i=TC),r.addTags({"appsec.blocked":"true"}),e.statusCode=403,e.setHeader("Content-Type",n),e.setHeader("Content-Length",Buffer.byteLength(i)),e.end(i),s&&s.abort()}function DY(t){t.appsec.blockedTemplateHtml&&(EC=t.appsec.blockedTemplateHtml),t.appsec.blockedTemplateJson&&(TC=t.appsec.blockedTemplateJson)}wC.exports={block:NY,setTemplates:DY}});var co=p((Gne,AC)=>{"use strict";var xC=E(),Jh=Vh(),Xh=rf(),{incomingHttpRequestStart:Kh,incomingHttpRequestEnd:Yh}=ui(),qt=Ys(),L=Vs(),IC=zh(),MY=K(),{extractIp:LY}=Fu(),{HTTP_CLIENT_IP:jY}=B(),{block:UY,setTemplates:HY}=ao(),Qh=!1,Zh;function BY(t){if(!Qh)try{HY(t),$Y(t,t.appsec.rules)}catch(e){GY(e)}}function $Y(t,e){Jh.applyRules(e,t.appsec),Xh.enableAsmData(t.appsec),IC.setRateLimit(t.appsec.rateLimit),Kh.subscribe(ef),Yh.subscribe(tf),qt.manager.addresses.add(L.HTTP_INCOMING_HEADERS),qt.manager.addresses.add(L.HTTP_INCOMING_ENDPOINT),qt.manager.addresses.add(L.HTTP_INCOMING_RESPONSE_HEADERS),qt.manager.addresses.add(L.HTTP_INCOMING_REMOTE_IP),Qh=!0,Zh=t}function GY(t){xC.error("Unable to start AppSec"),xC.error(t),Jh.clearAllRules(),Xh.disableAsmData()}function ef({req:t,res:e,abortController:r}){let s=MY.root(t);if(!s)return;let n=LY(Zh,t);s.addTags({"_dd.appsec.enabled":1,"_dd.runtime_family":"nodejs",[jY]:n});let i=qt.startContext();i.set("req",t),i.set("res",e);let o=i.get("context");if(n){let a=qt.propagate({[L.HTTP_CLIENT_IP]:n},o);if(!a||!r)return;for(let c of a)if(c&&c.includes("block")){UY(t,e,s,r);break}}}function tf(t){let e=qt.getContext();if(!e)return;let r=Object.assign({},t.req.headers);delete r.cookie;let s=Object.assign({},t.res.getHeaders());delete s["set-cookie"];let n={[L.HTTP_INCOMING_URL]:t.req.url,[L.HTTP_INCOMING_HEADERS]:r,[L.HTTP_INCOMING_METHOD]:t.req.method,[L.HTTP_INCOMING_REMOTE_IP]:t.req.socket.remoteAddress,[L.HTTP_INCOMING_REMOTE_PORT]:t.req.socket.remotePort,[L.HTTP_INCOMING_RESPONSE_CODE]:t.res.statusCode,[L.HTTP_INCOMING_RESPONSE_HEADERS]:s};if(t.req.body!==void 0&&t.req.body!==null&&(n[L.HTTP_INCOMING_BODY]=t.req.body),t.req.query&&typeof t.req.query=="object"&&(n[L.HTTP_INCOMING_QUERY]=t.req.query),t.req.route&&typeof t.req.route.path=="string"&&(n[L.HTTP_INCOMING_ENDPOINT]=t.req.route.path),t.req.params&&typeof t.req.params=="object"&&(n[L.HTTP_INCOMING_PARAMS]=t.req.params),t.req.cookies&&typeof t.req.cookies=="object"){n[L.HTTP_INCOMING_COOKIES]={};for(let i of Object.keys(t.req.cookies))n[L.HTTP_INCOMING_COOKIES][i]=[t.req.cookies[i]]}qt.propagate(n,e),IC.finishRequest(t.req,e)}function FY(){Qh=!1,Zh=null,Jh.clearAllRules(),Xh.disableAsmData(),Kh.hasSubscribers&&Kh.unsubscribe(ef),Yh.hasSubscribers&&Yh.unsubscribe(tf)}AC.exports={enable:BY,disable:FY,incomingHttpStartTranslator:ef,incomingHttpEndTranslator:tf}});var rf=p((Fne,RC)=>{"use strict";var zY=YR(),Qs=XR(),WY=Vh(),xe;function VY(t){xe=new zY(t),t.appsec.enabled===void 0&&(xe.updateCapabilities(Qs.ASM_ACTIVATION,!0),xe.on("ASM_FEATURES",(e,r)=>{if(r&&r.asm&&typeof r.asm.enabled=="boolean"){let s;e==="apply"||e==="modify"?s=r.asm.enabled:s=t.appsec.enabled,s?co().enable(t):co().disable()}}))}function KY(t){xe&&t&&!t.customRulesProvided&&(xe.updateCapabilities(Qs.ASM_IP_BLOCKING,!0),xe.updateCapabilities(Qs.ASM_USER_BLOCKING,!0),xe.on("ASM_DATA",kC))}function YY(){xe&&(xe.updateCapabilities(Qs.ASM_IP_BLOCKING,!1),xe.updateCapabilities(Qs.ASM_USER_BLOCKING,!1),xe.off("ASM_DATA",kC))}function kC(t,e,r){WY.updateAsmData(t,e,r)}RC.exports={enable:VY,enableAsmData:KY,disableAsmData:YY}});var uo=p((zne,CC)=>{"use strict";function JY(t){let e=t.scope().active();return e&&e.context()._trace.started[0]}CC.exports={getRootSpan:JY}});var po=p((Wne,NC)=>{"use strict";var{getRootSpan:XY}=uo(),OC=E();function PC(t,e){for(let r of Object.keys(t))e.setTag(`usr.${r}`,""+t[r])}function QY(t,e){if(!e||!e.id){OC.warn("Invalid user provided to setUser");return}let r=XY(t);if(!r){OC.warn("Root span not available in setUser");return}PC(e,r)}NC.exports={setUserTags:PC,setUser:QY}});var LC=p((Vne,MC)=>{"use strict";var Zs=E(),{getRootSpan:DC}=uo(),{MANUAL_KEEP:ZY}=B(),{setUserTags:e8}=po();function t8(t,e,r){if(!e||!e.id){Zs.warn("Invalid user provided to trackUserLoginSuccessEvent");return}let s=DC(t);if(!s){Zs.warn("Root span not available in trackUserLoginSuccessEvent");return}e8(e,s),sf(t,"users.login.success",r,"trackUserLoginSuccessEvent",s)}function r8(t,e,r,s){if(!e||typeof e!="string"){Zs.warn("Invalid userId provided to trackUserLoginFailureEvent");return}let n={"usr.id":e,"usr.exists":r?"true":"false",...s};sf(t,"users.login.failure",n,"trackUserLoginFailureEvent")}function s8(t,e,r){if(!e||typeof e!="string"){Zs.warn("Invalid eventName provided to trackCustomEvent");return}sf(t,e,r,"trackCustomEvent")}function sf(t,e,r,s,n=DC(t)){if(!n){Zs.warn(`Root span not available in ${s}`);return}let i={[`appsec.events.${e}.track`]:"true",[ZY]:"true"};if(r)for(let o of Object.keys(r))i[`appsec.events.${e}.${o}`]=""+r[o];n.addTags(i)}MC.exports={trackUserLoginSuccessEvent:t8,trackUserLoginFailureEvent:r8,trackCustomEvent:s8}});var HC=p((Kne,UC)=>{"use strict";var{USER_ID:n8}=Vs(),i8=Ys(),{getRootSpan:jC}=uo(),{block:o8}=ao(),{storage:a8}=I(),{setUserTags:c8}=po(),lo=E();function u8(t){let e=i8.propagate({[n8]:t.id});if(!e)return!1;for(let r of e)if(r&&r.includes("block"))return!0;return!1}function p8(t,e){if(!e||!e.id)return lo.warn("Invalid user provided to isUserBlocked"),!1;let r=jC(t);return r?r.context()._tags["usr.id"]||c8(e,r):lo.warn("Root span not available in isUserBlocked"),u8(e)}function l8(t,e,r){if(!e||!r){let n=a8.getStore();n&&(e=e||n.req,r=r||n.res)}if(!e||!r)return lo.warn("Requests or response object not available in blockRequest"),!1;let s=jC(t);return s?(o8(e,r,s),!0):(lo.warn("Root span not available in blockRequest"),!1)}UC.exports={checkUserAndSetUser:p8,blockRequest:l8}});var $C=p((Yne,BC)=>{"use strict";var{trackUserLoginSuccessEvent:d8,trackUserLoginFailureEvent:h8,trackCustomEvent:f8}=LC(),{checkUserAndSetUser:g8,blockRequest:m8}=HC(),{setTemplates:_8}=ao(),{setUser:b8}=po(),nf=class{constructor(e,r){this._tracer=e,r&&_8(r)}trackUserLoginSuccessEvent(e,r){return d8(this._tracer,e,r)}trackUserLoginFailureEvent(e,r,s){return h8(this._tracer,e,r,s)}trackCustomEvent(e,r){return f8(this._tracer,e,r)}isUserBlocked(e){return g8(this._tracer,e)}blockRequest(e,r){return m8(this._tracer,e,r)}setUser(e){return b8(this._tracer,e)}};BC.exports=nf});var cf=p((Jne,WC)=>{"use strict";var y8=require("retry"),{request:v8}=require("http"),S8=ra(),q8=Dn(),{storage:of}=I(),GC=Ie().version,FC=S8.id();function E8(t,e,r){let s=of.getStore();of.enterWith({noop:!0});let n=v8(t,i=>{if(i.statusCode>=400){let o=new Error(`HTTP Error ${i.statusCode}`);o.status=i.statusCode,r(o)}else r(null,i)});n.on("error",r),e&&e.pipe(n),of.enterWith(s)}function T8(t,e){let r=[];t.on("error",e),t.on("data",s=>r.push(s)),t.on("end",()=>{e(null,Buffer.concat(r))})}function zC(t){let e=0;for(;e<2||t>1e3;)e++,t/=2;return[e,Math.floor(t)]}var af=class{constructor({url:e,logger:r,uploadTimeout:s}={}){this._url=e,this._logger=r;let[n,i]=zC(s);this._backoffTime=i,this._backoffTries=n}export({profiles:e,start:r,end:s,tags:n}){let i=Object.keys(e),o=[["recording-start",r.toISOString()],["recording-end",s.toISOString()],["language","javascript"],["runtime","nodejs"],["runtime_version",process.version],["profiler_version",GC],["format","pprof"],["tags[]","language:javascript"],["tags[]","runtime:nodejs"],["tags[]",`runtime_version:${process.version}`],["tags[]",`profiler_version:${GC}`],["tags[]","format:pprof"],...Object.entries(n).map(([a,c])=>["tags[]",`${a}:${c}`])];this._logger.debug(()=>`Building agent export report: ${`
`+o.map(([c,u])=>`  ${c}: ${u}`).join(`
`)}`);for(let a=0;a<i.length;a++){let c=i[a],u=e[c];this._logger.debug(()=>{let l=u.toString("hex").match(/../g).join(" ");return`Adding ${c} profile to agent export: `+l}),o.push([`types[${a}]`,c]),o.push([`data[${a}]`,u,{filename:`${c}.pb.gz`,contentType:"application/octet-stream",knownLength:u.length}])}return new Promise((a,c)=>{let u=y8.operation({randomize:!0,minTimeout:this._backoffTime,retries:this._backoffTries,unref:!0});u.attempt(l=>{let d=new q8;for(let[f,g,v]of o)d.append(f,g,v);let h={method:"POST",path:"/profiling/v1/input",headers:d.getHeaders(),timeout:this._backoffTime*Math.pow(2,l)};FC&&(h.headers["Datadog-Container-ID"]=FC),this._url.protocol==="unix:"?h.socketPath=this._url.pathname:(h.protocol=this._url.protocol,h.hostname=this._url.hostname,h.port=this._url.port),this._logger.debug(()=>`Submitting profiler agent report attempt #${l} to: ${JSON.stringify(h)}`),E8(h,d,(f,g)=>{if(u.retry(f)){this._logger.error(`Error from the agent: ${f.message}`);return}else if(f){c(new Error("Profiler agent export back-off period expired"));return}T8(g,(v,q)=>{v?this._logger.error(`Error reading agent response: ${v.message}`):this._logger.debug(()=>`Agent export response: ${(q.toString("hex").match(/../g)||[]).join(" ")}`)}),a()})})})}};WC.exports={AgentExporter:af,computeRetries:zC}});var pf=p((Xne,VC)=>{"use strict";var w8=require("fs"),{promisify:x8}=require("util"),I8=x8(w8.writeFile);function A8(t){let e=r=>String(r).padStart(2,"0");return`${t.getUTCFullYear()}${e(t.getUTCMonth()+1)}${e(t.getUTCDate())}T${e(t.getUTCHours())}${e(t.getUTCMinutes())}${e(t.getUTCSeconds())}Z`}var uf=class{constructor({pprofPrefix:e}={}){this._pprofPrefix=e||""}export({profiles:e,end:r}){let s=Object.keys(e),n=A8(r),i=s.map(o=>I8(`${this._pprofPrefix}${o}_${n}.pprof`,e[o]));return Promise.all(i)}};VC.exports={FileExporter:uf}});var hf=p((Qne,KC)=>{"use strict";var lf={error:3,warn:4,info:6,debug:7},df=class{constructor(e={}){this._level=lf[e.level]||lf.error}debug(e){this._log("debug",e)}info(e){this._log("info",e)}warn(e){this._log("warn",e)}error(e){this._log("error",e)}_log(e,r){lf[e]>this._level||console[e](r)}};KC.exports={ConsoleLogger:df}});var gf=p((Zne,QC)=>{"use strict";var{storage:k8}=I(),XC=H(),YC=XC.channel("dd-trace:storage:before"),JC=XC.channel("dd-trace:storage:after");function R8(){let t=k8.getStore();if(t)return t.span}function C8(t){let e=t.context();if(e)return e._trace.started}function O8(t){return t.context()._tags}function P8(t){return t["span.type"]==="web"}function N8(t){return t["resource.name"]||[t["http.method"],t["http.route"]].filter(e=>e).join(" ")}var ff=class{constructor(e={}){this.type="cpu",this._frequency=e.frequency||99,this._mapper=void 0,this._pprof=void 0,this._started=!1,this._cpuProfiler=void 0,this._endpointCollection=e.endpointCollection,this._enter=this._enter.bind(this),this._exit=this._exit.bind(this)}_enter(){if(!this._cpuProfiler)return;let e=R8();if(!e)return;let r=e.context();if(!r)return;let s=C8(e);if(!s||!s.length)return;let n=s[0].context();if(!n)return;let i={"local root span id":n.toSpanId(),"span id":r.toSpanId()};if(this._endpointCollection){let o=s.map(O8).filter(P8)[0];o&&(i["trace endpoint"]=N8(o))}this._cpuProfiler.labels=i}_exit(){this._cpuProfiler&&(this._cpuProfiler.labels={})}start({mapper:e}={}){this._started||(this._started=!0,this._mapper=e,this._pprof||(this._pprof=require("@datadog/pprof"),this._cpuProfiler=new this._pprof.CpuProfiler),this._cpuProfiler.start(this._frequency),this._enter(),YC.subscribe(this._enter),JC.subscribe(this._exit))}profile(){if(this._started)return this._cpuProfiler.profile()}encode(e){return this._pprof.encode(e)}stop(){this._started&&(this._started=!1,this._cpuProfiler.stop(),YC.unsubscribe(this._enter),JC.unsubscribe(this._exit))}};QC.exports=ff});var _f=p((eie,ZC)=>{"use strict";var mf=class{constructor(e={}){this.type="wall",this._samplingInterval=e.samplingInterval||1e6/99,this._mapper=void 0,this._pprof=void 0}start({mapper:e}={}){this._mapper=e,this._pprof=require("@datadog/pprof"),process._startProfilerIdleNotifier||(process._startProfilerIdleNotifier=()=>{}),process._stopProfilerIdleNotifier||(process._stopProfilerIdleNotifier=()=>{}),this._record()}profile(){if(this._stop)return this._stop(!0)}encode(e){return this._pprof.encode(e)}stop(){this._stop&&(this._stop(),this._stop=void 0)}_record(){this._stop=this._pprof.time.start(this._samplingInterval,null,this._mapper,!1)}};ZC.exports=mf});var ho=p((tie,e0)=>{"use strict";var D8=Object.freeze({PERIODIC:"periodic",ON_SHUTDOWN:"on_shutdown",ON_OUT_OF_MEMORY:"on_oom"}),M8=Object.freeze({PROCESS:"process",ASYNC_CALLBACK:"async",INTERRUPT_CALLBACK:"interrupt",LOGS:"logs"});e0.exports={snapshotKinds:D8,oomExportStrategies:M8}});var yf=p((rie,t0)=>{"use strict";var{oomExportStrategies:fo}=ho();function L8(t,e){let r=t.includes(fo.INTERRUPT_CALLBACK)?e.Interrupt:0,s=t.includes(fo.ASYNC_CALLBACK)?e.Async:0;return r|s}var bf=class{constructor(e={}){this.type="space",this._samplingInterval=e.samplingInterval||512*1024,this._stackDepth=e.stackDepth||64,this._pprof=void 0,this._oomMonitoring=e.oomMonitoring||{}}start({mapper:e,nearOOMCallback:r}={}){if(this._mapper=e,this._pprof=require("@datadog/pprof"),this._pprof.heap.start(this._samplingInterval,this._stackDepth),this._oomMonitoring.enabled){let s=this._oomMonitoring.exportStrategies;this._pprof.heap.monitorOutOfMemory(this._oomMonitoring.heapLimitExtensionSize,this._oomMonitoring.maxHeapExtensionCount,s.includes(fo.LOGS),s.includes(fo.PROCESS)?this._oomMonitoring.exportCommand:[],n=>r(this.type,this._pprof.encodeSync(n)),L8(s,this._pprof.heap.CallbackMode))}}profile(){return this._pprof.heap.profile(void 0,this._mapper)}encode(e){return this._pprof.encode(e)}stop(){this._pprof.heap.stop()}};t0.exports=bf});var s0=p((sie,r0)=>{"use strict";var vf={parse(t){if(!t)return{};switch(typeof t){case"object":return Array.isArray(t)?t.reduce((e,r)=>{let s=r.split(":"),n=s.shift().trim(),i=s.join(":").trim();return!n||!i?e:Object.assign(e,{[n]:i})},{}):vf.parse(Object.keys(t).filter(e=>t[e]!==void 0&&t[e]!==null).map(e=>`${e}:${t[e]}`));case"string":return vf.parse(t.split(","));default:return{}}}};r0.exports={tagger:vf}});var u0=p((nie,c0)=>{"use strict";var j=require("koalas"),j8=require("os"),U8=require("path"),{URL:H8,format:B8,pathToFileURL:$8}=require("url"),{AgentExporter:Ef}=cf(),{FileExporter:i0}=pf(),{ConsoleLogger:G8}=hf(),F8=gf(),o0=_f(),a0=yf(),{oomExportStrategies:z8,snapshotKinds:W8}=ho(),{tagger:Sf}=s0(),{isTrue:n0}=te(),qf=class{constructor(e={}){let{DD_PROFILING_ENABLED:r,DD_PROFILING_PROFILERS:s,DD_PROFILING_ENDPOINT_COLLECTION_ENABLED:n,DD_ENV:i,DD_TAGS:o,DD_SERVICE:a,DD_VERSION:c,DD_TRACE_AGENT_URL:u,DD_AGENT_HOST:l,DD_TRACE_AGENT_PORT:d,DD_PROFILING_UPLOAD_TIMEOUT:h,DD_PROFILING_SOURCE_MAP:f,DD_PROFILING_UPLOAD_PERIOD:g,DD_PROFILING_PPROF_PREFIX:v,DD_PROFILING_EXPERIMENTAL_OOM_MONITORING_ENABLED:q,DD_PROFILING_EXPERIMENTAL_OOM_HEAP_LIMIT_EXTENSION_SIZE:_,DD_PROFILING_EXPERIMENTAL_OOM_MAX_HEAP_EXTENSION_COUNT:S,DD_PROFILING_EXPERIMENTAL_OOM_EXPORT_STRATEGIES:T}=process.env,x=n0(j(e.enabled,r,!0)),R=j(e.env,i),ue=e.service||a||"node",z=j8.hostname(),Me=j(e.version,c),Le=process.env.AWS_LAMBDA_FUNCTION_NAME,pe=j(e.interval,Number(g)*1e3,65*1e3),wo=j(e.uploadTimeout,Number(h),60*1e3),Jt=j(e.sourceMap,f,!0),xo=j(e.endpointCollection,n,!1),Io=j(e.pprofPrefix,v);this.enabled=x,this.service=ue,this.env=R,this.host=z,this.functionname=Le,this.version=Me,this.tags=Object.assign(Sf.parse(o),Sf.parse(e.tags),Sf.parse({env:R,host:z,service:ue,version:Me,functionname:Le})),this.logger=Z8(e.logger),this.flushInterval=pe,this.uploadTimeout=wo,this.sourceMap=Jt,this.endpointCollection=xo,this.pprofPrefix=Io;let Ao=j(e.hostname,l)||"localhost",on=j(e.port,d)||8126;this.url=new H8(j(e.url,u,B8({protocol:"http:",hostname:Ao,port:on}))),this.exporters=J8(e.exporters||[new Ef(this)],this);let an=n0(j(e.oomMonitoring,q,!1)),ko=j(e.oomHeapLimitExtensionSize,Number(_),0),Ro=j(e.oomMaxHeapExtensionCount,Number(S),0),Co=K8(j(e.oomExportStrategies,T),this),Oo=an?eJ(this):void 0;this.oomMonitoring={enabled:an,heapLimitExtensionSize:ko,maxHeapExtensionCount:Ro,exportStrategies:Co,exportCommand:Oo};let U=j(e.profilers,s,[new o0(this),new a0(this)]);this.profilers=Q8(U,this)}};c0.exports={Config:qf};function V8(t,e){let r=Object.values(z8).find(s=>s===t);return r===void 0&&e.logger.error(`Unknown oom export strategy "${t}"`),r}function K8(t,e){if(!t)return[];typeof t=="string"&&(t=t.split(","));for(let r=0;r<t.length;r++){let s=t[r];typeof s=="string"&&(t[r]=V8(s,e))}return[...new Set(t)]}function Y8(t,e){switch(t){case"agent":return new Ef(e);case"file":return new i0(e)}}function J8(t,e){typeof t=="string"&&(t=t.split(","));for(let r=0;r<t.length;r++){let s=t[r];typeof s=="string"&&(t[r]=Y8(s,e))}return t}function X8(t,e){switch(t){case"cpu":case"wall":return new o0(e);case"space":return new a0(e);case"cpu-experimental":return new F8(e);default:e.logger.error(`Unknown profiler "${t}"`)}}function Q8(t,e){typeof t=="string"&&(t=t.split(","));for(let r=0;r<t.length;r++){let s=t[r];typeof s=="string"&&(t[r]=X8(s,e))}return t.filter(r=>r)}function Z8(t){return typeof t!="object"||typeof t.debug!="function"||typeof t.info!="function"||typeof t.warn!="function"||typeof t.error!="function"?new G8:t}function eJ(t){let e=[...Object.entries(t.tags),["snapshot",W8.ON_OUT_OF_MEMORY]].map(([s,n])=>`${s}:${n}`).join(","),r=[];for(let s of t.exporters)s instanceof Ef?r.push(t.url.toString()):s instanceof i0&&r.push($8(t.pprofPrefix).toString());return[process.execPath,U8.join(__dirname,"exporter_cli.js"),r.join(","),e,"space"]}});var l0=p((iie,p0)=>{"use strict";var{EventEmitter:tJ}=require("events"),{Config:rJ}=u0(),{snapshotKinds:Tf}=ho();function sJ(t){if(!t)return;let{SourceMapper:e}=require("@datadog/pprof");return e.create([process.cwd()])}var go=class extends tJ{constructor(){super(),this._enabled=!1,this._logger=void 0,this._config=void 0,this._timer=void 0,this._lastStart=void 0,this._timeoutInterval=void 0}start(e){return this._start(e).catch(()=>{}),this}async _start(e){if(this._enabled)return;let r=this._config=new rJ(e);if(!r.enabled)return;this._logger=r.logger,this._enabled=!0,this._setInterval();let s;try{s=await sJ(r.sourceMap)}catch(n){this._logger.error(n)}try{for(let n of r.profilers)n.start({mapper:s,nearOOMCallback:this._nearOOMExport.bind(this)}),this._logger.debug(`Started ${n.type} profiler`);this._capture(this._timeoutInterval)}catch(n){this._logger.error(n),this._stop()}}_nearOOMExport(e,r){let s=this._lastStart,n=new Date;this._submit({[e]:r},s,n,Tf.ON_OUT_OF_MEMORY)}_setInterval(){this._timeoutInterval=this._config.flushInterval}async stop(){this._enabled&&(this._collect(Tf.ON_SHUTDOWN),this._stop())}_stop(){if(this._enabled){this._enabled=!1;for(let e of this._config.profilers)e.stop(),this._logger.debug(`Stopped ${e.type} profiler`);return clearTimeout(this._timer),this._timer=void 0,this}}_capture(e){this._enabled&&(this._lastStart=new Date,!this._timer||e!==this._timeoutInterval?(this._timer=setTimeout(()=>this._collect(Tf.PERIODIC),e),this._timer.unref()):this._timer.refresh())}async _collect(e){if(!this._enabled)return;let r=this._lastStart,s=new Date,n=[],i={};try{for(let o of this._config.profilers){let a=o.profile();a&&n.push({profiler:o,profile:a})}for(let{profiler:o,profile:a}of n)i[o.type]=await o.encode(a),this._logger.debug(()=>{let c=JSON.stringify(a,(u,l)=>typeof l=="bigint"?l.toString():l);return`Collected ${o.type} profile: `+c});this._capture(this._timeoutInterval),await this._submit(i,r,s,e),this._logger.debug("Submitted profiles")}catch(o){this._logger.error(o),this._stop()}}_submit(e,r,s,n){if(!Object.keys(e).length)return Promise.reject(new Error("No profiles to submit"));let{tags:i}=this._config,o=[];i.snapshot=n;for(let a of this._config.exporters){let c=a.export({profiles:e,start:r,end:s,tags:i}).catch(u=>this._logger.error(u));o.push(c)}return Promise.all(o)}},wf=class extends go{constructor(){super(),this._profiledIntervals=0,this._interval=1,this._flushAfterIntervals=void 0}_setInterval(){this._timeoutInterval=this._interval*1e3,this._flushAfterIntervals=this._config.flushInterval/1e3}async _collect(e){this._profiledIntervals>=this._flushAfterIntervals?(this._profiledIntervals=0,await super._collect(e)):(this._profiledIntervals+=1,this._capture(this._timeoutInterval))}};p0.exports={Profiler:go,ServerlessProfiler:wf}});var h0=p((oie,d0)=>{"use strict";var{Profiler:nJ,ServerlessProfiler:iJ}=l0(),oJ=gf(),aJ=_f(),cJ=yf(),{AgentExporter:uJ}=cf(),{FileExporter:pJ}=pf(),{ConsoleLogger:lJ}=hf(),dJ=process.env.AWS_LAMBDA_FUNCTION_NAME?new iJ:new nJ;d0.exports={profiler:dJ,AgentExporter:uJ,FileExporter:pJ,CpuProfiler:oJ,WallProfiler:aJ,SpaceProfiler:cJ,ConsoleLogger:lJ}});var g0=p((aie,f0)=>{"use strict";var mo=E(),{profiler:xf}=h0();process.once("beforeExit",()=>{xf.stop()});f0.exports={start:t=>{let{service:e,version:r,env:s,url:n,hostname:i,port:o,tags:a}=t,{enabled:c,sourceMap:u,exporters:l}=t.profiling,d={debug:h=>mo.debug(h),info:h=>mo.info(h),warn:h=>mo.warn(h),error:h=>mo.error(h)};xf.start({enabled:c,service:e,version:r,env:s,logger:d,sourceMap:u,exporters:l,url:n,hostname:i,port:o,tags:a})},stop:()=>{xf.stop()}}});var Cf=p((cie,y0)=>{var{MANUAL_KEEP:hJ}=B(),fJ=require("lru-cache"),If="vulnerabilities",m0="_dd.iast.json",gJ=1e3,Af=new fJ({max:gJ}),mJ=60*60*1e3,kf,en,Rf=!0;function _J(t,e,r,s){return t&&e?{type:t,evidence:e,location:{spanId:r||0,...s},hash:bJ(t,s)}:null}function bJ(t,e){let r;e?r=`${t}:${e.path}:${e.line}`:r=t;let s=0,n=0,i=r.length;for(let o=0;o<i;o++)s=(s<<5)-s+r.charCodeAt(n++);return s}function yJ(t,e){e&&e.evidence&&e.type&&e.location&&(t&&t.rootSpan?(t[If]=t[If]||[],t[If].push(e)):_0([e]))}function vJ(t){return t&&t.type&&t.evidence&&t.evidence.value&&t.location&&t.location.spanId}function SJ(t,e){if(!t.ranges)return{value:t.value};let r=[],s=0;return t.ranges.forEach((n,i)=>{s<n.start&&r.push({value:t.value.substring(s,n.start)}),r.push({value:t.value.substring(n.start,n.end),source:e[i]}),s=n.end}),s<t.value.length&&r.push({value:t.value.substring(s)}),{valueParts:r}}function qJ(t){return t.evidence.ranges?t.evidence.ranges.map(e=>({origin:e.iinfo.type,name:e.iinfo.parameterName,value:e.iinfo.parameterValue})):[]}function EJ(t,e){let r={type:t.type,hash:t.hash,evidence:SJ(t.evidence,e),location:{spanId:t.location.spanId}};return t.location.path&&(r.location.path=t.location.path),t.location.line&&(r.location.line=t.location.line),r}function _0(t,e){if(t&&t.length){let r=e;if(!r&&kf&&(r=kf.startSpan("vulnerability",{type:"vulnerability"}),t.forEach(s=>{s.location.spanId=r.context().toSpanId()})),r&&r.addTags){let s={sources:[],vulnerabilities:[]};if(xJ(t).forEach(n=>{if(vJ(n)){let i=[];qJ(n).forEach(a=>{let c=s.sources.findIndex(u=>u.origin===a.origin&&u.name===a.name&&u.value===a.value);c===-1&&(c=s.sources.length,s.sources.push(a)),i.push(c)}),s.vulnerabilities.push(EJ(n,i))}}),s.vulnerabilities.length>0){let n={};n[m0]=JSON.stringify(s),n[hJ]="true",r.addTags(n),e||r.finish()}}}return m0}function b0(){Af.clear()}function TJ(){en=setInterval(b0,mJ),en.unref()}function wJ(){en&&(clearInterval(en),en=null)}function xJ(t){return Rf?t.filter(r=>{let s=`${r.type}${r.hash}`;return Af.get(s)?!1:(Af.set(s,!0),!0)}):t}function IJ(t,e){Rf=t.iast.deduplicationEnabled,Rf&&TJ(),kf=e}function AJ(){wJ()}y0.exports={createVulnerability:_J,addVulnerability:yJ,sendVulnerabilities:_0,clearCache:b0,start:IJ,stop:AJ}});var T0=p((uie,E0)=>{"use strict";var v0=E(),Mr=new Map,S0=1e4,_o=0;function Of(t){let e=0,r=t.length;for(let s=0;s<r;s++)e=(e*31|0)+t.charCodeAt(s)|0;return e}function kJ(t){if(!t)return 0;let e=31,r=t.level?Of(t.level):0;return r=(e*r|0)+(t.message?Of(t.message):0)|0,r=(e*r|0)+(t.stack_trace?Of(t.stack_trace):0)|0,r}function RJ(t,e,r){return{message:t,level:e,tags:r}}function CJ(t){return t&&t.level&&t.message}var q0={add(t){try{if(!CJ(t)){v0.info("IAST log collector discarding invalid log");return}if(Mr.size>=S0){_o++;return}let e=kJ(t);if(!Mr.has(e))return Mr.set(e,t),!0}catch(e){v0.error(`Unable to add log to logCollector: ${e.message}`)}return!1},drain(){if(Mr.size===0)return;let t=[];return t.push(...Mr.values()),_o>0&&t.push(RJ(`Omitted ${_o} entries due to overflowing`,"ERROR")),this.reset(),t},reset(t){Mr.clear(),_o=0,t&&(S0=t)}};q0.reset();E0.exports=q0});var Uf=p((pie,C0)=>{"use strict";var w0=H(),x0=T0(),{sendData:OJ}=Yn(),bo=E(),Pf=w0.channel("datadog:telemetry:start"),Nf=w0.channel("datadog:telemetry:stop"),Lr,Mf,Lf,Df;function PJ(t){t&&I0(t.level)&&x0.add(t)}function NJ(){try{let t=x0.drain();t&&OJ(Lr,Mf,Lf,"logs",t)}catch(t){bo.error(t)}}function I0(t){return jf(Lr)&&(t!=="DEBUG"||Lr.telemetry.debug)}function jf(t){return t&&t.telemetry&&t.telemetry.logCollection}function A0(t){return!t||!jf(t.config)?(bo.info("IAST telemetry logs start received but log collection is not enabled or configuration is incorrect"),!1):(bo.info("IAST telemetry logs starting"),Lr=t.config,Mf=t.application,Lf=t.host,t.heartbeatInterval&&(Df=setInterval(NJ,t.heartbeatInterval),Df.unref()),!0)}function k0(){R0()}function DJ(){Pf.subscribe(A0),Nf.subscribe(k0)}function R0(){jf(Lr)&&(bo.info("IAST telemetry logs stopping"),Lr=null,Mf=null,Lf=null,Pf.hasSubscribers&&Pf.unsubscribe(A0),Nf.hasSubscribers&&Nf.unsubscribe(k0),clearInterval(Df))}C0.exports={start:DJ,stop:R0,publish:PJ,isLevelEnabled:I0}});var rn=p((lie,N0)=>{"use strict";var tn=E(),O0=Uf(),{calculateDDBasePath:MJ}=te(),Hf=MJ(__dirname),P0=`
`,LJ=/^\s*at\s/gm;function jJ(t,e){if(!e)return t;let r=e.split(P0),s=r.findIndex(i=>i.match(LJ)),n=s>-1&&r[s].includes(Hf);return r=r.filter((i,o)=>n&&o<s||i.includes(Hf)).map(i=>i.replace(Hf,"")),t.stack_trace=r.join(P0),n||(t.message="omitted"),t}function UJ(t,e){try{t=typeof t=="function"?t():t;let r;typeof t!="object"||!t?r=String(t):r=String(t.message||t);let s={message:r,level:e};return t.stack&&(s=jJ(s,t.stack),s.stack_trace==="")?void 0:s}catch(r){tn.error(r)}}var HJ={debug(t){return tn.debug(t),this},info(t){return tn.info(t),this},warn(t){return tn.warn(t),this},error(t){return tn.error(t),this},publish(t,e){if(O0.isLevelEnabled(e)){let r=UJ(t,e);O0.publish(r)}return this},debugAndPublish(t){return this.debug(t),this.publish(t,"DEBUG")},infoAndPublish(t){return this.info(t),this.publish(t,"DEBUG")},warnAndPublish(t){return this.warn(t),this.publish(t,"WARN")},errorAndPublish(t){return this.error(t),this.publish(t,"ERROR")}};N0.exports=HJ});var B0=p((die,H0)=>{"use strict";var Bf=require("path"),BJ=require("process"),{calculateDDBasePath:D0}=te(),j0={getFirstNonDDPathAndLine:FJ,getFirstNonDDPathAndLineFromCallsites:U0,calculateDDBasePath:D0,ddBasePath:D0(__dirname)},M0=[Bf.join(Bf.sep,"node_modules","diagnostics_channel")],L0=["node:diagnostics_channel","diagnostics_channel","node:child_process","child_process","node:async_hooks","async_hooks"];function $J(){let t=Error.prepareStackTrace,e=Error.stackTraceLimit,r;return Error.stackTraceLimit=100,Error.prepareStackTrace=function(n,i){r=i},new Error().stack,Error.prepareStackTrace=t,Error.stackTraceLimit=e,r}function U0(t){if(t)for(let e=0;e<t.length;e++){let r=t[e],s=r.getFileName();if(!GJ(r)&&s.indexOf(j0.ddBasePath)===-1)return{path:Bf.relative(BJ.cwd(),s),line:r.getLineNumber()}}return null}function GJ(t){if(t.isNative())return!0;let e=t.getFileName();if(!e)return!0;for(let r=0;r<M0.length;r++)if(e.indexOf(M0[r])>-1)return!0;for(let r=0;r<L0.length;r++)if(e.indexOf(L0[r])===0)return!0;return!1}function FJ(){return U0($J())}H0.exports=j0});var Vt=p((hie,$0)=>{var De=Symbol("_dd.iast.context"),zJ=Symbol("_dd.iast.transactionId");function WJ(t,e){let r=t&&t[De];return r||(r=e&&e[De]),r}function VJ(t,e,r){if(t&&e)return t[De]=r,e[De]=r,t[De]}function KJ(t,e,r){return t&&(r||(r=t[De]),t[De]=null),e&&(r||(r=e[De]),e[De]=null),r?(Object.keys(r).forEach(s=>delete r[s]),!0):!1}$0.exports={getIastContext:WJ,saveIastContext:VJ,cleanIastContext:KJ,IAST_CONTEXT_KEY:De,IAST_TRANSACTION_ID:zJ}});var Ff=p((fie,z0)=>{"use strict";var vo="oce",yo="REPORT_VULNERABILITY",G0={},Kt,Et={},sn=0,$f={REPORT_VULNERABILITY:{hasQuota:t=>{let e=t&&t.tokens&&t.tokens[yo]>0;return e&&t.tokens[yo]--,e},name:yo,initialTokenBucketSize(){return typeof Et.maxContextOperations=="number"?Et.maxContextOperations:2},initContext:function(t){t.tokens[yo]=this.initialTokenBucketSize()}}};function F0(){let t={tokens:{}};for(let e in $f)$f[e].initContext(t);return t}function YJ(t){return t&&t[vo]?t[vo]:G0}function Gf(){Object.assign(G0,F0())}function JJ(t){if(sn>0){let e=Et&&typeof Et.requestSampling=="number"?Et.requestSampling:30;if(t.context().toSpanId().slice(-2)<=e)return sn--,!0}return!1}function XJ(){sn<Et.maxConcurrentRequests&&sn++}function QJ(t,e){let r=YJ(e);return t.hasQuota(r)}function ZJ(t){t&&(t[vo]=F0())}function eX(t){Et=t,sn=Et.maxConcurrentRequests}function tX(){Kt||(Gf(),Kt=setInterval(()=>{Gf()},6e4),Kt.unref&&Kt.unref())}function rX(){Kt&&(clearInterval(Kt),Kt=null)}z0.exports={OVERHEAD_CONTROLLER_CONTEXT_KEY:vo,OPERATIONS:$f,startGlobalContext:tX,finishGlobalContext:rX,_resetGlobalContext:Gf,initializeRequestContext:ZJ,hasQuota:QJ,acquireRequest:JJ,releaseRequest:XJ,configure:eX}});var So=p((gie,Y0)=>{"use strict";var sX=N(),{storage:W0}=I(),nX=rn(),{getFirstNonDDPathAndLine:iX}=B0(),{createVulnerability:oX,addVulnerability:aX}=Cf(),{getIastContext:V0}=Vt(),K0=Ff(),zf=class extends sX{constructor(e){super(),this._type=e}_wrapHandler(e){return(r,s)=>{try{e(r,s)}catch(n){nX.errorAndPublish(n)}}}addSub(e,r){super.addSub(e,this._wrapHandler(r))}_isVulnerable(e,r){return!1}_isExcluded(e){return!1}_report(e,r){let s=this._getEvidence(e,r),n=this._getLocation();if(!this._isExcluded(n)){let i=r&&r.rootSpan&&r.rootSpan.context().toSpanId(),o=oX(this._type,s,i,n);aX(r,o)}}_reportIfVulnerable(e,r){return this._isVulnerable(e,r)&&this._checkOCE(r)?(this._report(e,r),!0):!1}_getEvidence(e){return{value:e}}_getLocation(){return iX()}analyze(e){let r=W0.getStore(),s=V0(r);r&&!s||this._reportIfVulnerable(e,s)}analyzeAll(...e){let r=W0.getStore(),s=V0(r);if(!(r&&!s))for(let n=0;n<e.length;n++){let i=e[n];if(this._isVulnerable(i,s)){this._checkOCE(s)&&this._report(i,s);break}}}_checkOCE(e){return K0.hasQuota(K0.OPERATIONS.REPORT_VULNERABILITY,e)}};Y0.exports=zf});var X0=p((mie,J0)=>{"use strict";var cX=So(),uX=new Set(["des","des-cbc","des-cfb","des-cfb1","des-cfb8","des-ecb","des-ede","des-ede-cbc","des-ede-cfb","des-ede-ecb","des-ede-ofb","des-ede3","des-ede3-cbc","des-ede3-cfb","des-ede3-cfb1","des-ede3-cfb8","des-ede3-ecb","des-ede3-ofb","des-ofb","des3","des3-wrap","rc2","rc2-128","rc2-40","rc2-40-cbc","rc2-64","rc2-64-cbc","rc2-cbc","rc2-cfb","rc2-ecb","rc2-ofb","blowfish","rc4","rc4-40","rc4-hmac-md5"].map(t=>t.toLowerCase())),Wf=class extends cX{constructor(){super("WEAK_CIPHER"),this.addSub("datadog:crypto:cipher:start",({algorithm:e})=>this.analyze(e))}_isVulnerable(e){return e&&typeof e=="string"?uX.has(e.toLowerCase()):!1}};J0.exports=new Wf});var Z0=p((_ie,Q0)=>{"use strict";var pX=So(),lX=new Set(["md4","md4WithRSAEncryption","RSA-MD4","RSA-MD5","md5","md5-sha1","ssl3-md5","md5WithRSAEncryption","RSA-SHA1","RSA-SHA1-2","sha1","md5-sha1","sha1WithRSAEncryption","ssl3-sha1"].map(t=>t.toLowerCase())),Vf=class extends pX{constructor(){super("WEAK_HASH"),this.addSub("datadog:crypto:hashing:start",({algorithm:e})=>this.analyze(e))}_isVulnerable(e){return typeof e=="string"?lX.has(e.toLowerCase()):!1}};Q0.exports=new Vf});var aO=p((bie,oO)=>{"use strict";var Kf=require("@datadog/native-iast-taint-tracking"),{storage:dX}=I(),eO=Vt(),rO=rn();function Tt(t){return t}var sO={plusOperator:Tt,trim:Tt,trimEnd:Tt,concat:Tt,substring:Tt,substr:Tt,slice:Tt,replace:Tt};function nO(){let t=dX.getStore(),e=eO.getIastContext(t);return e&&e[eO.IAST_TRANSACTION_ID]}function hX(t,e){return function(s,n,i,...o){try{if(e(s,n,i))return s;let a=nO();if(a)return t(a,s,i,...o)}catch(a){rO.error(`Error invoking CSI ${i}`).errorAndPublish(a)}return s}}function jr(){return Array.prototype.some.call(arguments,t=>typeof t!="string")}function fX(t,e){return e.some(r=>t===r)}function iO(t,...e){let r;if(!e||e.length===0)r=(s,n,i)=>jr(s,i);else if(e.length===1){let s=e[0];r=(n,i,o)=>jr(n,o)||i!==s}else r=(s,n,i)=>jr(s,i)||!fX(n,e);return hX(t,r)}function gX(t,e){let r={};return t.forEach(s=>{e.indexOf(s)===-1&&(r[s]=iO((n,i,o,...a)=>Kf[s](n,i,o,...a),String.prototype[s]))}),r}var tO={plusOperator:function(t,e,r){try{if(jr(t)||jr(e)&&jr(r))return t;let s=nO();if(s)return Kf.concat(s,t,e,r)}catch(s){rO.error("Error invoking CSI plusOperator").errorAndPublish(s)}return t},trim:iO((t,e,r)=>Kf.trim(t,e,r),String.prototype.trim,String.prototype.trimStart)},mX={...gX(Object.keys(sO),Object.keys(tO)),...tO};oO.exports={TaintTracking:mX,TaintTrackingDummy:sO}});var qo=p((yie,cO)=>{"use strict";var Yt=require("@datadog/native-iast-taint-tracking"),{IAST_TRANSACTION_ID:ee}=Vt(),_X=rn(),{TaintTracking:bX,TaintTrackingDummy:yX}=aO();function vX(t,e){t&&e&&(e[ee]=Yt.createTransaction(t))}function SX(t){if(t&&t[ee]){let e=t[ee];Yt.removeTransaction(e),delete t[ee]}}function qX(t,e,r,s){let n=e;if(t&&t[ee]){let i=t[ee];n=Yt.newTaintedString(i,e,r,s)}else n=e;return n}function EX(t,e,r){let s=e;if(t&&t[ee]){let n=t[ee],i=[{parent:null,property:null,value:e}],o=new WeakSet;for(;i.length>0;){let{parent:a,property:c,value:u}=i.pop();if(u!==null)try{if(typeof u=="string"){let l=Yt.newTaintedString(n,u,c,r);a?a[c]=l:s=l}else if(typeof u=="object"&&!o.has(u)){o.add(u);let l=Object.keys(u);for(let d=0;d<l.length;d++){let h=l[d];i.push({parent:u,property:c?`${c}.${h}`:h,value:u[h]})}}}catch(l){_X.error(`Error visiting property : ${c}`).errorAndPublish(l)}}}return s}function TX(t,e){let r=!1;if(t&&t[ee]){let s=t[ee];r=Yt.isTainted(s,e)}else r=!1;return r}function wX(t,e){let r=[];if(t&&t[ee]){let s=t[ee];r=Yt.getRanges(s,e)}else r=[];return r}function xX(){global._ddiast=bX}function IX(){global._ddiast=yX}function AX(t){t&&Yt.setMaxTransactions(t)}cO.exports={createTransaction:vX,removeTransaction:SX,newTaintedString:qX,taintObject:EX,isTainted:TX,getRanges:wX,enableTaintOperations:xX,disableTaintOperations:IX,setMaxTransactions:AX,IAST_TRANSACTION_ID:ee}});var nn=p((vie,uO)=>{"use strict";var kX=So(),{isTainted:RX,getRanges:CX}=qo(),Yf=class extends kX{_isVulnerable(e,r){return e?RX(r,e):!1}_getEvidence(e,r){let s=CX(r,e);return{value:e,ranges:s}}};uO.exports=Yf});var lO=p((Sie,pO)=>{"use strict";var OX=nn(),Jf=class extends OX{constructor(){super("SQL_INJECTION"),this.addSub("apm:mysql:query:start",({sql:e})=>this.analyze(e)),this.addSub("apm:mysql2:query:start",({sql:e})=>this.analyze(e)),this.addSub("apm:pg:query:start",({query:e})=>this.analyze(e.text))}};pO.exports=new Jf});var fO=p((qie,hO)=>{"use strict";var dO=require("path"),{getIastContext:PX}=Vt(),{storage:NX}=I(),DX=nn(),Xf=class extends DX{constructor(){super("PATH_TRAVERSAL"),this.addSub("apm:fs:operation:start",e=>{let r=[];e.dest&&r.push(e.dest),e.existingPath&&r.push(e.existingPath),e.file&&r.push(e.file),e.newPath&&r.push(e.newPath),e.oldPath&&r.push(e.oldPath),e.path&&r.push(e.path),e.prefix&&r.push(e.prefix),e.src&&r.push(e.src),e.target&&r.push(e.target),this.analyze(r)}),this.exclusionList=[dO.join("node_modules","send")+dO.sep]}_isExcluded(e){let r=!1;return e&&e.path&&(r=this.exclusionList.some(s=>e.path.includes(s))),r}analyze(e){let r=PX(NX.getStore());if(r&&e&&e.constructor===Array){for(let s of e)if(this._isVulnerable(s,r)){this._report(s,r);break}}}};hO.exports=new Xf});var mO=p((Eie,gO)=>{"use strict";var MX=nn(),Qf=class extends MX{constructor(){super("COMMAND_INJECTION"),this.addSub("datadog:child_process:execution:start",({command:e})=>this.analyze(e))}};gO.exports=new Qf});var bO=p((Tie,_O)=>{"use strict";var LX=nn(),Zf=class extends LX{constructor(){super("LDAP_INJECTION"),this.addSub("datadog:ldapjs:client:search",({base:e,filter:r})=>this.analyzeAll(e,r))}};_O.exports=new Zf});var vO=p((wie,yO)=>{"use strict";yO.exports={WEAK_CIPHER_ANALYZER:X0(),WEAK_HASH_ANALYZER:Z0(),SQL_INJECTION_ANALYZER:lO(),PATH_TRAVERSAL_ANALYZER:fO(),COMMAND_INJECTION_ANALYZER:mO(),LDAP_ANALYZER:bO()}});var qO=p((xie,SO)=>{"use strict";var Eo=vO();function jX(){for(let t in Eo)Eo[t].configure(!0)}function UX(){for(let t in Eo)Eo[t].configure(!1)}SO.exports={enableAllAnalyzers:jX,disableAllAnalyzers:UX}});var TO=p((Iie,EO)=>{"use strict";var HX="node_modules",BX=function(t){return t&&t.indexOf(HX)===-1},$X=function(t){return t&&t.indexOf("dd-trace-js")===-1&&t.indexOf("dd-trace")===-1};EO.exports={isPrivateModule:BX,isNotLibraryFile:$X}});var xO=p((Aie,wO)=>{"use strict";var GX=[{src:"plusOperator",operator:!0},{src:"trim"},{src:"trimStart",dst:"trim"},{src:"trimEnd"},{src:"concat"},{src:"substring"},{src:"substr"},{src:"slice"},{src:"replace"}];wO.exports={csiMethods:GX}});var CO=p((kie,RO)=>{"use strict";var IO=require("module"),AO=b(),kO=rn(),{isPrivateModule:FX,isNotLibraryFile:zX}=TO(),{csiMethods:WX}=xO(),To,eg;function VX(){if(!To)try{let t=require("@datadog/native-iast-rewriter"),e=t.Rewriter;eg=t.getPrepareStackTrace,To=new e({csiMethods:WX})}catch(t){kO.error("Unable to initialize TaintTracking Rewriter").errorAndPublish(t)}return To}var tg=Error.prepareStackTrace;function KX(){let t=eg(tg);return{get(){return t},set(e){t=eg(e),tg=e}}}function YX(t){return function(e,r){try{if(FX(r)&&zX(r)){let s=To.rewrite(e,r);if(s&&s.content)return t.apply(this,[s.content,r])}}catch(s){kO.error(`Error rewriting ${r}`).errorAndPublish(s)}return t.apply(this,[e,r])}}function JX(){VX()&&(Object.defineProperty(global.Error,"prepareStackTrace",KX()),AO.wrap(IO.prototype,"_compile",e=>YX(e)))}function XX(){AO.unwrap(IO.prototype,"_compile"),Error.prepareStackTrace=tg}RO.exports={enableRewriter:JX,disableRewriter:XX}});var PO=p((Rie,OO)=>{"use strict";OO.exports={HTTP_REQUEST_BODY:"http.request.body",HTTP_REQUEST_PARAMETER:"http.request.parameter"}});var MO=p((Cie,DO)=>{"use strict";var QX=N(),{getIastContext:ZX}=Vt(),{storage:e7}=I(),{HTTP_REQUEST_PARAMETER:t7,HTTP_REQUEST_BODY:r7}=PO(),{taintObject:NO}=qo(),rg=class extends QX{constructor(){super(),this._type="taint-tracking",this.addSub("datadog:body-parser:read:finish",({request:e})=>this._taintTrackingHandler(r7,e,"body")),this.addSub("datadog:qs:parse:finish",({qs:e})=>this._taintTrackingHandler(t7,e))}_taintTrackingHandler(e,r,s){let n=ZX(e7.getStore());s?r[s]=NO(n,r[s],e):r=NO(n,r,e)}enable(){this.configure(!0)}disable(){this.configure(!1)}};DO.exports=new rg});var HO=p((Oie,UO)=>{"use strict";var{enableRewriter:s7,disableRewriter:n7}=CO(),{createTransaction:i7,removeTransaction:o7,setMaxTransactions:LO,enableTaintOperations:a7,disableTaintOperations:c7}=qo(),jO=MO();UO.exports={enableTaintTracking(t){s7(),a7(),jO.enable(),LO(t.maxConcurrentRequests)},disableTaintTracking(){n7(),c7(),jO.disable()},setMaxTransactions:LO,createTransaction:i7,removeTransaction:o7}});var WO=p((Pie,zO)=>{var og=Cf(),{enableAllAnalyzers:u7,disableAllAnalyzers:p7}=qO(),BO=K(),{storage:$O}=I(),Ur=Ff(),GO=H(),sg=Vt(),{enableTaintTracking:l7,disableTaintTracking:d7,createTransaction:h7,removeTransaction:f7}=HO(),FO=Uf(),g7="_dd.iast.enabled",ng=GO.channel("dd-trace:incomingHttpRequestStart"),ig=GO.channel("dd-trace:incomingHttpRequestEnd");function m7(t,e){u7(),l7(t.iast),ng.subscribe(ag),ig.subscribe(cg),Ur.configure(t.iast),Ur.startGlobalContext(),og.start(t,e),FO.start()}function _7(){p7(),d7(),Ur.finishGlobalContext(),ng.hasSubscribers&&ng.unsubscribe(ag),ig.hasSubscribers&&ig.unsubscribe(cg),og.stop(),FO.stop()}function ag(t){if(t&&t.req){let e=$O.getStore();if(e){let r=BO.getContext(t.req);if(r){let s=r.span,n=Ur.acquireRequest(s);if(n){let i=sg.saveIastContext(e,r,{rootSpan:s,req:t.req});h7(s.context().toSpanId(),i),Ur.initializeRequestContext(i)}s.addTags&&s.addTags({[g7]:n?"1":"0"})}}}}function cg(t){if(t&&t.req){let e=$O.getStore(),r=BO.getContext(t.req),s=sg.getIastContext(e,r);if(s&&s.rootSpan){let n=s.vulnerabilities,i=s.rootSpan;og.sendVulnerabilities(n,i),f7(s)}sg.cleanIastContext(e,r,s)&&Ur.releaseRequest()}}zO.exports={enable:m7,disable:_7,onIncomingHttpRequestEnd:cg,onIncomingHttpRequestStart:ag}});var YO=p((Nie,KO)=>{"use strict";var b7=Ko(),y7=Uy(),v7=Wy(),S7=Gr(),VO=E(),{setStartupLogPluginManager:q7}=Vr(),E7=av(),T7=GR(),w7=rf(),x7=$C(),ug=class extends b7{constructor(){super(),this._initialized=!1,this._pluginManager=new T7(this)}init(e){if(this._initialized)return this;this._initialized=!0;try{let r=new v7(e);if(r.remoteConfig.enabled&&!r.isCiVisibility&&w7.enable(r),r.profiling.enabled)try{g0().start(r)}catch(s){VO.error(s)}r.runtimeMetrics&&S7.start(r),r.tracing&&(r.appsec.enabled&&co().enable(r),this._tracer=new y7(r),this.appsec=new x7(this._tracer,r),r.iast.enabled&&WO().enable(r,this._tracer),this._pluginManager.configure(r),q7(this._pluginManager),E7.start(r,this._pluginManager))}catch(r){VO.error(r)}return this}use(){return this._pluginManager.configurePlugin(...arguments),this}};KO.exports=ug});var XO=p((Die,JO)=>{"use strict";var{isFalse:I7}=te(),A7=typeof jest<"u";JO.exports=I7(process.env.DD_TRACE_ENABLED)||A7?Ko():YO()});var ZO=p((Mie,QO)=>{"use strict";if(!global._ddtrace){let t=XO();Object.defineProperty(global,"_ddtrace",{value:new t,enumerable:!1,configurable:!0,writable:!0}),global._ddtrace.default=global._ddtrace,global._ddtrace.tracer=global._ddtrace}QO.exports=global._ddtrace});module.exports=ZO();
