'use strict'

const { port, reqs } = require('./common')
const express = require('../../../versions/express').get()
const cookieParser = require('../../../versions/cookie-parser').get()
// const childProcess = require('child_process')

const app = express()
app.use(cookieParser())

let connectionsMade = 0

// function noop () {}

app.get('/', (req, res) => {
  // childProcess.exec('echo #' + req.query.param, noop)

  const key = '1111111111111111'
  const iv = 'abcdefgh'
  crypto.createCipheriv('des-ede-cbc', key, iv)

  res.writeHead(200)
  res.end('Hello, World!')

  if (++connectionsMade === reqs) {
    server.close()
  }
})

const server = app.listen(port)
